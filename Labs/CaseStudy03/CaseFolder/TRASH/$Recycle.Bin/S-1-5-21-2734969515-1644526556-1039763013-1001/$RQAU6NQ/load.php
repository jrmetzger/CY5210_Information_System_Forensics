mw.loader.implement("Hlsjs",function($){!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Hls=e()}}(function(){var e;return function e(t,r,i){function a(s,o){if(!r[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(n)return n(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var d=r[s]={exports:{}};t[s][0].call(d.exports,function(e){var r=t[s][1][e];return a(r?r:e)},d,d.exports,e,t,r,i)}return r[s].exports}for(var n="function"==typeof require&&require,s=0;s<i.length;s++)a(i[s]);return a}({1:[function(e,t,r){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function a(e){return"function"==typeof e}function n(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!n(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,r,i,n,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var d=new Error('Uncaught, unspecified "error" event. ('+t+")");throw d.context=t,d}if(r=this._events[e],o(r))return!1;if(a(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:n=Array.prototype.slice.call(arguments,1),r.apply(this,n)}else if(s(r))for(n=Array.prototype.slice.call(arguments,1),u=r.slice(),i=u.length,l=0;l<i;l++)u[l].apply(this,n);return!0},i.prototype.addListener=function(e,t){var r;if(!a(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,a(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(r=o(this._maxListeners)?i.defaultMaxListeners:this._maxListeners,r&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,"function"==typeof console.trace)),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){function r(){this.removeListener(e,r),i||(i=!0,t.apply(this,arguments))}if(!a(t))throw TypeError("listener must be a function");var i=!1;return r.listener=t,this.on(e,r),this},i.prototype.removeListener=function(e,t){var r,i,n,o;if(!a(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],n=r.length,i=-1,r===t||a(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(r)){for(o=n;o-->0;)if(r[o]===t||r[o].listener&&r[o].listener===t){i=o;break}if(i<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],a(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?a(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(a(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(t,r,i){!function(t){var a=/^([^#]*)(.*)$/,n=/^([^\?]*)(.*)$/,s=/^(([a-z]+:\/\/)?[^:\/]+(?::[0-9]+)?)?(\/?.*)$/i,o={buildAbsoluteURL:function(e,t){if(t=t.trim(),/^[a-z]+:/i.test(t))return t;var r=null,i=null,l=a.exec(t);l&&(i=l[2],t=l[1]);var u=n.exec(t);u&&(r=u[2],t=u[1]);var d=a.exec(e);d&&(e=d[1]);var f=n.exec(e);f&&(e=f[1]);var h=s.exec(e);if(!h)throw new Error("Error trying to parse base URL.");var c=h[2]||"",g=h[1]||"",v=h[3];0!==v.indexOf("/")&&""!==g&&(v="/"+v);var p=null;return p=/^\/\//.test(t)?c+o.buildAbsolutePath("",t.substring(2)):/^\//.test(t)?g+"/"+o.buildAbsolutePath("",t.substring(1)):o.buildAbsolutePath(g+v,t),r&&(p+=r),i&&(p+=i),p},buildAbsolutePath:function(e,t){for(var r,i,a=t,n="",s=e.replace(/[^\/]*$/,a.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),o=0;i=s.indexOf("/../",o),i>-1;o=i+r)r=/^\/(?:\.\.\/)*/.exec(s.slice(i))[0].length,n=(n+s.substring(o,i)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(r-1)/3+"}$"),"/");return n+s.substr(o)}};"object"==typeof i&&"object"==typeof r?r.exports=o:"function"==typeof e&&e.amd?e([],function(){return o}):"object"==typeof i?i.URLToolkit=o:t.URLToolkit=o}(this)},{}],3:[function(e,t,r){var i=arguments[3],a=arguments[4],n=arguments[5],s=JSON.stringify;t.exports=function(e,t){function r(e){p[e]=!0;for(var t in a[e][1]){var i=a[e][1][t];p[i]||r(i)}}for(var o,l=Object.keys(n),u=0,d=l.length;u<d;u++){var f=l[u],h=n[f].exports;if(h===e||h&&h.default===e){o=f;break}}if(!o){o=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var c={},u=0,d=l.length;u<d;u++){var f=l[u];c[f]=f}a[o]=[Function(["require","module","exports"],"("+e+")(self)"),c]}var g=Math.floor(Math.pow(16,8)*Math.random()).toString(16),v={};v[o]=o,a[g]=[Function(["require"],"var f = require("+s(o)+");(f.default ? f.default : f)(self);"),v];var p={};r(g);var y="("+i+")({"+Object.keys(p).map(function(e){return s(e)+":["+a[e][0]+","+s(a[e][1])+"]"}).join(",")+"},{},["+s(g)+"])",m=window.URL||window.webkitURL||window.mozURL||window.msURL,E=new Blob([y],{type:"text/javascript"});if(t&&t.bare)return E;var b=m.createObjectURL(E),R=new Worker(b);return R.objectURL=b,R}},{}],4:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),h=e(30),c=i(h),g=e(26),v=e(45),p=e(9),y=i(p),m=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.FRAG_LOADING,u.default.FRAG_LOADED,u.default.FRAG_BUFFERED,u.default.ERROR));return r.lastLoadedFragLevel=0,r._autoLevelCapping=-1,r._nextAutoLevel=-1,r.hls=e,r.onCheck=r.abandonRulesCheck.bind(r),r}return s(t,e),o(t,[{key:"destroy",value:function(){this.clearTimer(),f.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){var t=e.frag;if("main"===t.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this.bwEstimator){var r=this.hls,i=e.frag.level,a=r.levels[i].details.live,n=r.config,s=void 0,o=void 0;a?(s=n.abrEwmaFastLive,o=n.abrEwmaSlowLive):(s=n.abrEwmaFastVoD,o=n.abrEwmaSlowVoD),this.bwEstimator=new y.default(r,o,s,n.abrEwmaDefaultEstimate)}this.fragCurrent=t}}},{key:"abandonRulesCheck",value:function(){var e=this.hls,t=e.media,r=this.fragCurrent,i=r.loader,a=this.minAutoLevel;if(!i||i.stats&&i.stats.aborted)return v.logger.warn("frag loader destroy or aborted, disarm abandonRules"),void this.clearTimer();var n=i.stats;if(t&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&r.autoLevel&&r.level){var s=performance.now()-n.trequest,o=Math.abs(t.playbackRate);if(s>500*r.duration/o){var l=e.levels,d=Math.max(1,n.bw?n.bw/8:1e3*n.loaded/s),f=l[r.level],h=f.realBitrate?Math.max(f.realBitrate,f.bitrate):f.bitrate,g=n.total?n.total:Math.max(n.loaded,Math.round(r.duration*h/8)),p=t.currentTime,y=(g-n.loaded)/d,m=(c.default.bufferInfo(t,p,e.config.maxBufferHole).end-p)/o;if(m<2*r.duration/o&&y>m){var E=void 0,b=void 0;for(b=r.level-1;b>a;b--){var R=l[b].realBitrate?Math.max(l[b].realBitrate,l[b].bitrate):l[b].bitrate;if(E=r.duration*R/(6.4*d),E<m)break}E<y&&(v.logger.warn("loading too slow, abort fragment loading and switch to level "+b+":fragLoadedDelay["+b+"]<fragLoadedDelay["+(r.level-1)+"];bufferStarvationDelay:"+E.toFixed(1)+"<"+y.toFixed(1)+":"+m.toFixed(1)),e.nextLoadLevel=b,this.bwEstimator.sample(s,n.loaded),i.abort(),this.clearTimer(),e.trigger(u.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,stats:n}))}}}}},{key:"onFragLoaded",value:function(e){var t=e.frag;if("main"===t.type){this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1;var r=this.hls.levels[t.level],i=(r.loaded?r.loaded.bytes:0)+e.stats.loaded,a=(r.loaded?r.loaded.duration:0)+e.frag.duration;if(r.loaded={bytes:i,duration:a},r.realBitrate=Math.round(8*i/a),e.frag.bitrateTest){var n=e.stats;n.tparsed=n.tbuffered=n.tload,this.onFragBuffered(e)}}}},{key:"onFragBuffered",value:function(e){var t=e.stats,r=e.frag;if(t.aborted!==!0&&1===r.loadCounter&&"main"===r.type&&(!r.bitrateTest||t.tload===t.tbuffered)){var i=t.tparsed-t.trequest;v.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this.bwEstimator.sample(i,t.loaded),r.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0}}},{key:"onError",value:function(e){switch(e.details){case g.ErrorDetails.FRAG_LOAD_ERROR:case g.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"findBestLevel",value:function(e,t,r,i,a,n,s,o,l){for(var u=a;u>=i;u--){var d=l[u],f=d.details,h=f?f.totalduration/f.fragments.length:t,c=!!f&&f.live,g=void 0;g=u<=e?s*r:o*r;var p=l[u].realBitrate?Math.max(l[u].realBitrate,l[u].bitrate):l[u].bitrate,y=p*h/g;if(v.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(g)+"/"+p+"/"+h+"/"+n+"/"+y),g>p&&(!y||c||y<n))return u}return-1}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping=e}},{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this.bwEstimator,r=this.hls,i=r.levels,a=r.config.minAutoBitrate;if(!(e===-1||t&&t.canEstimate()))return Math.min(e,this.maxAutoLevel);var n=this.nextABRAutoLevel;if(e!==-1&&(n=Math.min(e,n)),void 0!==a)for(var s=i[n].realBitrate?Math.max(i[n].realBitrate,i[n].bitrate):i[n].bitrate;s<a;)n++;return n},set:function(e){this._nextAutoLevel=e}},{key:"minAutoLevel",get:function(){for(var e=this.hls,t=e.levels,r=e.config.minAutoBitrate,i=t?t.length:0,a=0;a<i;a++){var n=t[a].realBitrate?Math.max(t[a].realBitrate,t[a].bitrate):t[a].bitrate;if(n>r)return a}return 0}},{key:"maxAutoLevel",get:function(){var e,t=this.hls.levels,r=this._autoLevelCapping;return e=r===-1&&t&&t.length?t.length-1:r}},{key:"nextABRAutoLevel",get:function(){var e=this.hls,t=this.maxAutoLevel,r=e.levels,i=e.config,a=this.minAutoLevel,n=e.media,s=this.lastLoadedFragLevel,o=this.fragCurrent?this.fragCurrent.duration:0,l=n?n.currentTime:0,u=n&&0!==n.playbackRate?Math.abs(n.playbackRate):1,d=this.bwEstimator?this.bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,f=(c.default.bufferInfo(n,l,i.maxBufferHole).end-l)/u,h=this.findBestLevel(s,o,d,a,t,f,i.abrBandWidthFactor,i.abrBandWidthUpFactor,r);if(h>=0)return h;v.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var g=o?Math.min(o,i.maxStarvationDelay):i.maxStarvationDelay,p=i.abrBandWidthFactor,y=i.abrBandWidthUpFactor;if(0===f){var m=this.bitrateTestDelay;if(m){var E=o?Math.min(o,i.maxLoadingDelay):i.maxLoadingDelay;g=E-m,v.logger.trace("bitrate test took "+Math.round(1e3*m)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*g)+" ms"),p=y=1}}return h=this.findBestLevel(s,o,d,a,t,f+g,p,y,r),Math.max(h,0)}}]),t}(f.default);r.default=m},{26:26,27:27,28:28,30:30,45:45,9:9}],5:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),u=e(41),d=i(u),f=e(30),h=i(f),c=e(22),g=i(c),v=e(28),p=i(v),y=e(27),m=i(y),E=e(31),b=i(E),R=e(46),_=i(R),T=e(26),k=e(45),A={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},S=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,p.default.MEDIA_ATTACHED,p.default.MEDIA_DETACHING,p.default.AUDIO_TRACKS_UPDATED,p.default.AUDIO_TRACK_SWITCHING,p.default.AUDIO_TRACK_LOADED,p.default.KEY_LOADED,p.default.FRAG_LOADED,p.default.FRAG_PARSING_INIT_SEGMENT,p.default.FRAG_PARSING_DATA,p.default.FRAG_PARSED,p.default.ERROR,p.default.BUFFER_CREATED,p.default.BUFFER_APPENDED,p.default.BUFFER_FLUSHED,p.default.INIT_PTS_FOUND));return r.config=e.config,r.audioCodecSwap=!1,r.ticks=0,r._state=A.STOPPED,r.ontick=r.tick.bind(r),r.initPTS=[],r.waitingFragment=null,r}return s(t,e),l(t,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),m.default.prototype.destroy.call(this),this.state=A.STOPPED}},{key:"onInitPtsFound",value:function(e){var t=e.id,r=e.cc,i=e.initPTS;"main"===t&&(this.initPTS[r]=i,k.logger.log("InitPTS for cc:"+r+" found from video track:"+i),this.state===A.WAITING_INIT_PTS&&(k.logger.log("sending pending audio frag to demuxer"),this.state=A.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null))}},{key:"startLoad",value:function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,t>0&&e===-1?(k.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=A.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=A.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=A.STOPPED}},{key:"stopLoad",value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=A.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var e,t,r,i,a,n,s=this,l=this.hls,u=l.config,f=function(){switch(s.state){case A.ERROR:case A.PAUSED:case A.BUFFER_FLUSHING:break;case A.STARTING:s.state=A.WAITING_TRACK,s.loadedmetadata=!1;break;case A.IDLE:var o=s.tracks;if(!o)break;if(!s.media&&(s.startFragRequested||!u.startFragPrefetch))break;e=s.loadedmetadata?s.media.currentTime:s.nextLoadPosition;var f=s.mediaBuffer?s.mediaBuffer:s.media,c=h.default.bufferInfo(f,e,u.maxBufferHole),g=c.len,v=c.end,y=s.fragPrevious,m=u.maxMaxBufferLength,E=s.audioSwitch,b=s.trackId;if(g<m&&b<o.length){if(r=o[b].details,"undefined"==typeof r){s.state=A.WAITING_TRACK;break}if(!E&&!r.live&&y&&y.sn===r.endSN&&(!s.media.seeking||s.media.duration-v<y.duration/2)){s.hls.trigger(p.default.BUFFER_EOS,{type:"audio"}),s.state=A.ENDED;break}var R=r.fragments,_=R.length,S=R[0].start,L=R[_-1].start+R[_-1].duration,D=void 0;if(E)if(r.live&&!r.PTSKnown)k.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),v=0;else if(v=e,r.PTSKnown&&e<S){if(!(c.end>S||c.nextStart))return{v:void 0};k.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),s.media.currentTime=S+.05}if(v<=S){if(D=R[0],r.live&&D.loadIdx&&D.loadIdx===s.fragLoadIdx){var w=c.nextStart?c.nextStart:S;return k.logger.log("no alt audio available @currentTime:"+s.media.currentTime+", seeking @"+(w+.05)),s.media.currentTime=w+.05,{v:void 0}}}else!function(){var e=void 0,t=u.maxFragLookUpTolerance;v<L?(v>L-t&&(t=0),e=d.default.search(R,function(e){return e.start+e.duration-t<=v?1:e.start-t>v?-1:0}),e||k.logger.log("frag not found @bufferEnd/start:"+v+"/"+S)):e=R[_-1],e&&(D=e,S=e.start,y&&D.level===y.level&&D.sn===y.sn&&(D.sn<r.endSN?(D=R[D.sn+1-r.startSN],k.logger.log("SN just loaded, load next one: "+D.sn)):D=null))}();if(D)if(null!=D.decryptdata.uri&&null==D.decryptdata.key)k.logger.log("Loading key for "+D.sn+" of ["+r.startSN+" ,"+r.endSN+"],track "+b),s.state=A.KEY_LOADING,l.trigger(p.default.KEY_LOADING,{frag:D});else{if(k.logger.log("Loading "+D.sn+" of ["+r.startSN+" ,"+r.endSN+"],track "+b+", currentTime:"+e+",bufferEnd:"+v.toFixed(3)),void 0!==s.fragLoadIdx?s.fragLoadIdx++:s.fragLoadIdx=0,D.loadCounter){D.loadCounter++;var O=u.fragLoadingLoopThreshold;if(D.loadCounter>O&&Math.abs(s.fragLoadIdx-D.loadIdx)<O)return l.trigger(p.default.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:D}),{v:void 0}}else D.loadCounter=1;D.loadIdx=s.fragLoadIdx,s.fragCurrent=D,s.startFragRequested=!0,s.nextLoadPosition=D.start+D.duration,l.trigger(p.default.FRAG_LOADING,{frag:D}),s.state=A.FRAG_LOADING}}break;case A.WAITING_TRACK:t=s.tracks[s.trackId],t&&t.details&&(s.state=A.IDLE);break;case A.FRAG_LOADING_WAITING_RETRY:i=performance.now(),a=s.retryDate,f=s.media,n=f&&f.seeking,(!a||i>=a||n)&&(k.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),s.state=A.IDLE);break;case A.WAITING_INIT_PTS:case A.STOPPED:case A.FRAG_LOADING:case A.PARSING:case A.PARSED:case A.ENDED:}}();if("object"===("undefined"==typeof f?"undefined":o(f)))return f.v}},{key:"onMediaAttached",value:function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var r=this.config;this.tracks&&r.autoStartLoad&&this.startLoad(r.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(k.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.tracks;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){this.state===A.ENDED&&(this.state=A.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}},{key:"onAudioTracksUpdated",value:function(e){k.logger.log("audio tracks updated"),this.tracks=e.audioTracks}},{key:"onAudioTrackSwitching",value:function(e){var t=!!e.url;this.trackId=e.id,this.state=A.IDLE,this.fragCurrent=null,this.state=A.PAUSED,this.waitingFragment=null,t?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=A.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()}},{key:"onAudioTrackLoaded",value:function(e){var t=e.details,r=e.id,i=this.tracks[r],a=t.totalduration,n=0;if(k.logger.log("track "+r+" loaded ["+t.startSN+","+t.endSN+"],duration:"+a),t.live){var s=i.details;s&&t.fragments.length>0?(b.default.mergeDetails(s,t),n=t.fragments[0].start,t.PTSKnown?k.logger.log("live audio playlist sliding:"+n.toFixed(3)):k.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,k.logger.log("live audio playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(i.details=t,!this.startFragRequested){if(this.startPosition===-1){var o=t.startTimeOffset;isNaN(o)?this.startPosition=0:(k.logger.log("start time offset found in playlist, adjust startPosition to "+o),this.startPosition=o)}this.nextLoadPosition=this.startPosition}this.state===A.WAITING_TRACK&&(this.state=A.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===A.KEY_LOADING&&(this.state=A.IDLE,this.tick())}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent;if(this.state===A.FRAG_LOADING&&t&&"audio"===e.frag.type&&e.frag.level===t.level&&e.frag.sn===t.sn){this.state=A.PARSING,this.stats=e.stats;var r=this.tracks[this.trackId],i=r.details,a=i.totalduration,n=t.start,s=t.level,o=t.sn,l=t.cc,u=this.config.defaultAudioCodec||r.audioCodec;this.appended=!1,this.demuxer||(this.demuxer=new g.default(this.hls,"audio"));var d=this.initPTS[l];if(void 0!==d){this.pendingBuffering=!0,k.logger.log("Demuxing "+o+" of ["+i.startSN+" ,"+i.endSN+"],track "+s);var f=!1;this.demuxer.push(e.payload,u,null,n,l,s,o,a,t.decryptdata,f,d)}else k.logger.log("unknown video PTS for continuity counter "+l+", waiting for video PTS before demuxing audio frag "+o+" of ["+i.startSN+" ,"+i.endSN+"],track "+s),this.waitingFragment=e,this.state=A.WAITING_INIT_PTS}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(e){var t=this.fragCurrent;if(t&&"audio"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===A.PARSING){var r=e.tracks,i=void 0;if(r.video&&delete r.video,i=r.audio){i.levelCodec="mp4a.40.2",i.id=e.id,this.hls.trigger(p.default.BUFFER_CODECS,r),k.logger.log("audio track:audio,container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var a=i.initSegment;if(a){var n={type:"audio",data:a,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[n]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(p.default.BUFFER_APPENDING,n))}this.tick()}}}},{key:"onFragParsingData",value:function(e){var t=this,r=this.fragCurrent;r&&"audio"===e.id&&"audio"===e.type&&e.sn===r.sn&&e.level===r.level&&this.state===A.PARSING&&!function(){var r=t.trackId,i=t.tracks[r],a=t.fragCurrent,n=t.hls;k.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),b.default.updateFragPTSDTS(i.details,a.sn,e.startPTS,e.endPTS);var s=t.audioSwitch,o=t.media,l=!1;if(s&&o)if(o.readyState){var u=o.currentTime;k.logger.log("switching audio track : currentTime:"+u),u>=e.startPTS&&(k.logger.log("switching audio track : flushing all audio"),t.state=A.BUFFER_FLUSHING,n.trigger(p.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),l=!0,t.audioSwitch=!1,n.trigger(p.default.AUDIO_TRACK_SWITCHED,{id:r}))}else t.audioSwitch=!1,n.trigger(p.default.AUDIO_TRACK_SWITCHED,{id:r});var d=t.pendingData;t.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&d.push({type:e.type,data:t,parent:"audio",content:"data"})}),!l&&d.length&&(d.forEach(function(e){t.pendingBuffering=!0,t.hls.trigger(p.default.BUFFER_APPENDING,e)}),t.pendingData=[],t.appended=!0)),t.tick()}()}},{key:"onFragParsed",value:function(e){var t=this.fragCurrent;t&&"audio"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===A.PARSING&&(this.stats.tparsed=performance.now(),this.state=A.PARSED,this._checkAppendedParsed())}},{key:"onBufferCreated",value:function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0)}},{key:"onBufferAppended",value:function(e){if("audio"===e.parent){var t=this.state;t!==A.PARSING&&t!==A.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(!(this.state!==A.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,r=this.hls;if(e){this.fragPrevious=e,t.tbuffered=performance.now(),r.trigger(p.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var i=this.mediaBuffer?this.mediaBuffer:this.media;k.logger.log("audio buffered : "+_.default.toString(i.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,r.trigger(p.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=A.IDLE}this.tick()}}},{key:"onError",value:function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case T.ErrorDetails.FRAG_LOAD_ERROR:case T.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!e.fatal){var r=this.fragLoadError;r?r++:r=1;var i=this.config;if(r<=i.fragLoadingMaxRetry){this.fragLoadError=r,t.loadCounter=0;var a=Math.min(Math.pow(2,r-1)*i.fragLoadingRetryDelay,i.fragLoadingMaxRetryTimeout);k.logger.warn("audioStreamController: frag loading failed, retry in "+a+" ms"),this.retryDate=performance.now()+a,this.state=A.FRAG_LOADING_WAITING_RETRY}else k.logger.error("audioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.trigger(p.default.ERROR,e),this.state=A.ERROR}break;case T.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case T.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case T.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case T.ErrorDetails.KEY_LOAD_ERROR:case T.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==A.ERROR&&(this.state=e.fatal?A.ERROR:A.IDLE,k.logger.warn("audioStreamController: "+e.details+" while loading frag,switch to "+this.state+" state ..."))}}},{key:"onBufferFlushed",value:function(){var e=this,t=this.pendingData;t&&t.length?(k.logger.log("appending pending audio data on Buffer Flushed"),t.forEach(function(t){e.hls.trigger(p.default.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=A.PARSED):(this.state=A.IDLE,this.fragPrevious=null,this.tick())}},{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,k.logger.log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}]),t}(m.default);r.default=S},{22:22,26:26,27:27,28:28,30:30,31:31,41:41,45:45,46:46}],6:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),h=e(45),c=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MANIFEST_LOADING,u.default.MANIFEST_LOADED,u.default.AUDIO_TRACK_LOADED));return r.ticks=0,r.ontick=r.tick.bind(r),r}return s(t,e),o(t,[{key:"destroy",value:function(){f.default.prototype.destroy.call(this)}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){this.updateTrack(this.trackId)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(e){var t=this,r=e.audioTracks||[],i=!1;this.tracks=r,this.hls.trigger(u.default.AUDIO_TRACKS_UPDATED,{audioTracks:r});var a=0;r.forEach(function(e){return e.default?(t.audioTrack=a,void(i=!0)):void a++}),i===!1&&r.length&&(h.logger.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)}},{key:"onAudioTrackLoaded",value:function(e){e.id<this.tracks.length&&(h.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*e.details.targetduration)),!e.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setAudioTrackInternal",value:function(e){if(e>=0&&e<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=e,h.logger.log("switching to audioTrack "+e);var t=this.tracks[e],r=this.hls,i=t.type,a=t.url,n={id:e,type:i,url:a};r.trigger(u.default.AUDIO_TRACK_SWITCH,n),r.trigger(u.default.AUDIO_TRACK_SWITCHING,n);var s=t.details;!a||void 0!==s&&s.live!==!0||(h.logger.log("(re)loading playlist for audioTrack "+e),r.trigger(u.default.AUDIO_TRACK_LOADING,{url:a,id:e}))}}},{key:"updateTrack",value:function(e){if(e>=0&&e<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=e,h.logger.log("updating audioTrack "+e);var t=this.tracks[e],r=t.url,i=t.details;!r||void 0!==i&&i.live!==!0||(h.logger.log("(re)loading playlist for audioTrack "+e),this.hls.trigger(u.default.AUDIO_TRACK_LOADING,{url:r,id:e}))}}},{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(e){this.trackId===e&&void 0!==this.tracks[e].details||this.setAudioTrackInternal(e)}}]),t}(f.default);r.default=c},{27:27,28:28,45:45}],7:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),h=e(45),c=e(26),g=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.MANIFEST_PARSED,u.default.BUFFER_RESET,u.default.BUFFER_APPENDING,u.default.BUFFER_CODECS,u.default.BUFFER_EOS,u.default.BUFFER_FLUSHING,u.default.LEVEL_PTS_UPDATED,u.default.LEVEL_UPDATED));return r._msDuration=null,r._levelDuration=null,r.onsbue=r.onSBUpdateEnd.bind(r),r.onsbe=r.onSBUpdateError.bind(r),r.pendingTracks={},r.tracks={},r}return s(t,e),o(t,[{key:"destroy",value:function(){f.default.prototype.destroy.call(this)}},{key:"onLevelPtsUpdated",value:function(e){var t=e.type,r=this.tracks.audio;if("audio"===t&&r&&"audio/mpeg"===r.container){var i=this.sourceBuffer.audio,a=Math.abs(i.timestampOffset-e.start);if(a>.1){var n=i.updating;try{i.abort()}catch(e){n=!0,h.logger.warn("can not abort audio buffer: "+e)}n?this.audioTimestampOffset=e.start:(h.logger.warn("change mpeg audio timestamp offset from "+i.timestampOffset+" to "+e.start),i.timestampOffset=e.start)}}}},{key:"onManifestParsed",value:function(e){var t=e.audio,r=e.video,i=0;e.altAudio&&(t||r)&&(i=(t?1:0)+(r?1:0),h.logger.log(i+" sourceBuffer(s) expected")),this.sourceBufferNb=i}},{key:"onMediaAttaching",value:function(e){var t=this.media=e.media;if(t){var r=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),r.addEventListener("sourceopen",this.onmso),r.addEventListener("sourceended",this.onmse),r.addEventListener("sourceclose",this.onmsc),t.src=URL.createObjectURL(r)}}},{key:"onMediaDetaching",value:function(){h.logger.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){h.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this.media.src),this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(u.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){h.logger.log("media source opened"),this.hls.trigger(u.default.MEDIA_ATTACHED,{media:this.media});var e=this.mediaSource;e&&e.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function(){var e=this.pendingTracks,t=Object.keys(e).length;t&&(this.sourceBufferNb<=t||0===this.sourceBufferNb)&&(this.createSourceBuffers(e),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function(){h.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){h.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){if(this.audioTimestampOffset){var e=this.sourceBuffer.audio;h.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+this.audioTimestampOffset),e.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var t=this.parent,r=this.segments.reduce(function(e,r){return r.parent===t?e+1:e},0);this.hls.trigger(u.default.BUFFER_APPENDED,{parent:t,pending:r}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function(e){h.logger.error("sourceBuffer error:"+e),this.hls.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var e=this.sourceBuffer;for(var t in e){var r=e[t];try{this.mediaSource.removeSourceBuffer(r),r.removeEventListener("updateend",this.onsbue),r.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}},{key:"onBufferCodecs",value:function(e){if(0===Object.keys(this.sourceBuffer).length){for(var t in e)this.pendingTracks[t]=e[t];var r=this.mediaSource;r&&"open"===r.readyState&&this.checkPendingTracks()}}},{key:"createSourceBuffers",value:function(e){var t=this.sourceBuffer,r=this.mediaSource;for(var i in e)if(!t[i]){var a=e[i],n=a.levelCodec||a.codec,s=a.container+";codecs="+n;h.logger.log("creating sourceBuffer("+s+")");try{var o=t[i]=r.addSourceBuffer(s);o.addEventListener("updateend",this.onsbue),o.addEventListener("error",this.onsbe),this.tracks[i]={codec:n,container:a.container},a.buffer=o}catch(e){h.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:s})}}this.hls.trigger(u.default.BUFFER_CREATED,{tracks:e})}},{key:"onBufferAppending",value:function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())}},{key:"onBufferAppendFail",value:function(e){h.logger.error("sourceBuffer error:",e.event),this.hls.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1,frag:this.fragCurrent})}},{key:"onBufferEos",value:function(e){var t=this.sourceBuffer,r=e.type;for(var i in t)r&&i!==r||t[i].ended||(t[i].ended=!0,h.logger.log(i+" sourceBuffer now EOS"));this.checkEos()}},{key:"checkEos",value:function(){var e=this.sourceBuffer,t=this.mediaSource;if(!t||"open"!==t.readyState)return void(this._needsEos=!1);for(var r in e){var i=e[r];if(!i.ended)return;if(i.updating)return void(this._needsEos=!0)}h.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){h.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}},{key:"onBufferFlushing",value:function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function(e){var t=e.details;0!==t.fragments.length&&(this._levelDuration=t.totalduration+t.fragments[0].start,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function(){var e=this.media,t=this.mediaSource,r=this.sourceBuffer,i=this._levelDuration;if(null!==i&&e&&t&&r&&0!==e.readyState&&"open"===t.readyState){for(var a in r)if(r[a].updating)return;null===this._msDuration&&(this._msDuration=t.duration);var n=e.duration;(i>this._msDuration&&i>n||n===1/0||isNaN(n))&&(h.logger.log("Updating mediasource duration to "+i.toFixed(3)),this._msDuration=t.duration=i)}}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,r=this.sourceBuffer;try{for(var i in r)t+=r[i].buffered.length}catch(e){h.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(u.default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var e=this.hls,t=this.sourceBuffer,r=this.segments;if(Object.keys(t).length){if(this.media.error)return this.segments=[],void h.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(r&&r.length){var i=r.shift();try{var a=i.type,n=t[a];n?n.updating?r.unshift(i):(n.ended=!1,this.parent=i.parent,n.appendBuffer(i.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(t){h.logger.error("error while trying to append buffer:"+t.message),r.unshift(i);var s={type:c.ErrorTypes.MEDIA_ERROR};if(22===t.code)return this.segments=[],s.details=c.ErrorDetails.BUFFER_FULL_ERROR,s.fatal=!1,void e.trigger(u.default.ERROR,s);if(this.appendError?this.appendError++:this.appendError=1,s.details=c.ErrorDetails.BUFFER_APPEND_ERROR,s.frag=this.fragCurrent,this.appendError>e.config.appendErrorMaxRetry)return h.logger.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),r=[],s.fatal=!0,void e.trigger(u.default.ERROR,s);s.fatal=!1,e.trigger(u.default.ERROR,s)}}}}},{key:"flushBuffer",value:function(e,t,r){var i,a,n,s,o,l,u=this.sourceBuffer;if(Object.keys(u).length){if(h.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+e+"/"+t),this.flushBufferCounter<this.appended){for(var d in u)if(!r||d===r){if(i=u[d],i.ended=!1,i.updating)return h.logger.warn("cannot flush, sb updating in progress"),!1;try{for(a=0;a<i.buffered.length;a++)if(n=i.buffered.start(a),s=i.buffered.end(a),navigator.userAgent.toLowerCase().indexOf("firefox")!==-1&&t===Number.POSITIVE_INFINITY?(o=e,l=t):(o=Math.max(n,e),l=Math.min(s,t)),Math.min(l,s)-o>.5)return this.flushBufferCounter++,h.logger.log("flush "+d+" ["+o+","+l+"], of ["+n+","+s+"], pos:"+this.media.currentTime),i.remove(o,l),!1}catch(e){h.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else h.logger.warn("abort flushing too many retries");h.logger.log("buffer flushed")}return!0}}]),t}(f.default);r.default=g},{26:26,27:27,28:28,45:45}],8:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),h=function(e){function t(e){return a(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.FPS_DROP_LEVEL_CAPPING,u.default.MEDIA_ATTACHING,u.default.MANIFEST_PARSED))}return s(t,e),o(t,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onFpsDropLevelCapping",value:function(e){this.restrictedLevels||(this.restrictedLevels=[]),this.isLevelRestricted(e.droppedLevel)||this.restrictedLevels.push(e.droppedLevel)}},{key:"onMediaAttaching",value:function(e){this.media=e.media instanceof HTMLVideoElement?e.media:null}},{key:"onManifestParsed",value:function(e){var t=this.hls;t.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=e.levels,t.firstLevel=this.getMaxLevel(e.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}},{key:"getMaxLevel",value:function(e){var t=0,r=void 0,i=void 0,a=this.mediaWidth,n=this.mediaHeight,s=0,o=0;for(r=0;r<=e&&(i=this.levels[r],!this.isLevelRestricted(r))&&(t=r,s=i.width,o=i.height,!(a<=s||n<=o));r++);return t}},{key:"isLevelRestricted",value:function(e){return!(!this.restrictedLevels||this.restrictedLevels.indexOf(e)===-1)}},{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}},{key:"mediaWidth",get:function(){var e=void 0,t=this.media;return t&&(e=t.width||t.clientWidth||t.offsetWidth,e*=this.contentScaleFactor),e}},{key:"mediaHeight",get:function(){var e=void 0,t=this.media;return t&&(e=t.height||t.clientHeight||t.offsetHeight,e*=this.contentScaleFactor),e}}]),t}(f.default);r.default=h},{27:27,28:28}],9:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(44),o=i(s),l=function(){function e(t,r,i,n){a(this,e),this.hls=t,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new o.default(r),this.fast_=new o.default(i)}return n(e,[{key:"sample",value:function(e,t){e=Math.max(e,this.minDelayMs_);var r=8e3*t/e,i=e/1e3;this.fast_.sample(i,r),this.slow_.sample(i,r)}},{key:"canEstimate",value:function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"destroy",value:function(){}}]),e}();r.default=l},{44:44}],10:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),h=e(45),c=function(e){function t(e){return a(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHING))}return s(t,e),o(t,[{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1}},{key:"onMediaAttaching",value:function(e){var t=this.hls.config;if(t.capLevelOnFPSDrop){var r=this.video=e.media instanceof HTMLVideoElement?e.media:null;"function"==typeof r.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod)}}},{key:"checkFPS",value:function(e,t,r){var i=performance.now();if(t){if(this.lastTime){var a=i-this.lastTime,n=r-this.lastDroppedFrames,s=t-this.lastDecodedFrames,o=1e3*n/a,l=this.hls;if(l.trigger(u.default.FPS_DROP,{currentDropped:n,currentDecoded:s,totalDroppedFrames:r}),o>0&&n>l.config.fpsDroppedMonitoringThreshold*s){var d=l.currentLevel;h.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(l.autoLevelCapping===-1||l.autoLevelCapping>=d)&&(d-=1,l.trigger(u.default.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:l.currentLevel}),l.autoLevelCapping=d,l.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}},{key:"checkFPSInterval",value:function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}]),t}(f.default);r.default=c},{27:27,28:28,45:45}],11:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),h=e(45),c=e(26),g=e(30),v=i(g),p=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MANIFEST_LOADED,u.default.LEVEL_LOADED,u.default.FRAG_LOADED,u.default.ERROR));return r.ontick=r.tick.bind(r),r._manualLevel=r._autoLevelCapping=-1,r}return s(t,e),o(t,[{key:"destroy",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function(){this.canload=!0;var e=this._levels;e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(e){var t,r=[],i=[],a={},n=!1,s=!1,o=this.hls,l=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),d=function(e,t){return MediaSource.isTypeSupported(e+"/mp4;codecs="+t)};if(e.levels.forEach(function(e){e.videoCodec&&(n=!0),l&&e.audioCodec&&e.audioCodec.indexOf("mp4a.40.34")!==-1&&(e.audioCodec=void 0),(e.audioCodec||e.attrs&&e.attrs.AUDIO)&&(s=!0);var t=a[e.bitrate];void 0===t?(a[e.bitrate]=r.length,e.url=[e.url],e.urlId=0,r.push(e)):r[t].url.push(e.url)}),n&&s?r.forEach(function(e){e.videoCodec&&i.push(e)}):i=r,i=i.filter(function(e){var t=e.audioCodec,r=e.videoCodec;return(!t||d("audio",t))&&(!r||d("video",r))}),i.length){t=i[0].bitrate,i.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=i;for(var f=0;f<i.length;f++)if(i[f].bitrate===t){this._firstLevel=f,h.logger.log("manifest loaded,"+i.length+" level(s) found, first bitrate:"+t);break}o.trigger(u.default.MANIFEST_PARSED,{levels:i,firstLevel:this._firstLevel,stats:e.stats,audio:s,video:n,altAudio:e.audioTracks.length>0})}else o.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:o.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(e){var t=this._levels;if(e>=0&&e<t.length){this.timer&&(clearTimeout(this.timer),this.timer=null),this._level!==e&&(h.logger.log("switching to level "+e),this._level=e,this.hls.trigger(u.default.LEVEL_SWITCH,{level:e}));var r=t[e],i=r.details;if(!i||i.live===!0){var a=r.urlId;this.hls.trigger(u.default.LEVEL_LOADING,{url:r.url[a],level:e,id:a})}}else this.hls.trigger(u.default.ERROR,{type:c.ErrorTypes.OTHER_ERROR,details:c.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(e){if(!e.fatal){var t=e.details,r=this.hls,i=void 0,a=void 0,n=!1,s=r.abrController,o=s.minAutoLevel;switch(t){case c.ErrorDetails.FRAG_LOAD_ERROR:case c.ErrorDetails.FRAG_LOAD_TIMEOUT:case c.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case c.ErrorDetails.KEY_LOAD_ERROR:case c.ErrorDetails.KEY_LOAD_TIMEOUT:i=e.frag.level;break;case c.ErrorDetails.LEVEL_LOAD_ERROR:case c.ErrorDetails.LEVEL_LOAD_TIMEOUT:i=e.context.level,n=!0;break;case c.ErrorDetails.REMUX_ALLOC_ERROR:i=e.level}if(void 0!==i){a=this._levels[i],a.loadError?a.loadError++:a.loadError=1;var l=a.url.length;if(l>1&&a.loadError<l)a.urlId=(a.urlId+1)%l,a.details=void 0,h.logger.warn("level controller,"+t+" for level "+i+": switching to redundant stream id "+a.urlId);else{var d=this._manualLevel===-1&&i;if(d)h.logger.warn("level controller,"+t+": switch-down for next fragment"),s.nextAutoLevel=Math.max(o,i-1);else if(a&&a.details&&a.details.live)h.logger.warn("level controller,"+t+" on live stream, discard"),n&&(this._level=void 0);else if(t===c.ErrorDetails.LEVEL_LOAD_ERROR||t===c.ErrorDetails.LEVEL_LOAD_TIMEOUT){var f=r.media,g=f&&v.default.isBuffered(f,f.currentTime)&&v.default.isBuffered(f,f.currentTime+.5);if(g){var p=r.config.levelLoadingRetryDelay;h.logger.warn("level controller,"+t+", but media buffered, retry in "+p+"ms"),this.timer=setTimeout(this.ontick,p)}else h.logger.error("cannot recover "+t+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),e.fatal=!0,r.trigger(u.default.ERROR,e)}}}}}},{key:"onFragLoaded",value:function(e){var t=e.frag;if(t&&"main"===t.type){var r=this._levels[t.level];r&&(r.loadError=0)}}},{key:"onLevelLoaded",value:function(e){var t=e.level;if(t===this._level){var r=this._levels[t];r.loadError=0;var i=e.details;if(i.live){var a=1e3*(i.averagetargetduration?i.averagetargetduration:i.targetduration),n=r.details;n&&i.endSN===n.endSN&&(a/=2,h.logger.log("same live playlist, reload twice faster")),a-=performance.now()-e.stats.trequest,a=Math.max(1e3,Math.round(a)),h.logger.log("live playlist, reload in "+a+" ms"),this.timer=setTimeout(this.ontick,a)}else this.timer=null}}},{key:"tick",value:function(){var e=this._level;if(void 0!==e&&this.canload){var t=this._levels[e],r=t.urlId;this.hls.trigger(u.default.LEVEL_LOADING,{url:t.url[r],level:e,id:r})}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(e){var t=this._levels;t&&t.length>e&&(this._level===e&&void 0!==t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(e){this._manualLevel=e,void 0===this._startLevel&&(this._startLevel=e),e!==-1&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){e!==-1&&(e=Math.max(e,this.hls.abrController.minAutoLevel)),this._startLevel=e}},{key:"nextLoadLevel",get:function(){return this._manualLevel!==-1?this._manualLevel:this.hls.abrController.nextAutoLevel},set:function(e){this.level=e,this._manualLevel===-1&&(this.hls.abrController.nextAutoLevel=e)}}]),t}(f.default);r.default=p},{26:26,27:27,28:28,30:30,45:45}],12:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(41),u=i(l),d=e(30),f=i(d),h=e(22),c=i(h),g=e(28),v=i(g),p=e(27),y=i(p),m=e(31),E=i(m),b=e(46),R=i(b),_=e(26),T=e(45),k={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},A=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,v.default.MEDIA_ATTACHED,v.default.MEDIA_DETACHING,v.default.MANIFEST_LOADING,v.default.MANIFEST_PARSED,v.default.LEVEL_LOADED,v.default.KEY_LOADED,v.default.FRAG_LOADED,v.default.FRAG_LOAD_EMERGENCY_ABORTED,v.default.FRAG_PARSING_INIT_SEGMENT,v.default.FRAG_PARSING_DATA,v.default.FRAG_PARSED,v.default.ERROR,v.default.AUDIO_TRACK_SWITCHING,v.default.AUDIO_TRACK_SWITCHED,v.default.BUFFER_CREATED,v.default.BUFFER_APPENDED,v.default.BUFFER_FLUSHED));return r.config=e.config,r.audioCodecSwap=!1,r.ticks=0,r._state=k.STOPPED,r.ontick=r.tick.bind(r),r}return s(t,e),o(t,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),y.default.prototype.destroy.call(this),this.state=k.STOPPED}},{key:"startLoad",value:function(e){if(this.levels){var t=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var i=r.startLevel;i===-1&&(i=0,this.bitrateTest=!0),this.level=r.nextLoadLevel=i,this.loadedmetadata=!1}t>0&&e===-1&&(T.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=k.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else T.logger.warn("cannot start loading as manifest not parsed yet"),this.state=k.STOPPED}},{key:"stopLoad",value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=k.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){switch(this.state){case k.ERROR:break;case k.BUFFER_FLUSHING:this.fragLoadError=0;break;case k.IDLE:if(!this._doTickIdle())return;break;case k.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=k.IDLE);break;case k.FRAG_LOADING_WAITING_RETRY:var t=performance.now(),r=this.retryDate;(!r||t>=r||this.media&&this.media.seeking)&&(T.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=k.IDLE);break;case k.ERROR:case k.STOPPED:case k.FRAG_LOADING:case k.PARSING:case k.PARSED:case k.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"_doTickIdle",value:function(){var e=this.hls,t=e.config,r=this.media;if(void 0!==this.levelLastLoaded&&!r&&(this.startFragRequested||!t.startFragPrefetch))return!0;var i=void 0;i=this.loadedmetadata?r.currentTime:this.nextLoadPosition;var a=e.nextLoadLevel,n=this.levels[a],s=n.bitrate,o=void 0;o=s?Math.max(8*t.maxBufferSize/s,t.maxBufferLength):t.maxBufferLength,o=Math.min(o,t.maxMaxBufferLength);var l=f.default.bufferInfo(this.mediaBuffer?this.mediaBuffer:r,i,t.maxBufferHole),u=l.len;if(u>=o)return!0;T.logger.trace("buffer length of "+u.toFixed(3)+" is below max of "+o.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=a;var d=n.details;if("undefined"==typeof d||d.live&&this.levelLastLoaded!==a)return this.state=k.WAITING_LEVEL,!0;var h=this.fragPrevious;if(!d.live&&h&&h.sn===d.endSN&&r.duration-Math.max(l.end,h.start)<=Math.max(.2,h.duration/2)){var c={};return this.altAudio&&(c.type="video"),this.hls.trigger(v.default.BUFFER_EOS,c),this.state=k.ENDED,!0}return this._fetchPayloadOrEos(i,l,d)}},{key:"_fetchPayloadOrEos",value:function(e,t,r){var i=this.fragPrevious,a=this.level,n=r.fragments,s=n.length;if(0===s)return!1;var o=n[0].start,l=n[s-1].start+n[s-1].duration,u=t.end,d=void 0;if(r.live){var f=this.config.initialLiveManifestSize;if(s<f)return T.logger.warn("Can not start playback of a level, reason: not enough fragments "+s+" < "+f),!1;if(d=this._ensureFragmentAtLivePoint(r,u,o,l,i,n,s),null===d)return!1}else u<o&&(d=n[0]);return d||(d=this._findFragment(o,i,s,n,u,l,r)),!d||this._loadFragmentOrKey(d,a,r,e,u)}},{key:"_ensureFragmentAtLivePoint",value:function(e,t,r,i,a,n,s){var o=this.hls.config,l=this.media,u=void 0,d=void 0!==o.liveMaxLatencyDuration?o.liveMaxLatencyDuration:o.liveMaxLatencyDurationCount*e.targetduration;if(t<Math.max(r-o.maxFragLookUpTolerance,i-d)){var f=this.liveSyncPosition=this.computeLivePosition(r,e);T.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+f.toFixed(3)),t=f,l&&l.readyState&&l.duration>f&&(l.currentTime=f)}if(e.PTSKnown&&t>i&&l&&l.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(a){var h=a.sn+1;h>=e.startSN&&h<=e.endSN&&(u=n[h-e.startSN],T.logger.log("live playlist, switching playlist, load frag with next SN: "+u.sn))}u||(u=n[Math.min(s-1,Math.round(s/2))],T.logger.log("live playlist, switching playlist, unknown, load middle frag : "+u.sn))}return u}},{key:"_findFragment",value:function(e,t,r,i,a,n,s){var o=this.hls.config,l=void 0,d=void 0,f=o.maxFragLookUpTolerance;if(a<n?(a>n-f&&(f=0),d=u.default.search(i,function(e){return e.start+e.duration-f<=a?1:e.start-f>a&&e.start?-1:0})):d=i[r-1],d&&(l=d,e=d.start,t&&l.level===t.level&&l.sn===t.sn))if(l.sn<s.endSN){var h=t.deltaPTS,c=l.sn-s.startSN;h&&h>o.maxBufferHole&&t.dropped&&c?(l=i[c-1],T.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),t.loadCounter--):(l=i[c+1],T.logger.log("SN just loaded, load next one: "+l.sn))}else l=null;return l}},{key:"_loadFragmentOrKey",value:function(e,t,r,i,a){var n=this.hls,s=n.config;if(null==e.decryptdata.uri||null!=e.decryptdata.key){if(T.logger.log("Loading "+e.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+t+", currentTime:"+i.toFixed(3)+",bufferEnd:"+a.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,e.loadCounter){e.loadCounter++;var o=s.fragLoadingLoopThreshold;if(e.loadCounter>o&&Math.abs(this.fragLoadIdx-e.loadIdx)<o)return n.trigger(v.default.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:e}),!1}else e.loadCounter=1;return e.loadIdx=this.fragLoadIdx,this.fragCurrent=e,this.startFragRequested=!0,this.nextLoadPosition=e.start+e.duration,e.autoLevel=n.autoLevelEnabled,e.bitrateTest=this.bitrateTest,n.trigger(v.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new c.default(n,"main")),this.state=k.FRAG_LOADING,!0}T.logger.log("Loading key for "+e.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+t),this.state=k.KEY_LOADING,n.trigger(v.default.KEY_LOADING,{frag:e})}},{key:"getBufferRange",value:function(e){return u.default.search(this.bufferRange,function(t){return e<t.start?-1:e>t.end?1:0})}},{key:"followingBufferRange",value:function(e){return e?this.getBufferRange(e.end+.5):null}},{key:"_checkFragmentChanged",value:function(){var e,t,r=this.media;if(r&&r.readyState&&r.seeking===!1&&(t=r.currentTime,t>r.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=t),f.default.isBuffered(r,t)?e=this.getBufferRange(t):f.default.isBuffered(r,t+.1)&&(e=this.getBufferRange(t+.1)),e)){var i=e.frag;i!==this.fragPlaying&&(this.fragPlaying=i,this.hls.trigger(v.default.FRAG_CHANGED,{frag:i}))}}},{key:"immediateLevelSwitch",value:function(){if(T.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t=void 0;e?(t=e.paused,e.pause()):t=!0,this.previouslyPaused=t}var r=this.fragCurrent;r&&r.loader&&r.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"immediateLevelSwitchEnd",value:function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,f.default.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())}},{key:"nextLevelSwitch",value:function(){var e=this.media;if(e&&e.readyState){var t=void 0,r=void 0,i=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,r=this.getBufferRange(e.currentTime),r&&r.start>1&&this.flushMainBuffer(0,r.start-1),e.paused)t=0;else{var a=this.hls.nextLoadLevel,n=this.levels[a],s=this.fragLastKbps;t=s&&this.fragCurrent?this.fragCurrent.duration*n.bitrate/(1e3*s)+1:0}if(i=this.getBufferRange(e.currentTime+t),i&&(i=this.followingBufferRange(i))){var o=this.fragCurrent;o&&o.loader&&o.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(i.start,Number.POSITIVE_INFINITY)}}}},{key:"flushMainBuffer",value:function(e,t){this.state=k.BUFFER_FLUSHING;var r={startOffset:e,endOffset:t};this.altAudio&&(r.type="video"),this.hls.trigger(v.default.BUFFER_FLUSHING,r)}},{key:"onMediaAttached",value:function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var r=this.config;this.levels&&r.autoStartLoad&&this.hls.startLoad(r.startPosition)}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(T.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){var e=this.media,t=e?e.currentTime:void 0,r=this.config;if(T.logger.log("media seeking to "+t.toFixed(3)),this.state===k.FRAG_LOADING){var i=this.mediaBuffer?this.mediaBuffer:e,a=f.default.bufferInfo(i,t,this.config.maxBufferHole),n=this.fragCurrent;if(0===a.len&&n){var s=r.maxFragLookUpTolerance,o=n.start-s,l=n.start+n.duration+s;t<o||t>l?(n.loader&&(T.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),n.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=k.IDLE):T.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===k.ENDED&&(this.state=k.IDLE);e&&(this.lastCurrentTime=t),this.state!==k.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*r.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=t),this.tick()}},{key:"onMediaSeeked",value:function(){T.logger.log("media seeked to "+this.media.currentTime.toFixed(3)),this.tick()}},{key:"onMediaEnded",value:function(){T.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){T.logger.log("trigger BUFFER_RESET"),this.hls.trigger(v.default.BUFFER_RESET),this.bufferRange=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function(e){var t,r=!1,i=!1;e.levels.forEach(function(e){t=e.audioCodec,t&&(t.indexOf("mp4a.40.2")!==-1&&(r=!0),t.indexOf("mp4a.40.5")!==-1&&(i=!0))}),this.audioCodecSwitch=r&&i,this.audioCodecSwitch&&T.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startLevelLoaded=!1,this.startFragRequested=!1;var a=this.config;a.autoStartLoad&&this.hls.startLoad(a.startPosition)}},{key:"onLevelLoaded",value:function(e){var t=e.details,r=e.level,i=this.levels[r],a=t.totalduration,n=0;if(T.logger.log("level "+r+" loaded ["+t.startSN+","+t.endSN+"],duration:"+a),this.levelLastLoaded=r,t.live){var s=i.details;s&&t.fragments.length>0?(E.default.mergeDetails(s,t),n=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(n,s),t.PTSKnown?T.logger.log("live playlist sliding:"+n.toFixed(3)):T.logger.log("live playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,T.logger.log("live playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(i.details=t,this.hls.trigger(v.default.LEVEL_UPDATED,{details:t,level:r}),this.startFragRequested===!1){if(this.startPosition===-1||this.lastCurrentTime===-1){var o=t.startTimeOffset;isNaN(o)?t.live?(this.startPosition=this.computeLivePosition(n,t),T.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(o<0&&(T.logger.log("negative start time offset "+o+", count from end of last fragment"),o=n+a+o),T.logger.log("start time offset found in playlist, adjust startPosition to "+o),this.startPosition=o),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===k.WAITING_LEVEL&&(this.state=k.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===k.KEY_LOADING&&(this.state=k.IDLE,this.tick())}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent,r=e.frag;if(this.state===k.FRAG_LOADING&&t&&"main"===r.type&&r.level===t.level&&r.sn===t.sn){var i=e.stats,a=this.levels[t.level],n=a.details;if(T.logger.log("Loaded  "+t.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+t.level),this.bitrateTest=!1,r.bitrateTest===!0&&this.hls.nextLoadLevel)this.state=k.IDLE,this.startFragRequested=!1,i.tparsed=i.tbuffered=performance.now(),this.hls.trigger(v.default.FRAG_BUFFERED,{stats:i,frag:t,id:"main"}),this.tick();else{this.state=k.PARSING,this.stats=i;var s=n.totalduration,o=isNaN(t.startDTS)?t.start:t.startDTS,l=t.level,u=t.sn,d=this.config.defaultAudioCodec||a.audioCodec;this.audioCodecSwap&&(T.logger.log("swapping playlist audio codec"),void 0===d&&(d=this.lastAudioCodec),d&&(d=d.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,T.logger.log("Parsing "+u+" of ["+n.startSN+" ,"+n.endSN+"],level "+l+", cc "+t.cc);var f=this.demuxer;f||(f=this.demuxer=new c.default(this.hls,"main"));var h=this.media,g=h&&h.seeking,p=!g&&(n.PTSKnown||!n.live);f.push(e.payload,d,a.videoCodec,o,t.cc,l,u,s,t.decryptdata,p,null)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(e){var t=this.fragCurrent;if(t&&"main"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===k.PARSING){var r,i,a=e.tracks;if(a.audio&&this.altAudio&&delete a.audio,i=a.audio){var n=this.levels[this.level].audioCodec,s=navigator.userAgent.toLowerCase();n&&this.audioCodecSwap&&(T.logger.log("swapping playlist audio codec"),n=n.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==i.metadata.channelCount&&s.indexOf("firefox")===-1&&(n="mp4a.40.5"),s.indexOf("android")!==-1&&"audio/mpeg"!==i.container&&(n="mp4a.40.2",T.logger.log("Android: force audio codec to "+n)),i.levelCodec=n,i.id=e.id}if(i=a.video,i&&(i.levelCodec=this.levels[this.level].videoCodec,i.id=e.id),e.unique){var o={codec:"",levelCodec:""};for(r in e.tracks)i=a[r],o.container=i.container,o.codec&&(o.codec+=",",o.levelCodec+=","),i.codec&&(o.codec+=i.codec),i.levelCodec&&(o.levelCodec+=i.levelCodec);a={audiovideo:o}}this.hls.trigger(v.default.BUFFER_CODECS,a);for(r in a){i=a[r],T.logger.log("main track:"+r+",container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var l=i.initSegment;l&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(v.default.BUFFER_APPENDING,{type:r,data:l,parent:"main",content:"initSegment"}))}this.tick()}}},{key:"onFragParsingData",value:function(e){var t=this,r=this.fragCurrent;if(r&&"main"===e.id&&e.sn===r.sn&&e.level===r.level&&("audio"!==e.type||!this.altAudio)&&this.state===k.PARSING){var i=this.levels[this.level],a=this.fragCurrent;T.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0));var n=E.default.updateFragPTSDTS(i.details,a.sn,e.startPTS,e.endPTS,e.startDTS,e.endDTS),s=this.hls;s.trigger(v.default.LEVEL_PTS_UPDATED,{details:i.details,level:this.level,drift:n,type:e.type,start:e.startPTS,end:e.endPTS}),"video"===e.type&&(a.dropped=e.dropped),[e.data1,e.data2].forEach(function(r){r&&(t.appended=!0,t.pendingBuffering=!0,s.trigger(v.default.BUFFER_APPENDING,{type:e.type,data:r,parent:"main",content:"data"}))}),this.tick()}}},{key:"onFragParsed",value:function(e){var t=this.fragCurrent;t&&"main"===e.id&&e.sn===t.sn&&e.level===t.level&&this.state===k.PARSING&&(this.stats.tparsed=performance.now(),this.state=k.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitching",value:function(e){var t=!!e.url,r=e.id;if(!t){if(this.mediaBuffer!==this.media){T.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var i=this.fragCurrent;i.loader&&(T.logger.log("switching to main audio track, cancel main fragment load"),i.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=k.IDLE}var a=this.hls;a.trigger(v.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),a.trigger(v.default.AUDIO_TRACK_SWITCHED,{id:r}),this.altAudio=!1}}},{key:"onAudioTrackSwitched",value:function(e){var t=e.id,r=!!this.hls.audioTracks[t].url;if(r){var i=this.videoBuffer;i&&this.mediaBuffer!==i&&(T.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=r,this.tick()}},{key:"onBufferCreated",value:function(e){var t=e.tracks,r=void 0,i=void 0,a=!1;for(var n in t){var s=t[n];"main"===s.id?(i=n,r=s,"video"===n&&(this.videoBuffer=t[n].buffer)):a=!0}a&&r?(T.logger.log("alternate track found, use "+i+".buffered to schedule main fragment loading"),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function(e){if("main"===e.parent){var t=this.state;t!==k.PARSING&&t!==k.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){var e=this;if(!(this.state!==k.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent;t&&!function(){var r=e.mediaBuffer?e.mediaBuffer:e.media;T.logger.log("main buffered : "+R.default.toString(r.buffered));var i=e.bufferRange.filter(function(e){return f.default.isBuffered(r,(e.start+e.end)/2)});i.push({type:t.type,start:t.startPTS,end:t.endPTS,frag:t}),e.bufferRange=i.sort(function(e,t){return e.start-t.start}),e.fragPrevious=t;var a=e.stats;a.tbuffered=performance.now(),e.fragLastKbps=Math.round(8*a.total/(a.tbuffered-a.tfirst)),e.hls.trigger(v.default.FRAG_BUFFERED,{stats:a,frag:t,id:"main"}),e.state=k.IDLE}(),this.tick()}}},{key:"onError",value:function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var r=this.media,i=r&&f.default.isBuffered(r,r.currentTime)&&f.default.isBuffered(r,r.currentTime+.5);switch(e.details){case _.ErrorDetails.FRAG_LOAD_ERROR:case _.ErrorDetails.FRAG_LOAD_TIMEOUT:case _.ErrorDetails.KEY_LOAD_ERROR:case _.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal){var a=this.fragLoadError;a?a++:a=1;var n=this.config;if(a<=n.fragLoadingMaxRetry||i||t.autoLevel&&t.level){this.fragLoadError=a,t.loadCounter=0;var s=Math.min(Math.pow(2,a-1)*n.fragLoadingRetryDelay,n.fragLoadingMaxRetryTimeout);T.logger.warn("mediaController: frag loading failed, retry in "+s+" ms"),this.retryDate=performance.now()+s,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.state=k.FRAG_LOADING_WAITING_RETRY}else T.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.trigger(v.default.ERROR,e),this.state=k.ERROR}break;case _.ErrorDetails.FRAG_LOOP_LOADING_ERROR:e.fatal||(i?(this._reduceMaxBufferLength(t.duration),this.state=k.IDLE):t.autoLevel&&0!==t.level||(e.fatal=!0,this.hls.trigger(v.default.ERROR,e),this.state=k.ERROR));break;case _.ErrorDetails.LEVEL_LOAD_ERROR:case _.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==k.ERROR&&(e.fatal?(this.state=k.ERROR,T.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):this.state===k.WAITING_LEVEL&&(this.state=k.IDLE));break;case _.ErrorDetails.BUFFER_FULL_ERROR:this.state!==k.PARSING&&this.state!==k.PARSED||(i?(this._reduceMaxBufferLength(t.duration),this.state=k.IDLE):(T.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}}},{key:"_reduceMaxBufferLength",value:function(e){var t=this.config;t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,T.logger.warn("reduce max buffer length to "+t.maxMaxBufferLength+"s and switch to IDLE state"),this.fragLoadIdx+=2*t.fragLoadingLoopThreshold)}},{key:"_checkBuffer",value:function(){var e=this.media;if(e&&e.readyState){var t=e.currentTime,r=this.mediaBuffer?this.mediaBuffer:e,i=r.buffered;if(this.loadedmetadata||!i.length||e.seeking)if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var a=f.default.bufferInfo(e,t,0),n=!(e.paused||e.ended||0===e.buffered.length),s=.5,o=t!==this.lastCurrentTime,l=this.config;if(o)this.stallReported&&(T.logger.warn("playback not stuck anymore @"+t+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(n){var u=performance.now(),d=this.hls;if(this.stalled){var h=u-this.stalled,c=a.len,g=this.nudgeRetry||0;if(c<=s&&h>1e3*l.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,T.logger.warn("playback stalling in low buffer @"+t),d.trigger(v.default.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:c}));var p=a.nextStart,y=p-t;if(p&&y<l.maxSeekHole&&y>0){this.nudgeRetry=++g;var m=g*l.nudgeOffset;T.logger.log("adjust currentTime from "+e.currentTime+" to next buffered @ "+p+" + nudge "+m),e.currentTime=p+m,this.stalled=void 0,d.trigger(v.default.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:p+m-t})}}else if(c>s&&h>1e3*l.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,T.logger.warn("playback stalling in high buffer @"+t),d.trigger(v.default.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:c})),this.stalled=void 0,this.nudgeRetry=++g,g<l.nudgeMaxRetry){var E=e.currentTime,b=E+g*l.nudgeOffset;T.logger.log("adjust currentTime from "+E+" to "+b),e.currentTime=b,d.trigger(v.default.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else T.logger.error("still stuck in high buffer @"+t+" after "+l.nudgeMaxRetry+", raise fatal error"),d.trigger(v.default.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}else this.stalled=u,this.stallReported=!1}}else{this.loadedmetadata=!0;var R=this.startPosition,k=f.default.isBuffered(r,R);t===R&&k||(T.logger.log("target start position:"+R),k||(R=i.start(0),T.logger.log("target start position not buffered, seek to buffered.start(0) "+R)),T.logger.log("adjust currentTime from "+t+" to "+R),e.currentTime=R)}}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=k.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()}},{key:"onBufferFlushed",value:function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferRange=this.bufferRange.filter(function(t){return f.default.isBuffered(e,(t.start+t.end)/2)}),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=k.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function(e,t){var r=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-r)}},{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,T.logger.log("main stream:"+t+"->"+e),this.hls.trigger(v.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferRange(e.currentTime);if(t)return t.frag.level}return-1}},{key:"nextBufferRange",get:function(){var e=this.media;return e?this.followingBufferRange(this.getBufferRange(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferRange;return e?e.frag.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}]),t}(y.default);r.default=A},{22:22,26:26,27:27,28:28,30:30,31:31,41:41,45:45,46:46}],13:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),h=e(42),c=i(h),g=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.FRAG_PARSING_USERDATA,u.default.MANIFEST_LOADING,u.default.FRAG_LOADED,u.default.LEVEL_SWITCH));if(r.hls=e,r.config=e.config,r.enabled=!0,r.Cues=e.config.cueHandler,r.config.enableCEA708Captions){var i=r,s=function(e,t){var r=null;try{r=new window.Event("addtrack")}catch(e){r=document.createEvent("Event"),r.initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)},o={newCue:function(e,t,r){if(!i.textTrack1){var a=i.getExistingTrack("1");a?(i.textTrack1=a,i.clearCurrentCues(i.textTrack1),s(i.textTrack1,i.media)):(i.textTrack1=i.createTextTrack("captions","English","en"),i.textTrack1.textTrack1=!0)}i.Cues.newCue(i.textTrack1,e,t,r)}},l={newCue:function(e,t,r){if(!i.textTrack2){var a=i.getExistingTrack("2");a?(i.textTrack2=a,i.clearCurrentCues(i.textTrack2),s(i.textTrack2,i.media)):(i.textTrack2=i.createTextTrack("captions","Spanish","es"),i.textTrack2.textTrack2=!0)}i.Cues.newCue(i.textTrack2,e,t,r)}};r.cea608Parser=new c.default(0,o,l)}return r}return s(t,e),o(t,[{key:"clearCurrentCues",value:function(e){if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}},{key:"getExistingTrack",value:function(e){var t=this.media;if(t)for(var r=0;r<t.textTracks.length;r++){var i=t.textTracks[r],a="textTrack"+e;if(i[a]===!0)return i}return null}},{key:"createTextTrack",value:function(e,t,r){if(this.media)return this.media.addTextTrack(e,t,r)}},{key:"destroy",value:function(){f.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(e){this.media=e.media}},{key:"onMediaDetaching",value:function(){this.clearCurrentCues(this.textTrack1),this.clearCurrentCues(this.textTrack2)}},{key:"onManifestLoading",value:function(){this.lastPts=Number.NEGATIVE_INFINITY}},{key:"onLevelSwitch",value:function(){"NONE"===this.hls.currentLevel.closedCaptions?this.enabled=!1:this.enabled=!0}},{key:"onFragLoaded",value:function(e){if("main"===e.frag.type){var t=e.frag.start;t<=this.lastPts&&(this.clearCurrentCues(this.textTrack1),this.clearCurrentCues(this.textTrack2)),this.lastPts=t}}},{key:"onFragParsingUserdata",value:function(e){if(this.enabled&&this.config.enableCEA708Captions)for(var t=0;t<e.samples.length;t++){var r=this.extractCea608Data(e.samples[t].bytes);this.cea608Parser.addData(e.samples[t].pts,r)}}},{key:"extractCea608Data",value:function(e){for(var t,r,i,a,n,s=31&e[0],o=2,l=[],u=0;u<s;u++)t=e[o++],r=127&e[o++],i=127&e[o++],a=0!==(4&t),n=3&t,0===r&&0===i||a&&0===n&&(l.push(r),l.push(i));return l}}]),t}(f.default);r.default=g},{27:27,28:28,42:42}],14:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t,r){i(this,e),this.subtle=t,this.aesIV=r}return a(e,[{key:"decrypt",value:function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}]),e}();r.default=n},{}],15:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){i(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[],this.subMix[0]=new Uint32Array(256),this.subMix[1]=new Uint32Array(256),this.subMix[2]=new Uint32Array(256),this.subMix[3]=new Uint32Array(256),this.invSubMix=[],this.invSubMix[0]=new Uint32Array(256),this.invSubMix[1]=new Uint32Array(256),this.invSubMix[2]=new Uint32Array(256),this.invSubMix[3]=new Uint32Array(256),this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return a(e,[{key:"uint8ArrayToUint32Array_",value:function(e){for(var t=new DataView(e),r=new Uint32Array(4),i=0;i<r.length;i++)r[i]=t.getUint32(4*i);return r}},{key:"initTable",value:function(){var e=this.sBox,t=this.invSBox,r=this.subMix[0],i=this.subMix[1],a=this.subMix[2],n=this.subMix[3],s=this.invSubMix[0],o=this.invSubMix[1],l=this.invSubMix[2],u=this.invSubMix[3],d=new Uint32Array(256),f=0,h=0,c=0;for(c=0;c<256;c++)c<128?d[c]=c<<1:d[c]=c<<1^283;for(c=0;c<256;c++){var g=h^h<<1^h<<2^h<<3^h<<4;g=g>>>8^255&g^99,e[f]=g,t[g]=f;var v=d[f],p=d[v],y=d[p],m=257*d[g]^16843008*g;r[f]=m<<24|m>>>8,i[f]=m<<16|m>>>16,a[f]=m<<8|m>>>24,n[f]=m,m=16843009*y^65537*p^257*v^16843008*f,s[g]=m<<24|m>>>8,o[g]=m<<16|m>>>16,l[g]=m<<8|m>>>24,u[g]=m,f?(f=v^d[d[d[y^v]]],h^=d[d[h]]):f=h=1}}},{key:"expandKey",value:function(e){for(var t=this.uint8ArrayToUint32Array_(e),r=!0,i=0;i<t.length&&r;)r=t[i]===this.key[i],i++;if(!r){this.key=t;var a=this.keySize=t.length;if(4!==a&&6!==a&&8!==a)throw new Error("Invalid aes key size="+a);var n=this.ksRows=4*(a+6+1),s=void 0,o=void 0,l=this.keySchedule=new Uint32Array(this.ksRows),u=this.invKeySchedule=new Uint32Array(this.ksRows),d=this.sBox,f=this.rcon,h=this.invSubMix[0],c=this.invSubMix[1],g=this.invSubMix[2],v=this.invSubMix[3],p=void 0,y=void 0;for(s=0;s<n;s++)s<a?p=l[s]=t[s]:(y=p,s%a===0?(y=y<<8|y>>>24,y=d[y>>>24]<<24|d[y>>>16&255]<<16|d[y>>>8&255]<<8|d[255&y],y^=f[s/a|0]<<24):a>6&&s%a===4&&(y=d[y>>>24]<<24|d[y>>>16&255]<<16|d[y>>>8&255]<<8|d[255&y]),l[s]=p=(l[s-a]^y)>>>0);for(o=0;o<n;o++)s=n-o,y=3&o?l[s]:l[s-4],o<4||s<=4?u[o]=y:u[o]=h[d[y>>>24]]^c[d[y>>>16&255]]^g[d[y>>>8&255]]^v[d[255&y]],u[o]=u[o]>>>0}}},{key:"networkToHostOrderSwap",value:function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}},{key:"decrypt",value:function(e,t,r){for(var i,a,n=this.keySize+6,s=this.invKeySchedule,o=this.invSBox,l=this.invSubMix[0],u=this.invSubMix[1],d=this.invSubMix[2],f=this.invSubMix[3],h=this.uint8ArrayToUint32Array_(r),c=h[0],g=h[1],v=h[2],p=h[3],y=new Int32Array(e),m=new Int32Array(y.length),E=void 0,b=void 0,R=void 0,_=void 0,T=void 0,k=void 0,A=void 0,S=void 0,L=void 0,D=void 0,w=void 0,O=void 0;t<y.length;){for(L=this.networkToHostOrderSwap(y[t]),D=this.networkToHostOrderSwap(y[t+1]),w=this.networkToHostOrderSwap(y[t+2]),O=this.networkToHostOrderSwap(y[t+3]),T=L^s[0],k=O^s[1],A=w^s[2],S=D^s[3],i=4,a=1;a<n;a++)E=l[T>>>24]^u[k>>16&255]^d[A>>8&255]^f[255&S]^s[i],b=l[k>>>24]^u[A>>16&255]^d[S>>8&255]^f[255&T]^s[i+1],R=l[A>>>24]^u[S>>16&255]^d[T>>8&255]^f[255&k]^s[i+2],_=l[S>>>24]^u[T>>16&255]^d[k>>8&255]^f[255&A]^s[i+3],T=E,k=b,A=R,S=_,i+=4;E=o[T>>>24]<<24^o[k>>16&255]<<16^o[A>>8&255]<<8^o[255&S]^s[i],b=o[k>>>24]<<24^o[A>>16&255]<<16^o[S>>8&255]<<8^o[255&T]^s[i+1],R=o[A>>>24]<<24^o[S>>16&255]<<16^o[T>>8&255]<<8^o[255&k]^s[i+2],_=o[S>>>24]<<24^o[T>>16&255]<<16^o[k>>8&255]<<8^o[255&A]^s[i+3],i+=3,m[t]=this.networkToHostOrderSwap(E^c),m[t+1]=this.networkToHostOrderSwap(_^g),m[t+2]=this.networkToHostOrderSwap(R^v),m[t+3]=this.networkToHostOrderSwap(b^p),c=L,g=D,v=w,p=O,t+=4}return m.buffer}},{key:"destroy",value:function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}]),e}();r.default=n},{}],16:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(14),o=i(s),l=e(17),u=i(l),d=e(15),f=i(d),h=e(26),c=e(45),g=function(){function e(t,r){a(this,e),this.observer=t,this.config=r;try{var i=crypto?crypto:self.crypto;this.subtle=i.subtle||i.webkitSubtle}catch(e){}this.disableWebCrypto=!this.subtle}return n(e,[{key:"decrypt",value:function(e,t,r,i){var a=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){c.logger.log("JS AES decrypt");var n=this.decryptor;n||(this.decryptor=n=new f.default),n.expandKey(t),i(n.decrypt(e,0,r))}else!function(){c.logger.log("WebCrypto AES decrypt");var n=a.subtle;a.key!==t&&(a.key=t,a.fastAesKey=new u.default(n,t)),a.fastAesKey.expandKey().then(function(t){var a=new o.default(n,r);a.decrypt(e,t).then(function(e){i(e)})}).catch(function(n){a.onWebCryptoError(n,e,t,r,i)})}()}},{key:"onWebCryptoError",value:function(e,t,r,i,a){this.config.enableSoftwareAES?(c.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.decrypt(t,r,i,a)):(c.logger.error("decrypting error : "+e.message),this.observer.trigger(Event.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))}},{key:"destroy",value:function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)}}]),e}();r.default=g},{14:14,15:15,17:17,26:26,45:45}],17:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t,r){i(this,e),this.subtle=t,this.key=r}return a(e,[{key:"expandKey",value:function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),e}();r.default=n},{}],18:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(19),o=i(s),l=e(45),u=e(24),d=i(u),f=function(){function e(t,r,i,n,s){a(this,e),this.observer=t,this.id=r,this.remuxerClass=i,this.config=n,this.remuxer=new this.remuxerClass(t,r,n,s),this.insertDiscontinuity()}return n(e,[{key:"insertDiscontinuity",value:function(){this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,isAAC:!0,samples:[],len:0}}},{key:"push",value:function(e,t,r,i,a,n,s,u,f,h){var c,g,v,p,y,m,E,b,R,_,T=new d.default(e),k=90*T.timeStamp,A=!1;for(a!==this.lastCC?(l.logger.log(this.id+" discontinuity detected"),this.lastCC=a,this.insertDiscontinuity(),this.remuxer.switchLevel(),this.remuxer.insertDiscontinuity()):n!==this.lastLevel?(l.logger.log("audio track switch detected"),this.lastLevel=n,this.remuxer.switchLevel(),this.insertDiscontinuity()):s===this.lastSN+1&&(A=!0),c=this._aacTrack,this.lastSN=s,this.lastLevel=n,m=T.length,R=e.length;m<R-1&&(255!==e[m]||240!==(240&e[m+1]));m++);for(c.audiosamplerate||(g=o.default.getAudioConfig(this.observer,e,m,t),c.config=g.config,c.audiosamplerate=g.samplerate,c.channelCount=g.channelCount,c.codec=g.codec,c.manifestCodec=g.manifestCodec,c.duration=u,l.logger.log("parsed codec:"+c.codec+",rate:"+g.samplerate+",nb channel:"+g.channelCount)),y=0,p=9216e4/c.audiosamplerate;m+5<R&&(E=1&e[m+1]?7:9,v=(3&e[m+3])<<11|e[m+4]<<3|(224&e[m+5])>>>5,v-=E,v>0&&m+E+v<=R);)for(b=k+y*p,_={unit:e.subarray(m+E,m+E+v),pts:b,dts:b},c.samples.push(_),c.len+=v,m+=v+E,y++;m<R-1&&(255!==e[m]||240!==(240&e[m+1]));m++);this.remuxer.remux(n,s,a,c,{samples:[]},{samples:[{pts:k,dts:k,unit:T.payload}]},{samples:[]},i,A,f,h)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(e){var t,r,i=new d.default(e);if(i.hasTimeStamp)for(t=i.length,r=e.length;t<r-1;t++)if(255===e[t]&&240===(240&e[t+1]))return!0;return!1}}]),e}();r.default=f},{19:19,24:24,45:45}],19:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e(45),s=e(26),o=function(){function e(){i(this,e)}return a(e,null,[{key:"getAudioConfig",value:function(e,t,r,i){var a,o,l,u,d,f=navigator.userAgent.toLowerCase(),h=i,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return a=((192&t[r+2])>>>6)+1,o=(60&t[r+2])>>>2,o>c.length-1?void e.trigger(Event.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+o}):(u=(1&t[r+2])<<2,u|=(192&t[r+3])>>>6,n.logger.log("manifest codec:"+i+",ADTS data:type:"+a+",sampleingIndex:"+o+"["+c[o]+"Hz],channelConfig:"+u),/firefox/i.test(f)?o>=6?(a=5,d=new Array(4),l=o-3):(a=2,d=new Array(2),l=o):f.indexOf("android")!==-1?(a=2,d=new Array(2),l=o):(a=5,d=new Array(4),i&&(i.indexOf("mp4a.40.29")!==-1||i.indexOf("mp4a.40.5")!==-1)||!i&&o>=6?l=o-3:((i&&i.indexOf("mp4a.40.2")!==-1&&o>=6&&1===u||!i&&1===u)&&(a=2,d=new Array(2)),l=o)),d[0]=a<<3,d[0]|=(14&o)>>1,d[1]|=(1&o)<<7,d[1]|=u<<3,5===a&&(d[1]|=(14&l)>>1,d[2]=(1&l)<<7,d[2]|=8,d[3]=0),{config:d,samplerate:c[o],channelCount:u,codec:"mp4a.40."+a,manifestCodec:h})}}]),e}();r.default=o},{26:26,45:45}],20:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function");}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(28),o=i(s),l=e(26),u=e(16),d=i(u),f=e(18),h=i(f),c=e(25),g=i(c),v=e(38),p=i(v),y=e(39),m=i(y),E=function(){function e(t,r,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;a(this,e),this.hls=t,this.id=r,this.config=this.hls.config||n,this.typeSupported=i}return n(e,[{key:"destroy",value:function(){var e=this.demuxer;e&&e.destroy()}},{key:"push",value:function(e,t,r,i,a,n,s,l,u,f,h){if(e.byteLength>0&&null!=u&&null!=u.key&&"AES-128"===u.method){null==this.decrypter&&(this.decrypter=new d.default(this.hls,this.config));var c,g=this;try{c=performance.now()}catch(e){c=Date.now()}this.decrypter.decrypt(e,u.key.buffer,u.iv.buffer,function(e){var u;try{u=performance.now()}catch(e){u=Date.now()}g.hls.trigger(o.default.FRAG_DECRYPTED,{level:n,sn:s,stats:{tstart:c,tdecrypt:u}}),g.pushDecrypted(new Uint8Array(e),t,r,i,a,n,s,l,f,h)})}else this.pushDecrypted(new Uint8Array(e),t,r,i,a,n,s,l,f,h)}},{key:"pushDecrypted",value:function(e,t,r,i,a,n,s,u,d,f){var c=this.demuxer;if(!c||a!==this.cc&&!c.probe(e)){var v=this.hls,y=this.id,E=this.config,b=this.typeSupported;if(g.default.probe(e))c=this.typeSupported.mp2t===!0?new g.default(v,y,m.default,E,b):new g.default(v,y,p.default,E,b),c.probe=g.default.probe;else{if(!h.default.probe(e))return void v.trigger(o.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,id:y,details:l.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});c=new h.default(v,y,p.default,E,b),c.probe=h.default.probe}this.demuxer=c}c.push(e,t,r,i,a,n,s,u,d,f),this.cc=a}}]),e}();r.default=E},{16:16,18:18,25:25,26:26,28:28,38:38,39:39}],21:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a=e(20),n=i(a),s=e(28),o=i(s),l=e(45),u=e(1),d=i(u),f=function(e){var t=new d.default;t.trigger=function(e){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];t.emit.apply(t,[e,e].concat(i))},t.off=function(e){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];t.removeListener.apply(t,[e].concat(i))};var r=function(t,r){e.postMessage({event:t,data:r})};e.addEventListener("message",function(i){var a=i.data;switch(a.cmd){case"init":var s=JSON.parse(a.config);e.demuxer=new n.default(t,a.id,a.typeSupported,s);try{(0,l.enableLogs)(s.debug===!0)}catch(e){}r("init",null);break;case"demux":e.demuxer.push(a.data,a.audioCodec,a.videoCodec,a.timeOffset,a.cc,a.level,a.sn,a.duration,a.decryptdata,a.accurateTimeOffset,a.defaultInitPTS)}}),t.on(o.default.FRAG_DECRYPTED,r),t.on(o.default.FRAG_PARSING_INIT_SEGMENT,r),t.on(o.default.FRAG_PARSED,r),t.on(o.default.ERROR,r),t.on(o.default.FRAG_PARSING_METADATA,r),t.on(o.default.FRAG_PARSING_USERDATA,r),t.on(o.default.INIT_PTS_FOUND,r),t.on(o.default.FRAG_PARSING_DATA,function(t,r){var i=r.data1.buffer,a=r.data2.buffer;delete r.data1,delete r.data2,e.postMessage({event:t,data:r,data1:i,data2:a},[i,a])})};r.default=f},{1:1,20:20,28:28,45:45}],22:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(28),o=i(s),l=e(20),u=i(l),d=e(21),f=i(d),h=e(45),c=e(26),g=function(){function t(r,i){a(this,t),this.hls=r,this.id=i;var n={mp4:MediaSource.isTypeSupported("video/mp4"),mp2t:r.config.enableMP2TPassThrough&&MediaSource.isTypeSupported("video/mp2t"),mpeg:MediaSource.isTypeSupported("audio/mpeg"),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"')};if(r.config.enableWorker&&"undefined"!=typeof Worker){h.logger.log("demuxing in webworker");var s=void 0;try{var l=e(3);s=this.w=l(f.default),this.onwmsg=this.onWorkerMessage.bind(this),s.addEventListener("message",this.onwmsg),s.onerror=function(e){r.trigger(o.default.ERROR,{type:c.ErrorTypes.OTHER_ERROR,details:c.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},s.postMessage({cmd:"init",typeSupported:n,id:i,config:JSON.stringify(r.config)})}catch(e){h.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),s&&URL.revokeObjectURL(s.objectURL),this.demuxer=new u.default(r,i,n),this.w=void 0}}else this.demuxer=new u.default(r,i,n);this.demuxInitialized=!0}return n(t,[{key:"destroy",value:function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}}},{key:"push",value:function(e,t,r,i,a,n,s,o,l,u,d){var f=this.w;if(f)f.postMessage({cmd:"demux",data:e,audioCodec:t,videoCodec:r,timeOffset:i,cc:a,level:n,sn:s,duration:o,decryptdata:l,accurateTimeOffset:u,defaultInitPTS:d},[e]);else{var h=this.demuxer;h&&h.push(e,t,r,i,a,n,s,o,l,u,d)}}},{key:"onWorkerMessage",value:function(e){var t=e.data,r=this.hls;switch(t.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case o.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data.data2=new Uint8Array(t.data2);default:r.trigger(t.event,t.data)}}}]),t}();r.default=g},{20:20,21:21,26:26,28:28,3:3,45:45}],23:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e(45),s=function(){function e(t){i(this,e),this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return a(e,[{key:"loadWord",value:function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),a=Math.min(4,t);if(0===a)throw new Error("no bytes available");i.set(e.subarray(r,r+a)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*a,this.bytesAvailable-=a}},{key:"skipBits",value:function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;return e>32&&n.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(e){var t,r,i=8,a=8;for(t=0;t<e;t++)0!==a&&(r=this.readEG(),a=(i+r+256)%256),i=0===a?i:a}},{key:"readSPS",value:function(){var e,t,r,i,a,n,s,o,l,u=0,d=0,f=0,h=0,c=this.readUByte.bind(this),g=this.readBits.bind(this),v=this.readUEG.bind(this),p=this.readBoolean.bind(this),y=this.skipBits.bind(this),m=this.skipEG.bind(this),E=this.skipUEG.bind(this),b=this.skipScalingList.bind(this);if(c(),e=c(),t=g(5),y(3),r=c(),E(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var R=v();if(3===R&&y(1),E(),E(),y(1),p())for(o=3!==R?8:12,l=0;l<o;l++)p()&&b(l<6?16:64)}E();var _=v();if(0===_)v();else if(1===_)for(y(1),m(),m(),i=v(),l=0;l<i;l++)m();E(),y(1),a=v(),n=v(),s=g(1),0===s&&y(1),y(1),p()&&(u=v(),d=v(),f=v(),h=v());var T=[1,1];if(p()&&p()){var k=c();switch(k){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[c()<<8|c(),c()<<8|c()]}}return{width:Math.ceil(16*(a+1)-2*u-2*d),height:(2-s)*(n+1)*16-(s?2:4)*(f+h),pixelRatio:T}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}();r.default=s},{45:45}],24:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e(45),s=function(){function e(t){i(this,e),this._hasTimeStamp=!1;for(var r,a,s,o,l,u,d,f,h=0;;)if(d=this.readUTF(t,h,3),h+=3,"ID3"===d)h+=3,r=127&t[h++],a=127&t[h++],s=127&t[h++],o=127&t[h++],l=(r<<21)+(a<<14)+(s<<7)+o,u=h+l,this._parseID3Frames(t,h,u),h=u;else{if("3DI"!==d)return h-=3,f=h,void(f&&(this.hasTimeStamp||n.logger.warn("ID3 tag found, but no timestamp"),this._length=f,this._payload=t.subarray(0,f)));h+=7,n.logger.log("3DI footer found, end: "+h)}}return a(e,[{key:"readUTF",value:function(e,t,r){var i="",a=t,n=t+r;do i+=String.fromCharCode(e[a++]);while(a<n);return i}},{key:"_parseID3Frames",value:function(e,t,r){for(var i,a,s,o,l;t+8<=r;)switch(i=this.readUTF(e,t,4),t+=4,a=e[t++]<<24+e[t++]<<16+e[t++]<<8+e[t++],o=e[t++]<<8+e[t++],s=t,i){case"PRIV":if("com.apple.streaming.transportStreamTimestamp"===this.readUTF(e,t,44)){t+=44,t+=4;var u=1&e[t++];this._hasTimeStamp=!0,l=((e[t++]<<23)+(e[t++]<<15)+(e[t++]<<7)+e[t++])/45,u&&(l+=47721858.84),l=Math.round(l),n.logger.trace("ID3 timestamp found: "+l),this._timeStamp=l}}}},{key:"hasTimeStamp",get:function(){return this._hasTimeStamp}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"length",get:function(){return this._length}},{key:"payload",get:function(){return this._payload}}]),e}();r.default=s},{45:45}],25:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(19),o=i(s),l=e(28),u=i(l),d=e(23),f=i(d),h=e(45),c=e(26),g=function(){function e(t,r,i,n,s){a(this,e),this.observer=t,this.id=r,this.remuxerClass=i,this.config=n,this.typeSupported=s,this.lastCC=0,this.remuxer=new this.remuxerClass(t,r,n,s)}return n(e,[{key:"switchLevel",value:function(){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,sequenceNumber:0,samples:[],len:0,dropped:0},this._audioTrack={container:"video/mp2t",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0,isAAC:!0},this._id3Track={type:"id3",id:-1,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.remuxer.switchLevel()}},{key:"insertDiscontinuity",value:function(){this.switchLevel(),this.remuxer.insertDiscontinuity()}},{key:"push",value:function(e,t,r,i,a,n,s,o,l,d){var f,g,v,p,y,m,E=e.length,b=this.remuxer.passthrough,R=!1;this.audioCodec=t,this.videoCodec=r,this._duration=o,this.contiguous=!1,this.accurateTimeOffset=l,a!==this.lastCC&&(h.logger.log("discontinuity detected"),this.insertDiscontinuity(),this.lastCC=a),n!==this.lastLevel?(h.logger.log("level switch detected"),this.switchLevel(),this.lastLevel=n):s===this.lastSN+1&&(this.contiguous=!0),this.lastSN=s;var _=this.pmtParsed,T=this._avcTrack,k=this._audioTrack,A=this._id3Track,S=T.id,L=k.id,D=A.id,w=this._pmtId,O=T.pesData,I=k.pesData,P=A.pesData,C=this._parsePAT,M=this._parsePMT,x=this._parsePES,F=this._parseAVCPES.bind(this),N=this._parseAACPES.bind(this),U=this._parseMPEGPES.bind(this),G=this._parseID3PES.bind(this);for(E-=E%188,f=0;f<E;f+=188)if(71===e[f]){if(g=!!(64&e[f+1]),v=((31&e[f+1])<<8)+e[f+2],p=(48&e[f+3])>>4,p>1){if(y=f+5+e[f+4],y===f+188)continue}else y=f+4;switch(v){case S:if(g){if(O&&(m=x(O))&&(F(m,!1),b&&T.codec&&(L===-1||k.codec)))return void this.remux(n,s,a,e,i);O={data:[],size:0}}O&&(O.data.push(e.subarray(y,f+188)),O.size+=f+188-y);break;case L:if(g){if(I&&(m=x(I))&&(k.isAAC?N(m):U(m),b&&k.codec&&(S===-1||T.codec)))return void this.remux(n,s,a,e,i);I={data:[],size:0}}I&&(I.data.push(e.subarray(y,f+188)),I.size+=f+188-y);break;case D:g&&(P&&(m=x(P))&&G(m),P={data:[],size:0}),P&&(P.data.push(e.subarray(y,f+188)),P.size+=f+188-y);break;case 0:g&&(y+=e[y]+1),w=this._pmtId=C(e,y);break;case w:g&&(y+=e[y]+1);var B=M(e,y,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0);S=B.avc,S>0&&(T.id=S),L=B.audio,L>0&&(k.id=L,k.isAAC=B.isAAC),D=B.id3,D>0&&(A.id=D),R&&!_&&(h.logger.log("reparse from beginning"),R=!1,f=-188),_=this.pmtParsed=!0;break;case 17:case 8191:break;default:R=!0}}else this.observer.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,id:this.id,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});O&&(m=x(O))?(F(m,!0),T.pesData=null):T.pesData=O,I&&(m=x(I))?(k.isAAC?N(m):U(m),k.pesData=null):(I&&I.size&&h.logger.log("last AAC PES packet truncated,might overlap between fragments"),k.pesData=I),P&&(m=x(P))?(G(m),A.pesData=null):A.pesData=P,this.remux(n,s,a,null,i,d)}},{key:"remux",value:function(e,t,r,i,a,n){for(var s=this._avcTrack,o=s.samples,l=0,u=0,d=0;d<o.length;d++){for(var f=o[d],h=f.units.units,c=h.length,g=0,v=0;v<c;v++)g+=h[v].data.length;u+=g,l+=c,f.length=g}s.len=u,s.nbNalu=l,this.remuxer.remux(e,t,r,this._audioTrack,this._avcTrack,this._id3Track,this._txtTrack,a,this.contiguous,this.accurateTimeOffset,n,i)}},{key:"destroy",value:function(){this.switchLevel(),this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(e,t){return(31&e[t+10])<<8|e[t+11]}},{key:"_parsePMT",value:function(e,t,r){var i,a,n,s,o={audio:-1,avc:-1,id3:-1,isAAC:!0};for(i=(15&e[t+1])<<8|e[t+2],a=t+3+i-4,n=(15&e[t+10])<<8|e[t+11],t+=12+n;t<a;){switch(s=(31&e[t+1])<<8|e[t+2],e[t]){case 15:o.audio===-1&&(o.audio=s);break;case 21:o.id3===-1&&(o.id3=s);break;case 27:o.avc===-1&&(o.avc=s);break;case 3:case 4:r?o.audio===-1&&(o.audio=s,o.isAAC=!1):h.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:h.logger.warn("HEVC stream type found, not supported for now");break;default:h.logger.log("unkown stream type:"+e[t])}t+=((15&e[t+3])<<8|e[t+4])+5}return o}},{key:"_parsePES",value:function(e){var t,r,i,a,n,s,o,l,u,d=0,f=e.data;if(!e||0===e.size)return null;for(;f[0].length<19&&f.length>1;){var c=new Uint8Array(f[0].length+f[1].length);c.set(f[0]),c.set(f[1],f[0].length),f[0]=c,f.splice(1,1)}if(t=f[0],i=(t[0]<<16)+(t[1]<<8)+t[2],1===i){if(a=(t[4]<<8)+t[5],a&&a>e.size-6)return null;r=t[7],192&r&&(o=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,o>4294967295&&(o-=8589934592),64&r?(l=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,l>4294967295&&(l-=8589934592),o-l>54e5&&(h.logger.warn(Math.round((o-l)/9e4)+"s delta between PTS and DTS, align them"),o=l)):l=o),n=t[8],u=n+9,e.size-=u,s=new Uint8Array(e.size);for(var g=0,v=f.length;g<v;g++){t=f[g];var p=t.byteLength;if(u){if(u>p){u-=p;continue}t=t.subarray(u),p-=u,u=0}s.set(t,d),d+=p}return a&&(a-=n+3),{data:s,pts:o,dts:l,len:a}}return null}},{key:"pushAccesUnit",value:function(e,t){e.units.units.length&&e.frame&&(!this.config.forceKeyFrameOnDiscontinuity||e.key===!0||t.sps&&(t.samples.length||this.contiguous)?t.samples.push(e):t.dropped++),e.debug.length&&h.logger.log(e.pts+"/"+e.dts+":"+e.debug+","+e.units.length)}},{key:"_parseAVCPES",value:function(e,t){var r,i,a,n=this,s=this._avcTrack,o=this._parseAVCNALu(e.data),l=!1,u=this.avcSample;e.data=null,o.forEach(function(t){switch(t.type){case 1:i=!0,l&&u&&(u.debug+="NDR "),u.frame=!0;var o=t.data;if(o.length>4){var d=new f.default(o).readSliceType();2!==d&&4!==d&&7!==d&&9!==d||(u.key=!0)}break;case 5:i=!0,u||(u=n.avcSample=n._createAVCSample(!0,e.pts,e.dts,"")),l&&(u.debug+="IDR "),u.key=!0,u.frame=!0;break;case 6:i=!0,l&&u&&(u.debug+="SEI "),r=new f.default(n.discardEPB(t.data)),r.readUByte();for(var h=0,c=0,g=!1,v=0;!g&&r.bytesAvailable>1;){h=0;do v=r.readUByte(),h+=v;while(255===v);c=0;do v=r.readUByte(),c+=v;while(255===v);if(4===h&&0!==r.bytesAvailable){g=!0;var p=r.readUByte();if(181===p){var y=r.readUShort();if(49===y){var m=r.readUInt();if(1195456820===m){var E=r.readUByte();if(3===E){var b=r.readUByte(),R=r.readUByte(),_=31&b,T=[b,R];for(a=0;a<_;a++)T.push(r.readUByte()),T.push(r.readUByte()),T.push(r.readUByte());n._insertSampleInOrder(n._txtTrack.samples,{type:3,pts:e.pts,bytes:T})}}}}}else if(c<r.bytesAvailable)for(a=0;a<c;a++)r.readUByte()}break;case 7:if(i=!0,l&&u&&(u.debug+="SPS "),!s.sps){r=new f.default(t.data);var k=r.readSPS();s.width=k.width,s.height=k.height,s.pixelRatio=k.pixelRatio,s.sps=[t.data],s.duration=n._duration;var A=t.data.subarray(1,4),S="avc1.";for(a=0;a<3;a++){var L=A[a].toString(16);L.length<2&&(L="0"+L),S+=L}s.codec=S}break;case 8:i=!0,l&&u&&(u.debug+="PPS "),s.pps||(s.pps=[t.data]);break;case 9:i=!1,u&&n.pushAccesUnit(u,s),u=n.avcSample=n._createAVCSample(!1,e.pts,e.dts,l?"AUD ":"");break;case 12:i=!1;break;default:i=!1,u&&(u.debug+="unknown NAL "+t.type+" ")}if(u&&i){var D=u.units;D.units.push(t)}}),t&&u&&(this.pushAccesUnit(u,s),this.avcSample=null)}},{key:"_createAVCSample",value:function(e,t,r,i){return{key:e,pts:t,dts:r,units:{units:[],length:0},debug:i}}},{key:"_insertSampleInOrder",value:function(e,t){var r=e.length;if(r>0){if(t.pts>=e[r-1].pts)e.push(t);else for(var i=r-1;i>=0;i--)if(t.pts<e[i].pts){e.splice(i,0,t);break}}else e.push(t)}},{key:"_getLastNalUnit",value:function(){var e=this.avcSample,t=void 0;if(!e||0===e.units.units.length){var r=this._avcTrack,i=r.samples;e=i[i.length-1]}if(e){var a=e.units.units;t=a[a.length-1]}return t}},{key:"_parseAVCNALu",value:function(e){var t,r,i,a,n,s=0,o=e.byteLength,l=this._avcTrack,u=l.naluState||0,d=u,f=[],h=-1;for(u===-1&&(h=0,n=31&e[0],u=0,s=1);s<o;)if(t=e[s++],u)if(1!==u)if(t)if(1===t){if(h>=0)i={data:e.subarray(h,s-u-1),type:n},f.push(i);else{var c=this._getLastNalUnit();if(c&&(d&&s<=4-d&&c.state&&(c.data=c.data.subarray(0,c.data.byteLength-d)),r=s-u-1,r>0)){var g=new Uint8Array(c.data.byteLength+r);g.set(c.data,0),g.set(e.subarray(0,r),c.data.byteLength),c.data=g}}s<o?(a=31&e[s],h=s,n=a,u=0):u=-1}else u=0;else u=3;else u=t?0:2;else u=t?0:1;if(h>=0&&u>=0&&(i={data:e.subarray(h,o),type:n,state:u},f.push(i)),0===f.length){var v=this._getLastNalUnit();if(v){var p=new Uint8Array(v.data.byteLength+e.byteLength);p.set(v.data,0),p.set(e,v.data.byteLength),v.data=p}}return l.naluState=u,f}},{key:"discardEPB",value:function(e){for(var t,r,i=e.byteLength,a=[],n=1;n<i-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(a.push(n+2),n+=2):n++;if(0===a.length)return e;t=i-a.length,r=new Uint8Array(t);var s=0;for(n=0;n<t;s++,n++)s===a[0]&&(s++,a.shift()),r[n]=e[s];return r}},{key:"_parseAACPES",value:function(e){var t,r,i,a,n,s,l,d,f,g=this._audioTrack,v=e.data,p=e.pts,y=0,m=this.aacOverFlow,E=this.aacLastPTS;if(m){var b=new Uint8Array(m.byteLength+v.byteLength);b.set(m,0),b.set(v,m.byteLength),v=b}for(n=y,d=v.length;n<d-1&&(255!==v[n]||240!==(240&v[n+1]));n++);if(n){var R,_;if(n<d-1?(R="AAC PES did not start with ADTS header,offset:"+n,_=!1):(R="no ADTS header found in AAC PES",_=!0),h.logger.warn("parsing error:"+R),this.observer.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,id:this.id,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:_,reason:R}),_)return}if(!g.audiosamplerate){var T=this.audioCodec;t=o.default.getAudioConfig(this.observer,v,n,T),g.config=t.config,g.audiosamplerate=t.samplerate,g.channelCount=t.channelCount,g.codec=t.codec,g.manifestCodec=t.manifestCodec,g.duration=this._duration,h.logger.log("parsed codec:"+g.codec+",rate:"+t.samplerate+",nb channel:"+t.channelCount)}if(a=0,i=9216e4/g.audiosamplerate,m&&E){var k=E+i;Math.abs(k-p)>1&&(h.logger.log("AAC: align PTS for overlapping frames by "+Math.round((k-p)/90)),p=k)}for(;n+5<d&&(s=1&v[n+1]?7:9,r=(3&v[n+3])<<11|v[n+4]<<3|(224&v[n+5])>>>5,r-=s,r>0&&n+s+r<=d);)for(l=p+a*i,f={unit:v.subarray(n+s,n+s+r),pts:l,dts:l},g.samples.push(f),g.len+=r,n+=r+s,a++;n<d-1&&(255!==v[n]||240!==(240&v[n+1]));n++);m=n<d?v.subarray(n,d):null,this.aacOverFlow=m,this.aacLastPTS=l}},{key:"_parseMPEGPES",value:function(e){for(var t,r=e.data,i=e.pts,a=r.length,n=0,s=0;s<a&&(t=this._parseMpeg(r,s,a,n++,i))>0;)s+=t}},{key:"_onMpegFrame",value:function(e,t,r,i,a,n){var s=1152/r*1e3,o=n+a*s,l=this._audioTrack;l.config=[],l.channelCount=i,l.audiosamplerate=r,l.duration=this._duration,l.samples.push({unit:e,pts:o,dts:o}),l.len+=e.length}},{key:"_onMpegNoise",value:function(e){h.logger.warn("mpeg audio has noise: "+e.length+" bytes")}},{key:"_parseMpeg",value:function(e,t,r,i,a){var n=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],s=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3];if(t+2>r)return-1;if(255===e[t]||224===(224&e[t+1])){if(t+24>r)return-1;var o=e[t+1]>>3&3,l=e[t+1]>>1&3,u=e[t+2]>>4&15,d=e[t+2]>>2&3,f=!!(2&e[t+2]);if(1!==o&&0!==u&&15!==u&&3!==d){var h=3===o?3-l:3===l?3:4,c=1e3*n[14*h+u-1],g=3===o?0:2===o?1:2,v=s[3*g+d],p=f?1:0,y=e[t+3]>>6===3?1:2,m=3===l?(3===o?12:6)*c/v+p<<2:(3===o?144:72)*c/v+p|0;return t+m>r?-1:(this._onMpegFrame&&this._onMpegFrame(e.subarray(t,t+m),c,v,y,i,a),m)}}for(var E=t+2;E<r;){if(255===e[E-1]&&224===(224&e[E]))return this._onMpegNoise&&this._onMpegNoise(e.subarray(t,E-1)),E-t-1;E++}return-1}},{key:"_parseID3PES",value:function(e){this._id3Track.samples.push(e)}}],[{key:"probe",value:function(e){return e.length>=564&&71===e[0]&&71===e[188]&&71===e[376]}}]),e}();r.default=g},{19:19,23:23,26:26,28:28,45:45}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},r.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},{}],27:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=e(45),l=e(26),u=e(28),d=i(u),f=function(){function e(t){a(this,e),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var r=arguments.length,i=Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];this.handledEvents=i,this.useGenericHandler=!0,this.registerListeners()}return s(e,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===n(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if("hlsEventGeneric"===e)throw new Error("Forbidden event name: "+e);this.hls.on(e,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(e,t){this.onEventGeneric(e,t)}},{key:"onEventGeneric",value:function(e,t){var r=function(e,t){var r="on"+e.replace("hls","");if("function"!=typeof this[r])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+r+")");return this[r].bind(this,t)};try{r.call(this,e,t).call()}catch(t){o.logger.error("internal error happened while processing "+e+":"+t.message),this.hls.trigger(d.default.ERROR,{type:l.ErrorTypes.OTHER_ERROR,details:l.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}}}]),e}();r.default=f},{26:26,28:28,45:45}],28:[function(e,t,r){"use strict";t.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVEL_SWITCH:"hlsLevelSwitch",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},{}],29:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){i(this,e)}return a(e,null,[{key:"getSilentFrame",value:function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),e}();r.default=n},{}],30:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){i(this,e)}return a(e,null,[{key:"isBuffered",value:function(e,t){if(e)for(var r=e.buffered,i=0;i<r.length;i++)if(t>=r.start(i)&&t<=r.end(i))return!0;return!1}},{key:"bufferInfo",value:function(e,t,r){if(e){var i,a=e.buffered,n=[];for(i=0;i<a.length;i++)n.push({start:a.start(i),end:a.end(i)});return this.bufferedInfo(n,t,r)}return{len:0,start:0,end:0,nextStart:void 0}}},{key:"bufferedInfo",value:function(e,t,r){var i,a,n,s,o,l=[];for(e.sort(function(e,t){var r=e.start-t.start;return r?r:t.end-e.end}),o=0;o<e.length;o++){var u=l.length;if(u){var d=l[u-1].end;e[o].start-d<r?e[o].end>d&&(l[u-1].end=e[o].end):l.push(e[o])}else l.push(e[o])}for(o=0,i=0,a=n=t;o<l.length;o++){var f=l[o].start,h=l[o].end;if(t+r>=f&&t<h)a=f,n=h,i=n-t;else if(t+r<f){s=f;break}}return{len:i,start:a,end:n,nextStart:s}}}]),e}();r.default=n},{}],31:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e(45),s=function(){function e(){i(this,e)}return a(e,null,[{key:"mergeDetails",value:function(t,r){var i,a=Math.max(t.startSN,r.startSN)-r.startSN,s=Math.min(t.endSN,r.endSN)-r.startSN,o=r.startSN-t.startSN,l=t.fragments,u=r.fragments,d=0;if(s<a)return void(r.PTSKnown=!1);for(var f=a;f<=s;f++){var h=l[o+f],c=u[f];c&&h&&(d=h.cc-c.cc,isNaN(h.startPTS)||(c.start=c.startPTS=h.startPTS,c.endPTS=h.endPTS,c.duration=h.duration,i=c))}if(d)for(n.logger.log("discontinuity sliding from playlist, take drift into account"),f=0;f<u.length;f++)u[f].cc+=d;if(i)e.updateFragPTSDTS(r,i.sn,i.startPTS,i.endPTS,i.startDTS,i.endDTS);else if(o>=0&&o<l.length){var g=l[o].start;for(f=0;f<u.length;f++)u[f].start+=g}r.PTSKnown=t.PTSKnown}},{key:"updateFragPTSDTS",value:function(t,r,i,a,n,s){var o,l,u,d;if(!t||r<t.startSN||r>t.endSN)return 0;if(o=r-t.startSN,l=t.fragments,u=l[o],!isNaN(u.startPTS)){var f=Math.abs(u.startPTS-i);isNaN(u.deltaPTS)?u.deltaPTS=f:u.deltaPTS=Math.max(f,u.deltaPTS),i=Math.min(i,u.startPTS),a=Math.max(a,u.endPTS),n=Math.min(n,u.startDTS),s=Math.max(s,u.endDTS)}var h=i-u.start;for(u.start=u.startPTS=i,u.endPTS=a,u.startDTS=n,u.endDTS=s,u.duration=a-i,d=o;d>0;d--)e.updatePTS(l,d,d-1);for(d=o;d<l.length-1;d++)e.updatePTS(l,d,d+1);return t.PTSKnown=!0,h}},{key:"updatePTS",value:function(e,t,r){var i=e[t],a=e[r],s=a.startPTS;isNaN(s)?r>t?a.start=i.start+i.duration:a.start=i.start-a.duration:r>t?(i.duration=s-i.start,i.duration<0&&n.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")):(a.duration=i.start-s,a.duration<0&&n.logger.warn("negative duration computed for frag "+a.sn+",level "+a.level+", there should be some duration drift between playlist and fragment!"))}}]),e}();r.default=s},{45:45}],32:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(28),o=i(s),l=e(26),u=e(36),d=i(u),f=e(34),h=i(f),c=e(4),g=i(c),v=e(7),p=i(v),y=e(8),m=i(y),E=e(5),b=i(E),R=e(12),_=i(R),T=e(11),k=i(T),A=e(13),S=i(A),L=e(10),D=i(L),w=e(6),O=i(w),I=e(45),P=e(47),C=i(P),M=e(1),x=i(M),F=e(35),N=i(F),U=e(43),G=i(U),B=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e);var r=e.DefaultConfig;if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var i in r)i in t||(t[i]=r[i]);if(void 0!==t.liveMaxLatencyDurationCount&&t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(t.liveMaxLatencyDuration<=t.liveSyncDuration||void 0===t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,I.enableLogs)(t.debug),this.config=t;var n=this.observer=new x.default;n.trigger=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];n.emit.apply(n,[e,e].concat(r))},n.off=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];n.removeListener.apply(n,[e].concat(r))},this.on=n.on.bind(n),this.off=n.off.bind(n),this.trigger=n.trigger.bind(n),this.playlistLoader=new d.default(this),this.fragmentLoader=new h.default(this),this.levelController=new k.default(this),this.abrController=new t.abrController(this),this.bufferController=new t.bufferController(this),this.capLevelController=new t.capLevelController(this),this.fpsController=new t.fpsController(this),this.streamController=new t.streamController(this),this.audioStreamController=new t.audioStreamController(this),this.timelineController=new t.timelineController(this),this.audioTrackController=new O.default(this),this.keyLoader=new N.default(this)}return n(e,null,[{key:"isSupported",value:function(){return window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"version",get:function(){return"0.6.21"}},{key:"Events",get:function(){return o.default}},{key:"ErrorTypes",get:function(){return l.ErrorTypes}},{key:"ErrorDetails",get:function(){return l.ErrorDetails}},{key:"DefaultConfig",get:function(){return e.defaultConfig||(e.defaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxMaxBufferLength:600,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:C.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:g.default,bufferController:p.default,capLevelController:m.default,fpsController:D.default,streamController:_.default,audioStreamController:b.default,timelineController:S.default,cueHandler:G.default,enableCEA708Captions:!0,enableMP2TPassThrough:!1,stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0}),e.defaultConfig},set:function(t){e.defaultConfig=t}}]),n(e,[{key:"destroy",value:function(){I.logger.log("destroy"),this.trigger(o.default.DESTROYING),this.detachMedia(),this.playlistLoader.destroy(),this.fragmentLoader.destroy(),this.levelController.destroy(),this.abrController.destroy(),this.bufferController.destroy(),this.capLevelController.destroy(),this.fpsController.destroy(),this.streamController.destroy(),this.audioStreamController.destroy(),this.timelineController.destroy(),this.audioTrackController.destroy(),this.keyLoader.destroy(),this.url=null,this.observer.removeAllListeners()}},{key:"attachMedia",value:function(e){I.logger.log("attachMedia"),this.media=e,this.trigger(o.default.MEDIA_ATTACHING,{media:e})}},{key:"detachMedia",value:function(){I.logger.log("detachMedia"),this.trigger(o.default.MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(e){I.logger.log("loadSource:"+e),this.url=e,this.trigger(o.default.MANIFEST_LOADING,{url:e})}},{key:"startLoad",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;I.logger.log("startLoad("+e+")"),this.levelController.startLoad(),this.streamController.startLoad(e),this.audioStreamController.startLoad(e)}},{key:"stopLoad",value:function(){I.logger.log("stopLoad"),this.levelController.stopLoad(),this.streamController.stopLoad(),this.audioStreamController.stopLoad()}},{key:"swapAudioCodec",value:function(){I.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){I.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){I.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){I.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){I.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.abrController.minAutoLevel)},set:function(e){I.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){I.logger.log("set startLevel:"+e),this.levelController.startLevel=e}},{key:"autoLevelCapping",get:function(){return this.abrController.autoLevelCapping},set:function(e){I.logger.log("set autoLevelCapping:"+e),this.abrController.autoLevelCapping=e}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"audioTracks",get:function(){return this.audioTrackController.audioTracks}},{key:"audioTrack",get:function(){return this.audioTrackController.audioTrack},set:function(e){this.audioTrackController.audioTrack=e}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}}]),e}();r.default=B},{1:1,10:10,11:11,12:12,13:13,26:26,28:28,34:34,35:35,36:36,4:4,43:43,45:45,47:47,5:5,6:6,7:7,8:8}],33:[function(e,t,r){"use strict";t.exports=e(32).default},{32:32}],34:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),h=e(26),c=e(45),g=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.FRAG_LOADING));return r.loaders={},r}return s(t,e),o(t,[{key:"destroy",value:function(){var e=this.loaders;for(var t in e){var r=e[t];r&&r.destroy()}this.loaders={},f.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){var t=e.frag,r=t.type,i=this.loaders[r],a=this.hls.config;t.loaded=0,i&&(c.logger.warn("abort previous fragment loader for type:"+r),i.abort()),i=this.loaders[r]=t.loader="undefined"!=typeof a.fLoader?new a.fLoader(a):new a.loader(a);var n=void 0,s=void 0,o=void 0;n={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var l=t.byteRangeStartOffset,u=t.byteRangeEndOffset;isNaN(l)||isNaN(u)||(n.rangeStart=l,n.rangeEnd=u),s={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout},o={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},i.load(n,s,o)}},{key:"loadsuccess",value:function(e,t,r){var i=e.data,a=r.frag;a.loader=void 0,this.loaders[a.type]=void 0,this.hls.trigger(u.default.FRAG_LOADED,{payload:i,frag:a,stats:t})}},{key:"loaderror",value:function(e,t){var r=t.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e})}},{key:"loadtimeout",value:function(e,t){var r=t.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag})}},{key:"loadprogress",value:function(e,t,r){var i=t.frag;i.loaded=e.loaded,this.hls.trigger(u.default.FRAG_LOAD_PROGRESS,{frag:i,stats:e})}}]),t}(f.default);r.default=g},{26:26,27:27,28:28,45:45}],35:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(28),u=i(l),d=e(27),f=i(d),h=e(26),c=e(45),g=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.KEY_LOADING));return r.loaders={},r.decryptkey=null,r.decrypturl=null,r}return s(t,e),o(t,[{key:"destroy",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},f.default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(e){var t=e.frag,r=t.type,i=this.loaders[r],a=t.decryptdata,n=a.uri;if(n!==this.decrypturl||null===this.decryptkey){var s=this.hls.config;i&&(c.logger.warn("abort previous key loader for type:"+r),i.abort()),t.loader=this.loaders[r]=new s.loader(s),this.decrypturl=n,this.decryptkey=null;var o=void 0,l=void 0,d=void 0;o={url:n,frag:t,responseType:"arraybuffer"},l={timeout:s.fragLoadingTimeOut,maxRetry:s.fragLoadingMaxRetry,retryDelay:s.fragLoadingRetryDelay,maxRetryDelay:s.fragLoadingMaxRetryTimeout},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},t.loader.load(o,l,d)}else this.decryptkey&&(a.key=this.decryptkey,this.hls.trigger(u.default.KEY_LOADED,{frag:t}))}},{key:"loadsuccess",value:function(e,t,r){var i=r.frag;this.decryptkey=i.decryptdata.key=new Uint8Array(e.data),i.loader=void 0,this.loaders[i.type]=void 0,this.hls.trigger(u.default.KEY_LOADED,{frag:i})}},{key:"loaderror",value:function(e,t){var r=t.frag,i=r.loader;i&&i.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:r,response:e})}},{key:"loadtimeout",value:function(e,t){var r=t.frag,i=r.loader;i&&i.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:r})}}]),t}(f.default);r.default=g},{26:26,27:27,28:28,45:45}],36:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(2),u=i(l),d=e(28),f=i(d),h=e(27),c=i(h),g=e(26),v=e(40),p=i(v),y=e(45),m=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,E=/#EXT-X-MEDIA:(.*)/g,b=/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*))?|(?!#)(\S.+)|#EXT-X-BYTERANGE: *(.+)|#EXT-X-PROGRAM-DATE-TIME:(.+)|#.*/g,R=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,_=function(){function e(){s(this,e),this.method=null,this.key=null,this.iv=null,this._uri=null}return o(e,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=u.default.buildAbsoluteURL(this.baseuri,this.reluri)),this._uri}}]),e}(),T=function(){function e(){s(this,e),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return o(e,[{key:"createInitializationVector",value:function(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t}},{key:"fragmentDecryptdataFromLevelkey",value:function(e,t){var r=e;return e&&e.method&&e.uri&&!e.iv&&(r=new _,r.method=e.method,r.baseuri=e.baseuri,r.reluri=e.reluri,r.iv=this.createInitializationVector(t)),r}},{key:"cloneObj",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=u.default.buildAbsoluteURL(this.baseurl,this.relurl)),this._url},set:function(e){this._url=e}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var e=this._byteRange=[];if(this.rawByteRange){var t=this.rawByteRange.split("@",2);if(1===t.length){var r=this.lastByteRangeEndOffset;e[0]=r?r:0}else e[0]=parseInt(t[1]);e[1]=parseInt(t[0])+e[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),e}(),k=function(e){function t(e){s(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,f.default.MANIFEST_LOADING,f.default.LEVEL_LOADING,f.default.AUDIO_TRACK_LOADING));return r.loaders={},r}return n(t,e),o(t,[{key:"destroy",value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},c.default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(e){this.load(e.url,{type:"manifest"})}},{key:"onLevelLoading",value:function(e){this.load(e.url,{type:"level",level:e.level,id:e.id})}},{key:"onAudioTrackLoading",value:function(e){this.load(e.url,{type:"audioTrack",id:e.id})}},{key:"load",value:function(e,t){var r=this.loaders[t.type];if(r){var i=r.context;if(i&&i.url===e)return void y.logger.trace("playlist request ongoing");y.logger.warn("abort previous loader for type:"+t.type),r.abort()}var a=this.hls.config,n=void 0,s=void 0,o=void 0,l=void 0;"manifest"===t.type?(n=a.manifestLoadingMaxRetry,s=a.manifestLoadingTimeOut,o=a.manifestLoadingRetryDelay,l=a.manifestLoadingMaxRetryTimeout):(n=a.levelLoadingMaxRetry,s=a.levelLoadingTimeOut,o=a.levelLoadingRetryDelay,l=a.levelLoadingMaxRetryTimeout,y.logger.log("loading playlist for "+t.type+" "+(t.level||t.id))),r=this.loaders[t.type]=t.loader="undefined"!=typeof a.pLoader?new a.pLoader(a):new a.loader(a),t.url=e,t.responseType="";var u=void 0,d=void 0;u={timeout:s,maxRetry:n,retryDelay:o,maxRetryDelay:l},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},r.load(t,u,d)}},{key:"resolve",value:function(e,t){return u.default.buildAbsoluteURL(t,e)}},{key:"parseMasterPlaylist",value:function(e,t){var r=[],i=void 0;for(m.lastIndex=0;null!=(i=m.exec(e));){var a={},n=a.attrs=new p.default(i[1]);a.url=this.resolve(i[2],t);var s=n.decimalResolution("RESOLUTION");s&&(a.width=s.width,a.height=s.height),a.bitrate=n.decimalInteger("AVERAGE-BANDWIDTH")||n.decimalInteger("BANDWIDTH"),a.name=n.NAME;var o=n.CODECS;if(o){o=o.split(/[ ,]+/);for(var l=0;l<o.length;l++){var u=o[l];u.indexOf("avc1")!==-1?a.videoCodec=this.avc1toavcoti(u):a.audioCodec=u}}r.push(a)}return r}},{key:"parseMasterPlaylistMedia",value:function(e,t,r){var i=void 0,a=[];for(E.lastIndex=0;null!=(i=E.exec(e));){var n={},s=new p.default(i[1]);s.TYPE===r&&(n.groupId=s["GROUP-ID"],n.name=s.NAME,n.type=r,n.default="YES"===s.DEFAULT,n.autoselect="YES"===s.AUTOSELECT,n.forced="YES"===s.FORCED,s.URI&&(n.url=this.resolve(s.URI,t)),n.lang=s.LANGUAGE,n.name||(n.name=n.lang),a.push(n))}return a}},{key:"avc1toavcoti",value:function(e){var t,r=e.split(".");return r.length>2?(t=r.shift()+".",t+=parseInt(r.shift()).toString(16),t+=("000"+parseInt(r.shift()).toString(16)).substr(-4)):t=e,t}},{key:"parseLevelPlaylist",value:function(e,t,r,i){var a,n,s=0,o=0,l={type:null,version:null,url:t,fragments:[],live:!0,startSN:0},u=new _,d=0,f=null,h=new T;for(b.lastIndex=0;null!==(a=b.exec(e));){var c=a[1];if(c){h.duration=parseFloat(c);var g=(" "+a[2]).slice(1);h.title=g?g:null,h.tagList.push(g?["INF",c,g]:["INF",c])}else if(a[3]){if(!isNaN(h.duration)){var v=s++;h.type=i,h.start=o,h.levelkey=u,h.sn=v,h.level=r,h.cc=d,h.baseurl=t,h.relurl=(" "+a[3]).slice(1),l.fragments.push(h),f=h,o+=h.duration,h=new T}}else if(a[4]){if(h.rawByteRange=(" "+a[4]).slice(1),f){var m=f.byteRangeEndOffset;m&&(h.lastByteRangeEndOffset=m)}}else if(a[5])h.rawProgramDateTime=(" "+a[5]).slice(1),h.tagList.push(["PROGRAM-DATE-TIME",h.rawProgramDateTime]);else{for(a=a[0].match(R),n=1;n<a.length&&void 0===a[n];n++);var E=(" "+a[n+1]).slice(1),k=(" "+a[n+2]).slice(1);switch(a[n]){case"#":h.tagList.push(k?[E,k]:[E]);break;case"PLAYLIST-TYPE":l.type=E.toUpperCase();break;case"MEDIA-SEQUENCE":s=l.startSN=parseInt(E);break;case"TARGETDURATION":l.targetduration=parseFloat(E);break;case"VERSION":l.version=parseInt(E);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"DIS":d++,h.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":d=parseInt(E);break;case"KEY":var A=E,S=new p.default(A),L=S.enumeratedString("METHOD"),D=S.URI,w=S.hexadecimalInteger("IV");L&&(u=new _,D&&"AES-128"===L&&(u.method=L,u.baseuri=t,u.reluri=D,u.key=null,u.iv=w));break;case"START":var O=E,I=new p.default(O),P=I.decimalFloatingPoint("TIME-OFFSET");isNaN(P)||(l.startTimeOffset=P);break;case"MAP":var C=new p.default(E);h.relurl=C.URI,h.rawByteRange=C.BYTERANGE,h.baseurl=t,h.level=r,h.type=i,h.sn="initSegment",l.initSegment=h,h=new T;break;default:y.logger.warn("line parsed but not handled: "+a)}}}return h=f,h&&!h.relurl&&(l.fragments.pop(),o-=h.duration),l.totalduration=o,l.averagetargetduration=o/l.fragments.length,l.endSN=s-1,l}},{key:"loadsuccess",value:function(e,t,r){var i=e.data,a=e.url,n=r.type,s=r.id,o=r.level,l=this.hls;if(this.loaders[n]=void 0,void 0!==a&&0!==a.indexOf("data:")||(a=r.url),t.tload=performance.now(),0===i.indexOf("#EXTM3U"))if(i.indexOf("#EXTINF:")>0){var u="audioTrack"!==n,d=this.parseLevelPlaylist(i,a,(u?o:s)||0,u?"main":"audio");"manifest"===n&&l.trigger(f.default.MANIFEST_LOADED,{levels:[{url:a,details:d}],audioTracks:[],url:a,stats:t}),t.tparsed=performance.now(),d.targetduration?u?l.trigger(f.default.LEVEL_LOADED,{details:d,level:o||0,id:s||0,stats:t}):l.trigger(f.default.AUDIO_TRACK_LOADED,{details:d,id:s,stats:t}):l.trigger(f.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:a,reason:"invalid targetduration"})}else{var h=this.parseMasterPlaylist(i,a);if(h.length){var c=this.parseMasterPlaylistMedia(i,a,"AUDIO");if(c.length){var v=!1;c.forEach(function(e){e.url||(v=!0)}),v===!1&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(y.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),c.unshift({type:"main",name:"main"}))}l.trigger(f.default.MANIFEST_LOADED,{levels:h,audioTracks:c,url:a,stats:t})}else l.trigger(f.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:a,reason:"no level found in manifest"})}else l.trigger(f.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:a,reason:"no EXTM3U delimiter"})}},{key:"loaderror",value:function(e,t){var r,i,a=t.loader;switch(t.type){case"manifest":r=g.ErrorDetails.MANIFEST_LOAD_ERROR,i=!0;break;case"level":r=g.ErrorDetails.LEVEL_LOAD_ERROR,i=!1;break;case"audioTrack":r=g.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,i=!1}a&&(a.abort(),this.loaders[t.type]=void 0),this.hls.trigger(f.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:r,fatal:i,url:a.url,loader:a,response:e,context:t})}},{key:"loadtimeout",value:function(e,t){var r,i,a=t.loader;switch(t.type){case"manifest":r=g.ErrorDetails.MANIFEST_LOAD_TIMEOUT,i=!0;break;case"level":r=g.ErrorDetails.LEVEL_LOAD_TIMEOUT,i=!1;break;case"audioTrack":r=g.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT,i=!1}a&&(a.abort(),this.loaders[t.type]=void 0),this.hls.trigger(f.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:r,fatal:i,url:a.url,loader:a,context:t})}}]),t}(c.default);r.default=k},{2:2,26:26,27:27,28:28,40:40,45:45}],37:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){i(this,e)}return a(e,null,[{key:"init",value:function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var t;for(t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:r,audio:i};var a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=n,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,s,l,s,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,a))}},{key:"box",value:function(e){for(var t,r=Array.prototype.slice.call(arguments,1),i=8,a=r.length,n=a;a--;)i+=r[a].byteLength;for(t=new Uint8Array(i),t[0]=i>>24&255,t[1]=i>>16&255,t[2]=i>>8&255,t[3]=255&i,t.set(e,4),a=0,i=8;a<n;a++)t.set(r[a],i),i+=r[a].byteLength;return t}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,r){return r*=t,e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,r,i){return e.box(e.types.moof,e.mfhd(t),e.traf(i,r))}},{key:"moov",value:function(t){for(var r=t.length,i=[];r--;)i[r]=e.trak(t[r]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(e.mvex(t)))}},{key:"mvex",value:function(t){for(var r=t.length,i=[];r--;)i[r]=e.trex(t[r]);return e.box.apply(null,[e.types.mvex].concat(i))}},{key:"mvhd",value:function(t,r){r*=t;var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,i)}},{key:"sdtp",value:function(t){var r,i,a=t.samples||[],n=new Uint8Array(4+a.length);for(i=0;i<a.length;i++)r=a[i].flags,n[i+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return e.box(e.types.sdtp,n)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var r,i,a,n=[],s=[];for(r=0;r<t.sps.length;r++)i=t.sps[r],a=i.byteLength,n.push(a>>>8&255),n.push(255&a),n=n.concat(Array.prototype.slice.call(i));for(r=0;r<t.pps.length;r++)i=t.pps[r],a=i.byteLength,s.push(a>>>8&255),s.push(255&a),s=s.concat(Array.prototype.slice.call(i));var o=e.box(e.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|t.sps.length].concat(n).concat([t.pps.length]).concat(s))),l=t.width,u=t.height,d=t.pixelRatio[0],f=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,f>>24,f>>16&255,f>>8&255,255&f])))}},{key:"esds",value:function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}},{key:"mp4a",value:function(t){var r=t.audiosamplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),e.box(e.types.esds,e.esds(t)))}},{key:"mp3",value:function(t){var r=t.audiosamplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))}},{key:"stsd",value:function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var r=t.id,i=t.duration*t.timescale,a=t.width,n=t.height;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,n>>8&255,255&n,0,0]))}},{key:"traf",value:function(t,r){var i=e.sdtp(t),a=t.id;return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a])),e.box(e.types.tfdt,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),e.trun(t,i.length+16+16+8+16+8+8),i);}},{key:"trak",value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(t){var r=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(t,r){var i,a,n,s,o,l,u=t.samples||[],d=u.length,f=12+16*d,h=new Uint8Array(f);for(r+=8+f,h.set([0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),i=0;i<d;i++)a=u[i],n=a.duration,s=a.size,o=a.flags,l=a.cts,h.set([n>>>24&255,n>>>16&255,n>>>8&255,255&n,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*i);return e.box(e.types.trun,h)}},{key:"initSegment",value:function(t){e.types||e.init();var r,i=e.moov(t);return r=new Uint8Array(e.FTYP.byteLength+i.byteLength),r.set(e.FTYP),r.set(i,e.FTYP.byteLength),r}}]),e}();r.default=n},{}],38:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(29),o=i(s),l=e(28),u=i(l),d=e(45),f=e(37),h=i(f),c=e(26),g=function(){function e(t,r,i,n){a(this,e),this.observer=t,this.id=r,this.config=i,this.typeSupported=n,this.ISGenerated=!1,this.PES2MP4SCALEFACTOR=4,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR}return n(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){this._initPTS=this._initDTS=void 0}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,r,i,a,n,s,o,l,d,f){if(this.level=e,this.sn=t,this.ISGenerated||this.generateIS(i,a,o,r),null!==f&&(this._initPTS=this._initDTS=f),this.ISGenerated)if(i.samples.length){var h=this.remuxAudio(i,o,l,d);if(a.samples.length){var c=void 0;h&&(c=h.endPTS-h.startPTS),this.remuxVideo(a,o,l,c)}}else{var g=void 0;a.samples.length&&(g=this.remuxVideo(a,o,l)),g&&i.codec&&this.remuxEmptyAudio(i,o,l,g)}n.samples.length&&this.remuxID3(n,o),s.samples.length&&this.remuxText(s,o),this.observer.trigger(u.default.FRAG_PARSED,{id:this.id,level:this.level,sn:this.sn})}},{key:"generateIS",value:function(e,t,r,i){var a,n,s=this.observer,o=e.samples,l=t.samples,f=this.PES_TIMESCALE,g=this.typeSupported,v="audio/mp4",p={},y={id:this.id,level:this.level,sn:this.sn,tracks:p,unique:!1},m=void 0===this._initPTS;m&&(a=n=1/0),e.config&&o.length&&(e.timescale=e.audiosamplerate,e.timescale*e.duration>Math.pow(2,32)&&!function(){var t=function e(t,r){return r?e(r,t%r):t};e.timescale=e.audiosamplerate/t(e.audiosamplerate,e.isAAC?1024:1152)}(),d.logger.log("audio mp4 timescale :"+e.timescale),e.isAAC||(g.mpeg?(v="audio/mpeg",e.codec=""):g.mp3&&(e.codec="mp3")),p.audio={container:v,codec:e.codec,initSegment:!e.isAAC&&g.mpeg?new Uint8Array:h.default.initSegment([e]),metadata:{channelCount:e.channelCount}},m&&(a=n=o[0].pts-f*r)),t.sps&&t.pps&&l.length&&(t.timescale=this.MP4_TIMESCALE,p.video={container:"video/mp4",codec:t.codec,initSegment:h.default.initSegment([t]),metadata:{width:t.width,height:t.height}},m&&(a=Math.min(a,l[0].pts-f*r),n=Math.min(n,l[0].dts-f*r),this.observer.trigger(u.default.INIT_PTS_FOUND,{id:this.id,initPTS:a,cc:i}))),Object.keys(p).length?(s.trigger(u.default.FRAG_PARSING_INIT_SEGMENT,y),this.ISGenerated=!0,m&&(this._initPTS=a,this._initDTS=n)):s.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,id:this.id,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(e,t,r,i){var a,n,s,o,l,f,g,v,p=8,y=this.PES_TIMESCALE,m=this.PES2MP4SCALEFACTOR,E=e.samples,b=[],R=E.length,_=this._PTSNormalize,T=this._initDTS;E.sort(function(e,t){var r=e.dts-t.dts;return r?r:e.pts-t.pts});var k=E.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(k<0){d.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(k/90)+" ms to overcome this issue");for(var A=0;A<E.length;A++)E[A].dts+=k}var S=void 0;S=r?this.nextAvcDts:t*y;var L=E[0];l=Math.max(_(L.dts-T,S),0),o=Math.max(_(L.pts-T,S),0);var D=Math.round((l-S)/90);r&&D&&(D>1?d.logger.log("AVC:"+D+" ms hole between fragments detected,filling it"):D<-1&&d.logger.log("AVC:"+-D+" ms overlapping between fragments detected"),l=S,E[0].dts=l+T,o=Math.max(o-D,S),E[0].pts=o+T,d.logger.log("Video/PTS/DTS adjusted: "+Math.round(o/90)+"/"+Math.round(l/90)+",delta:"+D+" ms")),f=l,L=E[E.length-1],v=Math.max(_(L.dts-T,S),0),g=Math.max(_(L.pts-T,S),0),g=Math.max(g,v);var w=navigator.vendor,O=navigator.userAgent,I=w&&w.indexOf("Apple")>-1&&O&&!O.match("CriOS");I&&(a=Math.round((v-l)/(m*(E.length-1))));for(var P=0;P<R;P++){var C=E[P];I?C.dts=l+P*m*a:(C.dts=Math.max(_(C.dts-T,S),l),C.dts=Math.round(C.dts/m)*m),C.pts=Math.max(_(C.pts-T,S),C.dts),C.pts=Math.round(C.pts/m)*m}var M=e.len+4*e.nbNalu+8;try{n=new Uint8Array(M)}catch(e){return void this.observer.trigger(u.default.ERROR,{type:c.ErrorTypes.MUX_ERROR,level:this.level,id:this.id,details:c.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:M,reason:"fail allocating video mdat "+M})}var x=new DataView(n.buffer);x.setUint32(0,M),n.set(h.default.types.mdat,4);for(var F=0;F<R;F++){for(var N=E[F],U=N.units.units,G=0,B=void 0,j=0,H=U.length;j<H;j++){var K=U[j],W=K.data,V=K.data.byteLength;x.setUint32(p,V),p+=4,n.set(W,p),p+=V,G+=4+V}if(I)B=Math.max(0,a*Math.round((N.pts-N.dts)/(m*a)));else{if(F<R-1)a=E[F+1].dts-N.dts;else{var Y=this.config,X=N.dts-E[F>0?F-1:F].dts;if(Y.stretchShortVideoTrack){var q=Y.maxBufferHole,z=Y.maxSeekHole,J=Math.floor(Math.min(q,z)*y),Q=(i?o+i*y:this.nextAudioPts)-N.pts;Q>J?(a=Q-X,a<0&&(a=X),d.logger.log("It is approximately "+Q/90+" ms to the next segment; using duration "+a/90+" ms for the last video frame.")):a=X}else a=X}a/=m,B=Math.round((N.pts-N.dts)/m)}b.push({size:G,duration:a,cts:B,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:N.key?2:1,isNonSync:N.key?0:1}})}this.nextAvcDts=v+a*m;var $=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,b.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var Z=b[0].flags;Z.dependsOn=2,Z.isNonSync=0}e.samples=b,s=h.default.moof(e.sequenceNumber++,l/m,e),e.samples=[];var ee={id:this.id,level:this.level,sn:this.sn,data1:s,data2:n,startPTS:o/y,endPTS:(g+m*a)/y,startDTS:l/y,endDTS:this.nextAvcDts/y,type:"video",nb:b.length,dropped:$};return this.observer.trigger(u.default.FRAG_PARSING_DATA,ee),ee}},{key:"remuxAudio",value:function(e,t,r,i){var a,n,s,l,f,g,v,p,y,m,E,b,R,_,T,k,A=this.PES_TIMESCALE,S=e.timescale,L=A/S,D=e.timescale*(e.isAAC?1024:1152)/e.audiosamplerate,w=D*L,O=this._PTSNormalize,I=this._initDTS,P=!e.isAAC&&this.typeSupported.mpeg,C=P?0:8,M=[],x=[];if(e.samples.sort(function(e,t){return e.pts-t.pts}),x=e.samples,k=this.nextAudioPts,r|=x.length&&k&&(Math.abs(t-k/A)<.1||Math.abs(x[0].pts-k-this._initDTS)<20*w),r||(k=t*A),i&&e.isAAC)for(var F=0,N=k;F<x.length;){var U=x[F],G=O(U.pts-I,k),B=G-N;if(B<=-w)d.logger.warn("Dropping 1 audio frame @ "+Math.round(N/90)/1e3+"s due to "+Math.round(Math.abs(B/90))+" ms overlap."),x.splice(F,1),e.len-=U.unit.length;else if(B>=w&&N){var j=Math.round(B/w);d.logger.warn("Injecting "+j+" audio frame @ "+Math.round(N/90)/1e3+"s due to "+Math.round(B/90)+" ms gap.");for(var H=0;H<j;H++)T=N+I,T=Math.max(T,I),_=o.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),_||(d.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),_=U.unit.subarray()),x.splice(F,0,{unit:_,pts:T,dts:T}),e.len+=_.length,N+=w,F+=1;U.pts=U.dts=N+I,N+=w,F+=1}else Math.abs(B)>.1*w,N+=w,0===F?U.pts=U.dts=I+k:U.pts=U.dts=x[F-1].pts+w,F+=1}for(var K=0,W=x.length;K<W;K++){if(n=x[K],l=n.unit,m=n.pts-I,E=n.dts-I,void 0!==y)b=O(m,y),R=O(E,y),s.duration=Math.round((R-y)/L);else{b=O(m,k),R=O(E,k);var V=Math.round(1e3*(b-k)/A),Y=0;if(r&&e.isAAC&&V){if(V>0)Y=Math.round((b-k)/w),d.logger.log(V+" ms hole between AAC samples detected,filling it"),Y>0&&(_=o.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),_||(_=l.subarray()),e.len+=Y*_.length);else if(V<-12){d.logger.log(-V+" ms overlapping between AAC samples detected, drop frame"),e.len-=l.byteLength;continue}b=R=k}if(v=Math.max(0,b),p=Math.max(0,R),!(e.len>0))return;var X=P?e.len:e.len+8;try{f=new Uint8Array(X)}catch(e){return void this.observer.trigger(u.default.ERROR,{type:c.ErrorTypes.MUX_ERROR,level:this.level,id:this.id,details:c.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:X,reason:"fail allocating audio mdat "+X})}P||(a=new DataView(f.buffer),a.setUint32(0,X),f.set(h.default.types.mdat,4));for(var q=0;q<Y;q++)T=b-(Y-q)*w,_=o.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),_||(d.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),_=l.subarray()),f.set(_,C),C+=_.byteLength,s={size:_.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},M.push(s)}f.set(l,C);var z=l.byteLength;C+=z,s={size:z,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},M.push(s),y=R}var J=0,Q=M.length;if(Q>=2&&(J=M[Q-2].duration,s.duration=J),Q){this.nextAudioPts=b+L*J,e.len=0,e.samples=M,g=P?new Uint8Array:h.default.moof(e.sequenceNumber++,p/L,e),e.samples=[];var $={id:this.id,level:this.level,sn:this.sn,data1:g,data2:f,startPTS:v/A,endPTS:this.nextAudioPts/A,startDTS:p/A,endDTS:(R+L*J)/A,type:"audio",nb:Q};return this.observer.trigger(u.default.FRAG_PARSING_DATA,$),$}return null}},{key:"remuxEmptyAudio",value:function(e,t,r,i){var a=this.PES_TIMESCALE,n=e.timescale?e.timescale:e.audiosamplerate,s=a/n,l=this.nextAudioPts,u=(void 0!==l?l:i.startDTS*a)+this._initDTS,f=i.endDTS*a+this._initDTS,h=1024,c=s*h,g=Math.ceil((f-u)/c),v=o.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(d.logger.warn("remux empty Audio"),!v)return void d.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var p=[],y=0;y<g;y++){var m=u+y*c;p.push({unit:v,pts:m,dts:m}),e.len+=v.length}e.samples=p,this.remuxAudio(e,t,r)}},{key:"remuxID3",value:function(e,t){var r,i=e.samples.length;if(i){for(var a=0;a<i;a++)r=e.samples[a],r.pts=(r.pts-this._initPTS)/this.PES_TIMESCALE,r.dts=(r.dts-this._initDTS)/this.PES_TIMESCALE;this.observer.trigger(u.default.FRAG_PARSING_METADATA,{id:this.id,level:this.level,sn:this.sn,samples:e.samples})}e.samples=[],t=t}},{key:"remuxText",value:function(e,t){e.samples.sort(function(e,t){return e.pts-t.pts});var r,i=e.samples.length;if(i){for(var a=0;a<i;a++)r=e.samples[a],r.pts=(r.pts-this._initPTS)/this.PES_TIMESCALE;this.observer.trigger(u.default.FRAG_PARSING_USERDATA,{id:this.id,level:this.level,sn:this.sn,samples:e.samples})}e.samples=[],t=t}},{key:"_PTSNormalize",value:function(e,t){var r;if(void 0===t)return e;for(r=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=r;return e}},{key:"passthrough",get:function(){return!1}}]),e}();r.default=g},{26:26,28:28,29:29,37:37,45:45}],39:[function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(28),o=i(s),l=function(){function e(t,r){a(this,e),this.observer=t,this.id=r,this.ISGenerated=!1}return n(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,r,i,a,n){var s=this.observer;if(!this.ISGenerated){var l={},u={id:this.id,tracks:l,unique:!0},d=t,f=d.codec;f&&(u.tracks.video={container:d.container,codec:f,metadata:{width:d.width,height:d.height}}),d=e,f=d.codec,f&&(u.tracks.audio={container:d.container,codec:f,metadata:{channelCount:d.channelCount}}),this.ISGenerated=!0,s.trigger(o.default.FRAG_PARSING_INIT_SEGMENT,u)}s.trigger(o.default.FRAG_PARSING_DATA,{id:this.id,data1:n,startPTS:a,startDTS:a,type:"audiovideo",nb:1,dropped:0})}},{key:"passthrough",get:function(){return!0}}]),e}();r.default=l},{28:28}],40:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=/^(\d+)x(\d+)$/,s=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,o=function(){function e(t){i(this,e),"string"==typeof t&&(t=e.parseAttrList(t));for(var r in t)t.hasOwnProperty(r)&&(this[r]=t[r])}return a(e,[{key:"decimalInteger",value:function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"hexadecimalInteger",value:function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(2*i,2*i+2),16);return r}return null}},{key:"hexadecimalIntegerAsNumber",value:function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"decimalFloatingPoint",value:function(e){return parseFloat(this[e])}},{key:"enumeratedString",value:function(e){return this[e]}},{key:"decimalResolution",value:function(e){var t=n.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}}],[{key:"parseAttrList",value:function(e){var t,r={};for(s.lastIndex=0;null!==(t=s.exec(e));){var i=t[2],a='"';0===i.indexOf(a)&&i.lastIndexOf(a)===i.length-1&&(i=i.slice(1,-1)),r[t[1]]=i}return r}}]),e}();r.default=o},{}],41:[function(e,t,r){"use strict";var i={search:function(e,t){for(var r=0,i=e.length-1,a=null,n=null;r<=i;){a=(r+i)/2|0,n=e[a];var s=t(n);if(s>0)r=a+1;else{if(!(s<0))return n;i=a-1}}return null}};t.exports=i},{}],42:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},s=function(e){var t=e;return n.hasOwnProperty(e)&&(t=n[e]),String.fromCharCode(t)},o=15,l=32,u={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},d={17:2,18:4,21:6,22:8,23:10,19:13,20:15},f={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},h={25:2,26:4,29:6,30:8,31:10,27:13,28:15},c=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],g={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var r=this.verboseFilter[e];this.verboseLevel>=r}},v=function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].toString(16));return t},p=function(){function e(t,r,a,n,s){i(this,e),this.foreground=t||"white",this.underline=r||!1,this.italics=a||!1,this.background=n||"black",this.flash=s||!1}return a(e,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}},{key:"copy",value:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),e}(),y=function(){function e(t,r,a,n,s,o){i(this,e),this.uchar=t||" ",this.penState=new p(r,a,n,s,o)}return a(e,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(e,t){this.uchar=e,this.penState.copy(t)}},{key:"setPenState",value:function(e){this.penState.copy(e)}},{key:"equals",value:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}},{key:"copy",value:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),e}(),m=function(){function e(){i(this,e),this.chars=[];for(var t=0;t<l;t++)this.chars.push(new y);this.pos=0,this.currPenState=new p}return a(e,[{key:"equals",value:function(e){for(var t=!0,r=0;r<l;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<l;t++)this.chars[t].copy(e.chars[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<l;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}},{key:"setCursor",value:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(g.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>l&&(g.log("ERROR","Too large cursor position "+this.pos),this.pos=l)}},{key:"moveCursor",value:function(e){var t=this.pos+e;if(e>1)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(e){e>=144&&this.backSpace();var t=s(e);return this.pos>=l?void g.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),void this.moveCursor(1))}},{key:"clearFromPos",value:function(e){var t;for(t=e;t<l;t++)this.chars[t].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var e=[],t=!0,r=0;r<l;r++){var i=this.chars[r].uchar;" "!==i&&(t=!1),e.push(i)}return t?"":e.join("")}},{key:"setPenStyles",value:function(e){this.currPenState.setStyles(e);var t=this.chars[this.pos];t.setPenState(this.currPenState)}}]),e}(),E=function(){function e(){i(this,e),this.rows=[];for(var t=0;t<o;t++)this.rows.push(new m);this.currRow=o-1,this.nrRollUpRows=null,this.reset()}return a(e,[{key:"reset",value:function(){for(var e=0;e<o;e++)this.rows[e].clear();this.currRow=o-1}},{key:"equals",value:function(e){for(var t=!0,r=0;r<o;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}},{key:"copy",value:function(e){for(var t=0;t<o;t++)this.rows[t].copy(e.rows[t])}},{key:"isEmpty",value:function(){for(var e=!0,t=0;t<o;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}},{key:"backSpace",value:function(){var e=this.rows[this.currRow];e.backSpace()}},{key:"clearToEndOfRow",value:function(){var e=this.rows[this.currRow];e.clearToEndOfRow()}},{key:"insertChar",value:function(e){var t=this.rows[this.currRow];t.insertChar(e)}},{key:"setPen",value:function(e){var t=this.rows[this.currRow];t.setPenStyles(e)}},{key:"moveCursor",value:function(e){var t=this.rows[this.currRow];t.moveCursor(e)}},{key:"setCursor",value:function(e){g.log("INFO","setCursor: "+e);var t=this.rows[this.currRow];t.setCursor(e)}},{key:"setPAC",value:function(e,t){g.log("INFO","pacData = "+JSON.stringify(e));var r=e.row-1;if(this.nrRollUpRows&&r<this.nrRollUpRows-1&&(r=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==r){for(var i=0;i<o;i++)this.rows[i].clear();var a=this.currRow+1-this.nrRollUpRows,n=t.rows[a].cueStartTime;if(n&&n<g.time)for(i=0;i<this.nrRollUpRows;i++)this.rows[r-this.nrRollUpRows+i+1].copy(t.rows[a+i])}this.currRow=r;var s=this.rows[this.currRow];if(null!==e.indent){var l=e.indent,u=Math.max(l-1,0);s.setCursor(e.indent),e.color=s.chars[u].penState.foreground}var d={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(d)}},{key:"setBkgData",value:function(e){g.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}},{key:"setRollUpRows",value:function(e){this.nrRollUpRows=e}},{key:"rollUp",value:function(){if(null===this.nrRollUpRows)return void g.log("DEBUG","roll_up but nrRollUpRows not set yet");g.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),g.log("INFO","Rolling up")}},{key:"getDisplayText",value:function(e){e=e||!1;for(var t=[],r="",i=-1,a=0;a<o;a++){var n=this.rows[a].getTextString();n&&(i=a+1,e?t.push("Row "+i+": '"+n+"'"):t.push(n.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r}},{key:"getTextAndFormat",value:function(){return this.rows}}]),e}(),b=function(){function e(t,r){i(this,e),this.chNr=t,this.outputFilter=r,this.mode=null,this.verbose=0,this.displayedMemory=new E,this.nonDisplayedMemory=new E,this.lastOutputScreen=new E,this.currRollUpRow=this.displayedMemory.rows[o-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return a(e,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[o-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(e){this.outputFilter=e}},{key:"setPAC",value:function(e){this.writeScreen.setPAC(e,this.lastOutputScreen)}},{key:"setBkgData",value:function(e){this.writeScreen.setBkgData(e)}},{key:"setMode",value:function(e){e!==this.mode&&(this.mode=e,g.log("INFO","MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset(),this.lastOutputScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}},{key:"insertChars",value:function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var r=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";g.log("INFO",r+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(g.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}},{key:"ccRCL",value:function(){g.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){g.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){g.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(e){g.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}},{key:"ccFON",value:function(){g.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){g.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){g.log("INFO","TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){g.log("INFO","RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){g.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()}},{key:"ccCR",value:function(){g.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()}},{key:"ccENM",value:function(){g.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){if(g.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,g.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()}},{key:"ccTO",value:function(e){g.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}},{key:"ccMIDROW",value:function(e){var t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{var r=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[r]}g.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}},{key:"outputDataUpdate",value:function(){var e=g.time;null!==e&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(e,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}]),e}(),R=function(){function e(t,r,a){i(this,e),this.field=t||1,this.outputs=[r,a],this.channels=[new b(1,r),new b(2,a)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return a(e,[{key:"getHandler",value:function(e){return this.channels[e].getHandler()}},{key:"setHandler",value:function(e,t){this.channels[e].setHandler(t)}},{key:"addData",value:function(e,t){var r,i,a,n=!1;this.lastTime=e,g.setTime(e);for(var s=0;s<t.length;s+=2)if(i=127&t[s],a=127&t[s+1],0!==i||0!==a){if(g.log("DATA","["+v([t[s],t[s+1]])+"] -> ("+v([i,a])+")"),r=this.parseCmd(i,a),r||(r=this.parseMidrow(i,a)),r||(r=this.parsePAC(i,a)),r||(r=this.parseBackgroundAttributes(i,a)),!r&&(n=this.parseChars(i,a)))if(this.currChNr&&this.currChNr>=0){var o=this.channels[this.currChNr-1];o.insertChars(n)}else g.log("WARNING","No channel found yet. TEXT-MODE?");r?this.dataCounters.cmd+=2:n?this.dataCounters.char+=2:(this.dataCounters.other+=2,g.log("WARNING","Couldn't parse cleaned data "+v([i,a])+" orig: "+v([t[s],t[s+1]])))}else this.dataCounters.padding+=2}},{key:"parseCmd",value:function(e,t){var r=null,i=(20===e||28===e)&&32<=t&&t<=47,a=(23===e||31===e)&&33<=t&&t<=35;if(!i&&!a)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,g.log("DEBUG","Repeated command ("+v([e,t])+") is dropped"),!0;r=20===e||23===e?1:2;var n=this.channels[r-1];return 20===e||28===e?32===t?n.ccRCL():33===t?n.ccBS():34===t?n.ccAOF():35===t?n.ccAON():36===t?n.ccDER():37===t?n.ccRU(2):38===t?n.ccRU(3):39===t?n.ccRU(4):40===t?n.ccFON():41===t?n.ccRDC():42===t?n.ccTR():43===t?n.ccRTD():44===t?n.ccEDM():45===t?n.ccCR():46===t?n.ccENM():47===t&&n.ccEOC():n.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0}},{key:"parseMidrow",value:function(e,t){var r=null;if((17===e||25===e)&&32<=t&&t<=47){if(r=17===e?1:2,r!==this.currChNr)return g.log("ERROR","Mismatch channel in midrow parsing"),!1;var i=this.channels[r-1];return i.ccMIDROW(t),g.log("DEBUG","MIDROW ("+v([e,t])+")"),!0}return!1}},{key:"parsePAC",value:function(e,t){var r=null,i=null,a=(17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127,n=(16===e||24===e)&&64<=t&&t<=95;if(!a&&!n)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;r=e<=23?1:2,i=64<=t&&t<=95?1===r?u[e]:f[e]:1===r?d[e]:h[e];var s=this.interpretPAC(i,t),o=this.channels[r-1];return o.setPAC(s),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0}},{key:"interpretPAC",value:function(e,t){var r=t,i={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,i.underline=1===(1&r),r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((r-16)/2),i}},{key:"parseChars",value:function(e,t){var r=null,i=null,a=null;if(e>=25?(r=2,a=e-8):(r=1,a=e),17<=a&&a<=19){var n=t;n=17===a?t+80:18===a?t+112:t+144,g.log("INFO","Special char '"+s(n)+"' in channel "+r),i=[n]}else 32<=e&&e<=127&&(i=0===t?[e]:[e,t]);if(i){var o=v(i);g.log("DEBUG","Char codes =  "+o.join(",")),this.lastCmdA=null,this.lastCmdB=null}return i}},{key:"parseBackgroundAttributes",value:function(e,t){var r,i,a,n,s=(16===e||24===e)&&32<=t&&t<=47,o=(23===e||31===e)&&45<=t&&t<=47;return!(!s&&!o)&&(r={},16===e||24===e?(i=Math.floor((t-32)/2),r.background=c[i],t%2===1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0)),a=e<24?1:2,n=this.channels[a-1],n.setBkgData(r),this.lastCmdA=null,this.lastCmdB=null,!0)}},{key:"reset",value:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null}},{key:"cueSplitAtTime",value:function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)}}]),e}();r.default=R},{}],43:[function(e,t,r){"use strict";var i={newCue:function(e,t,r,i){for(var a,n,s,o,l,u=window.VTTCue||window.TextTrackCue,d=0;d<i.rows.length;d++)if(a=i.rows[d],s=!0,o=0,l="",!a.isEmpty()){for(var f=0;f<a.chars.length;f++)a.chars[f].uchar.match(/\s/)&&s?o++:(l+=a.chars[f].uchar,s=!1);a.cueStartTime=t,n=new u(t,r,l.trim()),o>=16?o--:o++,navigator.userAgent.match(/Firefox\//)?n.line=d+1:n.line=d>7?d-2:d+1,n.align="left",n.position=Math.max(0,Math.min(100,100*(o/32)+(navigator.userAgent.match(/Firefox\//)?50:0))),e.addCue(n)}}};t.exports=i},{}],44:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t){i(this,e),this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}return a(e,[{key:"sample",value:function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_}}]),e}();r.default=n},{}],45:[function(e,t,r){"use strict";function i(){}function a(e,t){return t="["+e+"] > "+t}function n(e){var t=self.console[e];return t?function(){for(var r=arguments.length,i=Array(r),n=0;n<r;n++)i[n]=arguments[n];i[0]&&(i[0]=a(e,i[0])),t.apply(self.console,i)}:i}function s(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];r.forEach(function(t){u[t]=e[t]?e[t].bind(e):n(t)})}Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l={trace:i,debug:i,log:i,warn:i,info:i,error:i},u=l;r.enableLogs=function(e){if(e===!0||"object"===("undefined"==typeof e?"undefined":o(e))){s(e,"debug","log","info","warn","error");try{u.log()}catch(e){u=l}}else u=l},r.logger=u},{}],46:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){i(this,e)}return a(e,null,[{key:"toString",value:function(e){for(var t="",r=e.length,i=0;i<r;i++)t+="["+e.start(i).toFixed(3)+","+e.end(i).toFixed(3)+"]";return t}}]),e}();r.default=n},{}],47:[function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e(45),s=function(){function e(t){i(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return a(e,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function(e,t,r){this.context=e,this.config=t,this.callbacks=r,this.stats={trequest:performance.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var e,t=this.context;e="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest,e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.open("GET",t.url,!0),t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.responseType=t.responseType;var r=this.stats;r.tfirst=0,r.loaded=0,this.xhrSetup&&this.xhrSetup(e,t.url),this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()}},{key:"readystatechange",value:function(e){var t=e.currentTarget,r=t.readyState,i=this.stats,a=this.context,s=this.config;if(!i.aborted&&r>=2)if(window.clearTimeout(this.requestTimeout),0===i.tfirst&&(i.tfirst=Math.max(performance.now(),i.trequest)),4===r){var o=t.status;if(o>=200&&o<300){i.tload=Math.max(i.tfirst,performance.now());var l=void 0,u=void 0;"arraybuffer"===a.responseType?(l=t.response,u=l.byteLength):(l=t.responseText,u=l.length),i.loaded=i.total=u;var d={url:t.responseURL,data:l};this.callbacks.onSuccess(d,i,a)}else i.retry>=s.maxRetry||o>=400&&o<499?(n.logger.error(o+" while loading "+a.url),this.callbacks.onError({code:o,text:t.statusText},a)):(n.logger.warn(o+" while loading "+a.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),i.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),s.timeout)}},{key:"loadtimeout",value:function(){n.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total);var r=this.callbacks.onProgress;r&&r(t,this.context,null)}}]),e}();r.default=s},{45:45}]},{},[33])(33)});(function(mw,$,Hls){"use strict";if(Hls.isSupported()&&!mw.isNativeApp()&&!mw.isChromeCast()&&!mw.isDesktopSafari()&&!mw.isSamsungStockBrowser()&&!mw.getConfig("disableHLSOnJs")){var orig_supportsFlash=mw.supportsFlash.bind(mw);mw.supportsFlash=function(){return false;};$(mw).bind('EmbedPlayerUpdateMediaPlayers',function(event,mediaPlayers){if(Hls.isSupported()){var hlsPlayer=new mw.MediaPlayer('hlsPlayer',['video/h264','video/mp4','application/vnd.apple.mpegurl'],'Native');mediaPlayers.addPlayer(hlsPlayer);mw.EmbedTypes.mediaPlayers.setMIMETypePlayers('application/vnd.apple.mpegurl','Native');}});var hlsjs=mw.KBasePlugin.extend({defaultConfig:{withCredentials:false,options:{},maxErrorRetryCount:2,hlsLogs:false},mediaErrorRecoveryCounter:0,playerErrorRecoveryCounter:0,debugInfoInterval:4,debugInfoCounter:0,LoadHLS:false,loaded:false,mediaAttached:false,isLevelSwitching:false,afterInitialSeeking:false,levelIndex:-1,ptsID3Data:{},isSafeEnviornment:function(){return Hls.isSupported();},setup:function(){this.log("version: "+Hls.version);mw.setConfig('isHLS_JS',true);this.addBindings();},addBindings:function(){this.bind("SourceChange",this.isNeeded.bind(this));this.bind("playerReady",this.initHls.bind(this));this.bind("onChangeMedia",this.clean.bind(this));if(mw.getConfig("hlsLogs")){this.bind("monitorEvent",this.monitorDebugInfo.bind(this));}},isNeeded:function(){if(this.getPlayer().mediaElement.selectedSource.mimeType==="application/vnd.apple.mpegurl"){this.LoadHLS=true;this.embedPlayer.streamerType='http';}else{this.LoadHLS=false;}},clean:function(){this.log("Clean");if(this.LoadHLS&&this.loaded){this.LoadHLS=false;this.loaded=false;this.unRegisterHlsEvents();this.unbind("onLiveOffSynchChanged");this.restorePlayerMethods();this.hls.detachMedia();this.mediaAttached=false;this.hls.destroy();this.hls=null;}},initHls:function(){if(this.LoadHLS&&!this.loaded){this.log("Init");this.embedPlayer.streamerType='hls';var hlsConfig=this.getHlsConfig();this.hls=new Hls(hlsConfig);this.loaded=true;this.mediaErrorRecoveryCounter=0;this.getPlayer().skipUpdateSource=true;this.registerHlsEvents();this.overridePlayerMethods();$(this.getPlayer().getPlayerElement()).one("canplay",function(){this.afterInitialSeeking=true;}.bind(this));this.bind("onLiveOffSynchChanged",this.onLiveOffSyncChanged.bind(this));this.bind("seeking",this.onSeekBeforePlay.bind(this));this.bind("firstPlay",function(){this.unbind("firstPlay");this.unbind("seeking");this.hls.attachMedia(this.getPlayer().getPlayerElement());}.bind(this));}},getHlsConfig:function(){var defaultConfig={liveSyncDurationCount:3,liveMaxLatencyDurationCount:6};var options=this.getConfig("options");var hlsConfig=$.extend({},defaultConfig,options);if(this.getConfig("withCredentials")){hlsConfig.xhrSetup=function(xhr,url){xhr.withCredentials=true;};}return hlsConfig;},registerHlsEvents:function(){this.onMediaAttachedHandler=this.onMediaAttached.bind(this);this.hls.on(Hls.Events.MEDIA_ATTACHED,this.onMediaAttachedHandler);this.onManifestParsedHandler=this.onManifestParsed.bind(this);this.hls.on(Hls.Events.MANIFEST_PARSED,this.onManifestParsedHandler);this.onAudioTracksUpdatedHandler=this.onAudioTracksUpdated.bind(this);this.hls.on(Hls.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdatedHandler);this.onAudioTrackSwitchingHandler=this.onAudioTrackSwitching.bind(this);this.hls.on(Hls.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitchingHandler);this.onAudioTrackSwitchedHandler=this.onAudioTrackSwitched.bind(this);this.hls.on(Hls.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitchedHandler);this.onFragLoadingHandler=this.onFragLoading.bind(this);this.hls.on(Hls.Events.FRAG_LOADING,this.onFragLoadingHandler);this.onFragLoadedHandler=this.onFragLoaded.bind(this);this.hls.on(Hls.Events.FRAG_LOADED,this.onFragLoadedHandler);this.onFragParsingMetadataHandler=this.onFragParsingMetadata.bind(this);this.hls.on(Hls.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadataHandler);this.onFragParsingDataHandler=this.onFragParsingData.bind(this);this.hls.on(Hls.Events.FRAG_PARSING_DATA,this.onFragParsingDataHandler);this.onPTSUpdatedHandler=this.onPTSUpdated.bind(this);this.hls.on(Hls.Events.LEVEL_PTS_UPDATED,this.onPTSUpdatedHandler);this.onFragBufferedHandler=this.onFragBuffered.bind(this);this.hls.on(Hls.Events.FRAG_BUFFERED,this.onFragBufferedHandler);this.onLevelSwitchHandler=this.onLevelSwitch.bind(this);this.hls.on(Hls.Events.LEVEL_SWITCH,this.onLevelSwitchHandler);this.onFragChangedHandler=this.onFragChanged.bind(this);this.hls.on(Hls.Events.FRAG_CHANGED,this.onFragChangedHandler);this.onErrorHandler=this.onError.bind(this);this.hls.on(Hls.Events.ERROR,this.onErrorHandler);this.onDropFramesHandler=this.onDropFrames.bind(this);this.hls.on(Hls.Events.FPS_DROP,this.onDropFramesHandler);},unRegisterHlsEvents:function(){this.hls.off(Hls.Events.MEDIA_ATTACHED,this.onMediaAttachedHandler);this.onMediaAttachedHandler=null;this.hls.off(Hls.Events.MANIFEST_PARSED,this.onManifestParsedHandler);this.onManifestParsedHandler=null;this.hls.off(Hls.Events.FRAG_LOADING,this.onFragLoadingHandler);this.onFragLoadingHandler=null;this.hls.off(Hls.Events.FRAG_LOADED,this.onFragLoadedHandler);this.onFragLoadedHandler=null;this.hls.off(Hls.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadataHandler);this.onFragParsingMetadataHandler=null;this.hls.off(Hls.Events.FRAG_PARSING_DATA,this.onFragParsingDataHandler);this.onFragParsingDataHandler=null;this.hls.off(Hls.Events.LEVEL_PTS_UPDATED,this.onPTSUpdatedHandler);this.onPTSUpdatedHandler=null;this.hls.off(Hls.Events.FRAG_BUFFERED,this.onFragBufferedHandler);this.onFragBufferedHandler=null;this.hls.off(Hls.Events.LEVEL_SWITCH,this.onLevelSwitchHandler);this.onLevelSwitchHandler=null;this.hls.off(Hls.Events.FRAG_CHANGED,this.onFragChangedHandler);this.onFragChangedHandler=null;this.hls.off(Hls.Events.ERROR,this.onErrorHandler);this.onErrorHandler=null;this.hls.off(Hls.Events.FPS_DROP,this.onDropFramesHandler);this.onDropFramesHandler=null;},onMediaAttached:function(){this.log("Media attached");this.mediaAttached=true;var selectedSource=this.getPlayer().getSrc();if(selectedSource){this.getPlayer().resolveSrcURL(selectedSource).then(function(source){this.hls.loadSource(source);}.bind(this),function(){this.hls.loadSource(selectedSource);}.bind(this));}},onFragLoading:function(e,data){this.getPlayer().triggerHelper('hlsFragLoading',data.frag.url);},onFragLoaded:function(e,data){this.getPlayer().triggerHelper('hlsFragLoaded',data.frag.url);},onFragParsingMetadata:function(e,data){data.samples.forEach(function(sample){var sampleData=String.fromCharCode.apply(null,new Uint8Array(sample.data));var sampleString=sampleData.substring(sampleData.indexOf("{"),sampleData.lastIndexOf("}")+1);var id3Tag=JSON.parse(sampleString);this.ptsID3Data[Math.round(sample.pts)]=id3Tag;}.bind(this));},onFragParsingData:function(e,data){this.getPlayer().triggerHelper('hlsFragParsingData',data);},onPTSUpdated:function(e,data){this.getPlayer().triggerHelper('hlsUpdatePTS',data);},onFragBuffered:function(e,data){this.getPlayer().triggerHelper('hlsFragBuffered',data.frag.url);},onDropFrames:function(e,data){this.getPlayer().triggerHelper('hlsDropFPS',data.totalDropped);mw.log("hlsjs :: onDropFrames | totalDropped = "+data.totalDropped);},onManifestParsed:function(event,data){this.log("manifest loaded, found "+data.levels.length+" quality level");this.addAbrFlavors(data.levels);if(this.backupExists(data.levels)){this.configFailoverSettings();}},onAudioTracksUpdated:function(event,data){var audioTracks=this.hls.audioTracks;if(audioTracks&&audioTracks.length>0){var audioTrackData={languages:[]};var audioTrackLangs={};$.each(audioTracks,function(index,audioTrack){if(audioTrackLangs[audioTrack.lang]===undefined){audioTrackLangs[audioTrack.lang]=1;audioTrackData.languages.push({'kind':'audioTrack','language':audioTrack.lang,'srclang':audioTrack.lang,'label':audioTrack.name,'title':audioTrack.name,'id':audioTrack.id,'index':audioTrackData.languages.length});}});this.log(audioTracks.length+" audio tracks were found: "+JSON.stringify(audioTracks));var audioTrack=this.getPlayer().audioTrack;if(audioTrack&&audioTrack.defaultTrack&&audioTrack.defaultTrack<audioTracks.length){setTimeout(function(){this.hls.audioTrack=this.getPlayer().audioTrack.defaultTrack;}.bind(this),0);}this.getPlayer().triggerHelper('audioTracksReceived',audioTrackData);}},onAudioTrackSwitching:function(event,data){this.log("switching audio track "+JSON.stringify(data));},onAudioTrackSwitched:function(event,data){this.log("switched audio track "+JSON.stringify(data));},onLevelSwitch:function(event,data){var source=this.hls.levels[data.level];var currentBitrate=Math.round(source.bitrate/1024);var previousBitrate=this.getPlayer().currentBitrate;this.getPlayer().currentBitrate=currentBitrate;this.getPlayer().triggerHelper('bitrateChange',currentBitrate);if(this.isLevelSwitching&&this.levelIndex==data.level){this.getPlayer().triggerHelper("sourceSwitchingStarted",previousBitrate);}this.getPlayer().triggerHelper('hlsCurrentBitrate',currentBitrate);mw.log("hlsjs :: onLevelSwitch | level = "+data.level+" | current bitrate = "+currentBitrate);},onFragChanged:function(event,data){if(data&&data.frag){if(data.frag.duration){this.fragmentDuration=data.frag.duration;}if(this.isLevelSwitching&&(this.levelIndex==data.frag.level)){this.isLevelSwitching=false;this.getPlayer().triggerHelper("sourceSwitchingEnd",this.getPlayer().currentBitrate);}this.getPlayer().triggerHelper('hlsFragChanged',data.frag);}},backupExists:function(levels){for(var i=0;i<levels.length;i++){if(levels[i].url&&levels[i].url.length>1){return true;}}return false;},configFailoverSettings:function(){this.hls.config.fragLoadingMaxRetry=1;this.hls.config.levelLoadingMaxRetry=1;},onError:function(event,data){this.log("Error: "+data.type+", "+data.details);if(this.mediaErrorRecoveryCounter>this.getConfig("maxErrorRetryCount")){this.handleUnRecoverableError(data);return;}switch(data.type){case Hls.ErrorTypes.NETWORK_ERROR:if(data.fatal){this.log("fatal network error encountered, try to recover");this.hls.startLoad();this.mediaErrorRecoveryCounter+=1;}else{if(this.isProtocolMismatch(data)){this.log("Error: protocol mismatch - probably caused by mixed content warning");this.handleUnRecoverableError(data);}}break;case Hls.ErrorTypes.MEDIA_ERROR:if(data.fatal){if(this.mediaErrorRecoveryCounter>1){this.log("fatal media error encountered, try to recover - switch audio codec");this.hls.swapAudioCodec();}this.log("fatal media error encountered, try to recover");this.hls.recoverMediaError();this.mediaErrorRecoveryCounter+=1;}else{switch(data.details){case Hls.ErrorDetails.BUFFER_STALLED_ERROR:this.getPlayer().bufferStart();break;}}break;default:if(data.fatal){this.handleUnRecoverableError(data);}break;}},isProtocolMismatch:function(data){var protocolMismatch=false;var hostPageProtocol=this.getProtocol(kWidgetSupport.getHostPageUrl());var currentUrl=null;switch(data.details){case Hls.ErrorDetails.FRAG_LOAD_ERROR:currentUrl=data.frag.url;break;case Hls.ErrorDetails.MANIFEST_LOAD_ERROR:case Hls.ErrorDetails.LEVEL_LOAD_ERROR:currentUrl=data.url;break;}if(currentUrl!==null){var urlProtocol=this.getProtocol(currentUrl);if(urlProtocol!==hostPageProtocol){protocolMismatch=true;}}return protocolMismatch;},getProtocol:function(url){try{var parser=document.createElement('a');parser.href=url;return parser.protocol;}catch(e){return"";}},handleUnRecoverableError:function(data){this.log("fatal media error encountered, cannot recover: "+data.type+", "+data.details);this.clean();if(orig_supportsFlash()){this.log("Try flash fallback");this.fallbackToFlash();}else{var errorObj={message:JSON.stringify(data),code:data.type==="networkError"?"1000":"3000"};this.getPlayer().triggerHelper('embedPlayerError',errorObj);}},fallbackToFlash:function(){mw.EmbedTypes.mediaPlayers.removeMIMETypePlayers('application/vnd.apple.mpegurl','Native');mw.EmbedTypes.mediaPlayers.setMIMETypePlayers('application/vnd.apple.mpegurl','Kplayer');mw.EmbedTypes.addFlashPlayer();var embedPlayer=this.getPlayer();embedPlayer.setKalturaConfig("","LeadWithHLSOnJs",false);embedPlayer.setKalturaConfig("","LeadWithHLSOnFlash",true);embedPlayer.stop();embedPlayer.autoplay=true;embedPlayer.setupSourcePlayer();},addAbrFlavors:function(levels){if(levels&&levels.length>1){var flavors=levels.map(function(level,index){var sourceAspect=Math.round((level.width/level.height)*100)/100;return{'data-bandwidth':level.bitrate,'data-width':level.width,'data-height':level.height,'data-aspect':sourceAspect,'type':'video/mp4','data-frameRate':level.frameRate,'data-assetid':index};});this.getPlayer().setKDPAttribute('sourceSelector','visible',true);this.getPlayer().onFlavorsListChanged(flavors);}},overridePlayerMethods:function(){this.orig_backToLive=this.getPlayer().backToLive;this.orig_switchSrc=this.getPlayer().switchSrc;this.orig_playerSwitchSource=this.getPlayer().playerSwitchSource;this.orig_switchAudioTrack=this.getPlayer().switchAudioTrack;this.orig_load=this.getPlayer().load;this.orig_onerror=this.getPlayer()._onerror;this.orig_ontimeupdate=this.getPlayer()._ontimeupdate;this.orig_clean=this.getPlayer().clean;if(this.getPlayer()._onseeking){this.orig_onseeking=this.getPlayer()._onseeking.bind(this.getPlayer());}if(this.getPlayer()._onseeked){this.orig_onseeked=this.getPlayer()._onseeked.bind(this.getPlayer());}this.getPlayer().backToLive=this.backToLive.bind(this);this.getPlayer().switchSrc=this.switchSrc.bind(this);this.getPlayer().playerSwitchSource=this.playerSwitchSource.bind(this);this.getPlayer().switchAudioTrack=this.switchAudioTrack.bind(this);this.getPlayer().load=this.load.bind(this);this.getPlayer()._onerror=this._onerror.bind(this);this.getPlayer()._ontimeupdate=this._ontimeupdate.bind(this);this.getPlayer()._onseeking=this._onseeking.bind(this);this.getPlayer()._onseeked=this._onseeked.bind(this);this.getPlayer().clean=this.clean.bind(this);},restorePlayerMethods:function(){this.getPlayer().backToLive=this.orig_backToLive;this.getPlayer().switchSrc=this.orig_switchSrc;this.getPlayer().playerSwitchSource=this.orig_playerSwitchSource;this.getPlayer().switchAudioTrack=this.orig_switchAudioTrack;this.getPlayer().load=this.orig_load;this.getPlayer()._onerror=this.orig_onerror;this.getPlayer()._ontimeupdate=this.orig_ontimeupdate;this.getPlayer()._onseeking=this.orig_onseeking;this.getPlayer()._onseeked=this.orig_onseeked;this.getPlayer().clean=this.orig_clean;},backToLive:function(){var _this=this;var vid=this.getPlayer().getPlayerElement();this.embedPlayer.goingBackToLive=true;vid.currentTime=vid.duration-(this.fragmentDuration||10)*3;if(this.embedPlayer.isDVR()){_this.once('seeked',function(){_this.getPlayer().triggerHelper('movingBackToLive');_this.embedPlayer.goingBackToLive=false;});}else{_this.getPlayer().triggerHelper('movingBackToLive');_this.embedPlayer.goingBackToLive=false;}},onLiveOffSyncChanged:function(event,status){if(this.LoadHLS){if(this.getConfig("options")&&!this.defaultLiveMaxLatencyDurationCount){this.defaultLiveMaxLatencyDurationCount=this.getConfig("options").liveMaxLatencyDurationCount;}if(status){this.hls.config.liveMaxLatencyDurationCount=Hls.DefaultConfig["liveMaxLatencyDurationCount"];}else{this.hls.config.liveMaxLatencyDurationCount=this.defaultLiveMaxLatencyDurationCount;}}},switchAudioTrack:function(index){if(this.loaded&&(index!==undefined)){this.hls.audioTrack=index;this.log("onSwitchAudioTrack switch to "+this.hls.audioTracks[index].lang);}},switchSrc:function(source){if(source!==-1){var sourceIndex=this.getPlayer().getSourceIndex(source);if(sourceIndex!==null){this.levelIndex=sourceIndex;if(!(this.hls.autoLevelEnabled||this.isLevelSwitching)&&(this.hls.currentLevel===sourceIndex)){this.onLevelSwitch(Hls.Events.LEVEL_SWITCH,{level:sourceIndex});this.onFragChanged(Hls.Events.LEVEL_LOADED,{frag:{level:sourceIndex}});this.getPlayer().currentBitrate=source.getBitrate();}else{this.hls.nextLevel=sourceIndex;this.isLevelSwitching=true;}}}else{this.hls.nextLevel=-1;}},load:function(){if(!this.getPlayer().isInSequence()){this.hls.startLoad();}},playerSwitchSource:function(src,switchCallback,doneCallback){if(!this.mediaAttached){this.unbind("firstPlay");this.unbind("seeking");this.hls.attachMedia(this.getPlayer().getPlayerElement());}this.getPlayer().play();if($.isFunction(switchCallback)){switchCallback();}},_onerror:function(evt){var errorTxt,mediaError=evt.currentTarget.error;switch(mediaError.code){case mediaError.MEDIA_ERR_ABORTED:errorTxt="You aborted the video playback";break;case mediaError.MEDIA_ERR_DECODE:errorTxt="The video playback was aborted due to a corruption problem or because the video used features your browser did not support. Trying to handle MediaError.";this.handleMediaError();break;case mediaError.MEDIA_ERR_NETWORK:errorTxt="A network error caused the video download to fail part-way";break;case mediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:errorTxt="The video could not be loaded, either because the server or network failed or because the format is not supported";break;}mw.log("HLS.JS ERROR: "+errorTxt);},_ontimeupdate:function(e){this.getPlayer().triggerHelper(e.type,e);var time=Math.round(e.currentTarget.currentTime);if(this.ptsID3Data[time]){this.getPlayer().triggerHelper('onId3Tag',this.ptsID3Data[time]);}},_onseeking:function(){if(this.afterInitialSeeking){this.orig_onseeking();}},_onseeked:function(){if(this.afterInitialSeeking){this.orig_onseeked();}},onSeekBeforePlay:function(){if(this.LoadHLS){this.unbind("firstPlay");this.unbind("seeking");this.hls.attachMedia(this.getPlayer().getPlayerElement());}},handleMediaError:function(){if(this.canRecover()){this.hls.recoverMediaError();}},canRecover:function(){if(this.playerErrorRecoveryCounter>2){this.playerErrorRecoveryCounter=0;return false;}this.playerErrorRecoveryCounter+=1;return true;},monitorDebugInfo:function(){this.debugInfoCounter++;if(this.debugInfoCounter===this.debugInfoInterval){this.debugInfoCounter=0;this.getPlayer().triggerHelper('hlsCurrentBuffer',mw.seconds2npt(this.getPlayer().getCurrentBufferLength()));if(mw.isChrome()||mw.isDesktopSafari()){this.getPlayer().triggerHelper('hlsDroppedFrames',this.getPlayer().getPlayerElement().webkitDroppedFrameCount);}else{this.getPlayer().triggerHelper('hlsDroppedFrames','not supported');}this.getPlayer().triggerHelper('hlsFPS','not supported');}}});mw.PluginManager.add('hlsjs',hlsjs);}})(window.mw,window.jQuery,window.Hls);;},{},{});mw.loader.implement("acCheck",function($){(function(mw,$){"use strict";var acCheck=function(embedPlayer){var ac=embedPlayer.kalturaContextData;var acStatus=kWidgetSupport.getAccessControlStatus(ac,embedPlayer);if(acStatus!==true){embedPlayer.setError(acStatus);return;}};mw.addKalturaConfCheck(function(embedPlayer,callback){if(embedPlayer.kalturaContextData){acCheck(embedPlayer);}callback();});})(window.mw,jQuery);;},{},{});mw.loader.implement("acPreview",function($){(function(mw,$){"use strict";var acPreview=function(embedPlayer){function acEndPreview(){mw.log('KWidgetSupport:: acEndPreview >');$(embedPlayer).trigger('KalturaSupport_FreePreviewEnd');mw.log('KWidgetSupport:: KalturaSupport_FreePreviewEnd set onDoneInterfaceFlag = false');embedPlayer.onDoneInterfaceFlag=false;var closeAcMessage=function(){$(embedPlayer).unbind('.acpreview');embedPlayer.layoutBuilder.closeMenuOverlay();embedPlayer.onClipDone();};$(embedPlayer).bind('onChangeMedia.acpreview',closeAcMessage);if(embedPlayer.getKalturaConfig('','disableAlerts')!==true){embedPlayer.layoutBuilder.displayMenuOverlay($('<div />').append($('<h3 />').append(embedPlayer.getKalturaMsg('FREE_PREVIEW_END_TITLE')),$('<span />').text(embedPlayer.getKalturaMsg('FREE_PREVIEW_END')),$('<br />'),$('<br />'),$('<button />').attr({'type':"button"}).addClass("ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only").append($('<span />').addClass("ui-button-text").text('Ok').css('margin','10')).click(closeAcMessage)),closeAcMessage);}};$(embedPlayer).unbind('.acPreview');var ac=embedPlayer.kalturaContextData;if(ac.isAdmin===false&&ac.isSessionRestricted===true&&ac.previewLength&&ac.previewLength!=-1){$(embedPlayer).bind('postEnded.acPreview',function(){acEndPreview(embedPlayer);});$(embedPlayer).bind('monitorEvent.acPreview',function(){if(embedPlayer.currentTime>=ac.previewLength){embedPlayer.stop();if(mw.isIOS()){embedPlayer.getPlayerElement().webkitExitFullScreen();}acEndPreview(embedPlayer);}});}};mw.addKalturaConfCheck(function(embedPlayer,callback){if(embedPlayer.kalturaContextData){acPreview(embedPlayer);}callback();});})(window.mw,jQuery);;},{},{});mw.loader.implement("base64_decode",function($){window['base64_decode']=function(input){var output="";var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;var _keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length){enc1=_keyStr.indexOf(input.charAt(i++));enc2=_keyStr.indexOf(input.charAt(i++));enc3=_keyStr.indexOf(input.charAt(i++));enc4=_keyStr.indexOf(input.charAt(i++));chr1=(enc1<<2)|(enc2>>4);chr2=((enc2&15)<<4)|(enc3>>2);chr3=((enc3&3)<<6)|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64){output=output+String.fromCharCode(chr2);}if(enc4!=64){output=output+String.fromCharCode(chr3);}}return output;};},{},{});mw.loader.implement("base64_encode",function($){window['base64_encode']=function(data){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc="",tmp_arr=[];if(!data){return data;}data=utf8_encode(data+'');do{o1=data.charCodeAt(i++);o2=data.charCodeAt(i++);o3=data.charCodeAt(i++);bits=o1<<16|o2<<8|o3;h1=bits>>18&0x3f;h2=bits>>12&0x3f;h3=bits>>6&0x3f;h4=bits&0x3f;tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4);}while(i<data.length);enc=tmp_arr.join('');var r=data.length%3;return(r?enc.slice(0,r-3):enc)+'==='.slice(r||3);};;},{},{});mw.loader.implement("class",function($){(function(){var initializing=false,fnTest=/xyz/.test(function(){xyz;})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(prop){var _super=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){prototype[name]=typeof prop[name]=="function"&&typeof _super[name]=="function"&&fnTest.test(prop[name])?(function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);this._super=tmp;return ret;};})(name,prop[name]):prop[name];}function Class(){if(!initializing&&this.init)this.init.apply(this,arguments);}Class.prototype=prototype;Class.prototype.constructor=Class;Class.extend=arguments.callee;return Class;};})();;},{},{});mw.loader.implement("controlBarContainer",function($){(function(mw,$){"use strict";mw.PluginManager.add('controlBarContainer',mw.KBasePlugin.extend({defaultConfig:{'hover':false},keepOnScreen:false,screenOpen:false,setup:function(){if(this.embedPlayer.isMobileSkin()){this.setConfig("hover",true);}if(this.getPlayer().useNativePlayerControls()){this.getPlayer().enableNativeControls();return;}this.getPlayer().overlaycontrols=this.getConfig('hover');this.addBindings();},addBindings:function(){var _this=this;this.bind('addLayoutContainer',function(){_this.getPlayer().getInterface().append(_this.getComponent());});this.bind('showInlineDownloadLink',function(){_this.hide();});this.bind('ended',function(){_this.show();});this.bind('layoutBuildDone',function(){if(!_this.embedPlayer.isMobileSkin()){_this.show();}});if(this.getConfig('hover')){this.bind('showPlayerControls',function(e,data){_this.show();});this.bind('hidePlayerControls',function(){_this.hide();});this.bind('onComponentsHoverDisabled',function(){if(!_this.embedPlayer.layoutBuilder.displayOptionsMenuFlag){_this.keepOnScreen=true;_this.show();}});this.bind('hideScreen closeMenuOverlay',function(){_this.screenOpen=false;if(!_this.embedPlayer.paused){_this.keepOnScreen=false;_this.hide();}else{_this.show();}});this.bind('onComponentsHoverEnabled displayMenuOverlay',function(){_this.keepOnScreen=false;_this.hide();});this.bind('showScreen',function(){_this.screenOpen=true;_this.keepOnScreen=false;_this.forceOnScreen=false;_this.hide();});this.bind('onHideSideBar',function(){_this.forceOnScreen=false;});this.bind('onShowSideBar',function(){_this.forceOnScreen=true;});}else{this.getPlayer().isControlsVisible=true;}},onConfigChange:function(property,value){switch(property){case'visible':if(value){this.getComponent().show();}else{this.getComponent().hide();}break;}},show:function(){this.getPlayer().isControlsVisible=true;if(!this.screenOpen){this.getComponent().addClass('open');this.getPlayer().triggerHelper('onShowControlBar',{'bottom':this.getComponent().height()+15});}var $interface=this.embedPlayer.getInterface();$interface.removeClass('player-out');},hide:function(){if(this.keepOnScreen||this.forceOnScreen)return;this.getPlayer().isControlsVisible=false;this.getComponent().removeClass('open');var $interface=this.embedPlayer.getInterface();$interface.addClass('player-out');this.getPlayer().triggerHelper('onHideControlBar',{'bottom':15});},getComponent:function(){if(!this.$el){var _this=this;var $controlsContainer=$('<div />').addClass('controlsContainer');this.$el=$('<div />').addClass('controlBarContainer').append($controlsContainer);if(this.getConfig('hover')&&this.getPlayer().isOverlayControls()){this.$el.addClass('hover').on("mouseenter",function(){_this.forceOnScreen=true;}).on("mouseleave click",function(){_this.forceOnScreen=false;});this.embedPlayer.getVideoHolder().addClass('hover');}else{this.$el.addClass('block');}}return this.$el;}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("currentTimeLabel",function($){(function(mw,$){"use strict";mw.PluginManager.add('currentTimeLabel',mw.KBaseComponent.extend({defaultConfig:{"parent":"controlsContainer","order":21,"displayImportance":"high","countDownMode":false},updateEnabled:true,labelWidth:null,adDuration:null,setup:function(){var _this=this;if(this.embedPlayer.isMobileSkin()){this.setConfig("order",26);this.setConfig('parent','videoHolder');this.setConfig("countDownMode",true);this.bind('firstPlay preSequence',function(){if(_this.getConfig('parent')==='videoHolder'){_this.setConfig('parent','controlsContainer');var currentTimeLabel=$('.currentTimeLabel').detach();$('.controlsContainer .scrubber').after(currentTimeLabel);setTimeout(function(){_this.embedPlayer.triggerHelper("updateComponentsVisibilityDone");},mw.isChromeCast()?200:0);}});this.bind('doStop',function(){_this.updateUI(0);});this.bind('AdSupport_AdUpdateDuration',function(e,duration){_this.adDuration=duration;});this.bind('AdSupport_EndAdPlayback',function(){_this.adDuration=null;});}this.bindTimeUpdate();this.bind('externalTimeUpdate',function(e,newTime){if(newTime!=undefined){_this.updateUI(newTime);}});this.bind('onChangeMediaDone',function(){_this.updateUI(0);});this.bind('detachTimeUpdate',function(){_this.unbind('timeupdate');});this.bind('reattachTimeUpdate',function(){_this.bindTimeUpdate();});this.bind('AdSupport_AdUpdatePlayhead',function(e,currentTime){if(_this.getPlayer().isInSequence()){_this.updateUI(currentTime);}});this.bind('AdSupport_EndAdPlayback',function(){_this.updateUI(_this.getCurrentTime());});this.bind('seeked',function(){_this.updateUI(_this.getCurrentTime());});this.bind("freezeTimeIndicators",function(e,state){if(state===true){_this.updateEnabled=false;}else{_this.updateEnabled=true;}});},bindTimeUpdate:function(){var _this=this;this.bind('timeupdate',function(){if(!_this.getPlayer().isInSequence()){_this.updateUI(_this.getCurrentTime());}});},updateUI:function(time){if(this.updateEnabled){if(this.getConfig("countDownMode")){if(this.embedPlayer.isInSequence()&&this.adDuration){time=this.adDuration-time;}else{time=this.embedPlayer.getDuration()-time;}if(time<0){time=0;}}time=Math.floor(time);this.getComponent().text(mw.seconds2npt(time));var currentWidth=this.$el.width();if(currentWidth!==this.labelWidth){this.embedPlayer.layoutBuilder.updateComponentsVisibility();this.labelWidth=this.$el.width();}}},getCurrentTime:function(){var ct=this.getPlayer().getPlayerElementTime()-this.getPlayer().startOffset;if(ct<0){ct=0;}return parseFloat(ct);},getComponent:function(){if(!this.$el){this.$el=$('<div />').addClass("timers"+this.getCssClass()).text('0:00');this.labelWidth=this.$el.width();if(this.getConfig("countDownMode")){this.$el.text(mw.seconds2npt(this.embedPlayer.getDuration()));}}return this.$el;},show:function(){this.getComponent().css('display','inline').removeData('forceHide');}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("durationLabel",function($){(function(mw,$){"use strict";mw.PluginManager.add('durationLabel',mw.KBaseComponent.extend({defaultConfig:{parent:"controlsContainer",order:31,displayImportance:'medium',prefix:' / '},contentDuration:0,isSafeEnviornment:function(){return!this.embedPlayer.isMobileSkin();},setup:function(){var _this=this;this.bind('durationChange',function(event,duration){if(!_this.getPlayer().isInSequence()){_this.contentDuration=duration;_this.updateUI(Math.floor(duration));}});this.bind('AdSupport_AdUpdateDuration',function(e,duration){_this.updateUI(duration);});this.bind('AdSupport_EndAdPlayback',function(){_this.updateUI(_this.contentDuration);});},updateUI:function(duration){var formatTime=mw.seconds2npt(parseFloat(duration))
var duration=this.getConfig('prefix')!==undefined?this.getConfig('prefix')+formatTime:formatTime;this.getComponent().text(duration);},getComponent:function(){if(!this.$el){var duration=this.getConfig('prefix')!==undefined?this.getConfig('prefix')+'0:00':'0:00';this.$el=$('<div />').addClass("timers"+this.getCssClass()).text(duration);}return this.$el;},show:function(){this.getComponent().css('display','inline').removeData('forceHide');}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("fullScreenBtn",function($){(function(mw,$){"use strict";mw.PluginManager.add('fullScreenBtn',mw.KBaseComponent.extend({defaultConfig:{"align":"right","parent":"controlsContainer","order":51,"showTooltip":true,"displayImportance":"high"},offIconClass:'icon-expand',onIconClass:'icon-contract',enterFullscreenTxt:gM('mwe-embedplayer-player_fullscreen'),exitFullscreenTxt:gM('mwe-embedplayer-player_closefullscreen'),setup:function(){if(this.getPlayer().isMobileSkin()){this.onIconClass='icon-arrow-left';}this.addBindings();},isSafeEnviornment:function(){if((mw.isIE9()||mw.isIE8())&&!mw.getConfig('EmbedPlayer.IsFriendlyIframe')){return false;}return mw.getConfig('EmbedPlayer.EnableFullscreen');},getComponent:function(){var _this=this;if(!this.$el){this.$el=$('<button />').attr('title',this.enterFullscreenTxt).addClass("btn "+this.offIconClass+this.getCssClass()).click(function(){_this.toggleFullscreen();});}this.setAccessibility(this.$el,this.enterFullscreenTxt);return this.$el;},addBindings:function(){var _this=this;this.bind('dblclick',function(){_this.toggleFullscreen();});this.bind('onOpenFullScreen',function(){_this.getComponent().removeClass(_this.offIconClass).addClass(_this.onIconClass);_this.updateTooltip(_this.exitFullscreenTxt);_this.setAccessibility(_this.$el,_this.exitFullscreenTxt);if(_this.getPlayer().isMobileSkin()){var fsBtn=$('.fullScreenBtn').detach();$('.topBarContainer').prepend(fsBtn);_this.getPlayer().triggerHelper("updateComponentsVisibilityDone");}});this.bind('onCloseFullScreen',function(){_this.getComponent().removeClass(_this.onIconClass).addClass(_this.offIconClass);_this.updateTooltip(_this.enterFullscreenTxt);_this.setAccessibility(_this.$el,_this.enterFullscreenTxt);if(_this.getPlayer().isMobileSkin()){var fsBtn=$('.fullScreenBtn').detach();$('.controlsContainer').append(fsBtn);_this.getPlayer().triggerHelper("updateComponentsVisibilityDone");}});},toggleFullscreen:function(){if(this.isDisabled)return;this.getPlayer().toggleFullscreen();}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("id3Tag",function($){(function(mw,$){"use strict";mw.PluginManager.add('id3Tag',mw.KBasePlugin.extend({defaultConfig:{updateTimeIntervalSec:1},timeIntervalSec:1,updatedTime:0,intervalCounter:4,counter:0,bindPostfix:'.id3Tag',isSafeEnviornment:function(){return true;},setup:function(){var _this=this;this.timeIntervalSec=this.getConfig('updateTimeIntervalSec');this.intervalCounter=this.timeIntervalSec/(this.embedPlayer.monitorRate/1000);this.bind('playerReady',function(){if(_this.getPlayer().isLive()){_this.addBinding();}});this.bind('onChangeMedia',function(){_this.removeBindings();});},removeBindings:function(){this.unbind(this.bindPostfix);},addBinding:function(){var _this=this;this.bind('monitorEvent'+_this.bindPostfix,function(){if(_this.updatedTime>0&&!_this.getPlayer().buffering){_this.updateTime();}});this.bind('seeking'+_this.bindPostfix,function(){_this.preSeekTime=_this.getPlayer().getPlayerElement().currentTime;});this.bind('seeked'+_this.bindPostfix,function(){var delta=_this.preSeekTime-_this.getPlayer().getPlayerElement().currentTime;_this.updatedTime-=delta;});this.bind('onId3Tag'+_this.bindPostfix,function(e,tag){_this.parseTag(tag);});},updateTime:function(){this.counter++;if(this.counter===this.intervalCounter){this.counter=0;this.updatedTime=this.updatedTime+this.timeIntervalSec;this.getPlayer().LiveCurrentTime=this.updatedTime;this.getPlayer().flashCurrentTime=this.updatedTime;this.sendTrackEventMonitor(mw.seconds2npt(this.updatedTime),false);}},parseTag:function(tag){var time;if(tag){time=tag.timestamp/1000;}else{mw.log("id3Tag plugin :: ERROR parsing tag.");}if(time){var d=new Date(0);d.setUTCSeconds(time);this.log("Update time from id3 tag: "+d.toUTCString());this.updatedTime=time;this.counter=0;this.getPlayer().LiveCurrentTime=time;this.getPlayer().flashCurrentTime=time;this.sendTrackEventMonitor(mw.seconds2npt(time),true);}},sendTrackEventMonitor:function(time,isId3TagTime){var traceString="id3Tag plugin :: id3 tag time = ";if(isId3TagTime){mw.log(traceString+time);if(this.getConfig('trackEventMonitor')){try{window.parent[this.getConfig('trackEventMonitor')](traceString+time);}catch(e){}}}}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("kAnalony",function($){(function(mw,$){"use strict";mw.PluginManager.add('kAnalony',mw.KBasePlugin.extend({PlayerEvent:{"IMPRESSION":1,"PLAY_REQUEST":2,"PLAY":3,"RESUME":4,"PLAY_25PERCENT":11,"PLAY_50PERCENT":12,"PLAY_75PERCENT":13,"PLAY_100PERCENT":14,"SHARE_CLICKED":21,"SHARE_NETWORK":22,"DOWNLOAD":23,"REPORT_CLICKED":24,"REPORT_SUBMITED":25,"ENTER_FULLSCREEN":31,"EXIT_FULLSCREEN":32,"PAUSE":33,"REPLAY":34,"SEEK":35,"RELATED_CLICKED":36,"RELATED_SELECTED":37,"CAPTIONS":38,"SOURCE_SELECTED":39,"INFO":40,"SPEED":41,"VIEW":99},startTime:null,reportingInterval:10000,bufferTime:0,eventIndex:1,currentBitRate:-1,currentflavorId:-1,eventType:1,firstPlay:true,viewEventInterval:null,savedPosition:null,monitorIntervalObj:{},_p25Once:false,_p50Once:false,_p75Once:false,_p100Once:false,hasSeeked:false,dvr:false,smartSetInterval:function(callback,time,monitorObj){var _this=this;var speed=time,counter=1,start=new Date().getTime();var instance=function(){if(monitorObj.cancel){return;}callback();var real=(counter*speed),ideal=(new Date().getTime()-start);counter++;var diff=(ideal-real);monitorObj.counter=counter;monitorObj.diff=diff;var nextSpeed=speed-diff;if(Math.abs(nextSpeed)>speed){nextSpeed=speed;}_this.viewEventInterval=window.setTimeout(function(){instance();},nextSpeed);};_this.viewEventInterval=window.setTimeout(function(){instance();},speed);},setup:function(){this.eventIndex=1;this.bufferTime=0;this.currentBitRate=-1;this.entryPlayCounter=1;this.addBindings();},addBindings:function(){var _this=this;var playerEvent=this.PlayerEvent;this.embedPlayer.bindHelper('playerReady',function(){_this.resetPlayerflags();if(_this.kalturaContextData&&_this.kalturaContextData.flavorAssets&&_this.kalturaContextData.flavorAssets.length===1){_this.currentBitRate=_this.kalturaContextData.flavorAssets[0].bitrate;}_this.sendAnalytics(playerEvent.IMPRESSION);});this.embedPlayer.bindHelper('onChangeMedia',function(){_this.firstPlay=true;_this.entryPlayCounter++;});this.embedPlayer.bindHelper('userInitiatedPlay',function(){_this.sendAnalytics(playerEvent.PLAY_REQUEST);});this.embedPlayer.bindHelper('onplay',function(){if(!this.isInSequence()){if(_this.firstPlay){_this.sendAnalytics(playerEvent.PLAY);}else{_this.sendAnalytics(playerEvent.RESUME);}}});this.embedPlayer.bindHelper('userInitiatedPause',function(){_this.sendAnalytics(playerEvent.PAUSE);});this.embedPlayer.bindHelper('monitorEvent',function(){_this.updateTimeStats();});this.embedPlayer.bindHelper('seeked',function(e,seekTarget){_this.hasSeeked=true;if(_this.embedPlayer.isDVR()){_this.dvr=true;}});this.embedPlayer.bindHelper('movingBackToLive',function(){_this.dvr=false;});this.embedPlayer.bindHelper('seeking onpause',function(){if(_this.embedPlayer.isDVR()){_this.dvr=true;}});this.embedPlayer.bindHelper('userInitiatedSeek',function(e,seekTarget){_this.sendAnalytics(playerEvent.SEEK,{"targetPosition":seekTarget});});this.embedPlayer.bindHelper('showShareEvent',function(){_this.sendAnalytics(playerEvent.SHARE_CLICKED);});this.embedPlayer.bindHelper('socialShareEvent',function(e,socialNetwork){_this.sendAnalytics(playerEvent.SHARE_NETWORK,{"socialNetwork":socialNetwork.name});});this.embedPlayer.bindHelper('downloadMedia',function(){_this.sendAnalytics(playerEvent.DOWNLOAD);});this.embedPlayer.bindHelper('onOpenFullScreen',function(){_this.sendAnalytics(playerEvent.ENTER_FULLSCREEN);});this.embedPlayer.bindHelper('onCloseFullScreen',function(){_this.sendAnalytics(playerEvent.EXIT_FULLSCREEN);});this.embedPlayer.bindHelper('onEndedDone',function(){_this.stopViewTracking();});this.embedPlayer.bindHelper('replayEvent',function(){_this.resetPlayerflags();_this.sendAnalytics(playerEvent.REPLAY);});this.embedPlayer.bindHelper('moderationOpen',function(){_this.sendAnalytics(playerEvent.REPORT_CLICKED);});this.embedPlayer.bindHelper('moderationSubmit',function(e,reportType){_this.sendAnalytics(playerEvent.REPORT_SUBMITED,{"reportType":reportType});});this.embedPlayer.bindHelper('relatedOpen',function(){_this.sendAnalytics(playerEvent.RELATED_CLICKED);});this.embedPlayer.bindHelper('relatedVideoSelect',function(e,data){if(!data.autoSelected){_this.sendAnalytics(playerEvent.RELATED_SELECTED,{"relatedEntryId":data.entryId});}});this.embedPlayer.bindHelper('selectClosedCaptions',function(e,language){_this.sendAnalytics(playerEvent.CAPTIONS,{"caption":language});});this.embedPlayer.bindHelper('newSourceSelected',function(e,flavorId){_this.sendAnalytics(playerEvent.SOURCE_SELECTED,{"flavorId":flavorId});});this.embedPlayer.bindHelper('infoScreenOpen',function(){_this.sendAnalytics(playerEvent.INFO);});this.embedPlayer.bindHelper('updatedPlaybackRate',function(e,speed){_this.sendAnalytics(playerEvent.SPEED,{"playbackSpeed":speed});});this.embedPlayer.bindHelper('bufferStartEvent',function(){_this.bufferStartTime=new Date();});this.embedPlayer.bindHelper('bufferEndEvent',function(){_this.calculateBuffer();_this.bufferStartTime=null;});this.embedPlayer.bindHelper('bitrateChange',function(event,newBitrate){_this.currentBitRate=newBitrate;});this.embedPlayer.bindHelper('onPlayerStateChange',function(e,newState,oldState){if(!this.isInSequence()){if(newState==="pause"){_this.stopViewTracking();}if(newState==="play"){if(oldState==="start"||oldState==="pause"){_this.startViewTracking();}}}});this.embedPlayer.bindHelper('AdSupport_midroll AdSupport_postroll',function(){_this.savedPosition=_this.embedPlayer.currentTime;});this.embedPlayer.bindHelper('AdSupport_EndAdPlayback',function(){setTimeout(function(){_this.savedPosition=null;_this.startViewTracking();},0);});this.embedPlayer.bindHelper('AdSupport_StartAdPlayback',function(){_this.stopViewTracking();});this.embedPlayer.bindHelper('SourceSelected',function(e,source){if(source.getBitrate()){_this.currentBitRate=source.getBitrate();}if(source.getAssetId()){_this.currentflavorId=source.getAssetId();}});this.embedPlayer.bindHelper('sourceSwitchingEnd',function(e,newSource){if(newSource.newBitrate){_this.currentBitRate=newSource.newBitrate;}});},resetPlayerflags:function(){this._p25Once=false;this._p50Once=false;this._p75Once=false;this._p100Once=false;this.hasSeeked=false;this.savedPosition=null;},updateTimeStats:function(){var _this=this;var percent=this.embedPlayer.currentTime/this.embedPlayer.duration;var playerEvent=this.PlayerEvent;if(!this.embedPlayer.isLive()){if(!_this._p25Once&&percent>=.25){_this._p25Once=true;_this.sendAnalytics(playerEvent.PLAY_25PERCENT);}else if(!_this._p50Once&&percent>=.50){_this._p50Once=true;_this.sendAnalytics(playerEvent.PLAY_50PERCENT);}else if(!_this._p75Once&&percent>=.75){_this._p75Once=true;_this.sendAnalytics(playerEvent.PLAY_75PERCENT);}else if(!_this._p100Once&&percent>=.99){_this._p100Once=true;_this.sendAnalytics(playerEvent.PLAY_100PERCENT);}}},calculateBuffer:function(closeSession){var _this=this;if(closeSession&&!_this.bufferStartTime){return;}this.bufferTime+=(new Date()-_this.bufferStartTime)/1000;if(this.bufferTime>10){this.bufferTime=10;}if(closeSession){_this.bufferStartTime=new Date();}},stopViewTracking:function(){var _this=this;_this.monitorIntervalObj.cancel=true;clearTimeout(_this.viewEventInterval);_this.viewEventInterval=null;},startViewTracking:function(){if(this.viewEventInterval){this.stopViewTracking();}var _this=this;var playerEvent=this.PlayerEvent;_this.startTime=null;_this.kClient=mw.kApiGetPartnerClient(_this.embedPlayer.kwidgetid);_this.monitorIntervalObj.cancel=false;if(_this.firstPlay){_this.sendAnalytics(playerEvent.VIEW);_this.firstPlay=false;}_this.smartSetInterval(function(){if(!_this._p100Once){_this.sendAnalytics(playerEvent.VIEW);_this.bufferTime=0;}},_this.reportingInterval,_this.monitorIntervalObj);},getEntrySessionId:function(){return this.embedPlayer.evaluate('{configProxy.sessionId}')+"-"+this.entryPlayCounter;},sendAnalytics:function(eventType,additionalData){if(!(this.embedPlayer.kentryid&&this.embedPlayer.kpartnerid)){return;}var _this=this;this.calculateBuffer(true);this.kClient=mw.kApiGetPartnerClient(this.embedPlayer.kwidgetid);if(this.embedPlayer.isMulticast&&$.isFunction(this.embedPlayer.getMulticastBitrate)){this.currentBitRate=this.embedPlayer.getMulticastBitrate();}var playbackType="vod";if(this.embedPlayer.isLive()){playbackType=this.dvr?"dvr":"live";}var position=this.embedPlayer.currentTime?this.embedPlayer.currentTime:0;if(this.savedPosition){position=this.savedPosition;}var statsEvent={'entryId':this.embedPlayer.kentryid,'partnerId':this.embedPlayer.kpartnerid,'eventType':eventType,'sessionId':this.getEntrySessionId(),'eventIndex':this.eventIndex,'bufferTime':this.bufferTime,'actualBitrate':this.currentBitRate,'flavorId':this.currentflavorId,'referrer':mw.getConfig('EmbedPlayer.IsFriendlyIframe')?mw.getConfig('EmbedPlayer.IframeParentUrl'):document.referrer,'deliveryType':this.embedPlayer.streamerType,'sessionStartTime':this.startTime,'uiConfId':this.embedPlayer.kuiconfid,'clientVer':mw.getConfig("version"),'position':position,'playbackType':playbackType};var flashVarEvents={'playbackContext':'playbackContext','applicationName':'application','userId':'userId'};for(var fvKey in flashVarEvents){if(this.embedPlayer.getKalturaConfig('',fvKey)){statsEvent[flashVarEvents[fvKey]]=this.embedPlayer.getKalturaConfig('',fvKey);}}var ks=this.kClient.getKs();if(ks){statsEvent["ks"]=ks;}if(this.embedPlayer.getRawKalturaConfig('mediaProxy')&&this.embedPlayer.getRawKalturaConfig('mediaProxy').preferedFlavorBR){statsEvent["expectedQuality"]=this.embedPlayer.getRawKalturaConfig('mediaProxy').preferedFlavorBR;}if(additionalData){$.extend(statsEvent,additionalData);}var config=this.getConfig();for(var key in config){if(key.indexOf("customVar")!==-1){var customVarObj={};customVarObj[key]=config[key];$.extend(statsEvent,customVarObj);}}if(mw.getConfig("playbackContext")){statsEvent["playbackContext"]=mw.getConfig("playbackContext");}var eventRequest={'service':'analytics','action':'trackEvent'};$.each(statsEvent,function(event,value){eventRequest[event]=value;});this.eventIndex+=1;this.embedPlayer.triggerHelper('analyticsEvent',statsEvent);this.log("Trigger analyticsEvent type = "+statsEvent.eventType);this.kClient.doRequest(eventRequest,function(data){try{if(!_this.startTime){_this.startTime=data;}}catch(e){mw.log("Failed sync time from server");}},true);}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("kdark",function($){;},{"all":"body{letter-spacing:0.04em; -webkit-touch-callout:none ; -webkit-user-select:none ; -webkit-tap-highlight-color:rgba(255,255,255,0); }.topBarContainer{position:absolute;top:0;width:100%;z-index:100;box-sizing:border-box;-webkit-transition:top 0.3s ease-in;-moz-transition:top 0.3s ease-in;-o-transition:top 0.3s ease-in;-ms-transition:top 0.3s ease-in;transition:top 0.3s ease-in;background-color:#222222;background:rgba(0,0,0,0.7);   height:2.3em;padding-right:5px}.topBarContainer.hover{top:-3.6em}.topBarContainer.open{top:0}.topBarContainer .btn{color:#fff;width:2em;text-shadow:none}.topBarContainer.block{position:static}.mobileSkin .topBarContainer{height:4.8em;display:none;background:transparent}.mobileSkin .topBarContainer.open{display:block;height:4.8em}.mobileSkin.size-tiny .topBarContainer.open{height:4em}.mobileSkin.size-small.fullscreen .topBarContainer,.mobileSkin.size-tiny.fullscreen .topBarContainer{display:block}.mobileSkin.pluginsScreenOpened .topBarContainer{display:none !important}.mobileSkin.start-state .topBarContainer{display:none}.sideBarContainerReminder{padding:10px;position:absolute;cursor:pointer;text-shadow:0px 0px 4px rgba(0,0,0,0.6)}#sideBarContainerReminderContainer{font-size:32px;color:rgb(255,255,255)}@media all and (max-width:640px){#sideBarContainerReminderContainer{font-size:24px}}.sideBarContainerReminder:hover div{-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)\";filter:alpha(opacity=100);opacity:1;color:#fff;text-shadow:0px 0px 10px #fff}.sideBarContainerReminder.active div{-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)\";filter:alpha(opacity=100);opacity:1;color:#fff;text-shadow:0px 0px 10px #fff}.sideBarContainerReminder.left{left:-30%;-webkit-transition:left 0.3s ease-in;-moz-transition:left 0.3s ease-in;-o-transition:left 0.3s ease-in;-ms-transition:left 0.3s ease-in;transition:left 0.3s ease-in}.sideBarContainerReminder.left.open{left:0px}.sideBarContainerReminder.left.shifted{left:30%}.sideBarContainerReminder.right{right:-30%;-webkit-transition:right 0.3s ease-in;-moz-transition:right 0.3s ease-in;-o-transition:right 0.3s ease-in;-ms-transition:right 0.3s ease-in;transition:right 0.3s ease-in}.sideBarContainerReminder.right.open{right:0px}.sideBarContainerReminder.right.shifted{right:30%}.sideBarContainer{position:absolute;top:0;width:30%;z-index:100;box-sizing:border-box;height:100%; -webkit-transition:left 0.3s ease-in,right 0.3s ease-in;-moz-transition:left 0.3s ease-in,right 0.3s ease-in;-o-transition:left 0.3s ease-in,right 0.3s ease-in;-ms-transition:left 0.3s ease-in,right 0.3s ease-in;transition:left 0.3s ease-in,right 0.3s ease-in;background:rgb(0,0,0);-ms-filter:progid:DXImageTransform.Microsoft.Alpha(opacity=70);background:rgba(0,0,0,0.7);background:-moz-linear-gradient(top,rgba(0,0,0,0.7) 0%,rgba(0,0,0,0.7) 100%);background:-webkit-gradient(left top,left bottom,color-stop(0%,rgba(0,0,0,0.7)),color-stop(100%,rgba(0,0,0,0.7)));background:-webkit-linear-gradient(top,rgba(0,0,0,0.7) 0%,rgba(0,0,0,0.7) 100%);background:-o-linear-gradient(top,rgba(0,0,0,0.7) 0%,rgba(0,0,0,0.7) 100%);background:-ms-linear-gradient(top,rgba(0,0,0,0.7) 0%,rgba(0,0,0,0.7) 100%);background:linear-gradient(to bottom,rgba(0,0,0,0.7) 0%,rgba(0,0,0,0.7) 100%)}.sideBarContainer.left{left:-30%}.sideBarContainer.openBtn{z-index:1001}.sideBarContainer.left.openBtn{left:0}.sideBarContainer.right{right:-30%}.sideBarContainer.right.openBtn{right:0}.titleLabel{padding:8px 0 0 10px;color:white}.mobileSkin .titleLabel{position:absolute;overflow:hidden;text-overflow:ellipsis;top:4px;padding-left:1em;text-shadow:0px 0px 2.4px rgba(0,0,0,0.12);font-size:2em;font-family:\'Lato\',Helvetica,Arial;color:rgb(255,255,255);font-weight:bold;line-height:1.333em;max-height:2.666em;-webkit-line-clamp:2;-webkit-box-orient:vertical;text-shadow:0px 0px 1px rgba(0,0,0,0.40);display:none !important}.mobileSkin.size-small .titleLabel{font-size:1.5em}.mobileSkin.size-tiny .titleLabel{font-size:1.2em}.ua-chromecast.pause-state .titleLabel{display:block !important;display:-webkit-box !important}.mobileSkin.start-state .titleLabel{display:block !important;display:-webkit-box !important}.fullscreen.mobileSkin .titleLabel{display:none !important}.playlistInterface .fullscreen.mobileSkin .titleLabel{display:block !important;display:-webkit-box !important;width:100% !important;text-align:center !important;top:calc(50% - 5em);padding-left:0px;font-size:1.7em}.playlistInterface .fullscreen.mobileSkin.player-out .titleLabel{display:none !important}.playlistInterface .fullscreen.mobileSkin.pluginsScreenOpened .titleLabel{display:none !important}.controlBarContainer{position:absolute;bottom:0;width:100%;-webkit-transition:bottom 0.3s ease-in,visibility 0.3s ease-in;-moz-transition:bottom 0.3s ease-in,visibility 0.3s ease-in;-o-transition:bottom 0.3s ease-in,visibility 0.3s ease-in;-ms-transition:bottom 0.3s ease-in,visibility 0.3s ease-in;transition:bottom 0.3s ease-in,visibility 0.3s ease-in}.controlBarContainer a{text-decoration:none}.controlBarContainer.hover{bottom:-4.2em;z-index:100;visibility:hidden}.controlBarContainer.open{bottom:0;visibility:visible}.mobileSkin.start-state .controlBarContainer{display:none;bottom:-4.2em}.btn{display:inline-block;height:100%;margin:0;padding:0;width:2.4em;cursor:pointer;border:0;font-size:1.1em}.mobileSkin .btn{font-size:2.4em;width:2em;color:white;outline:0;text-shadow:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mobileSkin.size-tiny .btn{font-size:2em;width:1.6em}.mobileSkin .btn:focus{outline:0}.mobileSkin .topBarContainer .btn{margin-top:0em}.mobileMenuSelect{position:absolute;width:100%;height:100%;opacity:0;font-size:2em;-webkit-appearance:menulist-button}.btnFixed{display:inline-block;height:100%;margin:0;padding:0;width:2.4em;cursor:pointer;border:0;font-size:1.1em}.mobileSkin .btnFixed{width:100%}.mobileSkin.pluginsScreenOpened .playbackRateSelector .btn{font-family:\'Lato\',Helvetica,Arial;}.mobileSkin .videoHolder .playbackRateSelector .btn{font-family:\'icomoon\'}.btnNarrow{width:1.8em}.btn .accessibilityLabel{font-size:0;height:1px !important;overflow:hidden;display:block;position:absolute}.accessibilityLabel{font-size:0;height:1px !important;overflow:hidden;display:block}.dropup{position:relative;height:99%}.pull-right{float:right}.pull-left{float:left}.mobileSkin .videoHolder .smartContainer{width:100%;height:100%;text-align:center;display:-webkit-flex;display:flex;position:absolute;-webkit-justify-content:center;-webkit-align-items:center;-webkit-flex-flow:row wrap;justify-content:center;align-items:center;flex-flow:row wrap} .mobileSkin .smartContainer.comp4,.mobileSkin .smartContainer.comp5,.mobileSkin .smartContainer.comp6{height:80%;top:15%}.mobileSkin .smartContainer.comp2,.mobileSkin .smartContainer.comp4{width:80%;left:10%}.mobileSkin .smartContainer.comp5,.mobileSkin .smartContainer.comp6{width:90%;left:5%}.mobileSkin:not(.pluginsScreenOpened) .smartContainer .comp{display:none !important}@media screen and (orientation:portrait){.mobileSkin.fullscreen .smartContainer{height:50%;top:25%}}.mobileSkin .videoHolder .smartContainer .btn{width:100%;font-size:3.2em}.mobileSkin .videoHolder .smartContainer.comp2 .btn{font-size:3.6em}.mobileSkin.fullscreen.size-large .videoHolder .smartContainer .btn{font-size:4.6em}.mobileSkin .videoHolder .btn{font-size:2.6em;margin-top:0em}.mobileSkin .videoHolder .btn.comp{position:relative}.mobileSkin .videoHolder .comp{display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0)}.btnLabel{font-weight:normal;font-size:0.3em;display:none}.mobileSkin .btnLabel{font-family:\'Lato\',Helvetica,Arial;display:block}.mobileSkin.size-medium .btnLabel,.mobileSkin.size-large .btnLabel{font-size:0.4em}.mobileSkin.fullscreen .btnLabel{font-size:0.3em}.largePlayBtn{cursor:pointer;position:absolute;top:50%;left:50%;font-size:3em;margin:-0.79em 0 0 -1em;text-decoration:none;padding:12px 20px 12px 25px;z-index:3}.largePlayBtnBorder{border-radius:0.1em}.scrubber{position:relative;height:0.6em;cursor:pointer;background-color:#686868;background:rgba(104,104,104,0.6)}.controlsContainer .scrubber{display:inline-block;margin-left:5px;top:-3px}.mobileSkin .controlsContainer .scrubber{height:2px;border-radius:2px;background:rgba(255,255,255,0.8); margin-left:20px; pointer-events:none}.sliderPreviewTime{position:absolute;font-family:Helvetica,Arial;font-size:12px;font-weight:bold;text-shadow:0 0 0.3em #000}.sliderPreview{position:absolute;width:100px;height:60px;z-index:9999999999;border:2px white solid;background-repeat:no-repeat;background-position:center;border-radius:4px}.scrubber .handle-wrapper{position:relative;margin:0 0.44em}.scrubber .watched{position:absolute;top:0;left:0;width:0%;height:100%;z-index:2}.scrubber .buffered{position:absolute;top:0;left:0;height:100%}.scrubber .arrow{position:absolute;left:48px;bottom:-6px;width:0;height:0;border-top:5px solid white;border-left:5px solid transparent;border-right:5px solid transparent}.scrubber .playHead{z-index:100;position:absolute;left:0;top:-3px;width:16px;height:16px;border-radius:50%;outline:0;margin-left:-0.38em; cursor:pointer; -webkit-transform:scale(1,1);-moz-transform:scale(1,1);-ms-transform:scale(1,1);-o-transform:scale(1,1);transform:scale(1,1); -webkit-transform-origin:50% 50%;-moz-transform-origin:50% 50%;-ms-transform-origin:50% 50%;-o-transform-origin:50% 50%;transform-origin:50% 50%; -webkit-transition:-webkit-transform-origin 0.1s ease-out,-webkit-transform 0.1s ease-out;-moz-transition:-moz-transform-origin 0.1s ease-out,-moz-transform 0.1s ease-out;-o-transition:-o-transform-origin 0.1s ease-out,-o-transform 0.1s ease-out;transition:transform-origin 0.1s ease-out,transform 0.1s ease-out; -webkit-transition-property:-webkit-transform-origin,-webkit-transform;-moz-transition-property:-moz-transform-origin,-moz-transform;-o-transition-property:-o-transform-origin,-o-transform;transition-property:transform-origin,transform; -webkit-transition-duration:0.3s,0.3s;-moz-transition-duration:0.3s,0.3s;-o-transition-duration:0.3s,0.3s;transition-duration:0.3s,0.3s; -webkit-transition-timing-function:ease-out,ease-out;-moz-transition-timing-function:ease-out,ease-out;-o-transition-timing-function:ease-out,ease-out;transition-timing-function:ease-out,ease-out; -webkit-transition-delay:initial,initial;-moz-transition-delay:initial,initial;-o-transition-delay:initial,initial;transition-delay:initial,initial;background:rgb(255,255,255); background:-moz-linear-gradient(top,rgba(255,255,255,1) 0%,rgba(204,204,204,1) 50%,rgba(255,255,255,1) 100%); background:-webkit-gradient(linear,left top,left bottom,color-stop(0%,rgba(255,255,255,1)),color-stop(50%,rgba(204,204,204,1)),color-stop(100%,rgba(255,255,255,1))); background:-webkit-linear-gradient(top,rgba(255,255,255,1) 0%,rgba(204,204,204,1) 50%,rgba(255,255,255,1) 100%); background:-o-linear-gradient(top,rgba(255,255,255,1) 0%,rgba(204,204,204,1) 50%,rgba(255,255,255,1) 100%); background:-ms-linear-gradient(top,rgba(255,255,255,1) 0%,rgba(204,204,204,1) 50%,rgba(255,255,255,1) 100%); background:linear-gradient(to bottom,rgba(255,255,255,1) 0%,rgba(204,204,204,1) 50%,rgba(255,255,255,1) 100%); }.mobileSkin .scrubber .playHead{border-radius:14px;width:32px;height:32px;margin-top:-12px;margin-left:-0.7em;pointer-events:auto;background:-moz-radial-gradient(center,ellipse cover,rgba(255,255,255,1) 0%,rgba(255,255,255,1) 30%,rgba(255,255,255,0) 31%,rgba(255,255,255,0) 100%); background:-webkit-radial-gradient(center,ellipse cover,rgba(255,255,255,1) 0%,rgba(255,255,255,1) 30%,rgba(255,255,255,0) 31%,rgba(255,255,255,0) 100%); background:radial-gradient(ellipse at center,rgba(255,255,255,1) 0%,rgba(255,255,255,1) 30%,rgba(255,255,255,0) 31%,rgba(255,255,255,0) 100%); filter:progid:DXImageTransform.Microsoft.gradient( startColorstr=\'#ffffff\',endColorstr=\'#00ffffff\',GradientType=1 ); }.mobileSkin .scrubber .playHead[aria-valuenow=\"100%\"]{margin-left:-0.4em}.mobileSkin .scrubber .playHead.ui-state-active{background:-moz-radial-gradient(center,ellipse cover,rgba(255,255,255,1) 0%,rgba(255,255,255,1) 30%,rgba(255,255,255,0.3) 31%,rgba(255,255,255,0.3) 100%); background:-webkit-radial-gradient(center,ellipse cover,rgba(255,255,255,1) 0%,rgba(255,255,255,1) 30%,rgba(255,255,255,0.3) 31%,rgba(255,255,255,0.3) 100%); background:radial-gradient(ellipse at center,rgba(255,255,255,1) 0%,rgba(255,255,255,1) 30%,rgba(255,255,255,0.3) 31%,rgba(255,255,255,0.3) 100%); filter:progid:DXImageTransform.Microsoft.gradient( startColorstr=\'#ffffff\',endColorstr=\'#00ffffff\',GradientType=1 ); }.player-out .hover .playHead{display:none}.accessibilityButtons{display:inline-block;height:1px}.accessibilityButton{width:1px;height:1px}.nextPrevBtn{display:inline-block;height:100%}.mobileSkin .nextPrevBtn{width:100%;text-align:left}.mobileSkin.pluginsScreenOpened .nextPrevBtn{display:none !important}.mobileSkin .nextPrevBtn\x3e.btn{position:relative;margin-top:-25px;height:50px;top:50%}.mobileSkin.fullscreen.size-large .nextPrevBtn\x3e.btn{font-size:2.6em !important}.mobileSkin .nextPrevBtn\x3e.btn.icon-prev{margin-left:20%}.mobileSkin .nextPrevBtn\x3e.btn.icon-next{float:right;margin-right:20%}.volumeControl{display:inline-block;height:100%}.volumeControl.vertical{width:36px}.volumeControl .ui-slider-horizontal.slider{display:inline-block;width:0;background:#7c7c7c;height:0.5em;top:-2px;-webkit-transition:width 0.3s ease-in-out;-moz-transition:width 0.3s ease-in-out;-o-transition:width 0.3s ease-in-out;-ms-transition:width 0.3s ease-in-out;transition:width 0.3s ease-in-out;cursor:pointer}.volumeControl.noTransition .ui-slider-horizontal.slider{-moz-transition:none ;-webkit-transition:none ;-o-transition:width 0 ease-in;transition:none}.volumeControl.open .ui-slider-horizontal.slider{width:5em;margin-right:10px}.volumeControl .ui-slider-horizontal .ui-slider-handle{display:none}.volumeControl .ui-slider-horizontal .ui-slider-range-min{-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=85)\";filter:alpha(opacity=85);opacity:0.85;background-color:#fff;background-repeat:repeat-x;background:-webkit-gradient(linear,0% 0%,0% 100%,from(#ffffff),to(#dddddd));background:-webkit-linear-gradient(top,#ffffff,#dddddd);background:-moz-linear-gradient(top,#ffffff,#dddddd);background:-o-linear-gradient(top,#ffffff,#dddddd);background:-ms-linear-gradient(top,#ffffff,#dddddd);background:linear-gradient(top,#ffffff,#dddddd);-webkit-box-shadow:0px 1px 0px rgba(0,0,0,0.3);box-shadow:0px 1px 0px rgba(0,0,0,0.3)}.volumeControl .ui-slider-horizontal .ui-slider-range-min:hover{-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)\";filter:alpha(opacity=100);opacity:1;-webkit-box-shadow:0px 0px 10px #fff;box-shadow:0px 0px 10px #fff}.volumeControl .aria{width:0px;height:0px}.volumeControl .sliderContainer{margin-top:-147px;width:40px;display:none;background:rgb(27,27,27);background-color:rgba(27,27,27,.9);border-radius:3px;height:97px;position:absolute}.volumeControl.noTransition .ui-slider-vertical{-moz-transition:none ;-webkit-transition:none ;-o-transition:width 0 ease-in;transition:none}.volumeControl.open .sliderContainer{display:block;display:block}.volumeControl .ui-slider-vertical{height:69px;margin-left:17px;top:14px;width:6px;background-color:#7c7c7c}.volumeControl .sliderContainer .arrow{margin-top:97px;margin-left:11px;width:0;height:0;border-style:solid;border-width:10px 9px 0 9px;border-color:rgb(27,27,27) transparent transparent transparent;position:absolute}.volumeControl .ui-slider-vertical .ui-slider-handle{display:none}.volumeControl .ui-slider-vertical .ui-slider-range-min{-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=85)\";filter:alpha(opacity=85);opacity:0.85;background-color:#fff;background-repeat:repeat-x;background:-webkit-gradient(linear,0% 0%,0% 100%,from(#ffffff),to(#dddddd));background:-webkit-linear-gradient(top,#ffffff,#dddddd);background:-moz-linear-gradient(top,#ffffff,#dddddd);background:-o-linear-gradient(top,#ffffff,#dddddd);background:-ms-linear-gradient(top,#ffffff,#dddddd);background:linear-gradient(top,#ffffff,#dddddd);-webkit-box-shadow:0px 1px 0px rgba(0,0,0,0.3);box-shadow:0px 1px 0px rgba(0,0,0,0.3)}.volumeControl .ui-slider-vertical .ui-slider-range-min:hover{-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)\";filter:alpha(opacity=100);opacity:1;-webkit-box-shadow:0px 0px 10px #fff;box-shadow:0px 0px 10px #fff}.smartContainerMenu{background-color:rgba(255,255,255,0.9);border-radius:4px;position:absolute;color:black;z-index:10}.mobile .smartContainerMenu{background-color:rgba(0,0,0,0.6);border-radius:0px;position:absolute;color:#ffffff;z-index:10;width:100%;height:100%;left:0px;right:0px;top:0px;bottom:0px;display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-box-pack:center;-moz-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-moz-box-align:center;-ms-flex-align:center;-webkit-align-items:center;align-items:center}.smartContainerMenu p{margin-top:20px;margin-bottom:20px}.smartContainerMenu .pluginIcon{display:none}.mobile .smartContainerMenu .pluginIcon{display:block;font-size:64px;padding-left:30px;padding-right:30px}.mobile .smartContainerMenu .pluginPropertyLabel{display:none}.mobile .smartContainerMenu .fakeCombo{display:none}.mobile .smartContainerMenu .hidden{position:absolute;visibility:visible;width:130px;height:100px;margin-top:-80px;opacity:0;-webkit-appearance:menulist-button}.smartContainerMenu label{letter-spacing:0px}.smartContainerMenu .pluginPropertyLabel{color:#555555;margin-left:20px;margin-right:10px;font-size:12px}.smartContainerMenu label{color:#555555;font-size:12px}.smartContainerMenu .pluginProperty.checkbox{width:14px;margin-top:18px;margin-bottom:18px}.smartContainerMenu .hidden{visibility:hidden;width:0px;height:0px;position:absolute}.smartContainerMenu .fakeCombo{font-size:9px;font-weight:bold;letter-spacing:2px;text-transform:uppercase;padding-top:6px;padding-bottom:6px;padding-left:7px;padding-right:7px;color:#999999;border:1px solid #999999;border-radius:3px;width:90px;float:right;margin-right:20px;margin-top:-2px;cursor:pointer}.smartContainerMenu .fakeCombo\x3ei{font-size:8px;float:right;margin-top:2px}.smartContainerMenu .fakeCombo\x3espan{width:80px;display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-top:2px}.smartContainerMenu ul{background-color:white;border:1px solid #999999;width:84px;float:right;right:20px;border-radius:3px;padding-right:10px;padding-left:10px;position:absolute;display:none}.smartContainerMenu li{list-style-type:none;color:#666666;font-size:12px;padding-top:6px;padding-bottom:6px;border-bottom:1px solid #cccccc;padding-left:0px;cursor:pointer;height:18px;overflow:hidden;text-overflow:ellipsis}.smartContainerMenu li:hover{font-weight:bold}.smartContainerMenu li.last{border-bottom:0px}.smartContainerMenu li.active{font-weight:bold}.smartContainerMenu li\x3ei{font-size:9px;float:right;margin-top:4px;display:none}.smartContainerMenu li.active\x3ei{display:block}.timers{position:relative;font-size:0.84em;display:inline;line-height:2.7em;top:-2px}.mobileSkin .timers{font-family:\'Lato\',Helvetica,Arial;top:0px;font-weight:bold;font-size:1.2em;text-shadow:0px 0px 2.4px rgba(0,0,0,0.12)}.mobileSkin.fullscreen .timers{font-size:1.1em}.mobileSkin.size-tiny .timers{font-size:0.9em}.mobileSkin .liveStatus{font-family:\'icomoon\'}.ua-chromecast .liveStatus{display:none}.ua-chromecast .topBarContainer .btn{display:none}.ua-chromecast .controlBarContainer .btn:not (.playHead){display:none}.currentTimeLabel{padding-left:1em;color:#e8e8e8}.mobileSkin .currentTimeLabel{margin-left:10px;margin-right:10px;color:#ffffff}.fullscreen.mobileSkin .currentTimeLabel{margin-right:10px}.mobileSkin.start-state .videoHolder .currentTimeLabel{position:absolute;font-size:1.5em;right:1em;bottom:1em;height:30px;top:inherit;text-shadow:0px 1px 2px rgba(0,0,0,0.20)}.mobileSkin.start-state.size-small .currentTimeLabel,.mobileSkin.start-state.size-tiny .currentTimeLabel{font-size:1.1em;right:0.6em;bottom:0.6em}.durationLabel{padding-left:0.5em;color:#b1aeab}.overlay{position:absolute;top:0;left:0;width:100%;height:100%;z-index:100}.overlay-win{z-index:1000 !important}.overlay-content{width:80%;margin-left:10%;padding-top:20px}.mobileSkin:not(.size-small) .overlay-content{padding-top:10%}.mobileSkin.size-small .overlay-content{padding-top:0px}.overlay-content select{color:#000000;-ms-box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}.mobileSkin .overlay-content select{border:0;color:#fff;outline:1px solid #fff;background-color:transparent}.overlay-content textarea{border:0;outline:1px solid #fff;background-color:transparent;color:#fff;padding-left:8px;padding-top:5px;outline-offset:0px;-ms-box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}.overlay-content .icon-toggle{display:none}.mobileSkin .overlay-content .icon-toggle{display:block;position:absolute;margin-top:17px;right:10%;margin-right:6px}.mobileSkin .overlay-win,.mobileSkin .overlay-win button,.mobileSkin .overlay-win select,.mobileSkin .overlay-win textarea{font-family:\'Lato\',Helvetica,Arial !important;font-size:1em}.alert-container{z-index:101;position:absolute;top:0;height:100%;width:100%;vertical-align:middle;box-sizing:border-box}.mobileSkin .alert-container{font-family:\'Lato\',Helvetica,Arial;background-color:rgba(255,255,255,0.9);width:60%;padding-top:20px;max-height:40% !important;color:#484848;letter-spacing:0;border-radius:10px}.mobileSkin.size-tiny .alert-container{padding-top:10px}.alert{display:table-cell;width:100%;height:100%;vertical-align:middle}.alert-title{padding-left:1.8em;padding-bottom:0.6em;text-align:center}.mobileSkin .alert-title{font-size:18px !important;font-weight:bold !important;background-color:transparent;border:0px solid black}.mobileSkin.size-tiny .alert-title{font-size:14px !important}.mobileSkin .alert-message{font-size:18px !important;font-weight:bold !important}.mobileSkin.size-tiny .alert-message{font-size:11px !important}.mobileSkin .alert-buttons-container{padding-bottom:0px !important;padding-top:20px;width:100% }.mobileSkin .alert-button{height:30px;font-family:\'Lato\',Helvetica,Arial;font-size:14px;border:none;background:transparent;border-top:1px solid #cacaca;border-left:1px solid #cacaca;border-radius:0px;color:#3984EF;width:100%}.alert-body{padding:1.5em 2.2em;font-size:1.5em}.alert-footer{text-align:right;padding-top:1.2em;padding-right:2em}.alert-footer .btn{min-width:100px;border:1px solid;border-radius:4px;padding:6px} .dropdown-menu{position:absolute;top:100%;left:0;z-index:1000;display:none;float:left;min-width:75px;padding:0 0;margin:2px 0 0;list-style:none;-webkit-box-shadow:0 5px 10px rgba(0,0,0,0.2);box-shadow:0 5px 10px rgba(0,0,0,0.2);-webkit-background-clip:padding-box;-moz-background-clip:padding-box;background-clip:padding-box}.dropdown-menu .divider{*width:100%;height:1px;margin:0;*margin:-5px 0 5px;overflow:hidden;background-color:rgba(34,34,34,0.5);border-bottom:1px solid rgba(70,70,70,0.5)}.dropdown-menu \x3e li \x3e a{display:block;padding:3px 10px;clear:both;font-weight:normal;line-height:20px;font-size:0.9em;color:#999999;white-space:nowrap; }.dropdown-menu \x3e li \x3e a:hover,.dropdown-menu \x3e li \x3e a:focus,.dropdown-submenu:hover \x3e a,.dropdown-submenu:focus \x3e a{text-decoration:none;color:#ffffff;background-color:#000}.dropdown-menu \x3e .active \x3e a,.dropdown-menu \x3e .active \x3e a:hover,.dropdown-menu \x3e .active \x3e a:focus{color:#ffffff;text-decoration:none;outline:0}.dropdown-menu \x3e .disabled \x3e a,.dropdown-menu \x3e .disabled \x3e a:hover,.dropdown-menu \x3e .disabled \x3e a:focus{color:#999999}.dropdown-menu \x3e .disabled \x3e a:hover,.dropdown-menu \x3e .disabled \x3e a:focus{text-decoration:none;background-color:transparent;background-image:none;filter:progid:DXImageTransform.Microsoft.gradient(enabled = false);cursor:default}.open{z-index:1000}.open.dropdown-menu{display:block}.pull-right \x3e .dropdown-menu{right:-30px;left:auto}.dropup .dropdown-menu,.navbar-fixed-bottom .dropdown .dropdown-menu{top:auto;bottom:102%}.ua-chromecast .closedCaptions{display:none !important}.closedCaptions \x3e .dropdown-menu{overflow-y:auto;overflow-x:hidden;max-height:200px;width:auto;max-width:140px}@media (max-height:220px){.closedCaptions \x3e .dropdown-menu{max-height:120px}}.dropup .dropdown-submenu \x3e .dropdown-menu{top:auto;bottom:0;margin-top:0;margin-bottom:-2px;border-radius:5px 5px 5px 0} .PlayerContainer{background:#000;color:#fff}.controlsContainer{height:2.1em; background-color:#222222;background:rgba(34,34,34,0.8);background:-webkit-gradient(linear,0% 0%,0% 100%,from(rgba(34,34,34,0.8)),to(rgba(0,0,0,0.8)));background:-webkit-linear-gradient(top,rgba(34,34,34,0.8),rgba(0,0,0,0.8));background:-moz-linear-gradient(top,rgba(34,34,34,0.8),rgba(0,0,0,0.8));background:-o-linear-gradient(top,rgba(34,34,34,0.8),rgba(0,0,0,0.8));background:-ms-linear-gradient(top,rgba(34,34,34,0.8),rgba(0,0,0,0.8));background:linear-gradient(top,rgba(34,34,34,0.8),rgba(0,0,0,0.8));border-top:1px solid rgba(170,168,168,0.5);-webkit-box-shadow:0px -1px 0px rgba(0,0,0,0.8);box-shadow:0px -1px 0px rgba(0,0,0,0.8);width:100%;display:inline-block}.mobileSkin .controlsContainer{position:relative;background:transparent;border-top:0px;box-shadow:none;height:4.2em;width:100%}.mobileSkin.size-tiny .controlsContainer{height:3em}.ui-tooltip{background-color:#000000;background-repeat:repeat-x;background:-webkit-gradient(linear,0% 0%,0% 100%,from(#000000),to(#000000));background:-webkit-linear-gradient(top,#000000,#000000);background:-moz-linear-gradient(top,#000000,#000000);background:-o-linear-gradient(top,#000000,#000000);background:-ms-linear-gradient(top,#000000,#000000);background:linear-gradient(top,#000000,#000000);z-index:1000;font-weight:bold;font-size:0.85em;letter-spacing:0px;color:#aaaaaa;border-radius:2px;padding:2px 5px}.ui-tooltip .arrow{width:70px;height:16px;overflow:hidden;position:absolute;left:50%;margin-left:-35px;bottom:-16px}.ui-tooltip .arrowTop{width:70px;height:16px;overflow:hidden;position:absolute;left:50%;margin-left:-35px;top:-16px;bottom:auto}.ui-tooltip .arrow .top{top:-16px;bottom:auto}.ui-tooltip .arrow .left{left:20%}.ui-tooltip .arrow:after{content:\"\";position:absolute;left:25px;top:-20px;width:20px;height:22px;-webkit-box-shadow:6px 5px 9px -9px #fff;box-shadow:6px 5px 9px -9px #fff;-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-o-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg);tranform:rotate(45deg);background-color:#000000}.ui-tooltip .arrowTop:after{content:\"\";position:absolute;left:25px;bottom:-20px;top:auto;width:20px;height:22px;-webkit-box-shadow:6px 5px 9px -9px #fff;box-shadow:6px 5px 9px -9px #fff;-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-o-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg);tranform:rotate(45deg);background-color:#000000}.ui-tooltip .arrow .top:after{bottom:-20px;top:auto}.btn{-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)\";filter:alpha(opacity=100);opacity:1;background-color:transparent;color:#ccc;text-shadow:1px 1px 1px rgba(0,0,0,0.8);outline-offset:-1px}.btn:hover{-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)\";filter:alpha(opacity=100);opacity:1;color:#fff;text-shadow:0px 0px 10px #fff}.btn.active{-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)\";filter:alpha(opacity=100);opacity:1;color:#fff;text-shadow:0px 0px 10px #fff}.btn.disabled,.btn.disabled:hover,.disabled .btn,.disabled .btn:hover{-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=30)\";filter:alpha(opacity=30);opacity:0.3;cursor:default;text-shadow:none;color:#fff}.btn:focus{outline:1px solid #66CCFF}.playHead.btn:focus{outline:none}.mobile .btn:focus{outline:none}.largePlayBtn{background-color:#222222;background:rgba(0,0,0,0.7);color:#efefef}.mobileSkin .largePlayBtn{display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center;-webkit-justify-content:center;justify-content:center;position:absolute;top:50%;left:50%;font-size:2.6em;text-decoration:none;width:76px;height:76px;border-radius:76px;padding:0px 0px 0px 0px;margin-top:-1.1em;margin-left:-1.05em;background-color:rgba(0,194,255,0.8);color:#ffffff;box-shadow:0px 0px 2px 0px rgba(0,0,0,0.20);outline:none}.mobileSkin.size-small .largePlayBtn{font-size:2.1em;width:60px;height:60px;border-radius:60px}.mobileSkin.size-tiny .largePlayBtn{font-size:1.8em;width:50px;height:50px;border-radius:50px}.largePlayBtn:hover{background-color:rgba(0,0,0,1);color:#fff}.mobileSkin .largePlayBtn:hover{background-color:rgba(0,214,255,0.75);color:#fff}.mobileSkin.pluginsScreenOpened .largePlayBtn{display:none !important}.scrubber.disabled{height:0.3em}.scrubber.disabled .watched{background-image:-webkit-gradient(linear,0 100%,100% 0,color-stop(0.25,rgba(255,255,255,0.15)),color-stop(0.25,transparent),color-stop(0.5,transparent),color-stop(0.5,rgba(255,255,255,0.15)),color-stop(0.75,rgba(255,255,255,0.15)),color-stop(0.75,transparent),to(transparent));background-image:-webkit-linear-gradient(45deg,rgba(255,255,255,0.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,0.15) 50%,rgba(255,255,255,0.15) 75%,transparent 75%,transparent);background-image:-moz-linear-gradient(45deg,rgba(255,255,255,0.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,0.15) 50%,rgba(255,255,255,0.15) 75%,transparent 75%,transparent);background-image:-o-linear-gradient(45deg,rgba(255,255,255,0.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,0.15) 50%,rgba(255,255,255,0.15) 75%,transparent 75%,transparent);background-image:-ms-linear-gradient(45deg,rgba(255,255,255,0.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,0.15) 50%,rgba(255,255,255,0.15) 75%,transparent 75%,transparent);background-image:linear-gradient(45deg,rgba(255,255,255,0.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,0.15) 50%,rgba(255,255,255,0.15) 75%,transparent 75%,transparent);-webkit-background-size:10px 10px;-moz-background-size:10px 10px;background-size:10px 10px}.scrubber.disabled .buffered,.scrubber.disabled .playHead{display:none}.watched{background-color:#2ec7e1}.mobileSkin .watched{background-color:#00D6FF;border-bottom-left-radius:10px;border-top-left-radius:10px}.buffered{background-color:#AFAFAF;background:rgba( 102,102,102,0.5 );-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=40)\";filter:alpha(opacity=40);opacity:0.4;  }.scrubber .playHead:hover{border-color:#fff;-webkit-box-shadow:0 1px 30px rgba(255,255,255,1);box-shadow:0 1px 30px rgba(255,255,255,1);-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)\";filter:alpha(opacity=100);opacity:1}.sourceSelector{display:inline-block}.mobileSkin .controlBarContainer .sourceSelector,.mobileSkin .controlBarContainer .streamSelector{margin-top:-5px}.mobileSkin .controlBarContainer .closedCaptions{margin-top:-6px}.overlay{background:rgb(0,0,0);-ms-filter:progid:DXImageTransform.Microsoft.Alpha(opacity=70);filter:alpha(opacity=70);background:rgba(0,0,0,0.7)}.alert-footer .btn{background:#fbfbfb;color:#000;border-color:#999}.dropdown-menu{-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=85)\";filter:alpha(opacity=85);opacity:0.85;background:#222222}.logo{width:3em;height:100%;position:relative}.logo img{margin:auto;position:absolute;top:0;left:0;bottom:0;right:0;max-width:100%;max-height:100%;border:0px}.kaltura-logo{display:inline-block;height:100%;margin:0;padding:0;width:3em;cursor:pointer;border:0;background-position:12px 6px;background-repeat:no-repeat;background-image:url(http://cdnapi.kaltura.com/html5/html5lib/v2.54//skins/kdark/css/../images/kalturaLogo.png?2017-03-09T14:16:40Z)}.mobileSkin .logo{background-position:center center;top:-0.2em;display:none !important} .fullscreen.mobileSkin .fullScreenBtn{float:left}.mobileSkin.size-tiny .fullScreenBtn{margin-top:3px}.playPauseBtn{width:3.3em}.chromecast{font-size:1.4em} .ad-component{position:absolute;color:#FFF;text-shadow:1px 1px 1px #000;font-size:90%}.ad-notice-label{bottom:14px;left:5px;z-index:102}.ad-skip-btn{cursor:pointer;font-size:110%}.ad-skip-label,.ad-skip-btn{right:5px;bottom:5px;padding:10px 20px;background:rgba(0,0,0,0.6);z-index:101}.overlayAd{width:100% !important;height:100% !important}.hover .ad-skip-label{bottom:30px}.hover .ad-skip-btn{bottom:30px}.hover .ad-notice-label{bottom:40px}#touchOverlay{position:absolute;top:0;width:100%;height:100%;z-index:1}.adplay-state #touchOverlay{top:3em !important}.clearfix:before,.clearfix:after{content:\" \";display:table}.clearfix:after{clear:both}.clearfix{*zoom:1}.watermark{position:absolute;padding:5px;z-index:2}.mobileSkin:not(.pluginsScreenOpened) .watermark{z-index:2}.mobileSkin .watermark{opacity:0.3}.mobileSkin.player-out .watermark{opacity:1}.mobileSkin.start-state .watermark{display:none}.watermark img{border:0px}.watermark.topRight{top:0;right:0}.watermark.topLeft{top:0;left:0}.watermark.bottomRight{bottom:0;right:0}.watermark.bottomLeft{bottom:0;left:0}.hide{display:none}.screen{display:none;position:absolute;width:100%;height:100%;top:0;left:0;z-index:3;box-sizing:border-box;padding-top:2.3em;background-color:#000;background-image:linear-gradient(top,#000000 10%,#3E3E3E 90%);background-image:-o-linear-gradient(top,#000000 10%,#3E3E3E 90%);background-image:-moz-linear-gradient(top,#000000 10%,#3E3E3E 90%);background-image:-webkit-linear-gradient(top,#000000 10%,#3E3E3E 90%);background-image:-ms-linear-gradient(top,#000000 10%,#3E3E3E 90%);background-image:-webkit-gradient(linear,left top,left bottom,color-stop(0.1,#000000),color-stop(0.9,#3E3E3E))}.mobileSkin .screen{padding-top:1em}.screen .icon-close{position:absolute;font-size:1.2em;font-weight:bold;right:2.4em;cursor:pointer;-webkit-tap-highlight-color:rgba(0,0,0,0);z-index:100}.mobileSkin .screen .icon-close{width:1em;height:1em;right:0.3em;top:0em;font-size:2.6em;font-weight:normal}.screen .icon-close:hover{text-shadow:0px 0px 10px #fff}.screen-content{box-sizing:border-box;padding:0 10px}.semiTransparentBkg{z-index:10; background:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzAwMDAwMCIgc3RvcC1vcGFjaXR5PSIwLjUiLz4KICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzNlM2UzZSIgc3RvcC1vcGFjaXR5PSIwLjUiLz4KICA8L2xpbmVhckdyYWRpZW50PgogIDxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIGZpbGw9InVybCgjZ3JhZC11Y2dnLWdlbmVyYXRlZCkiIC8+Cjwvc3ZnPg==);background:-moz-linear-gradient(top,rgba(0,0,0,0.5) 0%,rgba(62,62,62,0.5) 100%); background:-webkit-gradient(linear,left top,left bottom,color-stop(0%,rgba(0,0,0,0.65)),color-stop(100%,rgba(62,62,62,0.65))); background:-webkit-linear-gradient(top,rgba(0,0,0,0.65) 0%,rgba(62,62,62,0.5) 100%); background:-o-linear-gradient(top,rgba(0,0,0,0.65) 0%,rgba(62,62,62,0.65) 100%); background:-ms-linear-gradient(top,rgba(0,0,0,0.65) 0%,rgba(62,62,62,0.65) 100%); background:linear-gradient(to bottom,rgba(0,0,0,0.65) 0%,rgba(62,62,62,0.65) 100%); filter:progid:DXImageTransform.Microsoft.gradient( startColorstr=\'#80000000\',endColorstr=\'#803e3e3e\',GradientType=0 ); }.screen .panel-left{margin-right:10px;position:absolute;width:40%;height:100%}.videoPreview{position:relative;width:230px;height:129px}.animateVideo{transition:top 1s,left 1s,width 1s,height 1s}.previewPlayer .videoDisplay{top:40px;left:6px;z-index:4;width:40%;height:40%;transition:top 1s,left 1s,width 1s,height 1s}.expandPlayerBtn{position:absolute;z-index:10;font-size:2em;top:0.3em;left:0.3em;opacity:0.7;cursor:pointer;border:1px solid grey;border-radius:25px;background-color:grey}.ie8 .expandPlayerBtn{border:0px solid grey;background:url(blank.gif)}.expandPlayerBtn,.previewPlayer + .size-tiny .expandPlayerBtn{display:none}.previewPlayer .expandPlayerBtn{display:inline-block}.share .screen-content,.airPlay .screen-content{padding:10px;position:relative;height:100%}.screen .panel-right{width:58%;position:absolute;right:0}.size-tiny .screen .panel-right,.size-tiny .screen .panel-left,.size-tiny .infoScreen .views{position:static;width:100%;height:auto}.in-progress-state{-webkit-animation:spin 3s linear infinite;-moz-animation:spin 3s linear infinite;animation:spin 3s linear infinite;outline:0 !important}.truncateText{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.adCover{position:fixed;cursor:pointer;width:100%;height:100%;background-color:rgba(0,0,0,0);z-index:2}.adCoverIE8{background-color:black;-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)\"}.AlertMessageTransparent{background-color :transparent;padding :5px;font-weight :normal !important;font-size:1.5em;color:#a4a4a4;opacity:0.5;text-align:center}.AlertTitleTransparent{background-color :transparent;font-weight :normal !important;font-size:1.8em ;color:#a4a4a4;opacity:0.5;text-align:center}.AlertContainerTransparent{background-color :transparent;position:absolute;width:80%;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);-o-transform:translate(-50%,-50%);transform:translate(-50%,-50%);color:white}.flashBlockAlertContainer{background-color :transparent;position:fixed;top:40%;text-align:center;width:100%;color:white}.blur{-webkit-filter:blur(5px);-moz-filter:blur(5px);-o-filter:blur(5px);-ms-filter:blur(5px);filter:blur(5px)}.vpaidContainer{position:absolute;top:0px;left:0px;z-index:2000;width:100%;height:100%}.blackBackground{background-color:#000000}@-moz-keyframes spin{100%{-moz-transform:rotate(360deg)}}@-webkit-keyframes spin{100%{-webkit-transform:rotate(360deg)}}@keyframes spin{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes rotating{from{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(359deg)}}@-moz-keyframes rotating{from{-moz-transform:rotate(0deg)}to{-moz-transform:rotate(359deg)}}@keyframes rotating{from{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-ms-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(359deg);-moz-transform:rotate(359deg);-ms-transform:rotate(359deg);-o-transform:rotate(359deg);transform:rotate(359deg)}}.customSpinner{position:absolute;top:50%;left:50%;margin-top:-50px;margin-left:-50px;border-radius:50%;width:50px;height:50px;border:solid 4px rgba(255,255,255,0.7);background-color:transparent;border-right-color:#00d6ff;-webkit-animation:rotating 0.8s linear infinite;-moz-animation:rotating 0.8s linear infinite;animation:rotating 0.8s linear infinite}.mobileSkin.size-tiny .customSpinner{margin-top:-44px;margin-left:-44px;width:36px;height:36px;border-radius:36px}.mobileSkin .videoShadow{background:rgba(0,0,0,0.5);position:absolute;width:100%;height:100%;opacity:1;transition:opacity 0.3s linear;-webkit-transition:opacity 0.3s linear;-moz-transition:opacity 0.3s linear;-ms-transition:opacity 0.3s linear;-o-transition:opacity 0.3s linear}.mobileSkin.pluginsScreenOpened .videoShadow{background:rgba(0,0,0,0.75)}.mobileSkin.adplay-state .videoShadow{display:none}.closePluginsScreen{position:absolute;cursor :pointer;top :2px;right :2px;width:50px !important;height:50px !important}.closePluginsScreen:active{outline:0;border:0}.mobileSkin .overlay .closePluginsScreen{font-family:\'icomoon\' !important;font-size:2.6em;top:-0.5em;position:absolute;-webkit-tap-highlight-color:rgba(0,0,0,0)}.reportButton{width:100px;-webkit-border-radius:2px;-moz-border-radius:2px;border-radius:24px;background-color:#00d6ff;color:white;text-align:center;padding-top:8px;height:24px;position:absolute;margin-top:6px;cursor:pointer}.reportButton.right{right:10%;margin-right:-1px}.mobileSkin.player-out .videoShadow{opacity:0}.overlayAdContainer{-webkit-transition:top 0.3s ease-in-out;-moz-transition:top 0.3s ease-in-out;-o-transition:top 0.3s ease-in-out;transition:top 0.3s ease-in-out} .cssChecker{display:none !important}@font-face{font-family:\'icomoon\';src:url(http://cdnapi.kaltura.com/html5/html5lib/v2.54//skins/kdark/css/../fonts/icomoon.eot?2017-03-09T14:16:40Z);src:url(http://cdnapi.kaltura.com/html5/html5lib/v2.54//skins/kdark/css/../fonts/icomoon.eot?2017-03-09T14:16:40Z\x26#iefix) format(\'embedded-opentype\'),url(http://cdnapi.kaltura.com/html5/html5lib/v2.54//skins/kdark/css/../fonts/icomoon.woff?2017-03-09T14:16:40Z) format(\'woff\'),url(http://cdnapi.kaltura.com/html5/html5lib/v2.54//skins/kdark/css/../fonts/icomoon.ttf?2017-03-09T14:16:40Z) format(\'truetype\'),url(http://cdnapi.kaltura.com/html5/html5lib/v2.54//skins/kdark/css/../fonts/icomoon.svg?2017-03-09T14:16:40Z\x26#icomoon) format(\'svg\');font-weight:normal;font-style:normal}[class^=\"icon-\"],[class*=\" icon-\"]{font-family:\'icomoon\';speak:none;font-style:normal;font-weight:normal;font-variant:normal;text-transform:none;line-height:1; -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-volume-mute:before{content:\"\\e600\"}.icon-volume-low:before{content:\"\\e601\"}.icon-volume-high:before{content:\"\\e602\"}.icon-unlike:before{content:\"\\e603\"}.icon-share:before{content:\"\\e604\"}.icon-close:before{content:\"\\e605\"}.icon-checkmark:before{content:\"\\e606\"}.icon-check:before{content:\"\\e606\"}.icon-caret:before{content:\"\\e624\"}.icon-cc:before{content:\"\\e607\"}.icon-camera:before{content:\"\\e608\"}.icon-replay:before{content:\"\\e609\"}.icon-related:before{content:\"\\e60a\"}.icon-play:before{content:\"\\e60b\"}.icon-pause:before{content:\"\\e60c\"}.icon-like:before{content:\"\\e60d\"}.icon-info:before{content:\"\\e60e\"}.icon-fullscreen-exit-alt:before{content:\"\\e60f\"}.icon-fullscreen-alt:before{content:\"\\e610\"}.icon-flag:before{content:\"\\e611\"}.icon-expand2:before{content:\"\\e612\"}.icon-expand:before{content:\"\\e613\"}.icon-download:before{content:\"\\e614\"}.icon-contract:before{content:\"\\e615\"}.icon-cog:before{content:\"\\e616\"}.icon-ad:before{content:\"\\e617\"}.icon-list:before{content:\"\\e618\"}.icon-chromecast:before{content:\"\\e619\"}.icon-next:before{content:\"\\e61b\"}.icon-prev:before{content:\"\\e61a\"}.icon-duration:before{content:\"\\e61d\"}.icon-start_time:before{content:\"\\e61c\"}.icon-chapterMenu:before{content:\"\\e61e\"}.icon-clear:before{content:\"\\e61f\"}.icon-magnifyGlass:before{content:\"\\e620\"}.icon-switchSource:before{content:\"\\e621\"}.icon-off-air:before{content:\"\\e622\"}.icon-on-air:before{content:\"\\e623\"}.icon-toggle:before{content:\"\\e624\"}.icon-locator:before{content:\"\\e625\"}.icon-toggleAll:before{content:\"\\e626\"}.icon-audio:before{content:\"\\e627\"}.icon-new-tab:before{content:\"\\e628\"}.mobileSkin .icon-cog:before{content:\"\\e900\"}.mobileSkin .icon-share:before{content:\"\\e901\"}.mobileSkin .icon-more:before{content:\"\\e902\"}.mobileSkin .icon-chromecast:before{content:\"\\e903\"}.mobileSkin .icon-airplay:before{content:\"\\e904\"}.mobileSkin .icon-contract:before{content:\"\\e905\"}.mobileSkin .icon-expand:before{content:\"\\e906\"}.mobileSkin .icon-play:before{text-shadow:0px 0px 2px rgba(0,0,0,0.10);content:\"\\e907\"}.mobileSkin .icon-pause:before{text-shadow:0px 0px 2px rgba(0,0,0,0.10);content:\"\\e908\"}.mobileSkin .icon-prev:before{content:\"\\e909\"}.mobileSkin .icon-next:before{content:\"\\e90a\"}.mobileSkin .icon-richmedia:before{content:\"\\e90b\"}.mobileSkin .icon-info:before{content:\"\\e90c\"}.mobileSkin .icon-cc:before{content:\"\\e90d\"}.mobileSkin .icon-speedrate:before{content:\"\\e90e\"}.mobileSkin .icon-flag:before{content:\"\\e90f\"}.mobileSkin .icon-attachments:before{content:\"\\e910\"}.mobileSkin .icon-download:before{content:\"\\e911\"}.mobileSkin .icon-swap:before{content:\"\\e912\"}.mobileSkin .icon-mainslide:before{content:\"\\e913\"}.mobileSkin .icon-single:before{content:\"\\e914\"}.mobileSkin .icon-split:before{content:\"\\e915\"}.mobileSkin .icon-viewpoint:before{content:\"\\e916\"}.mobileSkin .icon-related:before{content:\"\\e91c\"}.mobileSkin .icon-ad:before{content:\"\\e91e\"}.mobileSkin .icon-arrow-left:before{content:\"\\e917\"}.mobileSkin .icon-close:before{content:\"\\e918\"}\n\n/* cache key: resourceloader:filter:minify-css:7:21b55b63029310951f9c502c5f1fb3db */\n"},{});mw.loader.implement("keyboardShortcuts",function($){(function(mw,$){"use strict";mw.PluginManager.add('keyboardShortcuts',mw.KBasePlugin.extend({defaultConfig:{"volumePercentChange":0.1,"shortSeekTime":5,"longSeekTime":10,"arrowUpKey":38,"arrowDownKey":40,"togglePlaybackKey":32,"shortSeekBackKey":37,"longSeekBackKey":'ctrl+37',"shortSeekForwardKey":39,"longSeekForwardKey":'ctrl+39',"percentageSeekKeys":"49,50,51,52,53,54,55,56,57","openFullscreenKey":70,"escapeKey":27,"gotoBeginingKey":36,"gotoEndKey":35},configKeyNames:['arrowUpKey','arrowDownKey','togglePlaybackKey','shortSeekBackKey','longSeekBackKey','shortSeekForwardKey','longSeekForwardKey','openFullscreenKey','escapeKey','gotoBeginingKey','gotoEndKey'],SHIFT_KEY_CODE:16,CTRL_KEY_CODE:17,ALT_KEY_CODE:18,enableKeyBindings:true,enableSingleKeyBindings:true,enableComboKeyBindings:true,canSeek:false,singleKeys:{},combinationKeys:{'ctrl':{},'alt':{},'shift':{},'alt+ctrl':{},'alt+shift':{},'ctrl+shift':{}},setup:function(){var _this=this;$.each(this.configKeyNames,function(idx,configKey){var keyVal=_this.getConfig(configKey);_this.mapKeyByType(keyVal,configKey);});var percentageArr=this.getConfig('percentageSeekKeys').split(",");$.each(percentageArr,function(keyIdx,keyCode){_this.singleKeys[keyCode]='percentageSeekKeys';});var addKeyCallback=function(keyCode,callback){_this.mapKeyByType(keyCode,callback);};this.bind('pluginsReady',function(){_this.getPlayer().triggerHelper('addKeyBindCallback',addKeyCallback);});this.bind('onEnableKeyboardBinding',function(){_this.enableKeyBindings=true;_this.enableSingleKeyBindings=true;_this.enableComboKeyBindings=true;});this.bind('onDisableKeyboardBinding',function(e,options){if(options){_this.enableSingleKeyBindings=options.disableSingle?!(!!options.disableSingle):true;_this.enableComboKeyBindings=options.disableCombo?!(!!options.disableCombo):true;_this.enableKeyBindings=_this.enableSingleKeyBindings||_this.enableComboKeyBindings;}else{_this.enableKeyBindings=false;_this.enableSingleKeyBindings=false;_this.enableComboKeyBindings=false;}});this.bind('updateBufferPercent',function(){_this.canSeek=true;});$(document).keydown(function(e){if(_this.enableKeyBindings){return _this.onKeyDown(e);}});},mapKeyByType:function(key,callback){switch(typeof key){case"number":this.singleKeys[key]=callback;break;case"string":var parts=key.split("+");if(parts.length==1){this.singleKeys[key]=callback;break;}var validSpecialKeys=['ctrl','alt','shift'];if(parts.length===2){if($.inArray(parts[0],validSpecialKeys)!==-1){this.combinationKeys[parts[0]][parts[1]]=callback;}else{this.log('First key must be one of: '+validSpecialKeys.join(","));}}if(parts.length===3){if(($.inArray(parts[0],validSpecialKeys)!==-1)&&($.inArray(parts[1],validSpecialKeys)!==-1)){var comboKey=parts.slice(0,2).sort(function(a,b){if(a.toLowerCase().charAt(0)>b.toLowerCase().charAt(0)){return 1;}if(a.toLowerCase().charAt(0)<b.toLowerCase().charAt(0)){return-1;}return 0;});this.combinationKeys[comboKey[0]+"+"+comboKey[1]][parts[2]]=callback;}else{this.log('First and second keys must be one of: '+validSpecialKeys.join(","));}}break;}},onKeyDown:function(e){var ranCallback=false;var keyCode=e.keyCode||e.which;if($("*:focus").is("textarea, input")){return true;}if(this.enableComboKeyBindings){if(e.ctrlKey&&e.altKey&&keyCode!==this.CTRL_KEY_CODE&&keyCode!==this.ALT_KEY_CODE&&!ranCallback){ranCallback=this.runCallbackByKeysArr(keyCode,this.combinationKeys['alt+ctrl']);}else if(e.ctrlKey&&e.shiftKey&&keyCode!==this.CTRL_KEY_CODE&&keyCode!==this.SHIFT_KEY_CODE&&!ranCallback){ranCallback=this.runCallbackByKeysArr(keyCode,this.combinationKeys['ctrl+shift']);}else if(e.shiftKey&&e.altKey&&keyCode!==this.SHIFT_KEY_CODE&&keyCode!==this.ALT_KEY_CODE&&!ranCallback){ranCallback=this.runCallbackByKeysArr(keyCode,this.combinationKeys['alt+shift']);}else if(e.altKey&&keyCode!==this.ALT_KEY_CODE){ranCallback=this.runCallbackByKeysArr(keyCode,this.combinationKeys['alt']);}else if(e.ctrlKey&&keyCode!==this.CTRL_KEY_CODE&&!ranCallback){ranCallback=this.runCallbackByKeysArr(keyCode,this.combinationKeys['ctrl']);}else if(e.shiftKey&&keyCode!==this.SHIFT_KEY_CODE&&!ranCallback){ranCallback=this.runCallbackByKeysArr(keyCode,this.combinationKeys['shift']);}}if(!ranCallback&&this.enableSingleKeyBindings){ranCallback=this.runCallbackByKeysArr(keyCode,this.singleKeys);}if(ranCallback){e.preventDefault();return false;}},runCallbackByKeysArr:function(keyCode,keysArr){var keyName=keysArr[keyCode];if($.isFunction(keyName)){keyName(keyCode);this.log('ran callback for key: '+keyCode);return true;}var keyCallback=keyName+'Callback';if(keyName&&typeof this[keyCallback]==='function'){this[keyCallback](keyCode);this.log('ran callback: '+keyCallback+' for key: '+keyCode);return true;}return false;},arrowUpKeyCallback:function(){if(this.getOpenedMenu()!=null){this.getOpenedMenu().previousItem();}else{this.volumeUpKeyCallback();}},arrowDownKeyCallback:function(){if(this.getOpenedMenu()!=null){this.getOpenedMenu().nextItem();}else{this.volumeDownKeyCallback();}},escapeKeyCallback:function(){if(this.getOpenedMenu()!=null){this.getOpenedMenu().close();}else{this.closeFullscreenkeyCallback();}},volumeUpKeyCallback:function(){var currentVolume=parseFloat(this.getPlayer().getPlayerElementVolume());var volumePercentChange=parseFloat(this.getConfig('volumePercentChange'));var newVolumeVal=(currentVolume+volumePercentChange).toFixed(2);if(newVolumeVal>1){newVolumeVal=1;}this.getPlayer().setVolume(newVolumeVal,true);},volumeDownKeyCallback:function(){var currentVolume=parseFloat(this.getPlayer().getPlayerElementVolume());var volumePercentChange=parseFloat(this.getConfig('volumePercentChange'));var newVolumeVal=(currentVolume-volumePercentChange).toFixed(2);if(newVolumeVal<0){newVolumeVal=0;}this.getPlayer().setVolume(newVolumeVal,true);},togglePlaybackKeyCallback:function(){if($('.btn').is(":focus")){return false;}var notificationName=(this.getPlayer().isPlaying())?'doPause':'doPlay';this.getPlayer().sendNotification(notificationName,{'userInitiated':true});return false;},seek:function(seekType,direction){if(!this.canSeek){return false;}var seekTimeConfig=(seekType=='short')?'shortSeekTime':'longSeekTime';var seekTime=parseFloat(this.getConfig(seekTimeConfig));var currentTime=parseFloat(this.getPlayer().currentTime);var newCurrentTime=0;if(direction=='back'){newCurrentTime=currentTime-seekTime;if(newCurrentTime<0){newCurrentTime=0;}}else{newCurrentTime=currentTime+seekTime;if(newCurrentTime>parseFloat(this.getPlayer().getDuration())){newCurrentTime=parseFloat(this.getPlayer().getDuration());}}this.getPlayer().seek(newCurrentTime);},shortSeekBackKeyCallback:function(){this.seek('short','back');},longSeekBackKeyCallback:function(){this.seek('long','back');},shortSeekForwardKeyCallback:function(){this.seek('short','forward');},longSeekForwardKeyCallback:function(){this.seek('long','forward');},percentageSeekKeysCallback:function(keyCode){if(!this.canSeek){return false;}var _this=this;var getPercentage=function(){var percentArr=_this.getConfig('percentageSeekKeys').split(",");var idx=$.inArray(keyCode.toString(),percentArr);return((idx+1)*0.1).toFixed(2);};var seekTime=getPercentage()*this.getPlayer().getDuration();this.getPlayer().seek(seekTime);},openFullscreenKeyCallback:function(){if(!this.getPlayer().getInterface().hasClass('fullscreen')){this.getPlayer().toggleFullscreen();}},closeFullscreenkeyCallback:function(){if(this.getPlayer().getInterface().hasClass('fullscreen')&&this.getPlayer().layoutBuilder.fullScreenManager.inFullScreen){this.getPlayer().toggleFullscreen();}},gotoBeginingKeyCallback:function(){if(!this.canSeek){return false;}this.getPlayer().seek(0);},gotoEndKeyCallback:function(){if(!this.canSeek||this.getPlayer().currentState==='end'){return false;}this.getPlayer().seek(this.getPlayer().getDuration()-1);},getOpenedMenu:function(){var openedMenu=null;for(var pluginID in this.getPlayer().plugins){var plugin=this.getPlayer().plugins[pluginID];if($.isFunction(plugin.getMenu)&&plugin.getMenu().isOpen()){openedMenu=plugin.getMenu();break;}}return openedMenu;}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("kgitGuard",function($){(function(mw,$){"use strict";mw.PluginManager.add('kgitGuard',mw.KBasePlugin.extend({defaultConfig:{"guardText":"Using non production player"},setup:function(){this.proxyPosterMethods();},isSafeEnviornment:function(){var hostPageUrl=window.kWidgetSupport.getHostPageUrl();var loaderPath=kWidget.getPath();return((hostPageUrl.indexOf("kgit.html5video.org")===-1)&&(hostPageUrl.indexOf("player.kaltura.com")===-1)&&(loaderPath.indexOf("kgit.html5video.org")!==-1));},proxyPosterMethods:function(){var _this=this;var orig_updatePosterHTML=this.embedPlayer.updatePosterHTML;this.embedPlayer.updatePosterHTML=function(){orig_updatePosterHTML.call(this);_this.addGuard();};var orig_addBlackScreen=this.embedPlayer.addBlackScreen;this.embedPlayer.addBlackScreen=function(){orig_addBlackScreen.call(this);_this.addGuard();};},addGuard:function(){$(this.embedPlayer).append('<div class="guard-ribbon-wrapper"><div class="guard-ribbon">'+this.getConfig("guardText")+'</div></div>');}}));})(window.mw,window.jQuery);;},{"all":".guard-ribbon-wrapper{width:300px;height:220px;overflow:hidden;position:absolute;top:0px;left:0px}.guard-ribbon{font:bold 15px Sans-Serif;color:red;text-align:center;text-shadow:rgba(255,255,255,0.5) 0px 1px 0px;-webkit-transform:rotate(-45deg);-moz-transform:rotate(-45deg);-ms-transform:rotate(-45deg);-o-transform:rotate(-45deg);position:relative;padding:25px 0;left:-46px;top:65px;width:270px;background-color:red;background-image:-webkit-gradient(linear,left top,left bottom,from(red),to(red));background-image:-webkit-linear-gradient(top,red,red);background-image:-moz-linear-gradient(top,red,red);background-image:-ms-linear-gradient(top,red,red);background-image:-o-linear-gradient(top,red,red);color:#6a6340;-webkit-box-shadow:0px 0px 3px rgba(0,0,0,0.3);-moz-box-shadow:0px 0px 3px rgba(0,0,0,0.3);box-shadow:0px 0px 3px rgba(0,0,0,0.3)}.guard-ribbon:before,.guard-ribbon:after{content:\"\";border-top:3px solid #6e8900;border-left:3px solid transparent;border-right:3px solid transparent;position:absolute;bottom:-3px}.guard-ribbon:before{left:0}.guard-ribbon:after{right:0}\n\n/* cache key: resourceloader:filter:minify-css:7:bafd80334cb26086b1c87565f033182f */\n"},{});mw.loader.implement("largePlayBtn",function($){(function(mw,$){"use strict";mw.PluginManager.add('largePlayBtn',mw.KBaseComponent.extend({shouldShow:false,isDisabled:false,defaultConfig:{'parent':'videoHolder','togglePause':true,'order':1},playLabel:gM('mwe-embedplayer-play_clip'),pauseLabel:gM('mwe-embedplayer-pause_clip'),setup:function(){this.addBindings();},isPersistantPlayBtn:function(){return(mw.isAndroid2()||this.getPlayer().isLinkPlayer()||(mw.isIphone()&&mw.getConfig('EmbedPlayer.iPhoneShowHTMLPlayScreen'))&&!mw.isWindowsPhone());},addBindings:function(){var _this=this;this.bind('showInlineDownloadLink',function(e,linkUrl){_this.getComponent().attr({'href':linkUrl.replace('playSessionId=','playSessionId=noev-'),'target':'_blank'});});this.bind('onChangeMediaDone playerReady onpause onEndedDone onRemovePlayerSpinner showPlayerControls showLargePlayBtn',function(e){if(!_this.embedPlayer.isPlaying()&&!_this.embedPlayer.isInSequence()&&!_this.embedPlayer.isPauseLoading){if(mw.isChromeCast()){_this.getComponent().removeClass("icon-play").addClass("icon-pause");if(e.type!=="onpause"&&e.type!=="playerReady"){return;}}else{_this.getComponent().removeClass("icon-pause").addClass("icon-play");}_this.setAccessibility(_this.getComponent(),_this.playLabel);_this.show();}});this.bind('onShowControlBar',function(){if(!mw.isIE8()&&_this.getConfig("togglePause")&&(_this.embedPlayer.isPlaying()||mw.isChromeCast())&&!_this.embedPlayer.isInSequence()){_this.getComponent().removeClass("icon-play").addClass("icon-pause");_this.show();}});this.bind('playing AdSupport_StartAdPlayback onHideControlBar onChangeMedia',function(e){_this.hide();});this.bind('onAddPlayerSpinner showScreen',function(e){_this.hide(true);});this.bind('onPlayerStateChange',function(e,newState,oldState){if(newState=='load'||newState=='play'){_this.setAccessibility(_this.getComponent(),_this.pauseLabel);_this.hide(true);}if(newState=='pause'&&_this.getPlayer().isPauseLoading&&!mw.isChromeCast()){_this.hide();}});this.bind('hideScreen closeMenuOverlay',function(){if(mw.isMobileDevice()&&_this.getPlayer().paused){_this.show();}});this.bind('liveOnline',function(){if(_this.getPlayer().isLive&&!_this.getPlayer().isDVR()){_this.hide();}});},show:function(){if(!this.isDisabled&&!this.embedPlayer.layoutBuilder.displayOptionsMenuFlag){if(this.embedPlayer.isMobileSkin()&&(this.embedPlayer.changeMediaStarted||this.embedPlayer.buffering||this.embedPlayer.isInSequence())){return;}if(this.embedPlayer.isMobileSkin()){if(mw.isIOS8()){this.getComponent().fadeIn('fast').css('display',"-webkit-flex");}else{this.getComponent().fadeIn('fast').css('display',"flex");}}else{this.getComponent().css('display',"block");}}this.shouldShow=true;},hide:function(force){this.hideComponent(force);this.shouldShow=false;},hideComponent:function(force){if(force||!this.isPersistantPlayBtn()){if(this.embedPlayer.isMobileSkin()){this.getComponent().stop();}this.getComponent().hide();}},clickButton:function(event){if(this.getPlayer().isLinkPlayer()){this.getPlayer().triggerHelper('firstPlay');this.getPlayer().triggerHelper('playing');return;}event.preventDefault();event.stopPropagation();if(this.getConfig("togglePause")&&this.getPlayer().isPlaying()){this.getPlayer().sendNotification('doPause',{'userInitiated':true});}else{this.getPlayer().triggerHelper('goingtoplay');this.getPlayer().sendNotification('doPlay',{'userInitiated':true});}},onEnable:function(){this.isDisabled=false;if(this.shouldShow){this.show();}},onDisable:function(){this.isDisabled=true;this.hideComponent();},getComponent:function(){if(!this.$el){var _this=this;var eventName='click';this.$el=$('<a />').attr({'tabindex':'-1','href':'#','role':'button','title':this.playLabel,'class':"icon-play "+this.getCssClass()}).hide().on(eventName,function(e){_this.clickButton(e);});if(!mw.isWindowsPhone()){this.$el.addClass("largePlayBtnBorder");}}return this.$el;}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("liveAnalytics",function($){(function(mw,$){"use strict";mw.PluginManager.add('liveAnalytics',mw.KBasePlugin.extend({defaultConfig:{'forceLoad':false},startTime:null,reportingInterval:10000,bufferTime:0,eventIndex:1,currentBitRate:-1,eventType:1,playing:false,firstPlay:true,liveEventInterval:null,monitorIntervalObj:{},smartSetInterval:function(callback,time,monitorObj){var _this=this;var speed=time,counter=1,start=new Date().getTime();var instance=function(){if(monitorObj.cancel){return;}callback();var real=(counter*speed),ideal=(new Date().getTime()-start);counter++;var diff=(ideal-real);monitorObj.counter=counter;monitorObj.diff=diff;var nextSpeed=speed-diff;if(Math.abs(nextSpeed)>speed){nextSpeed=speed;}_this.liveEventInterval=window.setTimeout(function(){instance();},nextSpeed);};_this.liveEventInterval=window.setTimeout(function(){instance();},speed);},setup:function(){var _this=this;_this.removeBindings();this.embedPlayer.bindHelper('playerReady',function(){if(_this.embedPlayer.isLive()||_this.getConfig('forceLoad')){_this.eventIndex=1;_this.bufferTime=0;_this.currentBitRate=-1;_this.addBindings();if(_this.embedPlayer&&_this.embedPlayer.kalturaContextData&&_this.embedPlayer.kalturaContextData.flavorAssets&&_this.embedPlayer.kalturaContextData.flavorAssets.length===1){_this.currentBitRate=_this.embedPlayer.kalturaContextData.flavorAssets[0].bitrate;}}});},addBindings:function(){var _this=this;this.bind('onPlayerStateChange',function(e,newState,oldState){if(newState==="pause"){_this.stopLiveEvents();_this.playing=false;}if(newState==="play"){_this.startLiveEvents();_this.playing=true;}});this.bind('bufferStartEvent',function(){_this.bufferStartTime=new Date();});this.bind('bufferEndEvent',function(){_this.calculateBuffer();_this.bufferStartTime=null;});this.bind('bitrateChange',function(event,newBitrate){_this.currentBitRate=newBitrate;});this.bind('liveStreamStatusUpdate',function(event,status){if(!status){_this.stopLiveEvents();_this.bufferTime=0;_this.bufferStartTime=null;}else{if(_this.playing&&!_this.isLiveEventsOn){_this.startLiveEvents();}}});this.bind('movingBackToLive',function(){_this.eventType=1;});this.bind('seeked seeking onpause',function(){if(_this.getPlayer().isDVR()){_this.eventType=2;}});},calculateBuffer:function(closeSession){var _this=this;if(closeSession&&!_this.bufferStartTime){return;}this.bufferTime+=(new Date()-_this.bufferStartTime)/1000;if(this.bufferTime>10){this.bufferTime=10;}if(closeSession){_this.bufferStartTime=new Date();}},removeBindings:function(){this.unbind("");},stopLiveEvents:function(){var _this=this;_this.isLiveEventsOn=false;_this.monitorIntervalObj.cancel=true;clearTimeout(_this.liveEventInterval);_this.liveEventInterval=null;},startLiveEvents:function(){var _this=this;_this.startTime=null;if(_this.isLiveEventsOn){return;}_this.isLiveEventsOn=true;_this.kClient=mw.kApiGetPartnerClient(_this.embedPlayer.kwidgetid);_this.monitorIntervalObj.cancel=false;if(_this.firstPlay){_this.sendLiveAnalytics();_this.firstPlay=false;}_this.smartSetInterval(function(){_this.sendLiveAnalytics();},_this.reportingInterval,_this.monitorIntervalObj);},sendLiveAnalytics:function(){var _this=this;_this.calculateBuffer(true);_this.kClient=mw.kApiGetPartnerClient(_this.embedPlayer.kwidgetid);if(_this.embedPlayer.isMulticast&&$.isFunction(_this.embedPlayer.getMulticastBitrate)){_this.currentBitRate=_this.embedPlayer.getMulticastBitrate();}var liveStatsEvent={'entryId':_this.embedPlayer.kentryid,'partnerId':_this.embedPlayer.kpartnerid,'eventType':_this.eventType,'sessionId':_this.embedPlayer.evaluate('{configProxy.sessionId}'),'eventIndex':_this.eventIndex,'bufferTime':_this.bufferTime,'bitrate':_this.currentBitRate,'referrer':encodeURIComponent(mw.getConfig('EmbedPlayer.IframeParentUrl')),'isLive':1,'deliveryType':_this.embedPlayer.streamerType,'startTime':_this.startTime};var eventRequest={'service':'liveStats','action':'collect'};$.each(liveStatsEvent,function(index,value){eventRequest['event:'+index]=value;});_this.bufferTime=0;_this.eventIndex+=1;_this.embedPlayer.triggerHelper('liveAnalyticsEvent',liveStatsEvent);_this.kClient.doRequest(eventRequest,function(data){try{if(!_this.startTime){_this.startTime=data;}}catch(e){mw.log("Failed sync time from server");}},true);}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("liveStream",function($){(function(mw,$){"use strict";mw.PluginManager.add('liveCore',mw.KBasePlugin.extend({firstPlay:false,liveStreamStatusInterval:10,defaultDVRWindow:30*60,onAirStatus:true,defaultConfig:{offlineAlertOffest:1000,disableLiveCheck:false,hideOfflineIndicators:false,hideCurrentTimeLabel:true,showThumbnailWhenOffline:false},shouldReAttachTimeUpdate:false,playWhenOnline:false,maxCurrentTime:0,liveStreamStatusUpdated:false,setup:function(){this.addPlayerBindings();this.extendApi();},extendApi:function(){var _this=this;this.getPlayer().isOffline=function(){return!_this.onAirStatus;}},addPoster:function(){this.getPlayer().removePosterFlag=false;this.getPlayer().updatePosterHTML();},removePoster:function(){this.getPlayer().removePoster();this.getPlayer().removePosterFlag=true;},addPlayerBindings:function(){var _this=this;var embedPlayer=this.getPlayer();this.bind('checkIsLive',function(e,callback){_this.getLiveStreamStatusFromAPI(callback);});this.bind('playerReady',function(){_this.onAirStatus=true;_this.isLiveChanged();});this.bind('onpause',function(){if(embedPlayer.isLive()&&_this.isDVR()&&_this.switchDone){embedPlayer.addPlayerSpinner();_this.getLiveStreamStatusFromAPI(function(onAirStatus){if(onAirStatus){if(_this.shouldHandlePausedMonitor()){_this.addPausedMonitor();}}});}});this.bind('firstPlay',function(){_this.firstPlay=true;});this.bind('AdSupport_PreSequenceComplete',function(){_this.switchDone=true;});this.bind('liveStreamStatusUpdate',function(e,onAirObj){if(!_this.liveStreamStatusUpdated){_this.liveStreamStatusUpdated=true;if(onAirObj.onAirStatus){_this.addPoster();_this.getPlayer().enablePlayControls();}else{_this.getPlayer().disablePlayControls();}}if(_this.onAirStatus&&!onAirObj.onAirStatus){var firstOfflineAlertOffest=_this.calculateOfflineAlertOffest();_this.setOffAir(firstOfflineAlertOffest);}else if(!_this.onAirStatus&&onAirObj.onAirStatus){if(_this.offAirTimeout){clearTimeout(_this.offAirTimeout);_this.offAirTimeout=null;}if(_this.getPlayer().removePosterFlag&&!_this.playWhenOnline&&!embedPlayer.isPlaying()){_this.addPoster();}embedPlayer.layoutBuilder.closeAlert();if(!_this.getPlayer().getError()){_this.getPlayer().enablePlayControls();}embedPlayer.triggerHelper('liveOnline');if(_this.playWhenOnline){embedPlayer.play();_this.playWhenOnline=false;}if(!embedPlayer.firstPlay&&_this.isDVR()){embedPlayer.disablePlayControls();var shouldPause=!embedPlayer.isPlaying();var playingEvtName="seeked.backToLive playing.backToLive";embedPlayer.bindHelper(playingEvtName,function(){embedPlayer.unbindHelper(playingEvtName);setTimeout(function(){embedPlayer.enablePlayControls();if(shouldPause){embedPlayer.pause();}},1);});setTimeout(function(){_this.maxCurrentTime=0;embedPlayer.pauseInterfaceUpdate();embedPlayer.backToLive();},1000);}}if(onAirObj.onAirStatus&&embedPlayer.firstPlay&&embedPlayer.autoplay&&embedPlayer.canAutoPlay()&&!embedPlayer.isInSequence()&&!embedPlayer.isPlaying()){embedPlayer.play();}_this.onAirStatus=onAirObj.onAirStatus;if(_this.isDVR()){if(!onAirObj.onAirStatus){if(_this.shouldHandlePausedMonitor()){_this.removePausedMonitor();}}}});this.bind('durationChange',function(e,newDuration){if(_this.switchDone&&embedPlayer.isLive()&&_this.isDVR()&&embedPlayer.paused){embedPlayer.triggerHelper('timeupdate',[embedPlayer.getPlayerElementTime()]);embedPlayer.triggerHelper('updatePlayHeadPercent',[embedPlayer.getPlayerElementTime()/embedPlayer.duration]);}});this.bind('liveEventEnded',function(){if(embedPlayer.isLive()&&_this.isDVR()){embedPlayer.setLive(false);if(_this.getConfig('hideOfflineIndicators')){_this.isLiveChanged();}embedPlayer.bindHelper('liveOnline',function(){embedPlayer.setLive(true);});if(!_this.isNativeHLS()){embedPlayer.bindHelper('ended',function(){if(embedPlayer.getPlayerElement().seek){embedPlayer.getPlayerElement().seek(0);}});}}});this.bind('movingBackToLive',function(){if(_this.isDVR()&&_this.isNativeHLS()){_this.maxCurrentTime=0;}});},setOffAir:function(offlineAlertOffest){var _this=this;var embedPlayer=this.getPlayer();if(_this.offAirTimeout){clearTimeout(_this.offAirTimeout);_this.offAirTimeout=null;}_this.offAirTimeout=setTimeout(function(){if(!_this.onAirStatus){var secondOfflineAlertOffest=_this.calculateOfflineAlertOffest();if(secondOfflineAlertOffest>1000){_this.setOffAir(secondOfflineAlertOffest);}else{if(!embedPlayer.firstPlay&&_this.isDVR()){embedPlayer.triggerHelper('liveEventEnded');}else{_this.playWhenOnline=embedPlayer.isPlaying();if(_this.getConfig('showThumbnailWhenOffline')){_this.addPoster();}else{embedPlayer.layoutBuilder.displayAlert({title:embedPlayer.getKalturaMsg('ks-LIVE-STREAM-OFFLINE-TITLE'),message:embedPlayer.getKalturaMsg('ks-LIVE-STREAM-OFFLINE'),keepOverlay:true,noButtons:true,props:{customAlertTitleCssClass:"AlertTitleTransparent",customAlertMessageCssClass:"AlertMessageTransparent",customAlertContainerCssClass:"AlertContainerTransparent"}});}_this.getPlayer().disablePlayControls();}embedPlayer.triggerHelper('liveOffline');}}},offlineAlertOffest);},isLiveChanged:function(){var _this=this;var embedPlayer=this.getPlayer();var showComponentsArr=[];var hideComponentsArr=[];_this.maxCurrentTime=0;_this.liveStreamStatusUpdated=false;if(embedPlayer.isLive()){if(!this.getConfig("disableLiveCheck")){_this.removePoster();embedPlayer.disablePlayControls();}_this.addLiveStreamStatusMonitor();hideComponentsArr.push('sourceSelector');embedPlayer.addPlayerSpinner();_this.getLiveStreamStatusFromAPI(function(onAirStatus){if(!embedPlayer._checkHideSpinner){embedPlayer.hideSpinner();}});_this.switchDone=true;if(embedPlayer.sequenceProxy){_this.switchDone=false;}hideComponentsArr.push('durationLabel');if(_this.isDVR()&&!embedPlayer.casting){_this.dvrWindow=embedPlayer.evaluate('{mediaProxy.entry.dvrWindow}')*60;if(!_this.dvrWindow){_this.dvrWindow=_this.defaultDVRWindow;}showComponentsArr.push('scrubber');hideComponentsArr.push('currentTimeLabel');}else{showComponentsArr.push('liveStatus');hideComponentsArr.push('scrubber','currentTimeLabel');}if(_this.isNativeHLS()){_this.bind('timeupdate',function(){var curTime=embedPlayer.getPlayerElement().currentTime;if(_this.isDVR()){if(curTime>_this.maxCurrentTime){_this.maxCurrentTime=curTime;embedPlayer.setDuration(_this.maxCurrentTime);}}});}if(_this.shouldHandlePausedMonitor()){_this.bind('playing',function(){if(_this.isDVR()&&_this.switchDone){_this.removePausedMonitor();}});}}else{embedPlayer.removePosterFlag=false;hideComponentsArr.push('liveStatus');showComponentsArr.push('scrubber','durationLabel','currentTimeLabel');if(!embedPlayer.isMobileSkin()){showComponentsArr.push('sourceSelector');}_this.removeLiveStreamStatusMonitor();_this.unbind('timeupdate');}embedPlayer.triggerHelper('onShowInterfaceComponents',[showComponentsArr]);embedPlayer.triggerHelper('onHideInterfaceComponents',[hideComponentsArr]);embedPlayer.doUpdateLayout();},isDVR:function(){return(this.getPlayer().isDVR()&&this.getPlayer().isTimeUpdateSupported());},getCurrentTime:function(){return this.getPlayer().getPlayerElement().currentTime;},removeMinDVRMonitor:function(){this.log("removeMinDVRMonitor");this.minDVRMonitor=clearInterval(this.minDVRMonitor);},addLiveStreamStatusMonitor:function(){if(this.embedPlayer.getError()){return;}this.log("addLiveStreamStatusMonitor");var _this=this;this.liveStreamStatusMonitor=setInterval(function(){_this.getLiveStreamStatusFromAPI();},_this.liveStreamStatusInterval*1000);},removeLiveStreamStatusMonitor:function(){this.log("removeLiveStreamStatusMonitor");this.liveStreamStatusMonitor=clearInterval(this.liveStreamStatusMonitor);},shouldHandlePausedMonitor:function(){if(this.isNativeHLS()){return true;}return false;},addPausedMonitor:function(){var _this=this;var embedPlayer=this.embedPlayer;var pauseTime=_this.maxCurrentTime;if(pauseTime==0){pauseTime=embedPlayer.getPlayerElementTime();}var pauseClockTime=Date.now();this.log("addPausedMonitor :   Monitor rate = "+mw.getConfig('EmbedPlayer.MonitorRate'));this.pausedMonitor=setInterval(function(){var timePassed=(Date.now()-pauseClockTime)/1000;embedPlayer.setDuration(pauseTime+timePassed);},1000);},removePausedMonitor:function(){this.log("removePausedMonitor");this.pausedMonitor=clearInterval(this.pausedMonitor);},getLiveStreamStatusFromAPI:function(callback){var _this=this;var embedPlayer=this.getPlayer();if(embedPlayer.getFlashvars('streamerType')=='rtmp'){if(callback){callback(_this.onAirStatus);}return;}if(this.getConfig("disableLiveCheck")){if(callback){callback(true);}embedPlayer.triggerHelper('liveStreamStatusUpdate',{'onAirStatus':true});return;}var service='liveStream';if(embedPlayer.kalturaPlayerMetaData&&embedPlayer.kalturaPlayerMetaData.type==8){service='liveChannel';}var protocol='hls';if(embedPlayer.streamerType!='http'){protocol=embedPlayer.streamerType;}var requestObj={'service':service,'action':'islive','id':embedPlayer.kentryid,'protocol':protocol,'partnerId':embedPlayer.kpartnerid};if(mw.isIOSAbove7()){requestObj.rnd=Math.random();}_this.getKalturaClient().doRequest(requestObj,function(data){var onAirStatus=false;if(data===true){onAirStatus=true;}if(callback){callback(onAirStatus);}embedPlayer.triggerHelper('liveStreamStatusUpdate',{'onAirStatus':onAirStatus});},mw.getConfig("SkipKSOnIsLiveRequest"),function(){mw.log("Error occur while trying to check onAir status");embedPlayer.triggerHelper('liveStreamStatusUpdate',{'onAirStatus':false});});},getKalturaClient:function(){if(!this.kClient){this.kClient=mw.kApiGetPartnerClient(this.embedPlayer.kwidgetid);}return this.kClient;},log:function(msg){mw.log("LiveStream :: "+msg);},isNativeHLS:function(){if(mw.isIOS()||mw.isDesktopSafari()||mw.isAndroid()||mw.isEdge()){return true;}return false;},calculateOfflineAlertOffest:function(){var offlineAlertOffest=this.getConfig('offlineAlertOffest');var bufferLength=this.getPlayer().getCurrentBufferLength()*1000;if(bufferLength>0){offlineAlertOffest=bufferLength;}return offlineAlertOffest;}}));})(window.mw,window.jQuery);(function(mw,$){"use strict";mw.PluginManager.add('liveStatus',mw.KBaseComponent.extend({onAirStatus:false,defaultConfig:{'parent':'controlsContainer','order':22,'displayImportance':'high','showTooltip':true},offlineIconClass:'icon-off-air live-icon offline-icon not-clickable',onAirIconClass:'icon-on-air live-icon online-icon not-clickable',unsyncIConClass:'icon-off-air live-icon live-off-sync-icon',noThumbClass:'not-clickable',stringsReady:false,liveText:'',offlineText:'',tooltip:'',prevIconClass:undefined,bindPostfix:'.LiveStatus',setup:function(){this.prevIconClass=this.onAirIconClass;var _this=this;this.bind('playerReady',function(){if(!_this.stringsReady){_this.initStrings();_this.setLiveStreamStatus();}if(_this.getPlayer().isLive()){_this.addBindings();}});this.bind('onChangeMedia',function(){_this.removeBindings();});},initStrings:function(){this.liveText=gM('mwe-embedplayer-player-on-air');this.offlineText=gM('mwe-embedplayer-player-off-air');this.tooltip=gM('mwe-embedplayer-player-jump-to-live');this.stringsReady=true;},addBindings:function(){var _this=this;this.bind('liveStreamStatusUpdate'+_this.bindPostfix,function(e,onAirObj){if(onAirObj.onAirStatus!=_this.onAirStatus){_this.onAirStatus=onAirObj.onAirStatus;_this.setLiveStreamStatus();}});this.bind('movingBackToLive'+_this.bindPostfix,function(){if(_this.onAirStatus){_this.setLiveUI();_this.prevIconClass=_this.onAirIconClass;}});this.once('playing'+_this.bindPostfix,function(){_this.bind('seeked'+_this.bindPostfix+' seeking'+_this.bindPostfix+' onpause'+_this.bindPostfix+' onLiveOffSynchChanged'+_this.bindPostfix,function(e,param){if(!_this.getPlayer().goingBackToLive){if(e.type==='onLiveOffSynchChanged'&&param===false){_this.backToLive();}else{_this.getPlayer().setLiveOffSynch(true);if(_this.onAirStatus){_this.setOffSyncUI();}_this.prevIconClass=_this.unsyncIConClass;}}});});this.bind('onplay'+_this.bindPostfix,function(){if(!_this.getPlayer().isDVR()&&!_this.embedPlayer.changeMediaStarted){_this.getPlayer().setLiveOffSynch(false);}});},removeBindings:function(){this.unbind(this.bindPostfix);},getComponent:function(){var _this=this;if(!this.$el){var $btnText=$('<div />').addClass('back-to-live-text timers '+this.noThumbClass+this.getCssClass()).text(this.offlineText);var $icon=$('<div />').addClass('btn timers '+this.offlineIconClass+this.getCssClass()).click(function(){if(_this.onAirStatus&&_this.prevIconClass!==_this.onAirIconClass){_this.getPlayer().setLiveOffSynch(false);}else{_this.getPlayer().setLiveOffSynch(true);}});this.$el=$('<div />').addClass('back-to-live'+this.getCssClass()).append($icon,$btnText);}return this.$el;},backToLive:function(){if(this.getPlayer().firstPlay){this.getPlayer().play();}else{this.getPlayer().removePoster();this.getPlayer().backToLive();}},setOffSyncUI:function(){this.getComponent().find('.live-icon').removeClass(this.offlineIconClass+" "+this.onAirIconClass).addClass(this.unsyncIConClass);this.getComponent().find('.back-to-live-text').text(this.liveText);this.updateTooltip(this.tooltip);},setLiveUI:function(){this.getComponent().find('.live-icon').removeClass(this.offlineIconClass+" "+this.unsyncIConClass).addClass(this.onAirIconClass);this.getComponent().find('.back-to-live-text').text(this.liveText);this.updateTooltip("");},setLiveStreamStatus:function(){if(this.onAirStatus){if(this.prevIconClass==this.unsyncIConClass){this.setOffSyncUI();}else{this.setLiveUI();}}else{this.getComponent().find('.live-icon').removeClass(this.onAirIconClass+" "+this.unsyncIConClass).addClass(this.offlineIconClass);this.getComponent().find('.back-to-live-text').text(this.offlineText);this.updateTooltip("");}}}))})(window.mw,window.jQuery);;},{"all":".back-to-live{display:inline;border:none}.play_head_dvr .ui-slider-handle{width:10px;height:15px;margin-left:-5px;margin-top:-0px;z-index:2}.live-icon{font-size:0.7em !important;margin-left:10px !important;margin-right:2px !important}.online-icon{color:#FF0000 !important}.offline-icon{color:#A4A4A4 !important;background-color:transparent}.live-off-sync-icon{color:#FF0000 !important;background-color:transparent}.back-to-live-text{color:#FFFFFF !important;font-family:\"Arial Narrow\",Arial}.not-clickable{cursor:default !important}.not-clickable:hover{cursor:default !important;text-shadow:none !important}\n\n/* cache key: resourceloader:filter:minify-css:7:c191469df5135000b151d69f71208102 */\n"},{});mw.loader.implement("logo",function($){(function(mw,$){"use strict";mw.PluginManager.add('logo',mw.KBaseComponent.extend({defaultConfig:{parent:"controlsContainer",order:41,displayImportance:'low',align:"right",cssClass:"kaltura-logo",href:null,title:null,img:null},getComponent:function(){var _this=this;if(!this.$el){var $img=[];if(this.getConfig('img')){$img=$('<img />').attr({alt:this.getConfig('title'),src:this.getConfig('img')}).removeAttr("width height");}this.$el=$('<div />').addClass(this.getCssClass()).addClass('btn').append($('<a />').addClass('btnFixed').click(function(){if(_this.isDisabled)return;if(_this.getConfig('href')){if(mw.isNativeApp()){_this.openInNativeApp();}else{window.open(_this.getConfig('href'),"_blank");}}}).attr({'title':this.getConfig('title')}).append($img));}if(this.getConfig('img')!=null){this.$el.removeClass('kaltura-logo');}return this.$el;},openInNativeApp:function(){var params={actionType:'openURL',url:this.getConfig('href')}
this.getPlayer().doNativeAction(JSON.stringify(params));}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("matchMedia",function($){window.matchMedia||(window.matchMedia=function(){"use strict";var styleMedia=(window.styleMedia||window.media);if(!styleMedia){var style=document.createElement('style'),script=document.getElementsByTagName('script')[0],info=null;style.type='text/css';style.id='matchmediajs-test';script.parentNode.insertBefore(style,script);info=('getComputedStyle'in window)&&window.getComputedStyle(style)||style.currentStyle;styleMedia={matchMedium:function(media){var text='@media '+media+'{ #matchmediajs-test { width: 1px; } }';if(style.styleSheet){style.styleSheet.cssText=text;}else{style.textContent=text;}return info.width==='1px';}};}return function(media){return{matches:styleMedia.matchMedium(media||'all'),media:media||'all'};};}());;},{},{});mw.loader.implement("morePlugins",function($){(function(mw,$){"use strict";mw.PluginManager.add('morePlugins',mw.KBaseSmartContainer.extend({defaultConfig:{'parent':'topBarContainer','order':1,'showTooltip':true,"displayImportance":"high","align":"right","cssClass":"icon-more"},title:gM('mwe-embedplayer-more')}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("nativeBridge",function($){(function(mw,$){"use strict";var NativeBridge={callbacksCount:1,callbacks:{},resultForCallback:function resultForCallback(callbackId,resultArray){try{var callback=NativeBridge.callbacks[callbackId];if(!callback){return;}callback.apply(null,resultArray);}catch(e){alert(e);}},call:function call(functionName,args,callback){var hasCallback=callback&&typeof callback=="function";var callbackId=hasCallback?NativeBridge.callbacksCount++:0;if(hasCallback){NativeBridge.callbacks[callbackId]=callback;}var iframe=document.createElement("IFRAME");iframe.setAttribute("src","js-frame:"+functionName+":"+callbackId+":"+encodeURIComponent(JSON.stringify(args)));document.documentElement.appendChild(iframe);iframe.parentNode.removeChild(iframe);iframe=null;}};NativeBridge.videoPlayer=NativeBridge.videoPlayer||{proxyElement:null,embedPlayer:null,isJsCallbackReady:false,bindPostfix:".nativeBridge",subscribed:[],playerMethods:['stop','play','pause','replay','setPlayerSource','bindPlayerEvents','showNativePlayer','hideNativePlayer','toggleFullscreen','notifyKPlayerEvent','notifyKPlayerEvaluated','notifyJsReady','showChromecastDeviceList','sendCCRecieverMessage','notifyLayoutReady','doneFSBtnPressed','addNativeAirPlayButton','showNativeAirPlayButton','hideNativeAirPlayButton','doNativeAction','textTracksReceived','loadEmbeddedCaptions','flavorsListChanged','switchFlavor','togglePictureInPicture'],registerPlayer:function(proxyElement){var _this=this;this.proxyElement=proxyElement;this.proxyElement.attr=function(attributeName,attributeValue){if(attributeName&&attributeValue===undefined){return _this.proxyElement[attributeName];}else if(attributeName&&attributeValue){_this.proxyElement[attributeName]=attributeValue;_this.execute('setAttribute',[attributeName,attributeValue]);_this.proxyElement['language']=mw.getConfig('localizationCode');_this.execute('setAttribute',['language',mw.getConfig('localizationCode')]);}}
for(var i=0;i<this.playerMethods.length;i++){(function(method){_this.proxyElement[method]=function(arg){_this.execute(method,arg);}})(this.playerMethods[i]);}this.proxyElement.subscribe=function(callback,eventName){_this.subscribed[eventName]=callback;}
this.proxyElement.unsubscribe=function(eventName){_this.subscribed[eventName]=undefined;}
this.bindNativeEvents();},notifyErrorOccurred:function(errObj){var errMsg=errObj!=null?errObj.title+", "+errObj.message:"error undefined";NativeBridge.videoPlayer.execute('setAttribute',["playerError",errMsg]);},notifyJsReadyFunc:function(){if(this.isJsCallbackReady&&this.proxyElement){this.proxyElement.notifyJsReady([]);}},registerEmbedPlayer:function(embedPlayer){var _this=this;this.embedPlayer=embedPlayer;$(this.embedPlayer).unbind("playerError").bind("playerError",function(e,errObj){_this.notifyErrorOccurred(errObj);});this.notifyJsReadyFunc();},sendNotification:function(eventName,eventValue){this.embedPlayer.sendNotification(eventName,eventValue);},getObjectString:function(object){var stringValue=object;if(typeof object==="object"){stringValue=JSON.stringify(object);}return stringValue;},addJsListener:function(eventName){var _this=this;this.embedPlayer.addJsListener(eventName+this.bindPostfix,function(val){_this.embedPlayer.getPlayerElement().notifyKPlayerEvent([eventName,_this.getObjectString(val)]);});},removeJsListener:function(eventName){this.embedPlayer.removeJsListener(eventName+this.bindPostfix);},setKDPAttribute:function(host,prop,value){this.embedPlayer.setKDPAttribute(host,prop,value);},asyncEvaluate:function(expression,callbackName){var result=this.embedPlayer.evaluate(expression);this.embedPlayer.getPlayerElement().notifyKPlayerEvaluated([callbackName,this.getObjectString(result)]);},trigger:function(eventName,eventValue){if(eventValue==="(null)"){eventValue=void(0);}var jsEventValue;if(eventValue!=undefined){jsEventValue=this.stringConvertion(eventValue);}if(eventName=='timeupdate'){this.proxyElement['currentTime']=jsEventValue;}else if(eventName=='progress'){this.proxyElement['progress']=jsEventValue;}else if(eventName=='visible'){this.proxyElement['visible']=jsEventValue;}else if(eventName=='durationchange'){this.proxyElement['duration']=jsEventValue;}else if(eventName=='nativeAction'){this.proxyElement['nativeAction']=jsEventValue;}else if(eventName=='play'){this.proxyElement['paused']=false;}else if(eventName=='pause'){this.proxyElement['paused']=true;}$(this.proxyElement).triggerHandler(eventName,[jsEventValue]);if(this.subscribed[eventName]){this.subscribed[eventName](jsEventValue);}},execute:function(command,args){args=args||[];console.log(command);console.log(args);NativeBridge.call(command,args);},bindNativeEvents:function(){console.log('bindNativeEvents');this.proxyElement.bindPlayerEvents([]);},log:function(message,arg){console.log(message,arg);},getVideoHolderHeight:function(){return this.embedPlayer.getVideoHolder().height();},getControlBarHeight:function(){return this.embedPlayer.getControlBarContainer().height();},stringConvertion:function(str){var value=parseFloat(str);if(isNaN(value)){if(value=='true'){return true;}else if(value=='false'){return false;}else{return str;}}return value;}};if(mw.getConfig('EmbedPlayer.ForceNativeComponent')===true){window["NativeBridge"]=NativeBridge;$(".mwPlayerContainer").one("playerError",function(e,errObj){NativeBridge.videoPlayer.notifyErrorOccurred(errObj);});kWidget.addReadyCallback(function(){NativeBridge.videoPlayer.isJsCallbackReady=true;NativeBridge.videoPlayer.notifyJsReadyFunc();});}})(window.mw,window.jQuery);;},{},{});mw.loader.implement("playPauseBtn",function($){(function(mw,$){"use strict";mw.PluginManager.add('playPauseBtn',mw.KBaseComponent.extend({defaultConfig:{'parent':'controlsContainer','order':1,'showTooltip':true,"displayImportance":"high"},isDisabled:false,playIconClass:'icon-play',pauseIconClass:'icon-pause',replayIconClass:'icon-replay',playTitle:gM('mwe-embedplayer-play_clip'),pauseTitle:gM('mwe-embedplayer-pause_clip'),replayTitle:gM('mwe-embedplayer-replay'),setup:function(embedPlayer){this.addBindings();},isSafeEnviornment:function(){return!this.embedPlayer.isMobileSkin();},getComponent:function(){var _this=this;if(!this.$el){this.$el=$('<button />').attr('title',this.playTitle).addClass("btn icon-play"+this.getCssClass()).click(function(){_this.togglePlayback();});}return this.$el;},addBindings:function(){var _this=this;this.bind('onPlayerStateChange',function(e,newState,oldState){_this.updateUI(newState,oldState);});this.bind('onOpenFullScreen',function(){try{_this.getComponent().focus();}catch(e){}});},updateUI:function(newState,oldState){var removeIconClasses=this.playIconClass+' '+this.pauseIconClass+' '+this.replayIconClass;var newIconClass=null;var title=null;var ignoreChange=false;switch(newState){case'play':title=this.pauseTitle;newIconClass=this.pauseIconClass;break;case'start':title=this.playTitle;newIconClass=this.playIconClass;break;case'pause':if(oldState&&oldState!='end'){title=this.playTitle;newIconClass=this.playIconClass;}else{ignoreChange=true;}break;case'end':title=this.replayTitle;newIconClass=this.replayIconClass;break;default:ignoreChange=true;break;}if(ignoreChange){return;}else{ignoreChange=false;this.updateTooltip(title);this.setAccessibility(this.$el,title);this.getComponent().removeClass(removeIconClasses).addClass(newIconClass);}},togglePlayback:function(){if(this.isDisabled)return;var notificationName=(this.getPlayer().isPlaying())?'doPause':'doPlay';this.getPlayer().sendNotification(notificationName,{'userInitiated':true});}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("polyfill_Array_filter",function($){if(!Array.prototype.filter){Array.prototype.filter=function(fun){'use strict';if(this===void 0||this===null){throw new TypeError();}var t=Object(this);var len=t.length>>>0;if(typeof fun!=='function'){throw new TypeError();}var res=[];var thisArg=arguments.length>=2?arguments[1]:void 0;for(var i=0;i<len;i++){if(i in t){var val=t[i];if(fun.call(thisArg,val,i,t)){res.push(val);}}}return res;};};},{},{});mw.loader.implement("qualitySettings",function($){(function(mw,$){"use strict";mw.PluginManager.add('qualitySettings',mw.KBaseSmartContainer.extend({defaultConfig:{'parent':'topBarContainer','order':2,'showTooltip':true,"displayImportance":"high","align":"right","cssClass":"icon-cog"},title:gM('mwe-embedplayer-quality_settings'),registeredPlugins:[],shouldResumePlay:false,pluginsScreenOpened:false,isDisabled:false}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("reportError",function($){(function(mw,$){"use strict";mw.PluginManager.add('reportError',mw.KBasePlugin.extend({kClient:null,didSeek:false,setup:function(){var _this=this;var embedPlayer=this.getPlayer();this.kClient=mw.kApiGetPartnerClient(embedPlayer.kwidgetid);this.bind('playerReady',function(){_this.didSeek=false;});this.bind('seeking',function(){_this.didSeek=true;});this.bind('embedPlayerError',function(e,data){var resourceUrl=undefined;if(embedPlayer.mediaElement&&embedPlayer.mediaElement.selectedSource){resourceUrl=embedPlayer.mediaElement.selectedSource.getSrc();}var currentTime=$.isFunction(embedPlayer.getPlayerElement().currentTime)?embedPlayer.getPlayerElement().currentTime():embedPlayer.getPlayerElement().currentTime;var msgParams=[];msgParams['pid']=embedPlayer.kpartnerid;msgParams['uiconfId']=embedPlayer.kuiconfid;msgParams['referrer']=window.kWidgetSupport.getHostPageUrl();msgParams['didSeek']=_this.didSeek;msgParams['resourceUrl']=resourceUrl;msgParams['userAgent']=navigator.userAgent;msgParams['playerCurrentTime']=currentTime;msgParams['playerLib']=embedPlayer.selectedPlayer.library;msgParams['streamerType']=embedPlayer.streamerType;if(data){for(var param in data){msgParams[param]=data[param];}}var errorMessage="";for(var i in msgParams){errorMessage+=i+' : '+msgParams[i]+" | ";}var eventRequest={'service':'stats','action':'reportError',errorCode:'mediaError'};eventRequest['errorMessage']=errorMessage;_this.kClient.doRequest(eventRequest);});}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("screenfull",function($){(function(window,document){'use strict';var keyboardAllowed=typeof Element!=='undefined'&&'ALLOW_KEYBOARD_INPUT'in Element,fn=(function(){var val,valLength;var fnMap=[['requestFullscreen','exitFullscreen','fullscreenElement','fullscreenEnabled','fullscreenchange','fullscreenerror'],['webkitRequestFullscreen','webkitExitFullscreen','webkitFullscreenElement','webkitFullscreenEnabled','webkitfullscreenchange','webkitfullscreenerror'],['webkitRequestFullScreen','webkitCancelFullScreen','webkitCurrentFullScreenElement','webkitCancelFullScreen','webkitfullscreenchange','webkitfullscreenerror'],['mozRequestFullScreen','mozCancelFullScreen','mozFullScreenElement','mozFullScreenEnabled','mozfullscreenchange','mozfullscreenerror'],['msRequestFullscreen','msExitFullscreen','msFullscreenElement','msFullscreenEnabled','MSFullscreenChange','MSFullscreenError']];var i=0;var l=fnMap.length;var ret={};for(;i<l;i++){val=fnMap[i];if(val&&val[1]in document){for(i=0,valLength=val.length;i<valLength;i++){ret[fnMap[0][i]]=val[i];}return ret;}}return false;})(),screenfull={request:function(elem,context){var request=fn.requestFullscreen;context=context||document;elem=elem||context.documentElement;if(/5\.1[\.\d]* Safari/.test(navigator.userAgent)){elem[request]();}else{elem[request](keyboardAllowed&&Element.ALLOW_KEYBOARD_INPUT);}},exit:function(context){context=context||document;context[fn.exitFullscreen]();},toggle:function(elem){if(this.isFullscreen){this.exit();}else{this.request(elem);}},isFullscreen:function(context){context=context||document;return!!context[fn.fullscreenElement];},element:function(context){context=context||document;return context[fn.fullscreenElement];},enabled:function(context){context=context||document;return!!context[fn.fullscreenEnabled];},onchange:function(){},onerror:function(){},raw:fn};if(!fn){window.screenfull=false;return;}document.addEventListener(fn.fullscreenchange,function(e){screenfull.onchange.call(screenfull,e);});document.addEventListener(fn.fullscreenerror,function(e){screenfull.onerror.call(screenfull,e);});window.screenfull=screenfull;})(window,document);;},{},{});mw.loader.implement("scrubber",function($){(function(mw,$,kWidget){"use strict";mw.PluginManager.add('scrubber',mw.KBaseComponent.extend({defaultConfig:{'parent':'controlBarContainer','insertMode':'firstChild','order':25,'sliderPreview':true,'thumbSlices':100,'thumbWidth':100,'minWidth':100,'displayImportance':"medium",'disableUntilFirstPlay':false,'showOnlyTime':false,'thumbSlicesUrl':null},waitForFirstPlay:false,updateEnabled:true,liveEdge:98,isSliderPreviewEnabled:function(){return this.getConfig("sliderPreview")&&!this.isDisabled;},setup:function(embedPlayer){if(this.embedPlayer.isMobileSkin()){this.setConfig('parent','controlsContainer');this.setConfig('showOnlyTime',true);}if(this.getConfig('parent')=='controlsContainer'){this.setConfig('insertMode','lastChild');}if(this.embedPlayer.isDVR()){this.setConfig('showOnlyTime',true);}this.addBindings();if(this.isSliderPreviewEnabled()){this.setupThumbPreview();}},addBindings:function(){var _this=this;this.bind('durationChange',function(event,duration){_this.duration=duration;});this.bind('seeked',function(){_this.justSeeked=true;});if(this.getConfig('parent')=='controlsContainer'){this.bind('updateComponentsVisibilityStart',function(){_this.getComponent().css('width',_this.getConfig('minWidth'));});this.bind('updateComponentsVisibilityDone',function(){var $container=_this.getComponent().parent();var compSize=_this.embedPlayer.layoutBuilder.getComponentsWidthForContainer($container)-_this.getComponent().width();var targetSize=$container.width()-compSize;if(targetSize<_this.getConfig('minWidth')){targetSize=_this.getConfig('minWidth');}_this.getComponent().css('width',(targetSize)+'px');});}this.bind('updateBufferPercent',function(e,bufferedPercent){_this.updateBufferUI(bufferedPercent);});this.bindUpdatePlayheadPercent();this.bind('externalUpdatePlayHeadPercent',function(e,perc){_this.updatePlayheadPercentUI(perc);});this.bind('detachTimeUpdate',function(){_this.unbind('updatePlayHeadPercent');});this.bind('reattachTimeUpdate',function(){_this.bindUpdatePlayheadPercent();});this.bind('onOpenFullScreen',function(){if(mw.isIE11()&&(mw.getConfig('EmbedPlayer.IsIframeServer')||mw.getConfig('EmbedPlayer.IsFriendlyIframe'))){window["resizeScrubberIE11"]=true;}});this.bind('onCloseFullScreen',function(){if(window["resizeScrubberIE11"]===true)window["resizeScrubberIE11"]=null;});this.bind('playerReady',function(event){if(_this.getConfig("sliderPreview")){_this.thumbnailsLoaded=_this.loadedThumb=false;setTimeout(function(){_this.loadThumbnails(function(){_this.thumbnailsLoaded=true;});},1000);}if(_this.getConfig('disableUntilFirstPlay')){_this.waitForFirstPlay=true;_this.onDisable();}});if(this.getConfig('disableUntilFirstPlay')){this.waitForFirstPlay=true;this.bind('firstPlay',function(){_this.waitForFirstPlay=false;_this.onEnable();});}this.bind("freezeTimeIndicators",function(e,state){if(state===true){_this.updateEnabled=false;}else{_this.updateEnabled=true;}});this.bind("onPlayerStateChange",function(e,newState,oldState){if(newState==='pause'){_this.paused=true;}});},bindUpdatePlayheadPercent:function(){var _this=this;this.bind('updatePlayHeadPercent',function(e,perc){_this.updatePlayheadPercentUI(perc);});},updatePlayheadPercentUI:function(perc){if(this.updateEnabled){var val=parseInt(perc*1000);this.updatePlayheadUI(val);}},updateBufferUI:function(percent){this.getComponent().find('.buffered').css({"width":(parseInt(percent*100))+'%'});},updatePlayheadUI:function(val){if(this.getPlayer().isPlaying()&&!this.paused&&this.embedPlayer.isDVR()){this.checkForLiveEdge();if(!this.getPlayer().isLiveOffSynch()){this.getComponent().slider('option','value',999);return;}}if(this.embedPlayer.isDVR()){if(this.duration<1800){var relativeEdge=this.calculateRelativeLiveEdge(val);if(!relativeEdge){this.getComponent().slider('option','value',val);}}}else{this.getComponent().slider('option','value',val);}if(this.paused&&this.getPlayer().isPlaying()){this.paused=false;}},checkForLiveEdge:function(){if(this.justSeeked){this.justSeeked=false;return;}var playHeadPercent=(this.getPlayHeadComponent().position().left+this.getPlayHeadComponent().width()/2)/this.getComponent().width();playHeadPercent=parseInt(playHeadPercent*100);if(this.getPlayer().isLiveOffSynch()&&playHeadPercent>=this.liveEdge){this.getPlayer().setLiveOffSynch(false);}},calculateRelativeLiveEdge:function(val){if(this.duration<50){return val>700;}if(this.duration<100){return val>800;}if(this.duration<200){return val>850;}if(this.duration<500){return val>900;}if(this.duration<900){return val>950;}if(this.duration<1200){return val>970;}if(this.duration<1400){return val>980;}if(this.duration<1650){return val>990;}},setupThumbPreview:function(){var _this=this;this.thumbnailsLoaded=false;this.getComponent().on({'mousemove touchmove touchstart':function(e){if(e.toElement&&e.toElement.className.indexOf("sliderPreview")>-1){_this.hideThumbnailPreview();return;}var $this=$(this);var width=$this.width();var offset=$this.offset();var options=$this.slider('option');var value=Math.round(((e.clientX-offset.left)/width)*(options.max-options.min))+options.min;_this.showThumbnailPreview({offset:offset,x:e.clientX-offset.left,val:value,width:width});},'mouseleave touchend':function(){_this.hideThumbnailPreview();}}).append($("<div/>").hide().addClass("sliderPreview").append($("<div/>").addClass("arrow")).append($("<span/>").addClass("sliderPreviewTime")));},onEnable:function(){if(this.waitForFirstPlay)return;this.isDisabled=false;this.getComponent().removeClass('disabled');this.getComponent().slider("option","disabled",false);},onDisable:function(){if(this.isDisabled)return;this.isDisabled=true;this.getComponent().slider("option","disabled",true);this.getComponent().addClass('disabled');},getSliceCount:function(duration){return this.getConfig("thumbSlices")||100;},loadThumbnails:function(callback){var _this=this;if(this.embedPlayer.isLive()||this.getConfig("showOnlyTime")){this.loadedThumb=true;}if(!this.loadedThumb){this.loadedThumb=true;var img=new Image();img.onload=function(){callback();};img.src=this.getThumbSlicesUrl();}else{callback();}},getThumbSlicesUrl:function(){if(this.getConfig('thumbSlicesUrl')){return this.getConfig('thumbSlicesUrl');}var thumbReq={'partner_id':this.embedPlayer.kpartnerid,'uiconf_id':this.embedPlayer.kuiconfid,'entry_id':this.embedPlayer.kentryid,'width':this.getConfig("thumbWidth"),'vid_slices':this.getSliceCount(this.duration)}
if(this.getPlayer().getFlashvars('loadThumbnailWithKs')){thumbReq['ks']=this.getPlayer().getFlashvars('ks');}return kWidget.getKalturaThumbUrl(thumbReq);},showThumbnailPreview:function(data){var showOnlyTime=this.getConfig("showOnlyTime");if(!this.isSliderPreviewEnabled()||!this.thumbnailsLoaded){return;}if(!(data.val>=0&&this.duration>=0)){return;}var $slider=$(".scrubber");if(!$slider.length){this.log('.scrubber class not in DOM');return;}var $sliderPreview=this.getComponent().find(".sliderPreview");var $sliderPreviewTime=this.getComponent().find(".sliderPreview .sliderPreviewTime");var sliderTop=0;var sliderLeft=0;var previewWidth=$sliderPreview.width();var previewHeight=$sliderPreview.height();var top=$(".scrubber").position().top-previewHeight-10;if(this.embedPlayer.isMobileSkin()){top-=25;}if(!showOnlyTime){sliderLeft=data.x-previewWidth/2;if((data.x+data.offset.left)<previewWidth/2){sliderLeft=0;}if(data.x>data.offset.left+data.width-previewWidth/2){sliderLeft=data.offset.left+data.width-previewWidth;}}else{sliderLeft=data.x-$sliderPreviewTime.width()/2;previewWidth=$sliderPreviewTime.width();if((data.x+data.offset.left)<$sliderPreviewTime.width()/2){sliderLeft=0;}if(data.x>data.offset.left+data.width-$sliderPreviewTime.width()/2){sliderLeft=data.offset.left+data.width-$sliderPreviewTime.width()-5;}$(".arrow").hide();}var perc=data.val/1000;perc=perc>1?1:perc;var currentTime=Math.floor(this.duration*perc);var thumbWidth=showOnlyTime?$sliderPreviewTime.width():this.getConfig("thumbWidth");$sliderPreview.css({top:top,left:sliderLeft});if(!showOnlyTime){$sliderPreview.css({'background-image':'url(\''+this.getThumbSlicesUrl()+'\')','background-position':kWidget.getThumbSpriteOffset(thumbWidth,currentTime,this.duration,this.getSliceCount(this.duration)),'background-size':(thumbWidth*this.getSliceCount(this.duration))+'px 100%'});}else{$sliderPreview.css("border","0px");}$(".scrubber .arrow").css("left",thumbWidth/2-4);var timeText;if(this.embedPlayer.isDVR()){if(this.getPlayer().isLiveOffSynch()&&parseInt(perc*100)>this.liveEdge){timeText='LIVE';}else{timeText="-"+kWidget.seconds2npt(this.duration-currentTime);}}else{timeText=kWidget.seconds2npt(currentTime);}$sliderPreviewTime.text(timeText);$sliderPreviewTime.css({bottom:2,left:thumbWidth/2-$sliderPreviewTime.width()/2+3});$sliderPreview.css("width",thumbWidth);if(kWidget.isIE8()){$sliderPreview.css("height",43);}if($sliderPreview.width()>0){$sliderPreview.css("visibility","visible");}else{$sliderPreview.css("visibility","hidden");}$sliderPreview.show();},hideThumbnailPreview:function(){this.getComponent().find(".sliderPreview").hide();},getSliderConfig:function(){var _this=this;var embedPlayer=this.getPlayer();var alreadyChanged=false;return{range:"min",value:0,min:0,max:1000,animate:mw.getConfig('EmbedPlayer.MonitorRate')-(mw.getConfig('EmbedPlayer.MonitorRate')/30),start:function(event,ui){embedPlayer.userSlide=true;$(_this.getPlayer()).one('hidePlayerControls onFocusOutOfIframe',function(){$(document).trigger('mouseup');});},slide:function(event,ui){_this.updateAttr(ui);},change:function(event,ui){alreadyChanged=true;var seekTime=(ui.value/1000)*embedPlayer.getDuration();_this.updateAttr(ui);if(embedPlayer.userSlide){embedPlayer.userSlide=false;embedPlayer.seeking=true;embedPlayer.triggerHelper("userInitiatedSeek",seekTime);embedPlayer.seek(seekTime);}}};},updateAttr:function(ui){var perc=ui.value/1000;var $slider=this.$el;var title=mw.seconds2npt(perc*this.embedPlayer.getDuration());var totalDuration=mw.seconds2npt(this.embedPlayer.getDuration());var attributes={'data-title':title,'aria-valuetext':title+" of "+totalDuration,'aria-valuenow':parseInt(perc*100)+'%'};$slider.attr(attributes);},getPlayHeadComponent:function(){return this.getComponent().find('.playHead');},getComponent:function(){var _this=this;if(!this.$el){this.$el=$('<div />').attr({'role':'slider'}).addClass(this.getCssClass()+" scrubber").slider(this.getSliderConfig());this.$el.find('.ui-slider-handle').addClass('playHead PIE btn').wrap('<div class="handle-wrapper" />');this.updateAttr({'value':0});this.$el.find('.ui-slider-range-min').addClass('watched');this.$el.append($('<div />').addClass("buffered"));if(this.getConfig('parent')=='controlsContainer'){this.$el.css({'width':this.getConfig('minWidth')});}this.$el.on("mouseup",function(){_this.hideThumbnailPreview();});}return this.$el;}}));})(window.mw,window.jQuery,kWidget);;},{},{});mw.loader.implement("sideBarContainer",function($){(function(mw,$){"use strict";mw.PluginManager.add('sideBarContainer',mw.KBasePlugin.extend({defaultConfig:{'hover':true,'clickToClose':false,'closeTimeout':2000,'position':'left','fullScreenDisplayOnly':false,'minDisplayWidth':0,'minDisplayHeight':0,'toggleBtnLabel':null,enableKeyboardShortcuts:true,"keyboardShortcutsMap":{"open":"ctrl+79","close":"ctrl+alt+79"}},enabled:true,render:true,currentScreenNameShown:"",keepOnScreen:false,openAfterDisable:false,setup:function(){this.addBindings();},addBindings:function(){var _this=this;this.bind('addLayoutContainer',function(){_this.getPlayer().getVideoHolder().before(_this.getComponent());_this.getComponent().after(_this.$elHelper);});this.bind('layoutBuildDone ended',function(){var disableClosingTimeout=function(){if(_this.closeBarTimeout){clearTimeout(_this.closeBarTimeout);_this.closeBarTimeout=null;}};_this.getComponentReminder().off('click touchstart').on('click touchstart',function(e){e.stopPropagation();e.preventDefault();disableClosingTimeout();_this.toggleSideBar();return false;});if(!_this.getConfig('clickToClose')){_this.getComponent().on('mouseleave',function(){disableClosingTimeout();_this.closeBarTimeout=setTimeout(function(){_this.closeBarTimeout=null;if(_this.getConfig('isSideBarOpen')){_this.close();}},_this.getConfig("closeTimeout"));}).on('mouseenter',function(){disableClosingTimeout();});}});this.bind('onDisableInterfaceComponents',function(event,excludedComponents){if($.inArray(_this.pluginName,excludedComponents)==-1){_this.enabled=false;_this.hideReminder();}});this.bind('onEnableInterfaceComponents',function(event,excludedComponents){if($.inArray(_this.pluginName,excludedComponents)==-1){_this.enabled=true;_this.showReminder();}});this.bind('preShowScreen',function(event,screenName){_this.currentScreenNameShown=screenName;_this.enabled=false;_this.hideReminder();});this.bind('preHideScreen',function(event,screenName){if(_this.currentScreenNameShown===screenName){_this.currentScreenNameShown="";_this.enabled=true;_this.showReminder();}});this.bind('updateLayout',function(){if(_this.getPlayer().layoutBuilder.isInFullScreen()||(!_this.getConfig("fullScreenDisplayOnly")&&_this.getConfig("minDisplayWidth")<=_this.getPlayer().getWidth()&&_this.getConfig("minDisplayHeight")<=_this.getPlayer().getHeight())){_this.render=true;_this.setHeight();_this.showReminder();}else{_this.render=false;_this.hideReminder();}});this.bind('layoutBuildDone',function(){if(!_this.getComponent().children().length){_this.getComponent().hide();_this.getComponentReminder().hide();}});this.bind('onChangeMedia',function(){_this.close();});this.bind('closeSideBarContainer',function(){_this.close();});this.bind('openSideBarContainer',function(){_this.open();});this.bind('onChangeMediaDone layoutChange',function(){var children=_this.getComponent().children();if(children.length&&(children.filter('*[data-visibility="visible"]').length>0)){_this.getComponent().show();_this.getComponentReminder().show();}else{_this.getComponent().hide();_this.getComponentReminder().hide();}});this.bind('layoutBuildDone ended',function(){_this.setHeight();_this.showReminder();});if(this.getConfig('hover')){this.bind('showPlayerControls',function(e,data){_this.showReminder();});this.bind('hidePlayerControls',function(){_this.hideReminder();});this.bind('onComponentsHoverDisabled',function(){_this.keepOnScreen=true;_this.showReminder();});this.bind('onComponentsHoverEnabled preHideScreen',function(){_this.keepOnScreen=false;});}if(this.getConfig('enableKeyboardShortcuts')){this.bind('addKeyBindCallback',function(e,addKeyCallback){_this.addKeyboardShortcuts(addKeyCallback);});}},addKeyboardShortcuts:function(addKeyCallback){var _this=this;addKeyCallback(this.getConfig("keyboardShortcutsMap").open,function(){_this.open();});addKeyCallback(this.getConfig("keyboardShortcutsMap").close,function(){_this.close();});},showReminder:function(){if(this.enabled&&this.render){this.getComponentReminder().addClass('open');if(this.openAfterDisable){this.openAfterDisable=false;this.getComponentReminder().trigger("click");}}},hideReminder:function(){if(this.enabled&&this.render&&(this.keepOnScreen||(this.getConfig('clickToClose')&&this.getConfig('isSideBarOpen'))))return;if(this.getConfig('isSideBarOpen')){this.openAfterDisable=true;}this.setConfig('isSideBarOpen','false');this.getComponentReminder().removeClass('open shifted');this.getComponent().removeClass('openBtn');},toggleSideBar:function(){if(this.getConfig('isSideBarOpen')){this.close();}else{this.open();}},open:function(){if(this.render){this.setConfig('isSideBarOpen','true');this.getComponentReminder().addClass('shifted');this.getComponent().addClass('openBtn');this.getPlayer().triggerHelper('onShowSideBar');this.getPlayer().triggerHelper('clearTooltip');this.getPlayer().triggerHelper('onComponentsHoverDisabled');}},close:function(){this.setConfig('isSideBarOpen','false');this.getComponent().removeClass('openBtn');this.getComponentReminder().removeClass('shifted');this.getPlayer().triggerHelper('onHideSideBar');this.getPlayer().triggerHelper('clearTooltip');this.getPlayer().triggerHelper('onComponentsHoverEnabled');},setHeight:function(){var height=this.getPlayer().getHeight()-this.getPlayer().getControlBarContainer().height();var noControls=this.getPlayer().isMobileSkin()?2:0;if(this.getPlayer().getTopBarContainer().length&&this.getPlayer().getTopBarContainer().children().length!==noControls){height-=this.getPlayer().getTopBarContainer().height();this.getComponent().css('top',this.getPlayer().getTopBarContainer().height());this.getComponentReminder().css('top',this.getPlayer().getTopBarContainer().height());}else{this.getComponent().css('top',0);this.getComponentReminder().css('top',0);}this.getComponent().css('height',height);},getComponent:function(){if(!this.$el){this.getComponentReminder();var _this=this;this.$el=$('<div />').addClass('sideBarContainer '+_this.getConfig('position'));if(this.getConfig('hover')){this.$el.addClass('hover');}else{this.$el.addClass('block');}}return this.$el;},getComponentReminder:function(){if(!this.$elHelper){var _this=this;var title=this.getConfig("toggleBtnLabel")||gM("ks-sidebar-toggleBtn");this.$elHelper=$('<div>').addClass('sideBarContainerReminder tooltipBelow '+_this.getConfig('position')).prop("title",title).attr("data-show-tooltip",true).append($('<div id="sideBarContainerReminderContainer">').addClass('icon-chapterMenu'));if(this.getConfig('hover')){this.$elHelper.addClass('hover');}else{this.$elHelper.addClass('block');}}return this.$elHelper;},destroy:function(){this._super();this.getComponent().remove();this.getComponentReminder().remove();}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("statisticsPlugin",function($){(function(mw,$){"use strict";mw.addKalturaPlugin("statistics",function(embedPlayer,callback){mw.addKAnalytics(embedPlayer);callback();});})(window.mw,window.jQuery);;},{},{});mw.loader.implement("topBarContainer",function($){(function(mw,$){"use strict";mw.PluginManager.add('topBarContainer',mw.KBasePlugin.extend({defaultConfig:{'hover':true},keepOnScreen:false,screenOpen:false,setup:function(){this.addBindings();},addBindings:function(){var _this=this;this.bind('addLayoutContainer',function(){_this.getPlayer().getVideoHolder().before(_this.getComponent());});this.bind('ended',function(){_this.show();});this.bind('layoutBuildDone',function(){if(!_this.embedPlayer.isMobileSkin()){_this.show();}});this.bind('layoutBuildDone',function(){if(!_this.getComponent().children().length&&!_this.embedPlayer.isMobileSkin()){_this.destroy();}});if(this.getConfig('hover')){this.bind('showPlayerControls',function(e,data){_this.show();});this.bind('hidePlayerControls',function(){_this.hide();});this.bind('onComponentsHoverDisabled',function(){_this.keepOnScreen=true;_this.show();});this.bind('hideScreen closeMenuOverlay',function(){_this.screenOpen=false;if(!_this.embedPlayer.paused){_this.keepOnScreen=false;_this.hide();}else{_this.show();}});this.bind('onComponentsHoverEnabled displayMenuOverlay',function(){_this.keepOnScreen=false;_this.hide();});this.bind('showScreen',function(){_this.screenOpen=true;_this.keepOnScreen=false;_this.forceOnScreen=false;_this.hide();});this.bind('onHideSideBar',function(){_this.forceOnScreen=false;});this.bind('onShowSideBar',function(){_this.forceOnScreen=true;});}},onConfigChange:function(property,value){switch(property){case'visible':if(value){this.getComponent().show();}else{this.getComponent().hide();}break;}},show:function(){if(this.embedPlayer.isMobileSkin()&&this.getPlayer().getPlayerPoster().length&&this.embedPlayer.getInterface().hasClass("start-state")){return;}if(!this.screenOpen){this.getComponent().addClass('open');this.getPlayer().triggerHelper('onShowToplBar',{'top':this.getComponent().height()+15});}},hide:function(){if(this.keepOnScreen||this.forceOnScreen)return;this.getComponent().removeClass('open');this.getPlayer().triggerHelper('onHideTopBar',{'top':15});},getComponent:function(){if(!this.$el){this.$el=$('<div />').addClass('topBarContainer');if(this.getConfig('hover')){this.$el.addClass('hover');}else{this.$el.addClass('block');}}return this.$el;},destroy:function(){this._super();this.getComponent().remove();}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("utf8_encode",function($){window['utf8_encode']=function(argString){if(argString===null||typeof argString==="undefined"){return"";}var string=(argString+'');var utftext="",start,end,stringl=0;start=end=0;stringl=string.length;for(var n=0;n<stringl;n++){var c1=string.charCodeAt(n);var enc=null;if(c1<128){end++;}else if(c1>127&&c1<2048){enc=String.fromCharCode((c1>>6)|192)+String.fromCharCode((c1&63)|128);}else{enc=String.fromCharCode((c1>>12)|224)+String.fromCharCode(((c1>>6)&63)|128)+String.fromCharCode((c1&63)|128);}if(enc!==null){if(end>start){utftext+=string.slice(start,end);}utftext+=enc;start=end=n+1;}}if(end>start){utftext+=string.slice(start,stringl);}return utftext;};},{},{});mw.loader.implement("volumeControl",function($){(function(mw,$){"use strict";mw.PluginManager.add('volumeControl',mw.KBaseComponent.extend({defaultConfig:{parent:"controlsContainer",order:11,layout:"horizontal",showTooltip:true,displayImportance:"medium",accessibleVolumeChange:0.1,showSlider:true,pinVolumeBar:false,useCookie:true,uniquePlayerCookie:false},icons:{'mute':'icon-volume-mute','low':'icon-volume-low','high':'icon-volume-high'},setup:function(embedPlayer){this.addBindings();var _this=this;this.cookieName=_this.getConfig('uniquePlayerCookie')?this.pluginName+'_volumeValue_'+this.embedPlayer.kuiconfid:this.pluginName+'_volumeValue';this.bind('playerReady ',function(){if((_this.getConfig('useCookie')&&$.cookie(_this.cookieName))){var volumeValue=parseInt($.cookie(_this.cookieName));if(!isNaN(volumeValue)&&volumeValue>=0&&volumeValue<=100){if(volumeValue===0){_this.getPlayer().preMuteVolume=1;_this.getPlayer().muted=true;_this.updateFirstMute=true;}_this.firstUpdate=true;_this.getPlayer().setVolume(volumeValue/100,true);}}});},saveVolume:function(){if(this.firstUpdate){this.firstUpdate=false;return;}if(this.getConfig('useCookie')){this.getPlayer().setCookie(this.cookieName,this.getPlayer().getPlayerElementVolume()*100,{path:'/'});}},isSafeEnviornment:function(){return!mw.isMobileDevice();},getSliderConfig:function(){var _this=this;return{orientation:this.getConfig("layout"),range:"min",value:(this.getPlayer().getPlayerElementVolume()*100),min:0,max:100,slide:function(event,ui){_this.getPlayer().setVolume((ui.value/100),true);_this.updateTooltipAndAccessibility(ui.value);},change:function(event,ui){_this.getPlayer().setVolume((ui.value/100),true);_this.updateTooltipAndAccessibility(ui.value);},start:function(event,ui){_this.getPlayer().preMuteVolume=(ui.value/100);}};},updateTooltipAndAccessibility:function(value){if(this.getPlayer().isMuted()||value===0){this.updateTooltip(gM('mwe-embedplayer-volume-unmute'));this.setAccessibility(this.getBtn(),gM('mwe-embedplayer-volume-unmute'));}else{this.updateTooltip(gM('mwe-embedplayer-volume-mute'));this.setAccessibility(this.getBtn(),gM('mwe-embedplayer-volume-mute'));}},addBindings:function(){var _this=this;var mouseOverSlider=false;if(this.getConfig('showSlider')){var openSlider=function(){_this.getComponent().removeClass('noTransition');_this.getComponent().addClass('open');if(_this.getConfig('layout')==="vertical"){_this.getPlayer().triggerHelper("onShowSideBar");}};var closeSlider=function(){if(_this.getConfig('layout')==="horizontal"&&!_this.getConfig('pinVolumeBar')){_this.getComponent().removeClass('open');}if(_this.getConfig('layout')==="vertical"){setTimeout(function(){if(!mouseOverSlider){_this.getComponent().removeClass('open');_this.getPlayer().triggerHelper("onHideSideBar");}},350);}};this.bind('layoutBuildDone',function(){if(_this.getConfig('layout')==="horizontal"){openSlider();_this.getComponent().addClass('noTransition');setTimeout(function(){_this.getComponent().data('width',_this.getComponent().width());closeSlider();},100);}});}this.getBtn().click(function(){_this.getPlayer().toggleMute();_this.updateTooltipAndAccessibility();if(_this.updateFirstMute){_this.updateFirstMute=false;_this.updateVolumeUI(1);}_this.saveVolume();});this.getBtn().focusin(openSlider);this.getBtn().focusout(closeSlider);this.getComponent().hover(openSlider,closeSlider);this.getSliderContainer().hover(function(){mouseOverSlider=true},function(){mouseOverSlider=false});this.bind('volumeChanged',function(e,percent){_this.updateVolumeUI(percent);_this.saveVolume();});this.getSlider().slider(this.getSliderConfig());if(this.getConfig('accessibilityLabels')){var percent=this.getPlayer().getPlayerElementVolume()*100;var title=gM('mwe-embedplayer-volume-value',percent);var $slider=this.getSlider().find('a');this.setAccessibility($slider,title);$slider.attr("role","paragraph");}},updateVolumeUI:function(percent){var iconClasses='',newClass='';$.each(this.icons,function(){iconClasses+=this+' ';});if(percent==0){newClass=this.icons['mute'];}else if(percent<=0.50){newClass=this.icons['low'];}else if(percent<=1){newClass=this.icons['high'];}this.getBtn().removeClass(iconClasses).addClass(newClass);var decPercent=percent*100;this.getSlider().slider('value',decPercent);if(this.getConfig('accessibilityLabels')){var title=gM('mwe-embedplayer-volume-value',decPercent);this.getSlider().attr({'role':'slider','aria-valuetext':title,'aria-valuenow':decPercent});}},getComponent:function(){if(!this.$el){var layoutClass=' '+this.getConfig('layout');var $btn=$('<button />').addClass("btn "+this.icons['high']).attr({'title':gM('mwe-embedplayer-volume-mute'),'id':'muteBtn'});this.setAccessibility($btn,gM('mwe-embedplayer-volume-mute'));var $sliderContainer=$('<div />').addClass('sliderContainer');if(this.getConfig("layout")=="vertical"){$sliderContainer.append($('<div />').addClass('arrow'));$sliderContainer.append($('<div />').addClass('slider'));}else{$sliderContainer=$('<div />').addClass('slider');}$sliderContainer.attr('tabindex',3);this.$el=$('<div />').addClass(this.getCssClass()+layoutClass).append($btn,$sliderContainer);}return this.$el;},getBtn:function(){return this.getComponent().find('#muteBtn');},getSlider:function(){return this.getComponent().find('.slider');},getSliderContainer:function(id){return this.getComponent().find('.sliderContainer');}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("jquery.client",function($){(function($){var profileCache={};$.client={profile:function(nav){if(nav===undefined){nav=window.navigator;}if(profileCache[nav.userAgent]===undefined){var uk='unknown';var x='x';var wildUserAgents=['Opera','Navigator','Minefield','KHTML','Chrome','PLAYSTATION 3'];var userAgentTranslations=[[/(Firefox|MSIE|KHTML,\slike\sGecko|Konqueror)/,''],['Chrome Safari','Chrome'],['KHTML','Konqueror'],['Minefield','Firefox'],['Navigator','Netscape'],['PLAYSTATION 3','PS3']];var versionPrefixes=['camino','chrome','firefox','netscape','netscape6','opera','version','konqueror','lynx','msie','safari','ps3'];var versionSuffix='(\\/|\\;?\\s|)([a-z0-9\\.\\+]*?)(\\;|dev|rel|\\)|\\s|$)';var names=['camino','chrome','firefox','netscape','konqueror','lynx','msie','opera','safari','ipod','iphone','blackberry','ps3'];var nameTranslations=[];var layouts=['gecko','konqueror','msie','opera','webkit'];var layoutTranslations=[['konqueror','khtml'],['msie','trident'],['opera','presto']];var layoutVersions=['applewebkit','gecko'];var platforms=['win','mac','linux','sunos','solaris','iphone'];var platformTranslations=[['sunos','solaris']];var translate=function(source,translations){for(var i=0;i<translations.length;i++){source=source.replace(translations[i][0],translations[i][1]);}return source;};var ua=nav.userAgent,match,name=uk,layout=uk,layoutversion=uk,platform=uk,version=x;if(match=new RegExp('('+wildUserAgents.join('|')+')').exec(ua)){ua=translate(ua,userAgentTranslations);}ua=ua.toLowerCase();if(match=new RegExp('('+names.join('|')+')').exec(ua)){name=translate(match[1],nameTranslations);}if(match=new RegExp('('+layouts.join('|')+')').exec(ua)){layout=translate(match[1],layoutTranslations);}if(match=new RegExp('('+layoutVersions.join('|')+')\\\/(\\d+)').exec(ua)){layoutversion=parseInt(match[2],10);}if(match=new RegExp('('+platforms.join('|')+')').exec(nav.platform.toLowerCase())){platform=translate(match[1],platformTranslations);}if(match=new RegExp('('+versionPrefixes.join('|')+')'+versionSuffix).exec(ua)){version=match[3];}if(name.match(/safari/)&&version>400){version='2.0';}if(name==='opera'&&version>=9.8){version=ua.match(/version\/([0-9\.]*)/i)[1]||10;}var versionNumber=parseFloat(version,10)||0.0;profileCache[nav.userAgent]={'name':name,'layout':layout,'layoutVersion':layoutversion,'platform':platform,'version':version,'versionBase':(version!==x?Math.floor(versionNumber).toString():x),'versionNumber':versionNumber};}return profileCache[nav.userAgent];},test:function(map,profile){profile=$.isPlainObject(profile)?profile:$.client.profile();var dir=$('body').is('.rtl')?'rtl':'ltr';if(typeof map[dir]!=='object'||typeof map[dir][profile.name]==='undefined'){return true;}var conditions=map[dir][profile.name];for(var i=0;i<conditions.length;i++){var op=conditions[i][0];var val=conditions[i][1];if(val===false){return false;}else if(typeof val=='string'){if(!(eval('profile.version'+op+'"'+val+'"'))){return false;}}else if(typeof val=='number'){if(!(eval('profile.versionNumber'+op+val))){return false;}}}return true;}};})(jQuery);;},{},{});mw.loader.implement("jquery.color",function($){(function(jQuery,undefined){var stepHooks="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",rplusequals=/^([\-+])=\s*(\d+\.?\d*)/,stringParsers=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[execResult[1],execResult[2],execResult[3],execResult[4]];}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[execResult[1]*2.55,execResult[2]*2.55,execResult[3]*2.55,execResult[4]];}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(execResult){return[parseInt(execResult[1],16),parseInt(execResult[2],16),parseInt(execResult[3],16)];}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(execResult){return[parseInt(execResult[1]+execResult[1],16),parseInt(execResult[2]+execResult[2],16),parseInt(execResult[3]+execResult[3],16)];}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(execResult){return[execResult[1],execResult[2]/100,execResult[3]/100,execResult[4]];}}],color=jQuery.Color=function(color,green,blue,alpha){return new jQuery.Color.fn.parse(color,green,blue,alpha);},spaces={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},propTypes={"byte":{floor:true,max:255},"percent":{max:1},"degrees":{mod:360,floor:true}},support=color.support={},supportElem=jQuery("<p>")[0],colors,each=jQuery.each;supportElem.style.cssText="background-color:rgba(1,1,1,.5)";support.rgba=supportElem.style.backgroundColor.indexOf("rgba")>-1;each(spaces,function(spaceName,space){space.cache="_"+spaceName;space.props.alpha={idx:3,type:"percent",def:1};});function clamp(value,prop,allowEmpty){var type=propTypes[prop.type]||{};if(value==null){return(allowEmpty||!prop.def)?null:prop.def;}value=type.floor?~~value:parseFloat(value);if(isNaN(value)){return prop.def;}if(type.mod){return(value+type.mod)%type.mod;}return 0>value?0:type.max<value?type.max:value;}function stringParse(string){var inst=color(),rgba=inst._rgba=[];string=string.toLowerCase();each(stringParsers,function(i,parser){var parsed,match=parser.re.exec(string),values=match&&parser.parse(match),spaceName=parser.space||"rgba";if(values){parsed=inst[spaceName](values);inst[spaces[spaceName].cache]=parsed[spaces[spaceName].cache];rgba=inst._rgba=parsed._rgba;return false;}});if(rgba.length){if(rgba.join()==="0,0,0,0"){jQuery.extend(rgba,colors.transparent);}return inst;}return colors[string];}color.fn=jQuery.extend(color.prototype,{parse:function(red,green,blue,alpha){if(red===undefined){this._rgba=[null,null,null,null];return this;}if(red.jquery||red.nodeType){red=jQuery(red).css(green);green=undefined;}var inst=this,type=jQuery.type(red),rgba=this._rgba=[];if(green!==undefined){red=[red,green,blue,alpha];type="array";}if(type==="string"){return this.parse(stringParse(red)||colors._default);}if(type==="array"){each(spaces.rgba.props,function(key,prop){rgba[prop.idx]=clamp(red[prop.idx],prop);});return this;}if(type==="object"){if(red instanceof color){each(spaces,function(spaceName,space){if(red[space.cache]){inst[space.cache]=red[space.cache].slice();}});}else{each(spaces,function(spaceName,space){var cache=space.cache;each(space.props,function(key,prop){if(!inst[cache]&&space.to){if(key==="alpha"||red[key]==null){return;}inst[cache]=space.to(inst._rgba);}inst[cache][prop.idx]=clamp(red[key],prop,true);});if(inst[cache]&&jQuery.inArray(null,inst[cache].slice(0,3))<0){inst[cache][3]=1;if(space.from){inst._rgba=space.from(inst[cache]);}}});}return this;}},is:function(compare){var is=color(compare),same=true,inst=this;each(spaces,function(_,space){var localCache,isCache=is[space.cache];if(isCache){localCache=inst[space.cache]||space.to&&space.to(inst._rgba)||[];each(space.props,function(_,prop){if(isCache[prop.idx]!=null){same=(isCache[prop.idx]===localCache[prop.idx]);return same;}});}return same;});return same;},_space:function(){var used=[],inst=this;each(spaces,function(spaceName,space){if(inst[space.cache]){used.push(spaceName);}});return used.pop();},transition:function(other,distance){var end=color(other),spaceName=end._space(),space=spaces[spaceName],startColor=this.alpha()===0?color("transparent"):this,start=startColor[space.cache]||space.to(startColor._rgba),result=start.slice();end=end[space.cache];each(space.props,function(key,prop){var index=prop.idx,startValue=start[index],endValue=end[index],type=propTypes[prop.type]||{};if(endValue===null){return;}if(startValue===null){result[index]=endValue;}else{if(type.mod){if(endValue-startValue>type.mod/2){startValue+=type.mod;}else if(startValue-endValue>type.mod/2){startValue-=type.mod;}}result[index]=clamp((endValue-startValue)*distance+startValue,prop);}});return this[spaceName](result);},blend:function(opaque){if(this._rgba[3]===1){return this;}var rgb=this._rgba.slice(),a=rgb.pop(),blend=color(opaque)._rgba;return color(jQuery.map(rgb,function(v,i){return(1-a)*blend[i]+a*v;}));},toRgbaString:function(){var prefix="rgba(",rgba=jQuery.map(this._rgba,function(v,i){return v==null?(i>2?1:0):v;});if(rgba[3]===1){rgba.pop();prefix="rgb(";}return prefix+rgba.join()+")";},toHslaString:function(){var prefix="hsla(",hsla=jQuery.map(this.hsla(),function(v,i){if(v==null){v=i>2?1:0;}if(i&&i<3){v=Math.round(v*100)+"%";}return v;});if(hsla[3]===1){hsla.pop();prefix="hsl(";}return prefix+hsla.join()+")";},toHexString:function(includeAlpha){var rgba=this._rgba.slice(),alpha=rgba.pop();if(includeAlpha){rgba.push(~~(alpha*255));}return"#"+jQuery.map(rgba,function(v){v=(v||0).toString(16);return v.length===1?"0"+v:v;}).join("");},toString:function(){return this._rgba[3]===0?"transparent":this.toRgbaString();}});color.fn.parse.prototype=color.fn;function hue2rgb(p,q,h){h=(h+1)%1;if(h*6<1){return p+(q-p)*h*6;}if(h*2<1){return q;}if(h*3<2){return p+(q-p)*((2/3)-h)*6;}return p;}spaces.hsla.to=function(rgba){if(rgba[0]==null||rgba[1]==null||rgba[2]==null){return[null,null,null,rgba[3]];}var r=rgba[0]/255,g=rgba[1]/255,b=rgba[2]/255,a=rgba[3],max=Math.max(r,g,b),min=Math.min(r,g,b),diff=max-min,add=max+min,l=add*0.5,h,s;if(min===max){h=0;}else if(r===max){h=(60*(g-b)/diff)+360;}else if(g===max){h=(60*(b-r)/diff)+120;}else{h=(60*(r-g)/diff)+240;}if(diff===0){s=0;}else if(l<=0.5){s=diff/add;}else{s=diff/(2-add);}return[Math.round(h)%360,s,l,a==null?1:a];};spaces.hsla.from=function(hsla){if(hsla[0]==null||hsla[1]==null||hsla[2]==null){return[null,null,null,hsla[3]];}var h=hsla[0]/360,s=hsla[1],l=hsla[2],a=hsla[3],q=l<=0.5?l*(1+s):l+s-l*s,p=2*l-q;return[Math.round(hue2rgb(p,q,h+(1/3))*255),Math.round(hue2rgb(p,q,h)*255),Math.round(hue2rgb(p,q,h-(1/3))*255),a];};each(spaces,function(spaceName,space){var props=space.props,cache=space.cache,to=space.to,from=space.from;color.fn[spaceName]=function(value){if(to&&!this[cache]){this[cache]=to(this._rgba);}if(value===undefined){return this[cache].slice();}var ret,type=jQuery.type(value),arr=(type==="array"||type==="object")?value:arguments,local=this[cache].slice();each(props,function(key,prop){var val=arr[type==="object"?key:prop.idx];if(val==null){val=local[prop.idx];}local[prop.idx]=clamp(val,prop);});if(from){ret=color(from(local));ret[cache]=local;return ret;}else{return color(local);}};each(props,function(key,prop){if(color.fn[key]){return;}color.fn[key]=function(value){var vtype=jQuery.type(value),fn=(key==="alpha"?(this._hsla?"hsla":"rgba"):spaceName),local=this[fn](),cur=local[prop.idx],match;if(vtype==="undefined"){return cur;}if(vtype==="function"){value=value.call(this,cur);vtype=jQuery.type(value);}if(value==null&&prop.empty){return this;}if(vtype==="string"){match=rplusequals.exec(value);if(match){value=cur+parseFloat(match[2])*(match[1]==="+"?1:-1);}}local[prop.idx]=value;return this[fn](local);};});});color.hook=function(hook){var hooks=hook.split(" ");each(hooks,function(i,hook){jQuery.cssHooks[hook]={set:function(elem,value){var parsed,curElem,backgroundColor="";if(value!=="transparent"&&(jQuery.type(value)!=="string"||(parsed=stringParse(value)))){value=color(parsed||value);if(!support.rgba&&value._rgba[3]!==1){curElem=hook==="backgroundColor"?elem.parentNode:elem;while((backgroundColor===""||backgroundColor==="transparent")&&curElem&&curElem.style){try{backgroundColor=jQuery.css(curElem,"backgroundColor");curElem=curElem.parentNode;}catch(e){}}value=value.blend(backgroundColor&&backgroundColor!=="transparent"?backgroundColor:"_default");}value=value.toRgbaString();}try{elem.style[hook]=value;}catch(e){}}};jQuery.fx.step[hook]=function(fx){if(!fx.colorInit){fx.start=color(fx.elem,hook);fx.end=color(fx.end);fx.colorInit=true;}jQuery.cssHooks[hook].set(fx.elem,fx.start.transition(fx.end,fx.pos));};});};color.hook(stepHooks);jQuery.cssHooks.borderColor={expand:function(value){var expanded={};each(["Top","Right","Bottom","Left"],function(i,part){expanded["border"+part+"Color"]=value;});return expanded;}};colors=jQuery.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"};}(jQuery));;},{},{});mw.loader.implement("jquery.cookie",function($){jQuery.cookie=function(name,value,options){if(typeof value!='undefined'){options=options||{};if(value===null){value='';options.expires=-1;}var expires='';if(options.expires&&(typeof options.expires=='number'||options.expires.toUTCString)){var date;if(typeof options.expires=='number'){date=new Date();date.setTime(date.getTime()+(options.expires*24*60*60*1000));}else{date=options.expires;}expires='; expires='+date.toUTCString();}var path=options.path?'; path='+(options.path):'';var domain=options.domain?'; domain='+(options.domain):'';var secure=options.secure?'; secure':'';document.cookie=[name,'=',encodeURIComponent(value),expires,path,domain,secure].join('');}else{var cookieValue=null;if(document.cookie&&document.cookie!=''){var cookies=document.cookie.split(';');for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==(name+'=')){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break;}}}return cookieValue;}};;},{},{});mw.loader.implement("jquery.debouncedresize",function($){(function($){var $event=$.event,$special,resizeTimeout;$special=$event.special.debouncedresize={setup:function(){$(this).on("resize",$special.handler);},teardown:function(){$(this).off("resize",$special.handler);},handler:function(event,execAsap){var context=this,args=arguments,dispatch=function(){event.type="debouncedresize";$event.dispatch.apply(context,args);};if(resizeTimeout){clearTimeout(resizeTimeout);}execAsap?dispatch():resizeTimeout=setTimeout(dispatch,$special.threshold);},threshold:150};})(jQuery);;},{},{});mw.loader.implement("jquery.hoverIntent",function($){(function($){$.fn.hoverIntent=function(f,g){var cfg={sensitivity:7,interval:100,timeout:0};cfg=$.extend(cfg,g?{over:f,out:g}:f);var cX,cY,pX,pY;var track=function(ev){cX=ev.pageX;cY=ev.pageY;};var compare=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);if((Math.abs(pX-cX)+Math.abs(pY-cY))<cfg.sensitivity){$(ob).unbind("mousemove",track);ob.hoverIntent_s=1;return cfg.over.apply(ob,[ev]);}else{pX=cX;pY=cY;ob.hoverIntent_t=setTimeout(function(){compare(ev,ob);},cfg.interval);}};var delay=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);ob.hoverIntent_s=0;return cfg.out.apply(ob,[ev]);};var handleHover=function(e){var p=(e.type=="mouseover"?e.fromElement:e.toElement)||e.relatedTarget;while(p&&p!=this){try{p=p.parentNode;}catch(e){p=this;}}if(p==this){return false;}var ev=$.extend({},e);var ob=this;if(ob.hoverIntent_t){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);}if(e.type=="mouseover"){pX=ev.pageX;pY=ev.pageY;$(ob).bind("mousemove",track);if(ob.hoverIntent_s!=1){ob.hoverIntent_t=setTimeout(function(){compare(ev,ob);},cfg.interval);}}else{$(ob).unbind("mousemove",track);if(ob.hoverIntent_s==1){ob.hoverIntent_t=setTimeout(function(){delay(ev,ob);},cfg.timeout);}}};return this.mouseover(handleHover).mouseout(handleHover);};})(jQuery);;},{},{});mw.loader.implement("jquery.messageBox",function($){(function($){$.messageBoxNew=function(options){options=$.extend({id:'js-messagebox',parent:'body',insert:'prepend'},options);var $curBox=$('#'+options.id);if($curBox.length>0){if($curBox.hasClass('js-messagebox')){return $curBox;}else{return $curBox.addClass('js-messagebox');}}else{var $newBox=$('<div>',{'id':options.id,'class':'js-messagebox','css':{'display':'none'}});if($(options.parent).length<1){options.parent='body';}if(options.insert==='append'){$newBox.appendTo(options.parent);return $newBox;}else{$newBox.prependTo(options.parent);return $newBox;}}};$.messageBox=function(options){options=$.extend({message:'',group:'default',replace:false,target:'js-messagebox'},options);var $target=$.messageBoxNew({id:options.target});var groupID=options.target+'-'+options.group;var $group=$('#'+groupID);if($group.length<1){$group=$('<div>',{'id':groupID,'class':'js-messagebox-group'});$target.prepend($group);}if(options.replace===true){$group.empty();}if(options.message===''||options.message===null){$group.hide();}else{$group.prepend($('<p>').append(options.message)).show();$target.slideDown();}if($target.find('> *:visible').length===0){$group.show();$target.slideUp();$group.hide();}else{$target.slideDown();}return $group;};}(jQuery));;},{"all":".js-messagebox{margin:1em 5%;padding:0.5em 2.5%;border:1px solid #ccc;background-color:#fcfcfc;font-size:0.8em}.js-messagebox .js-messagebox-group{margin:1px;padding:0.5em 2.5%;border-bottom:1px solid #ddd}.js-messagebox .js-messagebox-group:last-child{border-bottom:thin none transparent}\n\n/* cache key: resourceloader:filter:minify-css:7:2bb917065f5e11cbbe44ba45500bbed5 */\n"},{});mw.loader.implement("jquery.mwEmbedUtil",function($){(function($){var _oldUnique=$.unique;$.unique=function(arr){if(arr.length&&!!arr[0].nodeType){return _oldUnique.apply(this,arguments);}else{return $.grep(arr,function(v,k){return $.inArray(v,arr)===k;});}};$.btnHtml=function(msg,styleClass,iconId,opt){if(!opt)opt={};var href=(opt.href)?opt.href:'#';var target_attr=(opt.target)?' target="'+opt.target+'" ':'';var style_attr=(opt.style)?' style="'+opt.style+'" ':'';return'<a href="'+href+'" '+target_attr+style_attr+' class="ui-state-default ui-corner-all ui-icon_link '+styleClass+'"><span class="ui-icon ui-icon-'+iconId+'" ></span>'+'<span class="btnText">'+msg+'</span></a>';};var mw_default_button_options={'class':'','style':{},'text':'','icon':'carat-1-n'};$.button=function(options){var options=$j.extend({},mw_default_button_options,options);var $button=$('<a />').attr('href','#').addClass('ui-state-default ui-corner-all ui-icon_link');if(options.css){$button.css(options.css);}if(options['class']){$button.addClass(options['class']);}$button.append($('<span />').addClass('ui-icon ui-icon-'+options.icon),$('<span />').addClass('btnText').text(options.text)).buttonHover();if(!options.text){$button.css('padding','1em');}return $button;};$.fn.buttonHover=function(){$(this).hover(function(){$(this).addClass('ui-state-hover');},function(){$(this).removeClass('ui-state-hover');});return this;};})(jQuery);;},{},{});mw.loader.implement("jquery.mwExtension",function($){(function($){$.extend({trimLeft:function(str){return str===null?'':str.toString().replace(/^\s+/,'');},trimRight:function(str){return str===null?'':str.toString().replace(/\s+$/,'');},ucFirst:function(str){return str.charAt(0).toUpperCase()+str.substr(1);},escapeRE:function(str){return str.replace(/([\\{}()|.?*+\-^$\[\]])/g,"\\$1");},isDomElement:function(el){return!!el&&!!el.nodeType;},isEmpty:function(v){if(v===''||v===0||v==='0'||v===null||v===false||v===undefined){return true;}if(v.length===0){return true;}if(typeof v==='object'){for(var key in v){return false;}return true;}return false;},compareArray:function(arrThis,arrAgainst){if(arrThis.length!=arrAgainst.length){return false;}for(var i=0;i<arrThis.length;i++){if($.isArray(arrThis[i])){if(!$.compareArray(arrThis[i],arrAgainst[i])){return false;}}else if(arrThis[i]!==arrAgainst[i]){return false;}}return true;},compareObject:function(objectA,objectB){if(typeof objectA==typeof objectB){if(typeof objectA=='object'){if(objectA===objectB){return true;}else{var prop;for(prop in objectA){if(prop in objectB){var type=typeof objectA[prop];if(type==typeof objectB[prop]){switch(type){case'object':if(!$.compareObject(objectA[prop],objectB[prop])){return false;}break;case'function':if(objectA[prop].toString()!==objectB[prop].toString()){return false;}break;default:if(objectA[prop]!==objectB[prop]){return false;}break;}}else{return false;}}else{return false;}}for(prop in objectB){if(!(prop in objectA)){return false;}}}}}else{return false;}return true;}});})(jQuery);;},{},{});mw.loader.implement("jquery.naturalSize",function($){(function($){var props=['Width','Height'],prop;while(prop=props.pop()){(function(natural,prop){$.fn[natural]=(natural in new Image())?function(){return this[0][natural];}:function(){var node=this[0],img,value;if(node.tagName.toLowerCase()==='img'){img=new Image();img.src=node.src,value=img[prop];}return value;};}('natural'+prop,prop.toLowerCase()));}}(jQuery));;},{},{});mw.loader.implement("jquery.ui.core",function($){(function($,undefined){var uuid=0,runiqueId=/^ui-id-\d+$/;$.ui=$.ui||{};$.extend($.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}});$.fn.extend({focus:(function(orig){return function(delay,fn){return typeof delay==="number"?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus();if(fn){fn.call(elem);}},delay);}):orig.apply(this,arguments);};})($.fn.focus),scrollParent:function(){var scrollParent;if(($.ui.ie&&(/(static|relative)/).test(this.css("position")))||(/absolute/).test(this.css("position"))){scrollParent=this.parents().filter(function(){return(/(relative|absolute|fixed)/).test($.css(this,"position"))&&(/(auto|scroll)/).test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"));}).eq(0);}else{scrollParent=this.parents().filter(function(){return(/(auto|scroll)/).test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"));}).eq(0);}return(/fixed/).test(this.css("position"))||!scrollParent.length?$(document):scrollParent;},zIndex:function(zIndex){if(zIndex!==undefined){return this.css("zIndex",zIndex);}if(this.length){var elem=$(this[0]),position,value;while(elem.length&&elem[0]!==document){position=elem.css("position");if(position==="absolute"||position==="relative"||position==="fixed"){value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&value!==0){return value;}}elem=elem.parent();}}return 0;},uniqueId:function(){return this.each(function(){if(!this.id){this.id="ui-id-"+(++uuid);}});},removeUniqueId:function(){return this.each(function(){if(runiqueId.test(this.id)){$(this).removeAttr("id");}});}});function focusable(element,isTabIndexNotNaN){var map,mapName,img,nodeName=element.nodeName.toLowerCase();if("area"===nodeName){map=element.parentNode;mapName=map.name;if(!element.href||!mapName||map.nodeName.toLowerCase()!=="map"){return false;}img=$("img[usemap=#"+mapName+"]")[0];return!!img&&visible(img);}return(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element);}function visible(element){return $.expr.filters.visible(element)&&!$(element).parents().addBack().filter(function(){return $.css(this,"visibility")==="hidden";}).length;}$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName);};}):function(elem,i,match){return!!$.data(elem,match[3]);},focusable:function(element){return focusable(element,!isNaN($.attr(element,"tabindex")));},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN);}});if(!$("<a>").outerWidth(1).jquery){$.each(["Width","Height"],function(i,name){var side=name==="Width"?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};function reduce(elem,size,border,margin){$.each(side,function(){size-=parseFloat($.css(elem,"padding"+this))||0;if(border){size-=parseFloat($.css(elem,"border"+this+"Width"))||0;}if(margin){size-=parseFloat($.css(elem,"margin"+this))||0;}});return size;}$.fn["inner"+name]=function(size){if(size===undefined){return orig["inner"+name].call(this);}return this.each(function(){$(this).css(type,reduce(this,size)+"px");});};$.fn["outer"+name]=function(size,margin){if(typeof size!=="number"){return orig["outer"+name].call(this,size);}return this.each(function(){$(this).css(type,reduce(this,size,true,margin)+"px");});};});}if(!$.fn.addBack){$.fn.addBack=function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector));};}if($("<a>").data("a-b","a").removeData("a-b").data("a-b")){$.fn.removeData=(function(removeData){return function(key){if(arguments.length){return removeData.call(this,$.camelCase(key));}else{return removeData.call(this);}};})($.fn.removeData);}$.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());$.support.selectstart="onselectstart"in document.createElement("div");$.fn.extend({disableSelection:function(){return this.bind(($.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(event){event.preventDefault();});},enableSelection:function(){return this.unbind(".ui-disableSelection");}});$.extend($.ui,{plugin:{add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set){proto.plugins[i]=proto.plugins[i]||[];proto.plugins[i].push([option,set[i]]);}},call:function(instance,name,args){var i,set=instance.plugins[name];if(!set||!instance.element[0].parentNode||instance.element[0].parentNode.nodeType===11){return;}for(i=0;i<set.length;i++){if(instance.options[set[i][0]]){set[i][1].apply(instance.element,args);}}}},hasScroll:function(el,a){if($(el).css("overflow")==="hidden"){return false;}var scroll=(a&&a==="left")?"scrollLeft":"scrollTop",has=false;if(el[scroll]>0){return true;}el[scroll]=1;has=(el[scroll]>0);el[scroll]=0;return has;}});})(jQuery);;},{"all":".ui-helper-hidden{display:none}.ui-helper-hidden-accessible{position:absolute;left:-99999999px}.ui-helper-reset{margin:0;padding:0;border:0;outline:0;line-height:1.3;text-decoration:none;font-size:100%;list-style:none}.ui-helper-clearfix:after{content:\".\";display:block;height:0;clear:both;visibility:hidden}.ui-helper-clearfix{display:inline-block} * html .ui-helper-clearfix{height:1%}.ui-helper-clearfix{display:block} .ui-helper-zfix{width:100%;height:100%;top:0;left:0;position:absolute;opacity:0;filter:Alpha(Opacity=0)} .ui-state-disabled{cursor:default !important}  .ui-icon{display:block;text-indent:-99999px;overflow:hidden;background-repeat:no-repeat}  .ui-widget-overlay{position:absolute;top:0;left:0;width:100%;height:100%}\n\n/* cache key: resourceloader:filter:minify-css:7:b80b11161e9a8e2d415a43fd6f09d170 */\n"},{});mw.loader.implement("jquery.ui.mouse",function($){(function($,undefined){var mouseHandled=false;$(document).mouseup(function(){mouseHandled=false;});$.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var that=this;this.element.bind("mousedown."+this.widgetName,function(event){return that._mouseDown(event);}).bind("click."+this.widgetName,function(event){if(true===$.data(event.target,that.widgetName+".preventClickEvent")){$.removeData(event.target,that.widgetName+".preventClickEvent");event.stopImmediatePropagation();return false;}});this.started=false;},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);if(this._mouseMoveDelegate){$(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);}},_mouseDown:function(event){if(mouseHandled){return;}(this._mouseStarted&&this._mouseUp(event));this._mouseDownEvent=event;var that=this,btnIsLeft=(event.which===1),elIsCancel=(typeof this.options.cancel==="string"&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:false);if(!btnIsLeft||elIsCancel||!this._mouseCapture(event)){return true;}this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=true;},this.options.delay);}if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(event)!==false);if(!this._mouseStarted){event.preventDefault();return true;}}if(true===$.data(event.target,this.widgetName+".preventClickEvent")){$.removeData(event.target,this.widgetName+".preventClickEvent");}this._mouseMoveDelegate=function(event){return that._mouseMove(event);};this._mouseUpDelegate=function(event){return that._mouseUp(event);};$(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);event.preventDefault();mouseHandled=true;return true;},_mouseMove:function(event){if($.ui.ie&&(!document.documentMode||document.documentMode<9)&&!event.button){return this._mouseUp(event);}if(this._mouseStarted){this._mouseDrag(event);return event.preventDefault();}if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(this._mouseDownEvent,event)!==false);(this._mouseStarted?this._mouseDrag(event):this._mouseUp(event));}return!this._mouseStarted;},_mouseUp:function(event){$(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(event.target===this._mouseDownEvent.target){$.data(event.target,this.widgetName+".preventClickEvent",true);}this._mouseStop(event);}return false;},_mouseDistanceMet:function(event){return(Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance);},_mouseDelayMet:function(){return this.mouseDelayMet;},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true;}});})(jQuery);;},{},{});mw.loader.implement("jquery.ui.position",function($){(function($,undefined){$.ui=$.ui||{};var cachedScrollbarWidth,max=Math.max,abs=Math.abs,round=Math.round,rhorizontal=/left|center|right/,rvertical=/top|center|bottom/,roffset=/[\+\-]\d+(\.[\d]+)?%?/,rposition=/^\w+/,rpercent=/%$/,_position=$.fn.position;function getOffsets(offsets,width,height){return[parseFloat(offsets[0])*(rpercent.test(offsets[0])?width/100:1),parseFloat(offsets[1])*(rpercent.test(offsets[1])?height/100:1)];}function parseCss(element,property){return parseInt($.css(element,property),10)||0;}function getDimensions(elem){var raw=elem[0];if(raw.nodeType===9){return{width:elem.width(),height:elem.height(),offset:{top:0,left:0}};}if($.isWindow(raw)){return{width:elem.width(),height:elem.height(),offset:{top:elem.scrollTop(),left:elem.scrollLeft()}};}if(raw.preventDefault){return{width:0,height:0,offset:{top:raw.pageY,left:raw.pageX}};}return{width:elem.outerWidth(),height:elem.outerHeight(),offset:elem.offset()};}$.position={scrollbarWidth:function(){if(cachedScrollbarWidth!==undefined){return cachedScrollbarWidth;}var w1,w2,div=$("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),innerDiv=div.children()[0];$("body").append(div);w1=innerDiv.offsetWidth;div.css("overflow","scroll");w2=innerDiv.offsetWidth;if(w1===w2){w2=div[0].clientWidth;}div.remove();return(cachedScrollbarWidth=w1-w2);},getScrollInfo:function(within){var overflowX=within.isWindow||within.isDocument?"":within.element.css("overflow-x"),overflowY=within.isWindow||within.isDocument?"":within.element.css("overflow-y"),hasOverflowX=overflowX==="scroll"||(overflowX==="auto"&&within.width<within.element[0].scrollWidth),hasOverflowY=overflowY==="scroll"||(overflowY==="auto"&&within.height<within.element[0].scrollHeight);return{width:hasOverflowY?$.position.scrollbarWidth():0,height:hasOverflowX?$.position.scrollbarWidth():0};},getWithinInfo:function(element){var withinElement=$(element||window),isWindow=$.isWindow(withinElement[0]),isDocument=!!withinElement[0]&&withinElement[0].nodeType===9;return{element:withinElement,isWindow:isWindow,isDocument:isDocument,offset:withinElement.offset()||{left:0,top:0},scrollLeft:withinElement.scrollLeft(),scrollTop:withinElement.scrollTop(),width:isWindow?withinElement.width():withinElement.outerWidth(),height:isWindow?withinElement.height():withinElement.outerHeight()};}};$.fn.position=function(options){if(!options||!options.of){return _position.apply(this,arguments);}options=$.extend({},options);var atOffset,targetWidth,targetHeight,targetOffset,basePosition,dimensions,target=$(options.of),within=$.position.getWithinInfo(options.within),scrollInfo=$.position.getScrollInfo(within),collision=(options.collision||"flip").split(" "),offsets={};dimensions=getDimensions(target);if(target[0].preventDefault){options.at="left top";}targetWidth=dimensions.width;targetHeight=dimensions.height;targetOffset=dimensions.offset;basePosition=$.extend({},targetOffset);$.each(["my","at"],function(){var pos=(options[this]||"").split(" "),horizontalOffset,verticalOffset;if(pos.length===1){pos=rhorizontal.test(pos[0])?pos.concat(["center"]):rvertical.test(pos[0])?["center"].concat(pos):["center","center"];}pos[0]=rhorizontal.test(pos[0])?pos[0]:"center";pos[1]=rvertical.test(pos[1])?pos[1]:"center";horizontalOffset=roffset.exec(pos[0]);verticalOffset=roffset.exec(pos[1]);offsets[this]=[horizontalOffset?horizontalOffset[0]:0,verticalOffset?verticalOffset[0]:0];options[this]=[rposition.exec(pos[0])[0],rposition.exec(pos[1])[0]];});if(collision.length===1){collision[1]=collision[0];}if(options.at[0]==="right"){basePosition.left+=targetWidth;}else if(options.at[0]==="center"){basePosition.left+=targetWidth/2;}if(options.at[1]==="bottom"){basePosition.top+=targetHeight;}else if(options.at[1]==="center"){basePosition.top+=targetHeight/2;}atOffset=getOffsets(offsets.at,targetWidth,targetHeight);basePosition.left+=atOffset[0];basePosition.top+=atOffset[1];return this.each(function(){var collisionPosition,using,elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseCss(this,"marginLeft"),marginTop=parseCss(this,"marginTop"),collisionWidth=elemWidth+marginLeft+parseCss(this,"marginRight")+scrollInfo.width,collisionHeight=elemHeight+marginTop+parseCss(this,"marginBottom")+scrollInfo.height,position=$.extend({},basePosition),myOffset=getOffsets(offsets.my,elem.outerWidth(),elem.outerHeight());if(options.my[0]==="right"){position.left-=elemWidth;}else if(options.my[0]==="center"){position.left-=elemWidth/2;}if(options.my[1]==="bottom"){position.top-=elemHeight;}else if(options.my[1]==="center"){position.top-=elemHeight/2;}position.left+=myOffset[0];position.top+=myOffset[1];if(!$.support.offsetFractions){position.left=round(position.left);position.top=round(position.top);}collisionPosition={marginLeft:marginLeft,marginTop:marginTop};$.each(["left","top"],function(i,dir){if($.ui.position[collision[i]]){$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:[atOffset[0]+myOffset[0],atOffset[1]+myOffset[1]],my:options.my,at:options.at,within:within,elem:elem});}});if(options.using){using=function(props){var left=targetOffset.left-position.left,right=left+targetWidth-elemWidth,top=targetOffset.top-position.top,bottom=top+targetHeight-elemHeight,feedback={target:{element:target,left:targetOffset.left,top:targetOffset.top,width:targetWidth,height:targetHeight},element:{element:elem,left:position.left,top:position.top,width:elemWidth,height:elemHeight},horizontal:right<0?"left":left>0?"right":"center",vertical:bottom<0?"top":top>0?"bottom":"middle"};if(targetWidth<elemWidth&&abs(left+right)<targetWidth){feedback.horizontal="center";}if(targetHeight<elemHeight&&abs(top+bottom)<targetHeight){feedback.vertical="middle";}if(max(abs(left),abs(right))>max(abs(top),abs(bottom))){feedback.important="horizontal";}else{feedback.important="vertical";}options.using.call(this,props,feedback);};}elem.offset($.extend(position,{using:using}));});};$.ui.position={fit:{left:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollLeft:within.offset.left,outerWidth=within.width,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=withinOffset-collisionPosLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-withinOffset,newOverRight;if(data.collisionWidth>outerWidth){if(overLeft>0&&overRight<=0){newOverRight=position.left+overLeft+data.collisionWidth-outerWidth-withinOffset;position.left+=overLeft-newOverRight;}else if(overRight>0&&overLeft<=0){position.left=withinOffset;}else{if(overLeft>overRight){position.left=withinOffset+outerWidth-data.collisionWidth;}else{position.left=withinOffset;}}}else if(overLeft>0){position.left+=overLeft;}else if(overRight>0){position.left-=overRight;}else{position.left=max(position.left-collisionPosLeft,position.left);}},top:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollTop:within.offset.top,outerHeight=data.within.height,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=withinOffset-collisionPosTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-withinOffset,newOverBottom;if(data.collisionHeight>outerHeight){if(overTop>0&&overBottom<=0){newOverBottom=position.top+overTop+data.collisionHeight-outerHeight-withinOffset;position.top+=overTop-newOverBottom;}else if(overBottom>0&&overTop<=0){position.top=withinOffset;}else{if(overTop>overBottom){position.top=withinOffset+outerHeight-data.collisionHeight;}else{position.top=withinOffset;}}}else if(overTop>0){position.top+=overTop;}else if(overBottom>0){position.top-=overBottom;}else{position.top=max(position.top-collisionPosTop,position.top);}}},flip:{left:function(position,data){var within=data.within,withinOffset=within.offset.left+within.scrollLeft,outerWidth=within.width,offsetLeft=within.isWindow?within.scrollLeft:within.offset.left,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=collisionPosLeft-offsetLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-offsetLeft,myOffset=data.my[0]==="left"?-data.elemWidth:data.my[0]==="right"?data.elemWidth:0,atOffset=data.at[0]==="left"?data.targetWidth:data.at[0]==="right"?-data.targetWidth:0,offset=-2*data.offset[0],newOverRight,newOverLeft;if(overLeft<0){newOverRight=position.left+myOffset+atOffset+offset+data.collisionWidth-outerWidth-withinOffset;if(newOverRight<0||newOverRight<abs(overLeft)){position.left+=myOffset+atOffset+offset;}}else if(overRight>0){newOverLeft=position.left-data.collisionPosition.marginLeft+myOffset+atOffset+offset-offsetLeft;if(newOverLeft>0||abs(newOverLeft)<overRight){position.left+=myOffset+atOffset+offset;}}},top:function(position,data){var within=data.within,withinOffset=within.offset.top+within.scrollTop,outerHeight=within.height,offsetTop=within.isWindow?within.scrollTop:within.offset.top,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=collisionPosTop-offsetTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-offsetTop,top=data.my[1]==="top",myOffset=top?-data.elemHeight:data.my[1]==="bottom"?data.elemHeight:0,atOffset=data.at[1]==="top"?data.targetHeight:data.at[1]==="bottom"?-data.targetHeight:0,offset=-2*data.offset[1],newOverTop,newOverBottom;if(overTop<0){newOverBottom=position.top+myOffset+atOffset+offset+data.collisionHeight-outerHeight-withinOffset;if((position.top+myOffset+atOffset+offset)>overTop&&(newOverBottom<0||newOverBottom<abs(overTop))){position.top+=myOffset+atOffset+offset;}}else if(overBottom>0){newOverTop=position.top-data.collisionPosition.marginTop+myOffset+atOffset+offset-offsetTop;if((position.top+myOffset+atOffset+offset)>overBottom&&(newOverTop>0||abs(newOverTop)<overBottom)){position.top+=myOffset+atOffset+offset;}}}},flipfit:{left:function(){$.ui.position.flip.left.apply(this,arguments);$.ui.position.fit.left.apply(this,arguments);},top:function(){$.ui.position.flip.top.apply(this,arguments);$.ui.position.fit.top.apply(this,arguments);}}};(function(){var testElement,testElementParent,testElementStyle,offsetLeft,i,body=document.getElementsByTagName("body")[0],div=document.createElement("div");testElement=document.createElement(body?"div":"body");testElementStyle={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};if(body){$.extend(testElementStyle,{position:"absolute",left:"-1000px",top:"-1000px"});}for(i in testElementStyle){testElement.style[i]=testElementStyle[i];}testElement.appendChild(div);testElementParent=body||document.documentElement;testElementParent.insertBefore(testElement,testElementParent.firstChild);div.style.cssText="position: absolute; left: 10.7432222px;";offsetLeft=$(div).offset().left;$.support.offsetFractions=offsetLeft>10&&offsetLeft<11;testElement.innerHTML="";testElementParent.removeChild(testElement);})();}(jQuery));;},{},{});mw.loader.implement("jquery.ui.slider",function($){(function($,undefined){var numPages=5;$.widget("ui.slider",$.ui.mouse,{version:"1.10.3",widgetEventPrefix:"slide",options:{animate:false,distance:0,max:100,min:0,orientation:"horizontal",range:false,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=false;this._mouseSliding=false;this._animateOff=true;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider"+" ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all");this._refresh();this._setOption("disabled",this.options.disabled);this._animateOff=false;},_refresh:function(){this._createRange();this._createHandles();this._setupEvents();this._refreshValue();},_createHandles:function(){var i,handleCount,options=this.options,existingHandles=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),handle="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",handles=[];handleCount=(options.values&&options.values.length)||1;if(existingHandles.length>handleCount){existingHandles.slice(handleCount).remove();existingHandles=existingHandles.slice(0,handleCount);}for(i=existingHandles.length;i<handleCount;i++){handles.push(handle);}this.handles=existingHandles.add($(handles.join("")).appendTo(this.element));this.handle=this.handles.eq(0);this.handles.each(function(i){$(this).data("ui-slider-handle-index",i);});},_createRange:function(){var options=this.options,classes="";if(options.range){if(options.range===true){if(!options.values){options.values=[this._valueMin(),this._valueMin()];}else if(options.values.length&&options.values.length!==2){options.values=[options.values[0],options.values[0]];}else if($.isArray(options.values)){options.values=options.values.slice(0);}}if(!this.range||!this.range.length){this.range=$("<div></div>").appendTo(this.element);classes="ui-slider-range"+" ui-widget-header ui-corner-all";}else{this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({"left":"","bottom":""});}this.range.addClass(classes+((options.range==="min"||options.range==="max")?" ui-slider-range-"+options.range:""));}else{this.range=$([]);}},_setupEvents:function(){var elements=this.handles.add(this.range).filter("a");this._off(elements);this._on(elements,this._handleEvents);this._hoverable(elements);this._focusable(elements);},_destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider"+" ui-slider-horizontal"+" ui-slider-vertical"+" ui-widget"+" ui-widget-content"+" ui-corner-all");this._mouseDestroy();},_mouseCapture:function(event){var position,normValue,distance,closestHandle,index,allowed,offset,mouseOverHandle,that=this,o=this.options;if(o.disabled){return false;}this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();position={x:event.pageX,y:event.pageY};normValue=this._normValueFromMouse(position);distance=this._valueMax()-this._valueMin()+1;this.handles.each(function(i){var thisDistance=Math.abs(normValue-that.values(i));if((distance>thisDistance)||(distance===thisDistance&&(i===that._lastChangedValue||that.values(i)===o.min))){distance=thisDistance;closestHandle=$(this);index=i;}});allowed=this._start(event,index);if(allowed===false){return false;}this._mouseSliding=true;this._handleIndex=index;closestHandle.addClass("ui-state-active").focus();offset=closestHandle.offset();mouseOverHandle=!$(event.target).parents().addBack().is(".ui-slider-handle");this._clickOffset=mouseOverHandle?{left:0,top:0}:{left:event.pageX-offset.left-(closestHandle.width()/2),top:event.pageY-offset.top-(closestHandle.height()/2)-(parseInt(closestHandle.css("borderTopWidth"),10)||0)-(parseInt(closestHandle.css("borderBottomWidth"),10)||0)+(parseInt(closestHandle.css("marginTop"),10)||0)};if(!this.handles.hasClass("ui-state-hover")){this._slide(event,index,normValue);}this._animateOff=true;return true;},_mouseStart:function(){return true;},_mouseDrag:function(event){var position={x:event.pageX,y:event.pageY},normValue=this._normValueFromMouse(position);this._slide(event,this._handleIndex,normValue);return false;},_mouseStop:function(event){this.handles.removeClass("ui-state-active");this._mouseSliding=false;this._stop(event,this._handleIndex);this._change(event,this._handleIndex);this._handleIndex=null;this._clickOffset=null;this._animateOff=false;return false;},_detectOrientation:function(){this.orientation=(this.options.orientation==="vertical")?"vertical":"horizontal";},_normValueFromMouse:function(position){var pixelTotal,pixelMouse,percentMouse,valueTotal,valueMouse;if(this.orientation==="horizontal"){pixelTotal=this.elementSize.width;pixelMouse=position.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0);}else{pixelTotal=this.elementSize.height;pixelMouse=position.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0);}percentMouse=(pixelMouse/pixelTotal);if(percentMouse>1){percentMouse=1;}if(percentMouse<0){percentMouse=0;}if(this.orientation==="vertical"){percentMouse=1-percentMouse;}valueTotal=this._valueMax()-this._valueMin();valueMouse=this._valueMin()+percentMouse*valueTotal;return this._trimAlignValue(valueMouse);},_start:function(event,index){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values();}return this._trigger("start",event,uiHash);},_slide:function(event,index,newVal){var otherVal,newValues,allowed;if(this.options.values&&this.options.values.length){otherVal=this.values(index?0:1);if((this.options.values.length===2&&this.options.range===true)&&((index===0&&newVal>otherVal)||(index===1&&newVal<otherVal))){newVal=otherVal;}if(newVal!==this.values(index)){newValues=this.values();newValues[index]=newVal;allowed=this._trigger("slide",event,{handle:this.handles[index],value:newVal,values:newValues});otherVal=this.values(index?0:1);if(allowed!==false){this.values(index,newVal,true);}}}else{if(newVal!==this.value()){allowed=this._trigger("slide",event,{handle:this.handles[index],value:newVal});if(allowed!==false){this.value(newVal);}}}},_stop:function(event,index){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values();}this._trigger("stop",event,uiHash);},_change:function(event,index){if(!this._keySliding&&!this._mouseSliding){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values();}this._lastChangedValue=index;this._trigger("change",event,uiHash);}},value:function(newValue){if(arguments.length){this.options.value=this._trimAlignValue(newValue);this._refreshValue();this._change(null,0);return;}return this._value();},values:function(index,newValue){var vals,newValues,i;if(arguments.length>1){this.options.values[index]=this._trimAlignValue(newValue);this._refreshValue();this._change(null,index);return;}if(arguments.length){if($.isArray(arguments[0])){vals=this.options.values;newValues=arguments[0];for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(newValues[i]);this._change(null,i);}this._refreshValue();}else{if(this.options.values&&this.options.values.length){return this._values(index);}else{return this.value();}}}else{return this._values();}},_setOption:function(key,value){var i,valsLength=0;if(key==="range"&&this.options.range===true){if(value==="min"){this.options.value=this._values(0);this.options.values=null;}else if(value==="max"){this.options.value=this._values(this.options.values.length-1);this.options.values=null;}}if($.isArray(this.options.values)){valsLength=this.options.values.length;}$.Widget.prototype._setOption.apply(this,arguments);switch(key){case"orientation":this._detectOrientation();this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();break;case"value":this._animateOff=true;this._refreshValue();this._change(null,0);this._animateOff=false;break;case"values":this._animateOff=true;this._refreshValue();for(i=0;i<valsLength;i+=1){this._change(null,i);}this._animateOff=false;break;case"min":case"max":this._animateOff=true;this._refreshValue();this._animateOff=false;break;case"range":this._animateOff=true;this._refresh();this._animateOff=false;break;}},_value:function(){var val=this.options.value;val=this._trimAlignValue(val);return val;},_values:function(index){var val,vals,i;if(arguments.length){val=this.options.values[index];val=this._trimAlignValue(val);return val;}else if(this.options.values&&this.options.values.length){vals=this.options.values.slice();for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(vals[i]);}return vals;}else{return[];}},_trimAlignValue:function(val){if(val<=this._valueMin()){return this._valueMin();}if(val>=this._valueMax()){return this._valueMax();}var step=(this.options.step>0)?this.options.step:1,valModStep=(val-this._valueMin())%step,alignValue=val-valModStep;if(Math.abs(valModStep)*2>=step){alignValue+=(valModStep>0)?step:(-step);}return parseFloat(alignValue.toFixed(5));},_valueMin:function(){return this.options.min;},_valueMax:function(){return this.options.max;},_refreshValue:function(){var lastValPercent,valPercent,value,valueMin,valueMax,oRange=this.options.range,o=this.options,that=this,animate=(!this._animateOff)?o.animate:false,_set={};if(this.options.values&&this.options.values.length){this.handles.each(function(i){valPercent=(that.values(i)-that._valueMin())/(that._valueMax()-that._valueMin())*100;_set[that.orientation==="horizontal"?"left":"bottom"]=valPercent+"%";$(this).stop(1,1)[animate?"animate":"css"](_set,o.animate);if(that.options.range===true){if(that.orientation==="horizontal"){if(i===0){that.range.stop(1,1)[animate?"animate":"css"]({left:valPercent+"%"},o.animate);}if(i===1){that.range[animate?"animate":"css"]({width:(valPercent-lastValPercent)+"%"},{queue:false,duration:o.animate});}}else{if(i===0){that.range.stop(1,1)[animate?"animate":"css"]({bottom:(valPercent)+"%"},o.animate);}if(i===1){that.range[animate?"animate":"css"]({height:(valPercent-lastValPercent)+"%"},{queue:false,duration:o.animate});}}}lastValPercent=valPercent;});}else{value=this.value();valueMin=this._valueMin();valueMax=this._valueMax();valPercent=(valueMax!==valueMin)?(value-valueMin)/(valueMax-valueMin)*100:0;_set[this.orientation==="horizontal"?"left":"bottom"]=valPercent+"%";this.handle.stop(1,1)[animate?"animate":"css"](_set,o.animate);if(oRange==="min"&&this.orientation==="horizontal"){this.range.stop(1,1)[animate?"animate":"css"]({width:valPercent+"%"},o.animate);}if(oRange==="max"&&this.orientation==="horizontal"){this.range[animate?"animate":"css"]({width:(100-valPercent)+"%"},{queue:false,duration:o.animate});}if(oRange==="min"&&this.orientation==="vertical"){this.range.stop(1,1)[animate?"animate":"css"]({height:valPercent+"%"},o.animate);}if(oRange==="max"&&this.orientation==="vertical"){this.range[animate?"animate":"css"]({height:(100-valPercent)+"%"},{queue:false,duration:o.animate});}}},_handleEvents:{keydown:function(event){var allowed,curVal,newVal,step,index=$(event.target).data("ui-slider-handle-index");switch(event.keyCode){case $.ui.keyCode.HOME:case $.ui.keyCode.END:case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:event.preventDefault();if(!this._keySliding){this._keySliding=true;$(event.target).addClass("ui-state-active");allowed=this._start(event,index);if(allowed===false){return;}}break;}step=this.options.step;if(this.options.values&&this.options.values.length){curVal=newVal=this.values(index);}else{curVal=newVal=this.value();}switch(event.keyCode){case $.ui.keyCode.HOME:newVal=this._valueMin();break;case $.ui.keyCode.END:newVal=this._valueMax();break;case $.ui.keyCode.PAGE_UP:newVal=this._trimAlignValue(curVal+((this._valueMax()-this._valueMin())/numPages));break;case $.ui.keyCode.PAGE_DOWN:newVal=this._trimAlignValue(curVal-((this._valueMax()-this._valueMin())/numPages));break;case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:if(curVal===this._valueMax()){return;}newVal=this._trimAlignValue(curVal+step);break;case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:if(curVal===this._valueMin()){return;}newVal=this._trimAlignValue(curVal-step);break;}this._slide(event,index,newVal);},click:function(event){event.preventDefault();},keyup:function(event){var index=$(event.target).data("ui-slider-handle-index");if(this._keySliding){this._keySliding=false;this._stop(event,index);this._change(event,index);$(event.target).removeClass("ui-state-active");}}}});}(jQuery));;},{"all":".ui-slider{position:relative;text-align:left}.ui-slider .ui-slider-handle{position:absolute;z-index:2;width:1.2em;height:1.2em;cursor:default}.ui-slider .ui-slider-range{position:absolute;z-index:1;font-size:.7em;display:block;border:0;background-position:0 0} .ui-slider.ui-state-disabled .ui-slider-handle,.ui-slider.ui-state-disabled .ui-slider-range{filter:inherit}.ui-slider-horizontal{height:.8em}.ui-slider-horizontal .ui-slider-handle{top:-.3em;margin-left:-.6em}.ui-slider-horizontal .ui-slider-range{top:0;height:100%}.ui-slider-horizontal .ui-slider-range-min{left:0}.ui-slider-horizontal .ui-slider-range-max{right:0}.ui-slider-vertical{width:.8em;height:100px}.ui-slider-vertical .ui-slider-handle{left:-.3em;margin-left:0;margin-bottom:-.6em}.ui-slider-vertical .ui-slider-range{left:0;width:100%}.ui-slider-vertical .ui-slider-range-min{bottom:0}.ui-slider-vertical .ui-slider-range-max{top:0}\n\n/* cache key: resourceloader:filter:minify-css:7:be3ff74589a1fede91194c0f8bbf34ed */\n"},{});mw.loader.implement("jquery.ui.tooltip",function($){(function($){var increments=0;function addDescribedBy(elem,id){var describedby=(elem.attr("aria-describedby")||"").split(/\s+/);describedby.push(id);elem.data("ui-tooltip-id",id);}function removeDescribedBy(elem){var id=elem.data("ui-tooltip-id"),describedby=(elem.attr("aria-describedby")||"").split(/\s+/),index=$.inArray(id,describedby);if(index!==-1){describedby.splice(index,1);}elem.removeData("ui-tooltip-id");describedby=$.trim(describedby.join(" "));if(describedby){elem.attr("aria-describedby",describedby);}else{elem.removeAttr("aria-describedby");}}$.widget("ui.tooltip",{version:"1.10.3",options:{content:function(){var title=$(this).attr("title")||"";return $("<a>").text(title).html();},hide:true,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:true,tooltipClass:null,track:false,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"});this.tooltips={};this.parents={};if(this.options.disabled){this._disable();}},_setOption:function(key,value){var that=this;if(key==="disabled"){this[value?"_disable":"_enable"]();this.options[key]=value;return;}this._super(key,value);if(key==="content"){$.each(this.tooltips,function(id,element){that._updateContent(element);});}},_disable:function(){var that=this;$.each(this.tooltips,function(id,element){var event=$.Event("blur");event.target=event.currentTarget=element[0];that.close(event,true);});this.element.find(this.options.items).addBack().each(function(){var element=$(this);if(element.is("[title]")){element.data("ui-tooltip-title",element.attr("title")).attr("title","");}});},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var element=$(this);if(element.data("ui-tooltip-title")){element.attr("title",element.data("ui-tooltip-title"));}});},open:function(event){var that=this,target=$(event?event.target:this.element).closest(this.options.items);if(!target.length||target.data("ui-tooltip-id")){return;}if(target.attr("title")){target.data("ui-tooltip-title",target.attr("title"));}target.data("ui-tooltip-open",true);if(event&&event.type==="mouseover"){target.parents().each(function(){var parent=$(this),blurEvent;if(parent.data("ui-tooltip-open")){blurEvent=$.Event("blur");blurEvent.target=blurEvent.currentTarget=this;that.close(blurEvent,true);}if(parent.attr("title")){parent.uniqueId();that.parents[this.id]={element:this,title:parent.attr("title")};parent.attr("title","");}});}this._updateContent(target,event);},_updateContent:function(target,event){var content,contentOption=this.options.content,that=this,eventType=event?event.type:null;if(typeof contentOption==="string"){return this._open(event,target,contentOption);}content=contentOption.call(target[0],function(response){if(!target.data("ui-tooltip-open")){return;}that._delay(function(){if(event){event.type=eventType;}this._open(event,target,response);});});if(content){this._open(event,target,content);}},_open:function(event,target,content){var tooltip,events,delayedShow,positionOption=$.extend({},this.options.position);if(!content){return;}tooltip=this._find(target);if(tooltip.length){tooltip.find(".ui-tooltip-content").html(content);return;}if(target.is("[title]")){if(event&&event.type==="mouseover"){target.attr("title","");}else{target.removeAttr("title");}}tooltip=this._tooltip(target);addDescribedBy(target,tooltip.attr("id"));tooltip.find(".ui-tooltip-content").html(content);function position(event){positionOption.of=event;if(tooltip.is(":hidden")){return;}tooltip.position(positionOption);}if(this.options.track&&event&&/^mouse/.test(event.type)){this._on(this.document,{mousemove:position});position(event);}else{tooltip.position($.extend({of:target},this.options.position));}tooltip.hide();this._show(tooltip,this.options.show);if(this.options.show&&this.options.show.delay){delayedShow=this.delayedShow=setInterval(function(){if(tooltip.is(":visible")){position(positionOption.of);clearInterval(delayedShow);}},$.fx.interval);}this._trigger("open",event,{tooltip:tooltip});events={keyup:function(event){if(event.keyCode===$.ui.keyCode.ESCAPE){var fakeEvent=$.Event(event);fakeEvent.currentTarget=target[0];this.close(fakeEvent,true);}},remove:function(){this._removeTooltip(tooltip);}};if(!event||event.type==="mouseover"){events.mouseleave="close";}if(!event||event.type==="focusin"){events.focusout="close";}this._on(true,target,events);},close:function(event){var that=this,target=$(event?event.currentTarget:this.element),tooltip=this._find(target);if(this.closing){return;}clearInterval(this.delayedShow);if(target.data("ui-tooltip-title")){target.attr("title",target.data("ui-tooltip-title"));}removeDescribedBy(target);tooltip.stop(true);this._hide(tooltip,this.options.hide,function(){that._removeTooltip($(this));});target.removeData("ui-tooltip-open");this._off(target,"mouseleave focusout keyup");if(target[0]!==this.element[0]){this._off(target,"remove");}this._off(this.document,"mousemove");if(event&&event.type==="mouseleave"){$.each(this.parents,function(id,parent){$(parent.element).attr("title",parent.title);delete that.parents[id];});}this.closing=true;this._trigger("close",event,{tooltip:tooltip});this.closing=false;},_tooltip:function(element){var id="ui-tooltip-"+increments++,tooltip=$("<div>").attr({id:id,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));$("<div>").addClass("ui-tooltip-content").appendTo(tooltip);tooltip.appendTo(this.document[0].body);this.tooltips[id]=element;return tooltip;},_find:function(target){var id=target.data("ui-tooltip-id");return id?$("#"+id):$();},_removeTooltip:function(tooltip){tooltip.remove();delete this.tooltips[tooltip.attr("id")];},_destroy:function(){var that=this;$.each(this.tooltips,function(id,element){var event=$.Event("blur");event.target=event.currentTarget=element[0];that.close(event,true);$("#"+id).remove();if(element.data("ui-tooltip-title")){element.attr("title",element.data("ui-tooltip-title"));element.removeData("ui-tooltip-title");}});}});}(jQuery));;},{"all":".ui-tooltip{padding:8px;position:absolute;z-index:9999;max-width:300px;-webkit-box-shadow:0 0 5px #aaa;box-shadow:0 0 5px #aaa}body .ui-tooltip{border-width:2px}\n\n/* cache key: resourceloader:filter:minify-css:7:74dc316b0056155feeb3090bf2253792 */\n"},{});mw.loader.implement("jquery.ui.touchPunch",function($){(function($){$.support.touch='ontouchend'in document;if(!$.support.touch){return;}var mouseProto=$.ui.mouse.prototype,_mouseInit=mouseProto._mouseInit,touchHandled;function simulateMouseEvent(event,simulatedType){if(event.originalEvent.touches.length>1){return;}event.preventDefault();var touch=event.originalEvent.changedTouches[0],simulatedEvent=document.createEvent('MouseEvents');simulatedEvent.initMouseEvent(simulatedType,true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);event.target.dispatchEvent(simulatedEvent);}mouseProto._touchStart=function(event){var self=this;if(touchHandled||!self._mouseCapture(event.originalEvent.changedTouches[0])){return;}touchHandled=true;self._touchMoved=false;simulateMouseEvent(event,'mouseover');simulateMouseEvent(event,'mousemove');simulateMouseEvent(event,'mousedown');};mouseProto._touchMove=function(event){if(!touchHandled){return;}this._touchMoved=true;simulateMouseEvent(event,'mousemove');};mouseProto._touchEnd=function(event){if(!touchHandled){return;}simulateMouseEvent(event,'mouseup');simulateMouseEvent(event,'mouseout');if(!this._touchMoved){simulateMouseEvent(event,'click');}touchHandled=false;};mouseProto._mouseInit=function(){var self=this;self.element.bind('touchstart',$.proxy(self,'_touchStart')).bind('touchmove',$.proxy(self,'_touchMove')).bind('touchend',$.proxy(self,'_touchEnd'));_mouseInit.call(self);};})(jQuery);;},{},{});mw.loader.implement("jquery.ui.widget",function($){(function($,undefined){var uuid=0,slice=Array.prototype.slice,_cleanData=$.cleanData;$.cleanData=function(elems){for(var i=0,elem;(elem=elems[i])!=null;i++){try{$(elem).triggerHandler("remove");}catch(e){}}_cleanData(elems);};$.widget=function(name,base,prototype){var fullName,existingConstructor,constructor,basePrototype,proxiedPrototype={},namespace=name.split(".")[0];name=name.split(".")[1];fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget;}$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName);};$[namespace]=$[namespace]||{};existingConstructor=$[namespace][name];constructor=$[namespace][name]=function(options,element){if(!this._createWidget){return new constructor(options,element);}if(arguments.length){this._createWidget(options,element);}};$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]});basePrototype=new base();basePrototype.options=$.widget.extend({},basePrototype.options);$.each(prototype,function(prop,value){if(!$.isFunction(value)){proxiedPrototype[prop]=value;return;}proxiedPrototype[prop]=(function(){var _super=function(){return base.prototype[prop].apply(this,arguments);},_superApply=function(args){return base.prototype[prop].apply(this,args);};return function(){var __super=this._super,__superApply=this._superApply,returnValue;this._super=_super;this._superApply=_superApply;returnValue=value.apply(this,arguments);this._super=__super;this._superApply=__superApply;return returnValue;};})();});constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor?(basePrototype.widgetEventPrefix||name):name},proxiedPrototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetFullName:fullName});if(existingConstructor){$.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto);});delete existingConstructor._childConstructors;}else{base._childConstructors.push(constructor);}$.widget.bridge(name,constructor);};$.widget.extend=function(target){var input=slice.call(arguments,1),inputIndex=0,inputLength=input.length,key,value;for(;inputIndex<inputLength;inputIndex++){for(key in input[inputIndex]){value=input[inputIndex][key];if(input[inputIndex].hasOwnProperty(key)&&value!==undefined){if($.isPlainObject(value)){target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value);}else{target[key]=value;}}}}return target;};$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall=typeof options==="string",args=slice.call(arguments,1),returnValue=this;options=!isMethodCall&&args.length?$.widget.extend.apply(null,[options].concat(args)):options;if(isMethodCall){this.each(function(){var methodValue,instance=$.data(this,fullName);if(!instance){return $.error("cannot call methods on "+name+" prior to initialization; "+"attempted to call method '"+options+"'");}if(!$.isFunction(instance[options])||options.charAt(0)==="_"){return $.error("no such method '"+options+"' for "+name+" widget instance");}methodValue=instance[options].apply(instance,args);if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue;return false;}});}else{this.each(function(){var instance=$.data(this,fullName);if(instance){instance.option(options||{})._init();}else{$.data(this,fullName,new object(options,this));}});}return returnValue;};};$.Widget=function(){};$.Widget._childConstructors=[];$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0];this.element=$(element);this.uuid=uuid++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=$.widget.extend({},this.options,this._getCreateOptions(),options);this.bindings=$();this.hoverable=$();this.focusable=$();if(element!==this){$.data(element,this.widgetFullName,this);this._on(true,this.element,{remove:function(event){if(event.target===element){this.destroy();}}});this.document=$(element.style?element.ownerDocument:element.document||element);this.window=$(this.document[0].defaultView||this.document[0].parentWindow);}this._create();this._trigger("create",null,this._getCreateEventData());this._init();},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus");},_destroy:$.noop,widget:function(){return this.element;},option:function(key,value){var options=key,parts,curOption,i;if(arguments.length===0){return $.widget.extend({},this.options);}if(typeof key==="string"){options={};parts=key.split(".");key=parts.shift();if(parts.length){curOption=options[key]=$.widget.extend({},this.options[key]);for(i=0;i<parts.length-1;i++){curOption[parts[i]]=curOption[parts[i]]||{};curOption=curOption[parts[i]];}key=parts.pop();if(arguments.length===1){return curOption[key]===undefined?null:curOption[key];}curOption[key]=value;}else{if(arguments.length===1){return this.options[key]===undefined?null:this.options[key];}options[key]=value;}}this._setOptions(options);return this;},_setOptions:function(options){var key;for(key in options){this._setOption(key,options[key]);}return this;},_setOption:function(key,value){this.options[key]=value;if(key==="disabled"){this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!value).attr("aria-disabled",value);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus");}return this;},enable:function(){return this._setOption("disabled",false);},disable:function(){return this._setOption("disabled",true);},_on:function(suppressDisabledCheck,element,handlers){var delegateElement,instance=this;if(typeof suppressDisabledCheck!=="boolean"){handlers=element;element=suppressDisabledCheck;suppressDisabledCheck=false;}if(!handlers){handlers=element;element=this.element;delegateElement=this.widget();}else{element=delegateElement=$(element);this.bindings=this.bindings.add(element);}$.each(handlers,function(event,handler){function handlerProxy(){if(!suppressDisabledCheck&&(instance.options.disabled===true||$(this).hasClass("ui-state-disabled"))){return;}return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments);}if(typeof handler!=="string"){handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++;}var match=event.match(/^(\w+)\s*(.*)$/),eventName=match[1]+instance.eventNamespace,selector=match[2];if(selector){delegateElement.delegate(selector,eventName,handlerProxy);}else{element.bind(eventName,handlerProxy);}});},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;element.unbind(eventName).undelegate(eventName);},_delay:function(handler,delay){function handlerProxy(){return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments);}var instance=this;return setTimeout(handlerProxy,delay||0);},_hoverable:function(element){this.hoverable=this.hoverable.add(element);this._on(element,{mouseenter:function(event){$(event.currentTarget).addClass("ui-state-hover");},mouseleave:function(event){$(event.currentTarget).removeClass("ui-state-hover");}});},_focusable:function(element){this.focusable=this.focusable.add(element);this._on(element,{focusin:function(event){$(event.currentTarget).addClass("ui-state-focus");},focusout:function(event){$(event.currentTarget).removeClass("ui-state-focus");}});},_trigger:function(type,event,data){var prop,orig,callback=this.options[type];data=data||{};event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();event.target=this.element[0];orig=event.originalEvent;if(orig){for(prop in orig){if(!(prop in event)){event[prop]=orig[prop];}}}this.element.trigger(event,data);return!($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===false||event.isDefaultPrevented());}};$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){if(typeof options==="string"){options={effect:options};}var hasOptions,effectName=!options?method:options===true||typeof options==="number"?defaultEffect:options.effect||defaultEffect;options=options||{};if(typeof options==="number"){options={duration:options};}hasOptions=!$.isEmptyObject(options);options.complete=callback;if(options.delay){element.delay(options.delay);}if(hasOptions&&$.effects&&$.effects.effect[effectName]){element[method](options);}else if(effectName!==method&&element[effectName]){element[effectName](options.duration,options.easing,callback);}else{element.queue(function(next){$(this)[method]();if(callback){callback.call(element[0]);}next();});}};});})(jQuery);;},{},{});mw.loader.implement("mediawiki.Uri",function($){(function($,mw){function cat(pre,val,post,raw){if(val===undefined||val===null||val===''){return'';}else{return pre+(raw?val:mw.Uri.encode(val))+post;}}var parser={strict:/^(?:([^:\/?#]+):)?(?:\/\/(?:(?:([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)?((?:[^?#\/]*\/)*[^?#]*)(?:\?([^#]*))?(?:#(.*))?/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?(?:(?:([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?((?:\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?[^?#\/]*)(?:\?([^#]*))?(?:#(.*))?/},properties=['protocol','user','password','host','port','path','query','fragment'];mw.UriRelative=function(documentLocation){function Uri(uri,options){options=typeof options==='object'?options:{strictMode:!!options};options=$.extend({strictMode:false,overrideKeys:false},options);if(uri!==undefined&&uri!==null||uri!==''){if(typeof uri==='string'){this._parse(uri,options);}else if(typeof uri==='object'){var _this=this;$.each(properties,function(i,property){_this[property]=uri[property];});if(this.query===undefined){this.query={};}}}if(!this.protocol){this.protocol=defaultUri.protocol;}try{if(!this.host){this.host=defaultUri.host;if(!this.port){this.port=defaultUri.port;}}if(this.path&&this.path.charAt(0)!=='/'){throw new Error('Bad constructor arguments');}if(!(this.protocol&&this.host&&this.path)){throw new Error('Bad constructor arguments');}}catch(e){mw.log(e);}}Uri.encode=function(s){return encodeURIComponent(s).replace(/!/g,'%21').replace(/'/g,'%27').replace(/\(/g,'%28').replace(/\)/g,'%29').replace(/\*/g,'%2A').replace(/%20/g,'+');};Uri.decode=function(s){return decodeURIComponent(s.replace(/\+/g,'%20'));};Uri.prototype={_parse:function(str,options){var matches=parser[options.strictMode?'strict':'loose'].exec(str);var uri=this;$.each(properties,function(i,property){uri[property]=matches[i+1];});var q={};if(uri.query){uri.query.replace(/(?:^|&)([^&=]*)(?:(=)([^&]*))?/g,function($0,$1,$2,$3){if($1){var k=Uri.decode($1);var v=($2===''||$2===undefined)?null:Uri.decode($3);if(options.overrideKeys||q[k]===undefined){q[k]=v;}else{if(typeof q[k]==='string'){q[k]=[q[k]];}if($.isArray(q[k])){q[k].push(v);}}}});}this.query=q;},getUserInfo:function(){return cat('',this.user,cat(':',this.password,''));},getHostPort:function(){return this.host+cat(':',this.port,'');},getAuthority:function(){return cat('',this.getUserInfo(),'@')+this.getHostPort();},getQueryString:function(){var args=[];$.each(this.query,function(key,val){var k=Uri.encode(key);var vals=val===null?[null]:$.makeArray(val);$.each(vals,function(i,v){args.push(k+(v===null?'':'='+Uri.encode(v)));});});return args.join('&');},getRelativePath:function(){return this.path+cat('?',this.getQueryString(),'',true)+cat('#',this.fragment,'');},toString:function(){return this.protocol+'://'+this.getAuthority()+this.getRelativePath();},clone:function(){return new Uri(this);},extend:function(parameters){$.extend(this.query,parameters);return this;}};var defaultUri=new Uri(documentLocation);return Uri;};if(document&&document.location&&document.location.href){if(typeof document.location=='undefined'||!document.location.href){mw.Uri=mw.UriRelative('http://webview.com/fixme');}else{mw.Uri=mw.UriRelative(document.location.href);}}})(jQuery,mediaWiki);;},{},{});mw.loader.implement("mediawiki.UtilitiesTime",function($){(function(mw){mw.seconds2npt=function(sec,show_ms,mm_format){var hoursStr;if(isNaN(sec)){mw.log("Warning: mediawiki.UtilitiesTime, trying to get npt time on NaN:"+sec);return'0:00:00';}var tm=mw.seconds2Measurements(sec);if(show_ms){tm.seconds=Math.round(tm.seconds*1000)/1000;}else{tm.seconds=Math.round(tm.seconds);}if(tm.seconds<10){tm.seconds='0'+tm.seconds;}if(tm.hours==0){hoursStr='';if(mm_format&&tm.minutes<10)tm.minutes='0'+tm.minutes;}else{if(tm.minutes<10)tm.minutes='0'+tm.minutes;hoursStr=tm.hours;}hoursStr+=tm.days*24||'';if(hoursStr){hoursStr+=':';}return hoursStr+tm.minutes+":"+tm.seconds;};mw.seconds2Measurements=function(sec){var tm={};tm.days=Math.floor(sec/(3600*24));tm.hours=Math.floor(Math.round(sec)/3600)%24;tm.minutes=Math.floor((Math.round(sec)/60)%60);tm.seconds=Math.round(sec)%60;return tm;};mw.measurements2seconds=function(timeMeasurements){var seconds=0;if(timeMeasurements.days){seconds+=parseInt(timeMeasurements.days,10)*24*3600;}if(timeMeasurements.hours){seconds+=parseInt(timeMeasurements.hours,10)*3600;}if(timeMeasurements.minutes){seconds+=parseInt(timeMeasurements.minutes,10)*60;}if(timeMeasurements.seconds){seconds+=parseInt(timeMeasurements.seconds,10);}if(timeMeasurements.milliseconds){seconds+=parseFloat(timeMeasurements.milliseconds);}return seconds;};mw.npt2seconds=function(npt_str){if(!npt_str){return 0;}npt_str=npt_str.replace(/npt:|s/g,'');var hour=0;var min=0;var sec=0;times=npt_str.split(':');if(times.length==4){sec=times[2]+'.'+times[3];min=times[1];hour=times[0];}else if(times.length==3){sec=times[2];min=times[1];hour=times[0];}else if(times.length==2){sec=times[1];min=times[0];}else{sec=times[0];}sec=sec.replace(/,\s?/,'.');return parseInt(hour*3600)+parseInt(min*60)+parseFloat(sec);};})(window.mediaWiki);;},{},{});mw.loader.implement("mediawiki.UtilitiesUrl",function($){(function(mw){mw.absoluteUrl=function(source,contextUrl){if(source.indexOf('http://')===0||source.indexOf('https://')===0){return source;}if(!contextUrl){contextUrl=document.URL;}var contextUrl=new mw.Uri(contextUrl);if(source.indexOf('//')===0){return contextUrl.protocol+':'+source;}if(contextUrl.directory==''&&contextUrl.protocol=='file'){var fileUrl=contextUrl.split('\\');fileUrl.pop();return fileUrl.join('\\')+'\\'+src;}if(source.indexOf('/')===0){return contextUrl.protocol+'://'+contextUrl.getAuthority()+source;}else{return contextUrl.protocol+'://'+contextUrl.getAuthority()+contextUrl.path+source;}};mw.isLocalDomain=function(url){if(!url){return false;}if((url.indexOf('http://')!=0&&url.indexOf('//')!=0&&url.indexOf('https://')!=0)||new mw.Uri(document.URL).host==new mw.Uri(url).host){return true;}return false;}})(window.mediaWiki);;},{},{});mw.loader.implement("mediawiki.client",function($){(function(mw){var userAgent=navigator.userAgent;mw.isMobileDevice=function(){return(mw.isIphone()||mw.isIpod()||mw.isIpad()||mw.isAndroid()||mw.isWindowsPhone()||mw.getConfig("EmbedPlayer.ForceNativeComponent")===true||mw.getConfig("EmbedPlayer.SimulateMobile")===true)};mw.isNativeApp=function(){return mw.getConfig("EmbedPlayer.ForceNativeComponent");};mw.isIphone=function(){return(mw.getConfig("EmbedPlayer.ForceNativeComponent")!==true&&userAgent.indexOf('iPhone')!=-1&&!mw.isIpad())||mw.isIpod();};mw.isIE=function(){return(/msie/.test(userAgent.toLowerCase())||/trident/.test(userAgent.toLowerCase()));};mw.isChromeCast=function(){return(/CrKey/.test(userAgent));};mw.isIE7=function(){return(/msie 7/.test(userAgent.toLowerCase()));};mw.isIE8=function(){return document.documentMode===8;};mw.isIE9=function(){return document.documentMode===9;};mw.isIE11=function(){return(/trident\/7.0/.test(userAgent.toLowerCase()));};mw.isEdge=function(){return(/edge/.test(userAgent.toLowerCase()));};mw.isDesktopSafari=function(){return mw.isSafari()&&!mw.isMobileDevice();};mw.isSafari=function(){return(/safari/).test(userAgent.toLowerCase())&&!mw.isChrome()&&!mw.isEdge();};mw.isIE9Comp=function(){return(/msie 7/.test(userAgent.toLowerCase())&&/trident\/5/.test(userAgent.toLowerCase()));};mw.isIE10Comp=function(){return(/msie 7/.test(userAgent.toLowerCase())&&/trident\/6/.test(userAgent.toLowerCase()));};mw.isIphone4=function(){return(mw.isIphone()&&(window.devicePixelRatio&&window.devicePixelRatio>=2));};mw.isIpod=function(){return(userAgent.indexOf('iPod')!=-1);};mw.isIpad=function(){return(userAgent.indexOf('iPad')!=-1);};mw.isIpad2=function(){return(mw.isIpad()&&window.devicePixelRatio&&window.devicePixelRatio<2);};mw.isIpad3=function(){return/OS 3_/.test(userAgent)&&mw.isIpad();};mw.isAndroid44=function(){return(userAgent.indexOf('Android 4.4')!=-1&&userAgent.indexOf('Windows')===-1);};mw.isAndroid43=function(){return(userAgent.indexOf('Android 4.3')!=-1&&userAgent.indexOf('Windows')===-1);};mw.isAndroid42=function(){return(userAgent.indexOf('Android 4.2')!=-1&&userAgent.indexOf('Windows')===-1);};mw.isAndroid41=function(){return(userAgent.indexOf('Android 4.1')!=-1&&userAgent.indexOf('Windows')===-1);};mw.isAndroid40=function(){return(userAgent.indexOf('Android 4.0')!=-1&&userAgent.indexOf('Windows')===-1);};mw.isAndroid2=function(){return(userAgent.indexOf('Android 2.')!=-1&&userAgent.indexOf('Windows')===-1);};mw.isAndroid=function(){return(userAgent.indexOf('Android')!=-1&&userAgent.indexOf('Windows')===-1);};mw.isAndroid4andUp=function(){return((userAgent.indexOf('Android 4.')!=-1)||(userAgent.indexOf('Android 5.')!=-1)||(userAgent.indexOf('Android 6.')!=-1))&&userAgent.indexOf('Windows')===-1;};mw.isSamsungStockBrowser=function(){return((userAgent.indexOf('SamsungBrowser')!=-1));};mw.isFirefox=function(){return(userAgent.indexOf('Firefox')!=-1);};mw.isChrome=function(){return(userAgent.indexOf('Chrome')!=-1&&!mw.isEdge());};mw.isAndroidNativeBrowser=function(){return(mw.isAndroid()&&!mw.isFirefox()&&!mw.isChrome());};mw.isAndroidChromeNativeBrowser=function(){return(mw.isAndroid()&&mw.isChrome());};mw.isOldAndroidChromeNativeBrowser=function(){var regExpResult=userAgent.match(/Chrome\/([0-9][0-9])/);if(regExpResult instanceof Array&&regExpResult.length>1){return mw.isAndroidChromeNativeBrowser()&&parseInt(regExpResult[1])<30;}return false;};mw.isMobileChrome=function(){return(mw.isAndroid4andUp()&&userAgent.indexOf('Chrome')!=-1)};mw.isWindowsPhone=function(){return userAgent.indexOf('Windows Phone')!=-1;};mw.isIOS=function(){return(mw.isIphone()||mw.isIpod()||mw.isIpad());};mw.isIOS3=function(){return/OS 3_/.test(userAgent)&&mw.isIOS();};mw.isIOS4=function(){return/OS 4_/.test(userAgent)&&mw.isIOS();};mw.isIOS5=function(){return/OS 5_/.test(userAgent)&&mw.isIOS();};mw.isIOS6=function(){return/OS 6_/.test(userAgent)&&mw.isIOS();};mw.isIOS7=function(){return/OS 7_/.test(userAgent)&&mw.isIOS();};mw.isIOS71=function(){return/OS 7_1/.test(userAgent)&&mw.isIOS();};mw.isIOS8=function(){return(/OS 8_/.test(userAgent)||/Version\/8/.test(userAgent))&&mw.isIOS();};mw.isIOS9=function(){return(/OS 9_/.test(userAgent)||/Version\/9/.test(userAgent))&&mw.isIOS();};mw.isIOS10=function(){return(/OS 10_/.test(userAgent)||/Version\/10/.test(userAgent))&&mw.isIOS();};mw.isIOSBelow9=function(){return mw.isIOS()&&(mw.isIOS3()||mw.isIOS4()||mw.isIOS5()||mw.isIOS6()||mw.isIOS7()||mw.isIOS8());};mw.isIOSBelow10=function(){return mw.isIOSBelow9()||mw.isIOS9();};mw.isIOS11=function(){return(/OS 11_/.test(userAgent)||/Version\/11/.test(userAgent))&&mw.isIOS();};mw.isIOSAbove7=function(){return mw.isIOS8()||mw.isIOS9()||mw.isIOS10()||mw.isIOS11();};mw.isSilk=function(){return/\bSilk\b/.test(userAgent);};mw.hasNativeTouchBindings=function(){return(mw.isAndroid41()||mw.isAndroid42()||(mw.isAndroid()&&mw.isFirefox()));};mw.isDeviceLessThan480P=function(){return matchMedia('only screen and (max-device-width: 480px)').matches;};mw.hasMouseEvents=function(){return!mw.isMobileDevice();};mw.isTouchDevice=function(){return!!('ontouchstart'in window)||(mw.getConfig("EmbedPlayer.EnableMobileSkin")===true&&mw.getConfig("EmbedPlayer.SimulateMobile")===true);};mw.isMacintosh=function(){return navigator.platform.indexOf('Mac')>-1};mw.isWindows=function(){return navigator.platform.indexOf('Win')>-1};mw.getUserOS=function(){var os="";var nAgt=navigator.userAgent;var clientStrings=[{s:'Windows 10',r:/(Windows 10.0|Windows NT 10.0)/},{s:'Windows 8.1',r:/(Windows 8.1|Windows NT 6.3)/},{s:'Windows 8',r:/(Windows 8|Windows NT 6.2)/},{s:'Windows 7',r:/(Windows 7|Windows NT 6.1)/},{s:'Android',r:/Android/},{s:'Linux',r:/(Linux|X11)/},{s:'iOS',r:/(iPhone|iPad|iPod)/},{s:'Mac OS X',r:/Mac OS X/},{s:'Mac OS',r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},];for(var id in clientStrings){var cs=clientStrings[id];if(cs.r.test(nAgt)){os=cs.s;break;}}return os;};mw.isHTML5FallForwardNative=function(){if(mw.isMobileHTML5()){return true;}if(document.URL.indexOf('forceMobileHTML5')!=-1){return true;}if(mw.supportsFlash()){return false;}if(mw.supportsHTML5()){return true;}return false;};mw.isMobileHTML5=function(){if(mw.isIphone()||mw.isIpod()||mw.isIpad()||mw.isAndroid2()){return true;}return false;};mw.supportsHTML5=function(){if(userAgent.indexOf('BlackBerry')!=-1){return false;}var dummyvid=document.createElement("video");if(dummyvid.canPlayType){return true;}return false;};mw.supportsFlash=function(){if(mw.getConfig('EmbedPlayer.DisableHTML5FlashFallback')){return false;}if((mw.isDesktopSafari()&&!mw.getConfig('ForceFlashOnDesktopSafari'))||mw.isEdge()){return false;}var majorVersion=this.getFlashVersion().split(',').shift();if(majorVersion<10){return false;}else{return true;}};mw.supportSilverlight=function(){return Silverlight.isInstalled("4.0");};mw.parseJSON=function(json,retValue){try{var parsedJson=JSON.parse(json);}catch(e){mw.log("JSON parse syntax error: "+e);return retValue?retValue:null;}return parsedJson;}
mw.getFlashVersion=function(){if(navigator.plugins&&navigator.plugins.length){try{if(navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin){return(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1];}}catch(e){}}try{try{if(typeof ActiveXObject!='undefined'){var axo=new ActiveXObject('ShockwaveFlash.ShockwaveFlash.6');try{axo.AllowScriptAccess='always';}catch(e){return'6,0,0';}}}catch(e){}return new ActiveXObject('ShockwaveFlash.ShockwaveFlash').GetVariable('$version').replace(/\D+/g,',').match(/^,?(.+),?$/)[1];}catch(e){}return'0,0,0';};})(window.mediaWiki);;},{},{});mw.loader.implement("mediawiki.jqueryMsg",function($){(function(mw,$,undefined){mw.jqueryMsg={};function getFailableParserFn(options){var parser=new mw.jqueryMsg.parser(options);return function(args){var key=args[0];var argsArray=$.isArray(args[1])?args[1]:$.makeArray(args).slice(1);try{return parser.parse(key,argsArray);}catch(e){return $('<span>').append(key+': '+e.message);}};}mw.jqueryMsg.getMessageFunction=function(options){var failableParserFn=getFailableParserFn(options);return function(){if(window.getStringByKey&&arguments.length>0&&window.getStringByKey(arguments[0])){return window.getStringByKey(arguments[0]);}return failableParserFn(arguments).html();};};mw.jqueryMsg.getPlugin=function(options){var failableParserFn=getFailableParserFn(options);return function(){var $target=this.empty();$.each(failableParserFn(arguments).contents(),function(i,node){$target.append(node);});return $target;};};var parserDefaults={'magic':{'SITENAME':mw.config.get('wgSiteName')},'messages':mw.messages,'language':mw.language};mw.jqueryMsg.parser=function(options){this.settings=$.extend({},parserDefaults,options);this.emitter=new mw.jqueryMsg.htmlEmitter(this.settings.language,this.settings.magic);};mw.jqueryMsg.parser.prototype={astCache:{},parse:function(key,replacements){return this.emitter.emit(this.getAst(key),replacements);},getAst:function(key){if(this.astCache[key]===undefined){var wikiText=this.settings.messages.get(key);if(typeof wikiText!=='string'){wikiText="\\["+key+"\\]";}this.astCache[key]=this.wikiTextToAst(wikiText);}return this.astCache[key];},wikiTextToAst:function(input){var pos=0;function choice(ps){return function(){for(var i=0;i<ps.length;i++){var result=ps[i]();if(result!==null){return result;}}return null;};}function sequence(ps){var originalPos=pos;var result=[];for(var i=0;i<ps.length;i++){var res=ps[i]();if(res===null){pos=originalPos;return null;}result.push(res);}return result;}function nOrMore(n,p){return function(){var originalPos=pos;var result=[];var parsed=p();while(parsed!==null){result.push(parsed);parsed=p();}if(result.length<n){pos=originalPos;return null;}return result;};}function transform(p,fn){return function(){var result=p();return result===null?null:fn(result);};}function makeStringParser(s){var len=s.length;return function(){var result=null;if(input.substr(pos,len)===s){result=s;pos+=len;}return result;};}function makeRegexParser(regex){return function(){var matches=input.substr(pos).match(regex);if(matches===null){return null;}pos+=matches[0].length;return matches[0];};}var regularLiteral=makeRegexParser(/^[^{}[\]$\\]/);var regularLiteralWithoutBar=makeRegexParser(/^[^{}[\]$\\|]/);var regularLiteralWithoutSpace=makeRegexParser(/^[^{}[\]$\s]/);var backslash=makeStringParser("\\");var anyCharacter=makeRegexParser(/^./);function escapedLiteral(){var result=sequence([backslash,anyCharacter]);return result===null?null:result[1];}var escapedOrLiteralWithoutSpace=choice([escapedLiteral,regularLiteralWithoutSpace]);var escapedOrLiteralWithoutBar=choice([escapedLiteral,regularLiteralWithoutBar]);var escapedOrRegularLiteral=choice([escapedLiteral,regularLiteral]);function literalWithoutSpace(){var result=nOrMore(1,escapedOrLiteralWithoutSpace)();return result===null?null:result.join('');}function literalWithoutBar(){var result=nOrMore(1,escapedOrLiteralWithoutBar)();return result===null?null:result.join('');}function literal(){var result=nOrMore(1,escapedOrRegularLiteral)();return result===null?null:result.join('');}var whitespace=makeRegexParser(/^\s+/);var dollar=makeStringParser('$');var digits=makeRegexParser(/^\d+/);function replacement(){var result=sequence([dollar,digits]);if(result===null){return null;}return['REPLACE',parseInt(result[1],10)-1];}var openExtlink=makeStringParser('[');var closeExtlink=makeStringParser(']');function extlink(){var result=null;var parsedResult=sequence([openExtlink,nonWhitespaceExpression,whitespace,expression,closeExtlink]);if(parsedResult!==null){result=['LINK',parsedResult[1],parsedResult[3]];}return result;}function extLinkParam(){var result=sequence([openExtlink,dollar,digits,whitespace,expression,closeExtlink]);if(result===null){return null;}return['LINKPARAM',parseInt(result[2],10)-1,result[4]];}var openLink=makeStringParser('[[');var closeLink=makeStringParser(']]');function link(){var result=null;var parsedResult=sequence([openLink,expression,closeLink]);if(parsedResult!==null){result=['WLINK',parsedResult[1]];}return result;}var templateName=transform(makeRegexParser(/^[ !"$&'()*,.\/0-9;=?@A-Z\^_`a-z~\x80-\xFF+-]+/),function(result){return result.toString();});function templateParam(){var result=sequence([pipe,nOrMore(0,paramExpression)]);if(result===null){return null;}var expr=result[1];return expr.length>1?["CONCAT"].concat(expr):expr[0];}var pipe=makeStringParser('|');function templateWithReplacement(){var result=sequence([templateName,colon,replacement]);return result===null?null:[result[0],result[2]];}function templateWithOutReplacement(){var result=sequence([templateName,colon,paramExpression]);return result===null?null:[result[0],result[2]];}var colon=makeStringParser(':');var templateContents=choice([function(){var res=sequence([choice([templateWithReplacement,templateWithOutReplacement]),nOrMore(0,templateParam)]);return res===null?null:res[0].concat(res[1]);},function(){var res=sequence([templateName,nOrMore(0,templateParam)]);if(res===null){return null;}return[res[0]].concat(res[1]);}]);var openTemplate=makeStringParser('{{');var closeTemplate=makeStringParser('}}');function template(){var result=sequence([openTemplate,templateContents,closeTemplate]);return result===null?null:result[1];}var nonWhitespaceExpression=choice([template,link,extLinkParam,extlink,replacement,literalWithoutSpace]);var paramExpression=choice([template,link,extLinkParam,extlink,replacement,literalWithoutBar]);var expression=choice([template,link,extLinkParam,extlink,replacement,literal]);function start(){var result=nOrMore(0,expression)();if(result===null){return null;}return["CONCAT"].concat(result);}var result=start();if(result===null||pos!==input.length){throw new Error("Parse error at position "+pos.toString()+" in input: "+input);}return result;}};mw.jqueryMsg.htmlEmitter=function(language,magic){this.language=language;var _this=this;$.each(magic,function(key,val){_this[key.toLowerCase()]=function(){return val;};});this.emit=function(node,replacements){var ret=null;var _this=this;switch(typeof node){case'string':case'number':ret=node;break;case'object':var subnodes=$.map(node.slice(1),function(n){return _this.emit(n,replacements);});var operation=node[0].toLowerCase();if(typeof _this[operation]==='function'){ret=_this[operation](subnodes,replacements);}else{throw new Error('unknown operation "'+operation+'"');}break;case'undefined':ret='';break;default:throw new Error('unexpected type in AST: '+typeof node);}return ret;};};mw.jqueryMsg.htmlEmitter.prototype={concat:function(nodes){var span=$('<span>').addClass('mediaWiki_htmlEmitter');$.each(nodes,function(i,node){if(node instanceof jQuery&&node.hasClass('mediaWiki_htmlEmitter')){$.each(node.contents(),function(j,childNode){span.append(childNode);});}else{span.append(node);}});return span;},replace:function(nodes,replacements){var index=parseInt(nodes[0],10);if(index<replacements.length){if(typeof arg==='string'){return mw.html.escape(replacements[index]);}else{return replacements[index];}}else{return'$'+(index+1);}},wlink:function(nodes){return"unimplemented";},link:function(nodes){var arg=nodes[0];var contents=nodes[1];var $el;if(arg instanceof jQuery){$el=arg;}else{$el=$('<a>');if(typeof arg==='function'){$el.click(arg).attr('href','#');}else{$el.attr('href',arg.toString());}}$el.append(contents);return $el;},linkparam:function(nodes,replacements){var replacement,index=parseInt(nodes[0],10);if(index<replacements.length){replacement=replacements[index];}else{replacement='$'+(index+1);}return this.link([replacement,nodes[1]]);},plural:function(nodes){var count=parseInt(this.language.convertNumber(nodes[0],true),10);var forms=nodes.slice(1);return forms.length?this.language.convertPlural(count,forms):'';},gender:function(nodes){var gender;if(nodes[0]&&nodes[0].options instanceof mw.Map){gender=nodes[0].options.get('gender');}else{gender=nodes[0];}var forms=nodes.slice(1);return this.language.gender(gender,forms);},grammar:function(nodes){var form=nodes[0];var word=nodes[1];return word&&form&&this.language.convertGrammar(word,form);}};window.gM=mw.jqueryMsg.getMessageFunction();$.fn.msg=mw.jqueryMsg.getPlugin();var oldParser=mw.Message.prototype.parser;mw.Message.prototype.parser=function(){if(this.map.get(this.key).indexOf('{{')<0){return oldParser.apply(this);}var messageFunction=mw.jqueryMsg.getMessageFunction({'messages':this.map});return messageFunction(this.key,this.parameters);};})(mediaWiki,jQuery);;},{},{});mw.loader.implement("mediawiki.kmenu",function($){(function(mw,$){"use strict";mw.KMenu=function($element,options){if(mw.getConfig("EmbedPlayer.EnableMobileSkin")&&mw.isMobileDevice()){this.mobileMenu=$("<select class='mobileMenuSelect'></select>");$element.parent().prepend(this.mobileMenu);this.mobileMenu.change(function(){var title=this.value;$element.find("li>a").each(function(index,item){if($(item).attr("title")===title){$(item).trigger("click");}});});}var defaults={cssClass:"dropdown-menu",tabIndex:1,closeOnFocusOut:true,attributes:{'role':'menu','aria-labelledby':'dLabel'},dividerClass:'divider',onSelected:null};this.bindPostfix='.kMenu';this.$el=$element;this.options=$.extend({},defaults,options);this.itemIdx=0;this.selectedIndex=-1;this.init();return this;}
mw.KMenu.prototype={init:function(){var _this=this;if(this.options.cssClass){this.$el.addClass(this.options.cssClass);}if($.isPlainObject(this.options.attributes)){this.$el.attr(this.options.attributes);}this.$el.attr({'role':'menu'});this.$el.uniqueId();},getTabIndex:function(idx){var tabIndex=parseFloat(this.options.tabIndex+'.00');idx=(idx<10)?'0'+idx:idx;return tabIndex+=parseFloat('.'+idx);},addItem:function(item){if(mw.getConfig("EmbedPlayer.EnableMobileSkin")&&mw.isMobileDevice()){this.mobileMenu.append($('<option>',{value:item.label}).text(item.label));}var _this=this;item.idx=this.itemIdx;var attrs=item.attributes||{};if(item.accessibility){var accessibilityLabel=item.accessibility;}var $item=$('<li />').addClass(item.cssClass).attr(attrs).append($('<a />').attr({'href':'#','title':item.label,'role':'menuitemcheckbox','aria-checked':'false','tabindex':this.getTabIndex(this.itemIdx+1)}).text(item.label).click(function(e){e.preventDefault();_this.setActive(item.idx);_this.selectedIndex=item.idx;if($.isFunction(item.callback)){item.callback();}if($.isFunction(_this.options.onSelected)){_this.options.onSelected(item);}_this.close();}).attr('aria-label',accessibilityLabel));if(this.itemIdx>0){this.addDivider();}this.$el.append($item);if(item.active){$item.addClass('active').attr('aria-checked','true');this.selectedIndex=this.itemIdx;}this.itemIdx++;},addDivider:function(){this.$el.append($('<li />').addClass(this.options.dividerClass));},isOpen:function(){return this.$el.hasClass('open');},open:function(){var _this=this;this.$el.addClass('open');$(".ui-tooltip").hide();if(this.options.closeOnFocusOut){setTimeout(function(){$(document).on('click'+_this.bindPostfix+_this.$el.attr('id'),function(){_this.close();});},0);}},close:function(){this.$el.removeClass('open');if(this.options.closeOnFocusOut){$(document).off('click'+this.bindPostfix+this.$el.attr('id'));}},toggle:function(){if(this.isOpen()){this.close();}else{this.open();}},previousItem:function(){this.selectedIndex--;if(this.selectedIndex<0){this.selectedIndex=this.itemIdx-1;}this.setActive(this.selectedIndex);},nextItem:function(){this.selectedIndex++;if(this.selectedIndex==this.itemIdx){this.selectedIndex=0;}this.setActive(this.selectedIndex);},disable:function(){this.$el.addClass('disabled');},setActive:function(idx){this.clearActive();var selector=null;if(typeof idx=='number'){selector='li:not(.'+this.options.dividerClass+',.label):eq('+idx+')';if(mw.getConfig("EmbedPlayer.EnableMobileSkin")&&mw.isMobileDevice()){this.mobileMenu.get(0).selectedIndex=idx;}}else{selector='li['+idx.key+'='+idx.val+']';if(mw.getConfig("EmbedPlayer.EnableMobileSkin")&&mw.isMobileDevice()){this.mobileMenu.val(this.$el.find(selector).text());}}this.$el.find(selector).addClass('active').attr('aria-checked','true');this.$el.find(selector+" a").focus();if(mw.isIE8()){this.$el.addClass('dummy').removeClass('dummy');}},clearActive:function(){this.$el.find('li').removeClass('active').attr('aria-checked','false');},destroy:function(){this.$el.empty();this.itemIdx=0;if(mw.getConfig("EmbedPlayer.EnableMobileSkin")&&mw.isMobileDevice()&&this.mobileMenu){this.mobileMenu.find('option').remove().end();}},numOfChildren:function(){return this.itemIdx;}};})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mediawiki.language",function($){window.originalVTTCue=window.VTTCue;mediaWiki.language={'pluralProcessor':function(template){if(template.arg&&template.parameters&&mediaWiki.language.convertPlural){if(template.parameters.length==0){return'';}var count=mediaWiki.language.convertNumber(template.arg,true);return mediaWiki.language.convertPlural(parseInt(count),template.parameters);}if(template.parameters[0]){return template.parameters[0];}return'';},'convertPlural':function(count,forms){if(!forms||forms.length==0){return'';}return(parseInt(count)==1)?forms[0]:forms[1];},'preConvertPlural':function(forms,count){while(forms.length<count){forms.push(forms[forms.length-1]);}return forms;},'convertNumber':function(number,integer){if(!mediaWiki.language.digitTransformTable){return number;}var transformTable=mediaWiki.language.digitTransformTable;if(integer){if(parseInt(number)==number){return number;}var tmp=[];for(var i in transformTable){tmp[transformTable[i]]=i;}transformTable=tmp;}var numberString=''+number;var convertedNumber='';for(var i=0;i<numberString.length;i++){if(transformTable[numberString[i]]){convertedNumber+=transformTable[numberString[i]];}else{convertedNumber+=numberString[i];}}return integer?parseInt(convertedNumber):convertedNumber;},'digitTransformTable':null};;},{},{});mw.loader.implement("mediawiki.util",function($){(function($,mw){"use strict";var formatersStorage={};var util={init:function(){var profile,$tocTitle,$tocToggleLink,hideTocCookie;$.messageBoxNew({id:'mw-js-message',parent:'#content'});profile=$.client.profile();if(profile.name==='opera'){util.tooltipAccessKeyPrefix='shift-esc-';}else if(profile.name==='chrome'){util.tooltipAccessKeyPrefix=(profile.platform==='mac'?'ctrl-option-':profile.platform==='win'?'alt-shift-':'alt-');}else if(profile.platform!=='win'&&profile.name==='safari'&&profile.layoutVersion>526){util.tooltipAccessKeyPrefix='ctrl-alt-';}else if(!(profile.platform==='win'&&profile.name==='safari')&&(profile.name==='safari'||profile.platform==='mac'||profile.name==='konqueror')){util.tooltipAccessKeyPrefix='ctrl-';}else if(profile.name==='firefox'&&profile.versionBase>'1'){util.tooltipAccessKeyPrefix='alt-shift-';}if($('#bodyContent').length){util.$content=$('#bodyContent');}else if($('#mw_contentholder').length){util.$content=$('#mw_contentholder');}else if($('#article').length){util.$content=$('#article');}else{util.$content=$('#content');}$tocTitle=$('#toctitle');$tocToggleLink=$('#togglelink');if($('#toc').length&&$tocTitle.length&&!$tocToggleLink.length){hideTocCookie=$.cookie('mw_hidetoc');$tocToggleLink=$('<a href="#" class="internal" id="togglelink"></a>').text(mw.msg('hidetoc')).click(function(e){e.preventDefault();util.toggleToc($(this));});$tocTitle.append($tocToggleLink.wrap('<span class="toctoggle"></span>').parent().prepend('&nbsp;[').append(']&nbsp;'));if(hideTocCookie==='1'){util.toggleToc($tocToggleLink);}}},rawurlencode:function(str){str=String(str);return encodeURIComponent(str).replace(/!/g,'%21').replace(/'/g,'%27').replace(/\(/g,'%28').replace(/\)/g,'%29').replace(/\*/g,'%2A').replace(/~/g,'%7E');},wikiUrlencode:function(str){return util.rawurlencode(str).replace(/%20/g,'_').replace(/%3A/g,':').replace(/%2F/g,'/');},wikiGetlink:function(str){return mw.config.get('wgArticlePath').replace('$1',util.wikiUrlencode(typeof str==='string'?str:mw.config.get('wgPageName')));},wikiScript:function(str){return mw.config.get('wgScriptPath')+'/'+(str||'index')+mw.config.get('wgScriptExtension');},addCSS:function(text){var s=mw.loader.addStyleTag(text);return s.sheet||s;},toggleToc:function($toggleLink,callback){var $tocList=$('#toc ul:first');if($tocList.length){if($tocList.is(':hidden')){$tocList.slideDown('fast',callback);$toggleLink.text(mw.msg('hidetoc'));$('#toc').removeClass('tochidden');$.cookie('mw_hidetoc',null,{expires:30,path:'/'});return true;}else{$tocList.slideUp('fast',callback);$toggleLink.text(mw.msg('showtoc'));$('#toc').addClass('tochidden');$.cookie('mw_hidetoc','1',{expires:30,path:'/'});return false;}}else{return null;}},getParamValue:function(param,url){url=url||document.location.href;var re=new RegExp('^[^#]*[&?]'+$.escapeRE(param)+'=([^&#]*)'),m=re.exec(url);if(m){return decodeURIComponent(m[1].replace(/\+/g,'%20'));}return null;},tooltipAccessKeyPrefix:'alt-',tooltipAccessKeyRegexp:/\[(ctrl-)?(alt-)?(shift-)?(esc-)?(.)\]$/,updateTooltipAccessKeys:function($nodes){if(!$nodes){$nodes=$('#column-one a, #mw-head a, #mw-panel a, #p-logo a, input, label');}else if(!($nodes instanceof $)){$nodes=$($nodes);}$nodes.attr('title',function(i,val){if(val&&util.tooltipAccessKeyRegexp.exec(val)){return val.replace(util.tooltipAccessKeyRegexp,'['+util.tooltipAccessKeyPrefix+'$5]');}return val;});},$content:null,addPortletLink:function(portlet,href,text,id,tooltip,accesskey,nextnode){var $item,$link,$portlet,$ul;if(arguments.length<3){return null;}$link=$('<a>').attr('href',href).text(text);if(tooltip){$link.attr('title',tooltip);}switch(mw.config.get('skin')){case'standard':case'cologneblue':$('#quickbar').append($link.after('<br/>'));return $link[0];case'nostalgia':$('#searchform').before($link).before(' &#124; ');return $link[0];default:$portlet=$('#'+portlet);if($portlet.length===0){return null;}$ul=$portlet.find('ul').eq(0);if($ul.length===0){$ul=$('<ul>');if($portlet.find('div:first').length===0){$portlet.append($ul);}else{$portlet.find('div').eq(-1).append($ul);}}if($ul.length===0){return null;}$portlet.removeClass('emptyPortlet');if($portlet.hasClass('vectorTabs')){$item=$link.wrap('<li><span></span></li>').parent().parent();}else{$item=$link.wrap('<li></li>').parent();}if(id){$item.attr('id',id);}if(accesskey){$link.attr('accesskey',accesskey);tooltip+=' ['+accesskey+']';$link.attr('title',tooltip);}if(accesskey&&tooltip){util.updateTooltipAccessKeys($link);}if(nextnode&&nextnode.parentNode===$ul[0]){$(nextnode).before($item);}else if(typeof nextnode==='string'&&$ul.find(nextnode).length!==0){$ul.find(nextnode).eq(0).before($item);}else{$ul.append($item);}return $item[0];}},jsMessage:function(message,className){if(!arguments.length||message===''||message===null){$('#mw-js-message').empty().hide();return true;}else{var $messageDiv=$('#mw-js-message');if(!$messageDiv.length){$messageDiv=$('<div id="mw-js-message"></div>');if(util.$content.parent().length){util.$content.parent().prepend($messageDiv);}else{return false;}}if(className){$messageDiv.prop('class','mw-js-message-'+className);}if(typeof message==='object'){$messageDiv.empty();$messageDiv.append(message);}else{$messageDiv.html(message);}$messageDiv.slideDown();return true;}},validateEmail:function(mailtxt){var rfc5322_atext,rfc1034_ldh_str,HTML5_email_regexp;if(mailtxt===''){return null;}rfc5322_atext="a-z0-9!#$%&'*+\\-/=?^_`{|}~";rfc1034_ldh_str="a-z0-9\\-";HTML5_email_regexp=new RegExp('^'+'['+rfc5322_atext+'\\.]+'+'@'+'['+rfc1034_ldh_str+']+'+'(?:\\.['+rfc1034_ldh_str+']+)*'+'$','i');return(null!==mailtxt.match(HTML5_email_regexp));},isIPv4Address:function(address,allowBlock){if(typeof address!=='string'){return false;}var block=allowBlock?'(?:\\/(?:3[0-2]|[12]?\\d))?':'',RE_IP_BYTE='(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|0?[0-9]?[0-9])',RE_IP_ADD='(?:'+RE_IP_BYTE+'\\.){3}'+RE_IP_BYTE;return address.search(new RegExp('^'+RE_IP_ADD+block+'$'))!==-1;},isIPv6Address:function(address,allowBlock){if(typeof address!=='string'){return false;}var block=allowBlock?'(?:\\/(?:12[0-8]|1[01][0-9]|[1-9]?\\d))?':'',RE_IPV6_ADD='(?:'+':(?::|(?::'+'[0-9A-Fa-f]{1,4}'+'){1,7})'+'|'+'[0-9A-Fa-f]{1,4}'+'(?::'+'[0-9A-Fa-f]{1,4}'+'){0,6}::'+'|'+'[0-9A-Fa-f]{1,4}'+'(?::'+'[0-9A-Fa-f]{1,4}'+'){7}'+')';if(address.search(new RegExp('^'+RE_IPV6_ADD+block+'$'))!==-1){return true;}RE_IPV6_ADD='[0-9A-Fa-f]{1,4}'+'(?:::?'+'[0-9A-Fa-f]{1,4}'+'){1,6}';return address.search(new RegExp('^'+RE_IPV6_ADD+block+'$'))!==-1&&address.search(/::/)!==-1&&address.search(/::.*::/)===-1;},formaters:function(){var registerOne=function(name,callback){if(typeof name!=='string'){mw.log('mw.util.formaters.registerOne: name parameter must be a string, '+typeof name+' given');return;}if(!$.isFunction(callback)){mw.log('mw.util.formaters.registerOne: callback parameter must be a function, '+typeof callback+' given');return;}if($.isFunction(formatersStorage[name])){mw.log('mw.util.formaters.registerOne: callback: "'+name+'" already exists.');return;}formatersStorage[name]=callback;};return{register:function(name,callback){if($.isPlainObject(name)){$.each(name,registerOne);}else{registerOne(name,callback);}},get:function(name){if(!$.isFunction(formatersStorage[name])){throw new Exception("Formater: "+name+" does not exists, make sure to register it first with mw.util.formaters().register(name,callback)");}return formatersStorage[name];},getAll:function(){return formatersStorage;},exists:function(name){return $.isFunction(formatersStorage[name]);}};}};mw.util=util;})(jQuery,mediaWiki);;},{},{"showtoc":"[showtoc]","hidetoc":"[hidetoc]"});mw.loader.implement("mediawiki.util.tmpl",function($){(function($,mw){"use strict";mw.util.registerTemplateHelper=function(name,callback){mw.log('[Deprecated] mw.util.registerTemplateHelper is deprecated. please use mw.util.formaters().register method');mw.util.formaters().register(name,callback);};var isObject=function(obj){var type=typeof obj;return type==='function'||type==='object'&&!!obj;};var defaults=function(obj){if(!isObject(obj))return obj;for(var i=1,length=arguments.length;i<length;i++){var source=arguments[i];for(var prop in source){if(obj[prop]===void 0)obj[prop]=source[prop];}}return obj;};var templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'",'\\':'\\','\r':'r','\n':'n','\u2028':'u2028','\u2029':'u2029'};var escaper=/\\|'|\r|\n|\u2028|\u2029/g;var escapeChar=function(match){return'\\'+escapes[match];};mw.util.tmpl=function(text,settings,oldSettings){if(!settings&&oldSettings)settings=oldSettings;settings=defaults({},settings,templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join('|')+'|$','g');var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,escapeChar);index=offset+match.length;if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'";}else if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'";}else if(evaluate){source+="';\n"+evaluate+"\n__p+='";}return match;});source+="';\n";if(!settings.variable)source='with(obj||{}){\n'+source+'}\n';source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+'return __p;\n';try{var render=new Function(settings.variable||'obj','_',source);}catch(e){e.source=source;throw e;}var template=function(data){return render.call(this,data);};var argument=settings.variable||'obj';template.source='function('+argument+'){\n'+source+'}';return template;};})(jQuery,mediaWiki);;},{},{});mw.loader.implement("mw.AdLoader",function($){(function(mw,$){"use strict";mw.AdLoader=function(embedPlayer){return this.init(embedPlayer);};mw.AdLoader.prototype={maxRedirects:5,currentCounter:0,init:function(embedPlayer){this.embedPlayer=embedPlayer;},load:function(adUrl,callback,wrapped,wrapperData,ajaxOptions){var _this=this;if(wrapperData==null){wrapperData=[];}adUrl=_this.replaceCacheBuster(adUrl);adUrl=$.trim(adUrl);mw.log('AdLoader :: load Ad: ',adUrl);if(wrapped){this.currentCounter++;}else{this.currentCounter=0;}if(this.currentCounter>=this.maxRedirects){mw.log("Error: The allowed number of redirects is "+this.maxRedirects);callback({});return;}new mw.ajaxProxy({url:adUrl,ajaxOptions:ajaxOptions,success:function(resultXML){_this.handleResult(resultXML,callback,wrapperData,ajaxOptions);},error:function(error){mw.log("Error: AdLoader failed to load:"+adUrl);callback({});}});},handleResult:function(data,callback,wrapperData,ajaxOptions){var _this=this;if(typeof data==='string'){var xmlPosition=data.indexOf("<?xml");if(xmlPosition>0){var junk=data.substr(0,xmlPosition);data=data.replace(junk,'');}try{data=$.parseXML(data);}catch(error){}}switch(_this.getAdFormat(data)){case'vast':mw.load('mw.VastAdParser',function(){mw.VastAdParser.parse(data,callback,wrapperData,ajaxOptions,_this);});return;break;}mw.log("Error: could not parse adFormat from add content: \n"+data);callback(false);},getAdFormat:function(xmlObject){if(xmlObject&&xmlObject.childNodes){var childNodes=xmlObject.childNodes,node,nodeNameLC;for(var i=0,iMax=childNodes.length;i<iMax;i++){node=xmlObject.childNodes[i];if(node.nodeType===1){nodeNameLC=node.nodeName.toLowerCase();if(nodeNameLC==="xml"&&i<iMax-1){continue;}if(nodeNameLC==='vast'||nodeNameLC==='videoadservingtemplate'){return'vast';}else{break;}}}}return'unknown';},replaceCacheBuster:function(adUrl){var cacheBusters=['[timestamp]','[cachebuster]','[random]','[randnum]'];var timestamp=Math.round(+new Date()/1000);for(var i=0;i<cacheBusters.length;i++){adUrl=adUrl.replace(cacheBusters[i],timestamp);}return adUrl;}};})(window.mw,jQuery);;},{},{});mw.loader.implement("mw.AdTimeline",function($){(function(mw,$){"use strict";mw.addAdTimeline=function(embedPlayer){embedPlayer.adTimeline=new mw.AdTimeline(embedPlayer);};mw.AdTimeline=function(embedPlayer){return this.init(embedPlayer);};mw.AdTimeline.prototype={adOverlaysEnabled:true,originalSource:false,firstPlay:true,bindPostfix:'.AdTimeline',pendingSeek:false,currentAdSlotType:null,init:function(embedPlayer){this.embedPlayer=embedPlayer;this.bindPlayer();},updateSequenceProxy:function(propName,value){this.embedPlayer.sequenceProxy[propName]=value;},bindPlayer:function(){var _this=this;var embedPlayer=this.embedPlayer;_this.originalSource=embedPlayer.getSource();_this.destroy();embedPlayer.sequenceProxy={'isInSequence':false,'timeRemaining':0,'duration':0,'skipOffsetRemaining':0};embedPlayer.bindHelper('onChangeMedia'+_this.bindPostfix,function(){_this.destroy();});_this.displayedSlotCount=0;embedPlayer.bindHelper('preSequence'+_this.bindPostfix,function(){var orgDuration=embedPlayer.duration;embedPlayer.triggerHelper('AdSupport_PreSequence');embedPlayer.unbindHelper("preSeek"+_this.bindPostfix).bindHelper("preSeek"+_this.bindPostfix,function(e,seekTime,stopAfterSeek,stopSeek){mw.log('AdTimeline::preSeek : prevented seek during ad playback');embedPlayer.unbindHelper("preSeek"+_this.bindPostfix);stopSeek.value=true;_this.pendingSeek=true;_this.pendingSeekData={seekTime:seekTime,stopAfterSeek:stopAfterSeek};});var playedAnLinearAdFlag=false;embedPlayer.bindHelper('onAdOpen'+_this.bindPostfix,function(e,adId,adSystem,AdSlotType,adPosition,linear){mw.log("AdTimeline:: set Played an linear ad flag to "+linear);playedAnLinearAdFlag=linear;});var playedAnAdFlag=false;embedPlayer.bindHelper('AdSupport_StartAdPlayback'+_this.bindPostfix,function(){mw.log("AdTimeline:: set Played an ad flag to true");playedAnAdFlag=true;});mw.log("AdTimeline:: load ads, trigger: AdSupport_OnPlayAdLoad");embedPlayer.pauseLoading();embedPlayer.triggerQueueCallback('AdSupport_OnPlayAdLoad',function(){mw.log("AdTimeline:: AdSupport_OnPlayAdLoad ");_this.displaySlots('preroll',function(){if(_this.displayedSlotCount>0&&!$.isEmptyObject(_this.getSequenceProxy('bumper'))){_this.embedPlayer.triggerHelper('AdSupport_EndAdPlayback','preroll');}_this.displaySlots('bumperPreSeq',function(){var completeFunc=function(){embedPlayer.sequenceProxy.isInSequence=false;embedPlayer.triggerHelper('AdSupport_PreSequenceComplete');if(playedAnAdFlag){_this.displayedSlotCount=0;}_this.restorePlayer(null,playedAnAdFlag);embedPlayer.setDuration(orgDuration);if(playedAnAdFlag||!playedAnLinearAdFlag){embedPlayer.play();}};if(!embedPlayer.isVideoSiblingEnabled()){embedPlayer.switchPlaySource(_this.originalSource,completeFunc);}else{completeFunc();}});});});if(embedPlayer.seeking){setTimeout(function(){embedPlayer.stopEventPropagation();},100);}});var displayedPostroll=false;embedPlayer.bindHelper('ended'+_this.bindPostfix,function(event){if(embedPlayer.isInSequence()||(embedPlayer.replayEventCount>0&&!embedPlayer.adsOnReplay)){return;}if(displayedPostroll){displayedPostroll=false;return;}var playedAnAdFlag=false;embedPlayer.bindHelper('AdSupport_StartAdPlayback'+_this.bindPostfix,function(){playedAnAdFlag=true;});displayedPostroll=true;mw.log('AdTimeline:: AdSupport_StartAdPlayback set onDoneInterfaceFlag = false');embedPlayer.onDoneInterfaceFlag=false;embedPlayer.keepNativeFullScreen=true;setTimeout(function(){embedPlayer.triggerHelper('AdSupport_PostSequence');_this.displaySlots('bumperPostSeq',function(){_this.displaySlots('postroll',function(){embedPlayer.sequenceProxy.isInSequence=false;embedPlayer.triggerHelper('AdSupport_PostSequenceComplete');function onPostRollDone(){_this.restorePlayer("postroll",playedAnAdFlag);embedPlayer.onDoneInterfaceFlag=true;embedPlayer.stopped=false;embedPlayer.keepNativeFullScreen=false;embedPlayer.onClipDone();}if(playedAnAdFlag&&!embedPlayer.isVideoSiblingEnabled()){embedPlayer.switchPlaySource(_this.originalSource,function(video){if(video){video.pause();if(!mw.isChromeCast()){$(video).bind('play.postSequenceComplete',function(){video.pause();$(video).unbind('.postSequenceComplete');});}}onPostRollDone();});}else{onPostRollDone();}});});},0);});},destroy:function(){var _this=this;_this.firstPlay=true;$(_this.embedPlayer).unbind(_this.bindPostfix);},getSequenceProxy:function(slotType){var sequenceProxy={};this.embedPlayer.triggerHelper('AdSupport_'+slotType,[sequenceProxy]);this.embedPlayer.triggerHelper("AdSupport_SequnceProxyBuildDone",[slotType,sequenceProxy]);return sequenceProxy;},displaySlots:function(slotType,doneCallback){var _this=this;var sequenceProxy=_this.getSequenceProxy(slotType);var keyList=[];$.each(sequenceProxy,function(k,na){keyList.push(k);});mw.log("AdTimeline:: displaySlots: "+slotType+' found sequenceProxy length: '+keyList.length);if(!keyList.length){doneCallback();return;}keyList.sort();var seqInx=0;var runSequeceProxyInx=function(seqInx){var key=keyList[seqInx];if(!sequenceProxy[key]){doneCallback();return;}_this.embedPlayer.sequenceProxy.isInSequence=true;sequenceProxy[key](function(){_this.displayedSlotCount++;seqInx++;runSequeceProxyInx(seqInx);});};runSequeceProxyInx(seqInx);},updateUiForAdPlayback:function(slotType){if(!slotType){mw.log("Error:: please supply an ad type, "+slotType+' provided.');slotType='';}mw.log("AdTimeline:: updateUiForAdPlayback: slotType:"+slotType);var embedPlayer=this.embedPlayer;if(!embedPlayer){return;}this.currentAdSlotType=slotType;embedPlayer.stopEventPropagation();var components=['fullScreenBtn','logo','volumeControl'];if(mw.getConfig('enableControlsDuringAd')){components.push('playPauseBtn');}embedPlayer.disablePlayControls(components);embedPlayer.playInterfaceUpdate();embedPlayer.hideSpinner();if(!embedPlayer.isVideoSiblingEnabled()){embedPlayer.removePoster();}embedPlayer.sequenceProxy.isInSequence=true;mw.log('AdTimeline:: trigger: AdSupport_'+slotType+'Started');embedPlayer.triggerHelper('AdSupport_'+slotType+'Started');mw.log('AdTimeline:: trigger: AdSupport_'+slotType.replace('roll','')+'SequenceStart');embedPlayer.triggerHelper('AdSupport_'+slotType.replace('roll','')+'SequenceStart');mw.log('AdTimeline:: trigger: AdSupport_StartAdPlayback');embedPlayer.triggerHelper('AdSupport_StartAdPlayback',slotType);},restorePlayer:function(slotType,playedAd){if(!this.currentAdSlotType){mw.log("Error:: AdTimeline missing currentAdSlotType on player restore ( assume preroll )");this.currentAdSlotType='preroll';}if(!slotType){slotType=this.currentAdSlotType;}mw.log("AdTimeline:: restorePlayer ");var embedPlayer=this.embedPlayer;if(!embedPlayer){return;}embedPlayer.restoreEventPropagation();if(this.pendingSeek){this.pendingSeek=false;mw.log('AdTimeline:: Seek back to preSeek time');embedPlayer.seek(this.pendingSeekData.seekTime,this.pendingSeekData.stopAfterSeek);}else{embedPlayer.unbindHelper("preSeek"+this.bindPostfix);}embedPlayer.enablePlayControls();embedPlayer.seeking=false;embedPlayer.sequenceProxy.isInSequence=false;if(!mw.isNativeApp()&&!embedPlayer.isVideoSiblingEnabled()){embedPlayer.updatePosterHTML();}if(playedAd){mw.log('AdTimeline:: trigger: AdSupport_EndAdPlayback');embedPlayer.triggerHelper('AdSupport_EndAdPlayback',this.currentAdSlotType);mw.log('AdTimeline:: trigger: AdSupport_'+slotType.replace('roll','')+'SequenceComplete')
embedPlayer.triggerHelper('AdSupport_'+slotType.replace('roll','')+'SequenceComplete');}}};})(window.mw,jQuery);;},{},{});mw.loader.implement("mw.AkamaiMediaAnalytics",function($){(function(mw,$){"use strict";mw.AkamaiMediaAnalytics=function(embedPlayer,callback){return this.init(embedPlayer,callback);}
mw.AkamaiMediaAnalytics.prototype={bindPostFix:'.akamaiMediaAnalytics',defaultConfigPath:'http://ma193-r.analytics.edgesuite.net/config/beacon-3431.xml?beaconSentNotify=1',defaultConfigPathHTTPS:'https://ma193-r.analytics.edgekey.net/config/beacon-3898.xml?beaconSentNotify=1',defaultJS:'http://79423.analytics.edgesuite.net/html5/akamaihtml5-min.js',defaultJSHTTPS:'https://79423.analytics.edgekey.net/html5/akamaihtml5-min.js',defaultSWF:'http://79423.analytics.edgesuite.net/csma/plugin/csma.swf',defaultSWFHTTPS:'https://79423.analytics.edgekey.net/csma/plugin/csma.swf',init:function(embedPlayer,callback){var _this=this;this.embedPlayer=embedPlayer;this.embedPlayer.unbindHelper(_this.bindPostFix);this.embedPlayer.bindHelper('PlayerLoaded'+_this.bindPostFix,function(){if(embedPlayer.selectedPlayer.library=='Kplayer'){_this.sendDataToKPlayer(embedPlayer);}else{if(typeof setAkamaiMediaAnalyticsData=='function'){_this.setData(embedPlayer);}else{var jsSrc=_this.defaultJS;if(_this.isHttps()){jsSrc=_this.defaultJSHTTPS;}kWidget.appendScriptUrl(jsSrc,function(){_this.setData(embedPlayer);},window.document);}}});var configPath=_this.getConfigPath();window.AKAMAI_MEDIA_ANALYTICS_CONFIG_FILE_PATH=configPath;if(mw.getConfig('EmbedPlayer.IsFriendlyIframe')){try{window.parent.AKAMAI_MEDIA_ANALYTICS_CONFIG_FILE_PATH=configPath;}catch(e){}}var swfPath=_this.getConfig('swfPath')||_this.defaultSWF;var securedSwfPath=_this.getConfig('securedSwfPath')||_this.defaultSWFHTTPS;var configPath=_this.getConfig('configPath')||_this.defaultConfigPath;var securedConfigPath=_this.getConfig('securedConfigPath')||_this.defaultConfigPathHTTPS;var kdpVars=embedPlayer.getKalturaConfig('kdpVars',null)||{};kdpVars.akamaiMediaAnalytics={plugin:'true',asyncInit:'true',secured:_this.isHttps(),configPath:configPath,securedConfigPath:securedConfigPath,swfPath:swfPath,securedSwfPath:securedSwfPath}
embedPlayer.setKalturaConfig('kdpVars',kdpVars);callback();},getAkamaiDataObject:function(embedPlayer){var flavorSrc=embedPlayer.getSource();var flavorURL='';if(flavorSrc){flavorURL=flavorSrc.src;}var startIndex=flavorURL.indexOf('/flavorId/')+10;var flavorId=flavorURL.substr(startIndex,flavorURL.indexOf('/format/')-startIndex);var dataObject={'publisherId':embedPlayer.kpartnerid,'title':this.getConfig('title')||embedPlayer.kentryid,'playerId':this.getConfig('playerId')||embedPlayer.kuiconfid,'flavorId':flavorId,'playerVersion':MWEMBED_VERSION,'category':this.getConfig('category')||this.getMediaTypeName(),'contentLength':embedPlayer.evaluate('{mediaProxy.entry.msDuration}'),'device':navigator.platform,'deliveryType':'O'}
if(embedPlayer.isLive()){dataObject.deliveryType='L';}this.setDataIfExsits('subCategory',dataObject);this.setDataIfExsits('eventName',dataObject);return dataObject;},setData:function(embedPlayer){var _this=this;var dataObject=this.getAkamaiDataObject(embedPlayer);$.each(dataObject,function(key,element){_this.sendAkamaiData(key,element);});this.doOnPlayerLoadReady(embedPlayer,function(){_this.sendAkamaiData('playerLoadtime',embedPlayer.evaluate('{playerStatusProxy.loadTime}'));});},doOnPlayerLoadReady:function(embedPlayer,callback){if(embedPlayer.evaluate('{playerStatusProxy.loadTime}')){callback();}else{embedPlayer.bindHelper('playerReady.AkamaiMediaAnalytics',function(){setTimeout(function(){callback();},0);});}},sendDataToKPlayer:function(embedPlayer){var _this=this;var dataObject=this.getAkamaiDataObject(embedPlayer);$.each(dataObject,function(key,element){_this.sendEventLog(key,element);});this.doOnPlayerLoadReady(embedPlayer,function(){if(embedPlayer.selectedPlayer.library!='Kplayer'){return;}dataObject['playerLoadtime']=embedPlayer.evaluate('{playerStatusProxy.loadTime}');_this.sendEventLog('playerLoadtime',dataObject['playerLoadtime']);if(embedPlayer.getPlayerElement()){embedPlayer.getPlayerElement().sendNotification('setMediaAnalyticsData',dataObject);}});},sendAkamaiData:function(eventId,data){setAkamaiMediaAnalyticsData(eventId,data);this.sendEventLog(eventId,data);},sendEventLog:function(eventId,data){if(this.getConfig('trackEventMonitor')){try{window.parent[this.getConfig('trackEventMonitor')](eventId,data);}catch(e){}}},getConfigPath:function(){if(this.isHttps()){return this.getConfig('securedConfigPath')||this.defaultConfigPathHTTPS;}return this.getConfig('configPath')||this.defaultConfigPath;},getConfig:function(attr){return this.embedPlayer.getKalturaConfig('akamaiMediaAnalytics',attr);},setDataIfExsits:function(attr,obj){var attrVal=this.getConfig(attr);if(attrVal!==null)obj[attr]=attrVal;},getMediaTypeName:function(){switch(this.embedPlayer.evaluate('{mediaProxy.entry.mediaType}')){case 2:return'Image';break;case 5:return'Audio';break;case 201:return'Live_Stream_Flash';break;case 202:return'Live_Stream_Windows_Media';break;case 203:return'Live_Stream_Real_Media';break;case 204:return'Live_Stream_Quicktime';break;}return'Video';},isHttps:function(){return(document.location.protocol=='https:');}};})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mw.BaseAdPlugin",function($){(function(mw,$){"use strict";mw.BaseAdPlugin=function(embedPlayer,callback){return this.init(embedPlayer,callback);};mw.BaseAdPlugin.prototype={init:function(embedPlayer,callback){this.embedPlayer=embedPlayer;return this;},getSequenceIndex:function(slotType){var _this=this;if(slotType=='preroll'&&_this.getConfig('preSequence')){return _this.getConfig('preSequence');}if(slotType=='postroll'&&_this.getConfig('postSequence')){return _this.getConfig('postSequence');}return 1;},destroy:function(){$(this.embedPlayer).unbind(this.bindPostfix);}};})(window.mw,jQuery);;},{},{});mw.loader.implement("mw.Comscore",function($){(function(mw,$){"use strict";mw.Comscore=function(embedPlayer,callback){this.init(embedPlayer,callback);};mw.Comscore.prototype={pluginVersion:"1.1",prerollAdContentType:"09",postrollAdContentType:"10",midrollAdContentType:"11",inBannerVideoAd:"12",loadedXML:false,bindPostfix:'.Comscore',cParams:{c1:"1",c2:"",c3:"",c4:"",c5:"",c6:"",c10:""},currentSegment:0,init:function(embedPlayer,callback){this.embedPlayer=embedPlayer;this.setupConfig();this.loadXML(callback);},setupConfig:function(){var attributes=['cTagsMap'];for(var i=2;i<10;i++){if(i>6&&i<10)continue;attributes.push('c'+i);attributes.push('c'+i+'attributeKey');attributes.push('c'+i+'attributeValue');attributes.push('c'+i+'Value');}this.config=this.embedPlayer.getKalturaConfig('comscore',attributes);},loadXML:function(callback){var _this=this;if(this.config.cTagsMap){mw.log('Comscore:: Retrive Comscore xml file from: '+_this.config.cTagsMap);new mw.ajaxProxy({url:_this.config.cTagsMap,success:function(resultXML){_this.handleXMLResult(resultXML,callback);},error:function(){mw.log("Comscore:: Error: failed to load: "+_this.config.cTagsMap);_this.addPlayerBindings(callback);}});}else{this.addPlayerBindings(callback);}},handleXMLResult:function(xml,callback){var _this=this;mw.log('Comscore:: loaded xml successfully, setup cparams & player bindings');try{_this.$xml=$(xml);_this.loadedXML=true;}catch(e){}_this.addPlayerBindings(callback);},addPlayerBindings:function(callback){var _this=this;var embedPlayer=this.embedPlayer;var cParams=_this.cParams;embedPlayer.unbindHelper(_this.bindPostfix);var shouldSendBeacon=false;var sendOnSequnceEnd=false;var playerPlayedFired=false;this.setupCParams();embedPlayer.bindHelper('onChangeMedia'+_this.bindPostfix,function(){_this.destroy();});embedPlayer.bindHelper('KalturaSupport_EntryDataReady'+this.bindPostfix,function(){playerPlayedFired=false;shouldSendBeacon=false;sendOnSequnceEnd=false;_this.currentSegment=0;_this.setupCParams();});embedPlayer.bindHelper('onplay'+this.bindPostfix,function(){if(!playerPlayedFired&&!_this.inAd()){playerPlayedFired=true;_this.currentSegment++;cParams["c5"]=_this.parseCAttribute('c5');mw.log('Comscore:: Send Content Start Beacon');_this.comScoreBeacon(cParams);}});embedPlayer.bindHelper('KalturaSupport_AdOpportunity'+this.bindPostfix,function(event,cuePoint){if(embedPlayer.kCuePoints.getAdSlotType(cuePoint)==='midroll'){_this.currentSegment++;setTimeout(function(){shouldSendBeacon=true;},mw.getConfig('EmbedPlayer.MonitorRate'));}});embedPlayer.bindHelper('AdSupport_StartAdPlayback'+this.bindPostfix,function(event,adType){switch(adType){case'preroll':cParams["c5"]=_this.prerollAdContentType;break;case'postroll':cParams["c5"]=_this.postrollAdContentType;break;case'midroll':cParams["c5"]=_this.midrollAdContentType;sendOnSequnceEnd=true;break;}mw.log('Comscore:: Send Ad Start Beacon');_this.comScoreBeacon(cParams);shouldSendBeacon=false;});embedPlayer.bindHelper('AdSupport_EndAdPlayback'+this.bindPostfix,function(){if(sendOnSequnceEnd){cParams["c5"]=_this.parseCAttribute('c5');mw.log('Comscore:: Send Ad End Beacon (Resume Content)');_this.comScoreBeacon(cParams);sendOnSequnceEnd=false;}});embedPlayer.bindHelper('monitorEvent'+this.bindPostfix,function(){if(shouldSendBeacon){cParams["c5"]=_this.parseCAttribute('c5');mw.log('Comscore:: Send Resume Content Beacon (No Ad)');_this.comScoreBeacon(cParams);shouldSendBeacon=false;}});callback();},setupCParams:function(){mw.log('Comscore:: Setup CParams');var cParams=this.cParams;for(var i=2;i<10;i++){if(i>6&&i<10)continue;cParams['c'+i]=this.parseCAttribute('c'+i);}},parseCAttribute:function(cName){var _this=this;var config=this.config;var $xml=this.$xml;var returnValue=config[cName];if(_this.loadedXML&&config[cName+"attributeKey"]){var attributeKey=config[cName+"attributeKey"];var attributeValue=config[cName+"attributeValue"];var value=config[cName+"Value"];if(!attributeKey||!attributeValue||!value)return returnValue;var map={};$xml.find(cName).children().each(function(idx,node){map[$(node).attr(attributeKey)]=$(node).attr(attributeValue);});if(map[value]){return map[value];}}return returnValue;},getC10:function(){if(!this.embedPlayer.kCuePoints){return"1-1";}var adsCount=this.embedPlayer.kCuePoints.getCuePointsCount('midroll');if(adsCount==0){return"1-1";}else{return this.currentSegment+"-"+(parseInt(adsCount)+1);}},comScoreBeacon:function(beaconObject){var _this=this;var loadUrl=(document.location.protocol=="https:"?"https://sb.":"http://b.");loadUrl+="scorecardresearch.com/p?";if(mw.getConfig('EmbedPlayer.IframeParentUrl')){beaconObject["c7"]=mw.getConfig('EmbedPlayer.IframeParentUrl');}if(mw.getConfig('EmbedPlayer.IframeParentTitle')){beaconObject["c8"]=mw.getConfig('EmbedPlayer.IframeParentTitle');}if(mw.getConfig('EmbedPlayer.IframeParentReferrer')){beaconObject["c9"]=mw.getConfig('EmbedPlayer.IframeParentReferrer');}beaconObject["c10"]=_this.getC10();for(var cParam in beaconObject){if(beaconObject[cParam]){loadUrl+=cParam+"="+encodeURIComponent(beaconObject[cParam])+"&";}}if(this.config['trackEventMonitor']){if(parent[this.config['trackEventMonitor']]){parent[this.config['trackEventMonitor']](beaconObject);}}loadUrl+="rn="+Math.random().toString()+"&";loadUrl+="cv="+_this.pluginVersion;mw.sendBeaconUrl(loadUrl);mw.log('Comscore:: Sent Beacon: '+loadUrl,beaconObject);},destroy:function(){$(this.embedPlayer).unbind(this.bindPostfix);},inAd:function(){return!!this.embedPlayer.evaluate('{sequenceProxy.isInSequence}');}};})(window.mw,jQuery);;},{},{});mw.loader.implement("mw.DoubleClick",function($){(function(mw,$){"use strict";mw.DoubleClick=function(embedPlayer,callback,pluginName){this.init(embedPlayer,callback,pluginName);};mw.DoubleClick.prototype={bindPostfix:'.DoubleClick',content:null,globalVolume:1,adsLoader:null,adsManager:null,adActive:false,adPaused:false,adMonitor:null,adSkippable:null,shouldPausePlaylist:false,adPreviousTimeLeft:null,contentPlaying:false,adDuration:null,demoStartTime:null,isChromeless:false,isNativeSDK:false,entryDuration:null,contentDoneFlag:null,startedAdPlayback:null,allAdsCompletedFlag:null,adLoaderErrorFlag:false,playerElementLoaded:false,currentAdSlotType:null,adClickEvent:null,isAdClickTimeoutEnabled:false,imaLoaded:false,prePlayActionTriggered:false,saveTimeWhenSwitchMedia:false,timeToReturn:null,cust_params:null,playingLinearAd:false,leadWithFlash:false,adManagerLoaded:false,adManagerAutoStart:false,localizationCode:null,trackCuePoints:false,overrideCuePointWithPreRoll:false,adCuePoints:[],skipTimeoutId:null,chromelessAdManagerLoadedId:null,init:function(embedPlayer,callback,pluginName){if(embedPlayer.casting||mw.getConfig("EmbedPlayer.UseExternalAdPlayer")===true){callback();return;}var _this=this;if(mw.getConfig('localizationCode')){_this.localizationCode=mw.getConfig('localizationCode');}this.copyFlashvarsToKDP(embedPlayer,pluginName);this.embedPlayer=embedPlayer;mw.inherit(this,new mw.BaseAdPlugin(embedPlayer,callback));this.pluginName=pluginName;this.contentDoneFlag=null;this.allAdsCompletedFlag=null;this.trackCuePoints=this.getConfig("trackCuePoints")==true&&!_this.getConfig('adTagUrl');this.overrideCuePointWithPreRoll=this.getConfig("overrideCuePointWithPreRoll")==true&&!_this.getConfig('adTagUrl');embedPlayer.unbindHelper(this.bindPostfix);var globalAdsManger=$(_this.embedPlayer).data('doubleClickAdsMangerRef');if(globalAdsManger){mw.log("DoubleClick::unload old adManger");if($.isFunction(globalAdsManger.destroy)){var resotreFunction=$(_this.embedPlayer).data('doubleClickRestore');if($.isFunction(resotreFunction)){resotreFunction();}globalAdsManger.destroy();}this.removeAdContainer();}if(_this.getConfig('leadWithFlash')!==undefined){_this.leadWithFlash=_this.getConfig('leadWithFlash');}if(_this.getConfig('prerollUrl')!==undefined&&!_this.getConfig('adTagUrl')){_this.adTagUrl=_this.getConfig('prerollUrl');}if(mw.getConfig("EmbedPlayer.ForceNativeComponent")){_this.isNativeSDK=true;_this.embedPlayer.bindHelper('playerReady'+_this.bindPostfix,function(){_this.bindChromelessEvents();});_this.addManagedBinding();callback();return;}if(this.embedPlayer.getRawKalturaConfig('noticeMessage')){embedPlayer.setKalturaConfig('doubleClick','enableCountDown',true);embedPlayer.setKalturaConfig('doubleClick','countdownText',this.embedPlayer.getRawKalturaConfig('noticeMessage','text'));}if(this.getConfig('enableCountDown')===true){if(!_this.getConfig('countdownText')){embedPlayer.setKalturaConfig('doubleClick','countdownText','Advertisement: Video will resume in {sequenceProxy.timeRemaining} seconds');}}else{embedPlayer.setKalturaConfig('doubleClick','countdownText',null);}if(this.trackCuePoints){this.handleCuePoints();}if((mw.isIE8()||mw.isIE9()||mw.isEdge()||_this.leadWithFlash)&&(mw.supportsFlash())){mw.setConfig('EmbedPlayer.ForceKPlayer',true);_this.isChromeless=true;_this.prevSlotType='none';_this.embedPlayer.bindHelper('playerReady'+_this.bindPostfix,function(){_this.bindChromelessEvents();});_this.embedPlayer.bindHelper('volumeChanged'+this.bindPostfix,function(event,percent){mw.log("DoubleClick::chromeless volumeChanged: "+percent);_this.embedPlayer.setPlayerElementVolume(percent);});_this.embedPlayer.bindHelper('Kaltura_SendNotification'+this.bindPostfix,function(event,notificationName,notificationData){if(notificationName==="doPause"){_this.embedPlayer.getPlayerElement().pause();}});_this.addManagedBinding();callback();return;}else if(mw.isIE8()||mw.isIE9()){callback();return;}if(_this.getConfig('prerollUrlJS')!==undefined&&!_this.getConfig('adTagUrl')){_this.adTagUrl=_this.getConfig('prerollUrlJS');}this.embedPlayer.bindHelper('prePlayAction'+this.bindPostfix,function(e,prePlay){prePlay.allowPlayback=false;_this.embedPlayer.addPlayerSpinner();_this.prePlayActionTriggered=true;});var onImaLoadSuccess=function(){_this.imaLoaded=true;_this.embedPlayer.unbindHelper('prePlayAction'+_this.bindPostfix);if(_this.localizationCode){google.ima.settings.setLocale(_this.localizationCode);}google.ima.settings.setPlayerType("kaltura/mwEmbed");google.ima.settings.setPlayerVersion(mw.getConfig("version"));google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED);var numRedirects=_this.getConfig("numRedirects");if(numRedirects){google.ima.settings.setNumRedirects(numRedirects);}if(_this.getConfig('adPattern')){var adIndex=_this.getAdPatternIndex();mw.log("DoubleClick:: adPattern: "+_this.getConfig('adPattern')+" on index: "+adIndex);if(adIndex==='A'){_this.addManagedBinding();}}else{_this.addManagedBinding();}var requestAdsAndPlay=function(){_this.requestAds();if(_this.prePlayActionTriggered){_this.embedPlayer.play();}};if(_this.embedPlayer.changeMediaStarted){setTimeout(requestAdsAndPlay,100)}else{requestAdsAndPlay();}};var onImaLoadFailed=function(errorCode){mw.log("Error::DoubleClick Loading Error: "+errorCode);_this.onAdError(errorCode);_this.embedPlayer.unbindHelper('prePlayAction'+_this.bindPostfix);if(_this.prePlayActionTriggered){_this.embedPlayer.play();}};try{if(top.google&&top.google.ima){window.google=top.google;}}catch(e){}if(this.getConfig("useExternalImaLib")&&window.google&&window.google.ima){mw.log("Google IMA lib already loaded");onImaLoadSuccess();}else{mw.log("Google IMA lib loading");this.loadIma(onImaLoadSuccess,onImaLoadFailed);}var restoreOnInit=function(){_this.destroy();};$(_this.embedPlayer).data('doubleClickRestore',restoreOnInit);callback();},handleCuePoints:function(){var _this=this;$(this.embedPlayer).bind('KalturaSupport_AdOpportunity',function(event,cuePointWrapper){if(cuePointWrapper.cuePoint.protocolType==1&&_this.adCuePoints.indexOf(cuePointWrapper.cuePoint.id)===-1){if(!_this.overrideCuePointWithPreRoll){_this.adTagUrl=cuePointWrapper.cuePoint.sourceUrl;}if(cuePointWrapper.cuePoint.adType==1){_this.currentAdSlotType="midroll";}else{_this.currentAdSlotType="overlay";if(_this.getConfig("timeout")){setTimeout(function(){if(_this.adsManager){_this.adsManager.stop();}},parseFloat(_this.getConfig("timeout"))*1000);}}_this.adCuePoints.push(cuePointWrapper.cuePoint.id);_this.adManagerAutoStart=true;_this.requestAds();}});},removeAdContainer:function(){var $containerAd=$('#'+this.getAdContainerId());if($containerAd.length){$containerAd.remove();}},parseAdTagUrlParts:function(embedPlayer,pluginName){var adTagUrl=embedPlayer.getRawKalturaConfig(pluginName,"adTagUrl");if(adTagUrl){try{var adTagUrlParts=adTagUrl.split('?');var adTagBaseUrl=adTagUrlParts[0];var queryStringParams=adTagUrlParts[1];var evaluatedQueryStringParams="";if(queryStringParams){var queryStringParamsParts=queryStringParams.split('&');for(var i=0;i<queryStringParamsParts.length;i++){var equalIndex=queryStringParamsParts[i].indexOf("=");var evaluatedKey=embedPlayer.evaluate(unescape(queryStringParamsParts[i].substr(0,equalIndex)));var evaluatedValue=embedPlayer.evaluate(unescape(queryStringParamsParts[i].substr(equalIndex+1)));if(evaluatedKey!='cust_params'){evaluatedQueryStringParams+=escape(evaluatedKey);if(evaluatedValue){evaluatedQueryStringParams+="="+encodeURIComponent(evaluatedValue);}evaluatedQueryStringParams+="&";}else{this.cust_params=escape(evaluatedValue);}}evaluatedQueryStringParams=evaluatedQueryStringParams.substring(0,evaluatedQueryStringParams.length-1);this.adTagUrl=adTagBaseUrl+"?"+evaluatedQueryStringParams;}else{this.adTagUrl=adTagUrl;}}catch(e){mw.log("failed to evaluate adTagUrl parts, using fully escaped/evaluated adTagUrl");var adTagUrl=embedPlayer.getKalturaConfig(pluginName);if(adTagUrl){this.adTagUrl=adTagUrl;this.cust_params="";}}}},copyFlashvarsToKDP:function(embedPlayer,pluginName){var flashVars=embedPlayer.getKalturaConfig(pluginName);this.parseAdTagUrlParts(embedPlayer,pluginName);flashVars['adTagUrl']=escape(this.adTagUrl);flashVars['cust_params']=this.cust_params;var ignoredVars=['path','customParams','preSequence','postSequence','postrollUrl','postrollUrlJS','countdownText','prerollUrl','prerollUrlJS'];for(var i=0;i<ignoredVars.length;i++){delete flashVars[ignoredVars[i]];}flashVars['playerVersion']=mw.getConfig("version");embedPlayer.setKalturaConfig('kdpVars','doubleClick',flashVars);if(this.localizationCode){embedPlayer.setKalturaConfig('kdpVars','localizationCode',this.localizationCode);}},getAdPatternIndex:function(){var adPattern=this.getConfig('adPattern');var currentAdIndex=$(this.embedPlayer).data('DcAdPatternIndex');if(typeof currentAdIndex==='undefined'){currentAdIndex=0;}else{currentAdIndex++;if(currentAdIndex>adPattern.length-1){currentAdIndex=0;}}$(this.embedPlayer).data('DcAdPatternIndex',currentAdIndex);return adPattern[currentAdIndex];},loadIma:function(successCB,failureCB){var _this=this;var isLoaded=false;var timeoutVal=_this.getConfig("adsManagerLoadedTimeout")||(mw.isChromeCast()?15000:5000);mw.log("DoubleClick::loadIma: start timer for adsManager loading check: "+timeoutVal+"ms");setTimeout(function(){if(!isLoaded){mw.log("DoubleClick::loadIma: adsManager failed loading after "+timeoutVal+"ms");failureCB();}},timeoutVal);var imaURL='//s0.2mdn.net/instream/html5/ima3.js';if(this.getConfig('debugMode')===true){imaURL='//s0.2mdn.net/instream/html5/ima3_debug.js';}$.getScript(imaURL,function(){isLoaded=true;successCB();}).fail(function(jqxhr,settings,errorCode){isLoaded=true;failureCB(errorCode);});},startAdsManager:function(){if(this.embedPlayer.casting){this.embedPlayer.adTimeline.restorePlayer(null,true);this.destroy();return;}this.adsManager.init(this.embedPlayer.getWidth(),this.embedPlayer.getHeight(),google.ima.ViewMode.NORMAL);this.adsManager.setVolume(this.embedPlayer.getPlayerElementVolume());mw.log("DoubleClick::adsManager.play");this.adsManager.start();},addManagedBinding:function(){var _this=this;mw.log("DoubleClick::addManagedBinding");_this.embedPlayer.bindHelper('AdSupport_preroll'+_this.bindPostfix,function(event,sequenceProxy){sequenceProxy[_this.getSequenceIndex('preroll')]=function(callback){_this.sequenceProxy=sequenceProxy;_this.currentAdSlotType='preroll';_this.shouldPausePlaylist=true;_this.restorePlayerCallback=callback;if(_this.isChromeless||_this.isNativeSDK){_this.requestAds();}else{if(!_this.getConfig("adTagUrl")&&!_this.getConfig("prerollUrl")&&!_this.getConfig('prerollUrlJS')){mw.log("DoubleClick::No adTagUrl defined. Restore player and resume playback.")
_this.restorePlayer(true);return;}var playerElement=_this.embedPlayer.getPlayerElement();if(mw.isMobileDevice()&&!_this.playerElementLoaded){_this.playerElementLoaded=true;playerElement.load();}_this.saveTimeWhenSwitchMedia=mw.isMobileDevice();_this.getAdDisplayContainer().initialize();if(_this.adManagerLoaded){_this.startAdsManager();}else{_this.adManagerAutoStart=true;}}}});_this.embedPlayer.bindHelper('AdSupport_midroll'+_this.bindPostfix,function(event,sequenceProxy){sequenceProxy[_this.getSequenceIndex('midroll')]=function(callback){_this.currentAdSlotType='midroll';_this.restorePlayerCallback=callback;}});_this.embedPlayer.bindHelper('AdSupport_postroll'+_this.bindPostfix,function(event,sequenceProxy){sequenceProxy[_this.getSequenceIndex('postroll')]=function(callback){_this.currentAdSlotType='postroll';_this.postRollCallback=callback;if(_this.getConfig("adTagUrl")&&(_this.isLinear===false||_this.allAdsCompletedFlag||_this.adLoaderErrorFlag)){_this.restorePlayer(true);}_this.restorePlayerNoPostroll();};_this.adManagerAutoStart=true;if(!_this.isChromeless&&_this.getConfig("postrollUrlJS")&&!_this.getConfig("adTagUrl")){_this.contentDoneFlag=true;_this.adTagUrl=_this.getConfig("postrollUrlJS");_this.currentAdSlotType="postroll";_this.requestAds("postroll");return;}if(_this.getConfig("postrollUrl")&&!_this.getConfig("adTagUrl")){_this.contentDoneFlag=true;_this.adTagUrl=_this.getConfig("postrollUrl");_this.currentAdSlotType="postroll";_this.requestAds("postroll");}});_this.embedPlayer.bindHelper('Kaltura_SendNotification'+this.bindPostfix,function(event,notificationName,notificationData){if(_this.playingLinearAd){if(notificationName==="doPause"){_this.pauseAd(true);}if(notificationName==="doPlay"){_this.resumeAd(true);}}});_this.embedPlayer.bindHelper('casting'+this.bindPostfix,function(){_this.embedPlayer.adTimeline.restorePlayer(null,true);_this.destroy();});_this.embedPlayer.bindHelper('AdSupport_StartAdPlayback'+this.bindPostfix,function(event){if(_this.isChromeless){_this.embedPlayer.getPlayerElement().sendNotification("hideContent");}else{if(_this.embedPlayer.isVideoSiblingEnabled()&&!mw.isAndroidNativeBrowser()&&!_this.isNativeSDK){$(".mwEmbedPlayer").addClass("mwEmbedPlayerBlackBkg");_this.embedPlayer.addBlackScreen();}else{_this.embedPlayer.removePoster();}}});_this.embedPlayer.bindHelper('AdSupport_EndAdPlayback'+this.bindPostfix,function(event){if(_this.isChromeless){_this.embedPlayer.getPlayerElement().sendNotification("showContent");}else{if(_this.embedPlayer.isVideoSiblingEnabled()&&!mw.isAndroidNativeBrowser()&&!_this.isNativeSDK){$(".mwEmbedPlayer").removeClass("mwEmbedPlayerBlackBkg");_this.embedPlayer.removeBlackScreen();}else{_this.embedPlayer.updatePosterHTML();}}});_this.embedPlayer.bindHelper('cancelAllAds'+this.bindPostfix,function(event){mw.log("DoubleClick::cancelAllAds event called.");_this.destroy();});_this.embedPlayer.bindHelper('onChangeMedia'+this.bindPostfix,function(event){if(_this.embedPlayer.isInSequence()){mw.log("DoubleClick::changeMedia event called. Calling Destroy.");_this.destroy();_this.isdestroy=true;}});if(_this.embedPlayer.isMobileSkin()){_this.embedPlayer.bindHelper('onShowControlBar'+this.bindPostfix,function(event){if(!_this.isLinear){$(_this.getAdContainer()).css({top:-60});}});_this.embedPlayer.bindHelper('onHideControlBar'+this.bindPostfix,function(event){if(!_this.isLinear){$(_this.getAdContainer()).css({top:0});}});}if(!_this.isNativeSDK&&_this.embedPlayer.playlist&&mw.isMobileDevice()&&mw.isAndroid()){_this.embedPlayer.setKalturaConfig('playlistAPI','autoPlay',false);_this.embedPlayer.autoplay=false;_this.embedPlayer.bindHelper('prePlayAction',function(event,prePlay){prePlay.allowPlayback=false;mw.setConfig('EmbedPlayer.HidePosterOnStart',false);_this.embedPlayer.updatePosterHTML();});_this.embedPlayer.bindHelper('userInitiatedPlay',function(){_this.embedPlayer.unbindHelper('prePlayAction');});}},pauseAd:function(isLinear){var _this=this;this.adPaused=true;this.embedPlayer.paused=true;$(this.embedPlayer).trigger('onpause');var classes="adCover";if(mw.isIE8()){classes+=" adCoverIE8";}var adCover=$('<div class="'+classes+'"></div>').on('click',function(){_this.embedPlayer.hideSpinnerOncePlaying();_this.resumeAd(isLinear)});$(".adCover").remove();if(this.isChromeless){$(".videoDisplay").prepend(adCover);}else{if(!mw.isIphone()){$(this.getAdContainer()).append(adCover);}}$(this.embedPlayer).trigger("onPlayerStateChange",["pause",this.embedPlayer.currentState]);if(isLinear&&!this.isNativeSDK){this.clearSkipTimeout();this.embedPlayer.enablePlayControls(["scrubber","share","infoScreen","related","playlistAPI","nextPrevBtn","sourceSelector","qualitySettings","morePlugins"]);}else{_this.embedPlayer.pause();}if(_this.isChromeless){_this.embedPlayer.getPlayerElement().sendNotification("pauseAd");}else{if(this.adsManager){this.adsManager.pause();}else{_this.embedPlayer.getPlayerElement().pause();}}},resumeAd:function(isLinear){if(this.adPaused){var _this=this;this.adPaused=false;this.embedPlayer.paused=false;$(".adCover").remove();$(this.embedPlayer).trigger("onPlayerStateChange",["play",this.embedPlayer.currentState]);if(isLinear){if(!_this.adSkippable){this.resumeSkipSupport();}this.embedPlayer.disablePlayControls();}else{_this.embedPlayer.play();}if(_this.isChromeless){_this.embedPlayer.getPlayerElement().sendNotification("resumeAd");}else{if(this.adsManager){this.adsManager.resume();}else{_this.embedPlayer.getPlayerElement().resume();}}}},toggleAdPlayback:function(isLinear){if(this.getConfig("pauseAdOnClick")!==false&&!this.isNativeSDK){if(this.adPaused){this.resumeAd(isLinear);}else{$(this.embedPlayer).trigger('adClick');this.pauseAd(isLinear);}}else{$(this.embedPlayer).trigger('adClick');}},getContent:function(){return this.embedPlayer.getPlayerElement();},addCountdownNotice:function(){if(this.getConfig('countdownText')&&this.embedPlayer.getInterface().find(".ad-notice-label").length==0){this.embedPlayer.getVideoHolder().append($('<span />').addClass('ad-component ad-notice-label'));}},getAdContainer:function(){if(!$('#'+this.getAdContainerId()).length){this.embedPlayer.getVideoHolder().after($('<div />').attr('id',this.getAdContainerId()).css({'position':'absolute','top':'0px','left':'0px'}));this.addCountdownNotice();}return $('#'+this.getAdContainerId()).get(0);},getAdContainerId:function(){return'adContainer'+this.embedPlayer.id;},hideAdContainer:function(removeFromDOM){$("#"+this.getAdContainerId()).css("visibility","hidden");if(removeFromDOM){$("#"+this.getAdContainerId()).hide();}},showAdContainer:function(){$("#"+this.getAdContainerId()).css("visibility","visible");},getAdDisplayContainer:function(){if(!this.adDisplayContainer){this.adDisplayContainer=new google.ima.AdDisplayContainer(this.getAdContainer(),this.getContent());}return this.adDisplayContainer;},addSkipSupport:function(){var _this=this;if(this.embedPlayer.getRawKalturaConfig('skipBtn')&&this.embedPlayer.getRawKalturaConfig('skipBtn','plugin')&&this.embedPlayer.getVideoHolder().find(".ad-skip-btn").length===0){var label="Skip Ad";if(this.embedPlayer.getKalturaConfig('skipBtn','label')){label=this.embedPlayer.getKalturaConfig('skipBtn','label');}this.embedPlayer.getVideoHolder().append($('<span />').text(label).addClass('ad-component ad-skip-btn').css({"position":"absolute","float":"right","display":"none"}).on("click touchstart",function(e){e.stopPropagation();e.preventDefault();$(_this.embedPlayer).trigger('onAdSkip');if(_this.adPaused){_this.resumeAd(_this.isLinear);_this.clearSkipTimeout();}if(_this.isChromeless){_this.embedPlayer.getPlayerElement().sendNotification('skipAd');}else{_this.adsManager.stop();if(_this.currentAdSlotType==="postroll"&&_this.getConfig('adTagUrl')){_this.restorePlayer(true);}}$(this).hide();return false;}));if(this.embedPlayer.getRawKalturaConfig('skipNotice')&&this.embedPlayer.getVideoHolder().find(".ad-skip-label").length===0){this.embedPlayer.getVideoHolder().append($('<span />').addClass('ad-component ad-skip-label').css({"position":"absolute","float":"right","display":"none"}));}}this.embedPlayer.bindHelper('chromecastReceiverAdOpen'+this.bindPostfix,function(event){_this.showSkipBtn();});this.embedPlayer.bindHelper('chromecastReceiverAdComplete'+this.bindPostfix,function(event){_this.hideSkipBtn();});},resumeSkipSupport:function(){if(this.embedPlayer.getKalturaConfig('skipBtn','skipOffset')){var timePassed=(this.duration-this.adPreviousTimeLeft)*1000;this.startSkipTimeout((this.embedPlayer.getKalturaConfig('skipBtn','skipOffset')*1000)-timePassed);}},showSkipBtn:function(){if(this.embedPlayer.getKalturaConfig('skipBtn','skipOffset')){$(".ad-skip-label").show();this.startSkipTimeout(parseFloat(this.embedPlayer.getKalturaConfig('skipBtn','skipOffset')*1000));}else{$(".ad-skip-btn").show();$(".ad-skip-label").hide();}},hideSkipBtn:function(){this.clearSkipTimeout();$(".ad-skip-btn").hide();$(".ad-skip-label").hide();},clearSkipTimeout:function(){if(this.skipTimeoutId!==null){clearTimeout(this.skipTimeoutId);this.skipTimeoutId=null;}},startSkipTimeout:function(time){this.skipTimeoutId=setTimeout(function(){$(".ad-skip-btn").show();$(".ad-skip-label").hide();},time);},addCustomParams:function(adUrl,cust_params){var postFix="";if(!cust_params){postFix=(this.getConfig('customParams'))?'cust_params='+encodeURIComponent(this.getConfig('customParams')):'';}else{postFix='cust_params='+cust_params;}if(postFix){var paramSeperator=adUrl.indexOf('?')===-1?'?':adUrl[adUrl.length-1]=='&'?'':'&';return unescape(adUrl)+paramSeperator+postFix;}else{return unescape(adUrl);}},addAdRequestParams:function(adTagUrl){var _this=this;if(adTagUrl){var paramSep=adTagUrl.indexOf('?')===-1?'?':'&';}var adRequestMap={'contentId':'vid','cmsId':'cmsid'};$.each(adRequestMap,function(uiconfId,paramId){if(_this.getConfig(uiconfId)){adTagUrl+=paramSep+paramId+'='+encodeURIComponent(_this.getConfig(uiconfId));paramSep='&';}});return adTagUrl;},requestAds:function(adType){if(!this.adTagUrl){if($.isFunction(this.restorePlayerCallback)){this.restorePlayerCallback();}return;}var _this=this;this.addSkipSupport();this.parseAdTagUrlParts(this.embedPlayer,this.pluginName);var adTagUrl=this.adTagUrl;var cust_params=this.cust_params;adTagUrl=_this.addCustomParams(adTagUrl,cust_params);adTagUrl=_this.addAdRequestParams(adTagUrl);this.embedPlayer.setKDPAttribute(this.pluginName,'requestedAdTagUrl',adTagUrl);var adsRequest={};if(this.isChromeless){adTagUrl=_this.addAdRequestParams(this.adTagUrl);adsRequest.adTagUrl=adTagUrl;adsRequest.cust_params=cust_params;}else{adsRequest.adTagUrl=adTagUrl;}mw.log("DoubleClick::requestAds: url: "+adTagUrl);if(adType){adsRequest['adType']=adType;}var size=this.getPlayerSize();adsRequest.linearAdSlotWidth=size.width;adsRequest.linearAdSlotHeight=size.height;adsRequest.nonLinearAdSlotWidth=size.width;adsRequest.nonLinearAdSlotHeight=size.height;if(this.isChromeless){adsRequest.adTagUrl=encodeURIComponent(adsRequest.adTagUrl);this.embedPlayer.getPlayerElement().sendNotification('requestAds',adsRequest);mw.log("DoubleClick::requestAds: Chromeless player request ad from KDP plugin");var timeout=this.getConfig("adsManagerLoadedTimeout")||(mw.isChromeCast()?15000:5000);this.chromelessAdManagerLoadedId=setTimeout(function(){mw.log("DoubleClick::Error: AdsManager failed to load by Flash plugin after "+timeout+" seconds.");_this.restorePlayer(true);_this.embedPlayer.play();},timeout);return;}if(this.isNativeSDK){this.embedPlayer.getPlayerElement().attr('doubleClickRequestAds',adTagUrl);mw.log("DoubleClick::requestAds: Native SDK player request ad ");return;}this.getAdDisplayContainer();this.hideAdContainer(false);if(this.adsLoader){this.adsLoader.contentComplete();}this.adsLoader=this.adsLoader||new google.ima.AdsLoader(_this.adDisplayContainer);if(mw.isChromeCast()){this.adsLoader.getSettings().setAutoPlayAdBreaks(false);}this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(event){_this.onAdsManagerLoaded(event);},false);this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,function(event){_this.hideAdContainer(true);_this.onAdError(event);},false);try{this.adsLoader.requestAds(adsRequest);}catch(e){this.onAdError(e);}},onAdsManagerLoaded:function(loadedEvent){mw.log('DoubleClick:: onAdsManagerLoaded');var adsRenderingSettings=new google.ima.AdsRenderingSettings();if(!this.adTagUrl){adsRenderingSettings.restoreCustomPlaybackStateOnAdBreakComplete=true;}if(this.getConfig('enableCountDown')===true){adsRenderingSettings["uiElements"]=[];}adsRenderingSettings.useStyledNonLinearAds=true;this.adsManager=loadedEvent.getAdsManager(this.embedPlayer,adsRenderingSettings);this.adManagerLoaded=true;if(mw.isChromeCast()){this.adsManager.addEventListener(google.ima.AdEvent.Type.AD_BREAK_READY,this.adBreakReadyHandler.bind(this));this.embedPlayer.triggerHelper("onCuePointsRevealed",JSON.stringify(this.adsManager.getCuePoints()));}$(this.embedPlayer).data('doubleClickAdsMangerRef',this.adsManager);this.addAdMangerListeners();this.addEmbedPlayerListeners();if(this.adManagerAutoStart){this.startAdsManager();}},adBreakReadyHandler:function(adEvent){var adData=adEvent.getAdData();var adBreakTime=adData.adBreakTime;if(adBreakTime===0||adBreakTime===-1){this.adsManager.start();}},displayCompanions:function(ad){if(this.getConfig('disableCompanionAds')){return;}if(this.getConfig('htmlCompanions')){var companions=this.getConfig('htmlCompanions').split(";");for(var i=0;i<companions.length;i++){var companionsArr=companions[i].split(":");if(companionsArr.length==3){var companionID=companionsArr[0];var adSlotWidth=companionsArr[1];var adSlotHeight=companionsArr[2];var companionAds=[];try{var selectionCriteria=new google.ima.CompanionAdSelectionSettings();selectionCriteria.resourceType=google.ima.CompanionAdSelectionSettings.ResourceType.ALL;selectionCriteria.creativeType=google.ima.CompanionAdSelectionSettings.CreativeType.ALL;switch(this.getConfig('companionSizeCriteria')){case'SELECT_NEAR_MATCH':selectionCriteria.sizeCriteria=google.ima.CompanionAdSelectionSettings.SizeCriteria.SELECT_NEAR_MATCH;break;case'IGNORE':selectionCriteria.sizeCriteria=google.ima.CompanionAdSelectionSettings.SizeCriteria.IGNORE;break;default:selectionCriteria.sizeCriteria=google.ima.CompanionAdSelectionSettings.SizeCriteria.SELECT_EXACT_MATCH;}companionAds=ad.getCompanionAds(adSlotWidth,adSlotHeight,selectionCriteria);}catch(e){mw.log("Error: DoubleClick could not access getCompanionAds");}if(companionAds.length>0){var companionAd=companionAds[0];var content=companionAd.getContent();this.showCompanion(companionID,content);}}}}},showCompanion:function(companionID,content){try{var targetElm=window['parent'].document.getElementById(companionID);if(targetElm){targetElm.innerHTML=content;}}catch(e){mw.log("Error: DoubleClick could not access parent iframe");}},addAdMangerListeners:function(){var _this=this;var adsListener=function(eventType,callback){_this.adsManager.addEventListener(google.ima.AdEvent.Type[eventType],function(event){mw.log("DoubleClick::AdsEvent:"+eventType);if(event.type===google.ima.AdEvent.Type.STARTED){_this.displayCompanions(event.getAd());}if($.isFunction(callback)){callback(event);}},false);};_this.adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,function(event){_this.onAdError(event)},false);var lastAdStartTime=null;adsListener('CONTENT_PAUSE_REQUESTED',function(event){var previousDuration=_this.embedPlayer.duration;if(_this.currentAdSlotType==='midroll'){var restoreMidroll=function(){_this.embedPlayer.adTimeline.restorePlayer('midroll',true);_this.embedPlayer.setDuration(previousDuration);_this.embedPlayer.addPlayerSpinner();if(_this.adsManager.isCustomPlaybackUsed()&&_this.saveTimeWhenSwitchMedia&&_this.timeToReturn){var orgOnLoadedCallback=_this.embedPlayer.onLoadedCallback;_this.embedPlayer.onLoadedCallback=function(){_this.embedPlayer.onLoadedCallback=orgOnLoadedCallback;if(_this.getConfig("adTagUrl")){_this.embedPlayer.seek(_this.timeToReturn);_this.timeToReturn=null;}};}_this.embedPlayer.play();_this.embedPlayer.restorePlayerOnScreen();_this.embedPlayer.hideSpinner();};_this.embedPlayer.adTimeline.displaySlots('midroll',restoreMidroll);}_this.embedPlayer.pauseLoading();_this.embedPlayer.stopPlayAfterSeek=true;if(_this.saveTimeWhenSwitchMedia){_this.timeToReturn=_this.embedPlayer.currentTime;}});adsListener('LOADED',function(adEvent){_this.showAdContainer();var adData=adEvent.getAdData();if(adData){_this.isLinear=adData.linear;}var currentAdSlotType=_this.isLinear?_this.currentAdSlotType:"overlay";$("#"+_this.getAdContainerId()).show();$(_this.embedPlayer).trigger('onAdOpen',[adData.adId,adData.adSystem,currentAdSlotType,adData.adPodInfo?adData.adPodInfo.adPosition:0,adData.linear]);_this.duration=_this.adsManager.getRemainingTime();if(_this.duration>=0){_this.embedPlayer.triggerHelper('AdSupport_AdUpdateDuration',_this.duration);}var size=_this.getPlayerSize();_this.adsManager.resize(size.width,size.height,google.ima.ViewMode.NORMAL);_this.adsManager.setVolume(_this.embedPlayer.getPlayerElementVolume());if(_this.isLinear){_this.hideContent();_this.embedPlayer.addPlayerSpinner();_this.hidePlayerOffScreen(_this.getAdContainer());_this.embedPlayer.getInterface().find(".ad-notice-label").text("").show();_this.monitorAdProgress();}else{_this.embedPlayer.getInterface().find(".ad-notice-label").hide();$(_this.getAdContainer()).addClass("overlayAdContainer");_this.restorePlayer();}});adsListener('STARTED',function(adEvent){var ad=adEvent.getAd();_this.isLinear=ad.isLinear();var currentAdSlotType=_this.isLinear?_this.currentAdSlotType:"overlay";if(mw.isIpad()&&_this.embedPlayer.getPlayerElement().paused){_this.embedPlayer.getPlayerElement().play();}if(currentAdSlotType==="overlay"&&_this.getConfig("timeout")){setTimeout(function(){_this.adsManager.stop();},parseFloat(_this.getConfig("timeout"))*1000);}var adPosition=0;if(ad.getAdPodInfo()&&ad.getAdPodInfo().getAdPosition()){adPosition=ad.getAdPodInfo().getAdPosition();}if(_this.isLinear&&adPosition===1){_this.embedPlayer.adTimeline.updateUiForAdPlayback(_this.currentAdSlotType);}var podPosition=null;var podStartTime=null;if(ad.getAdPodInfo()&&ad.getAdPodInfo().getPodIndex()!==-1){podPosition=ad.getAdPodInfo().getPodIndex();podStartTime=ad.getAdPodInfo().getTimeOffset();}$(_this.embedPlayer).trigger("onAdPlay",[ad.getAdId(),ad.getAdSystem(),currentAdSlotType,adPosition,ad.getDuration(),podPosition,podStartTime,ad.getTitle(),ad.getTraffickingParameters()]);$(_this.embedPlayer).trigger("playing");if(lastAdStartTime!==null&&new Date().getTime()-lastAdStartTime<250){mw.log("ERROR:: Stacking Ad STARTED! :"+(lastAdStartTime-new Date().getTime()));return;}else{mw.log('DoubleClick:: time delta since last adStart: '+(new Date().getTime()-lastAdStartTime));}lastAdStartTime=new Date().getTime();_this.adActive=true;_this.adSkippable=ad.isSkippable();if(_this.isLinear){if(!_this.adSkippable){_this.showSkipBtn();}_this.playingLinearAd=true;_this.embedPlayer.hideSpinner();_this.embedPlayer.playInterfaceUpdate();_this.hideContent();if(mw.isIOS()&&_this.embedPlayer.seeking){_this.embedPlayer.restorePlayerOnScreen();}_this.embedPlayer.sequenceProxy.isInSequence=true;_this.adStartTime=new Date().getTime();_this.monitorAdProgress();_this.embedPlayer.sendNotification('doPlay');if(_this.currentAdSlotType==="preroll"&&!_this.adsManager.isCustomPlaybackUsed()){_this.embedPlayer._propagateEvents=true;_this.embedPlayer.load();}}else{_this.embedPlayer.getInterface().find(".largePlayBtn").css("z-index",1);}});adsListener('PAUSED',function(){_this.embedPlayer.sendNotification('doPause');});adsListener('CLICK',function(adEvent){var ad=adEvent.getAd();var isLinear=ad.isLinear();if(!mw.isIphone()){_this.toggleAdPlayback(isLinear);}$(_this.embedPlayer).trigger('onAdClick');});adsListener('FIRST_QUARTILE',function(){_this.monitorAdProgress();});adsListener('MIDPOINT');adsListener('THIRD_QUARTILE');adsListener('COMPLETE',function(adEvent){var ad=adEvent.getAd();$(_this.embedPlayer).trigger('onAdComplete',[ad.getAdId(),mw.npt2seconds($(".currentTimeLabel").text())]);_this.duration=-1;_this.embedPlayer.getInterface().find(".largePlayBtn").css("z-index","");_this.hideSkipBtn();});adsListener('SKIPPED',function(){mw.log("DoubleClick:: adSkipped");$(_this.embedPlayer).trigger('onAdSkip');});adsListener('CONTENT_RESUME_REQUESTED',function(){$(_this.embedPlayer).trigger('onContentResumeRequested');_this.playingLinearAd=false;if(_this.currentAdSlotType==='preroll'){_this.currentAdSlotType='midroll';}if(_this.currentAdSlotType!='postroll'){if(mw.isIE11()&&mw.getUserOS()==='Windows 8.1'){var videoElement=$(_this.embedPlayer.getPlayerElement());var position=videoElement.css('position');videoElement.css('position','');_this.restorePlayer();videoElement.css('position',position);}else{_this.restorePlayer();}}});adsListener('ALL_ADS_COMPLETED',function(){_this.allAdsCompletedFlag=true;if(_this.contentDoneFlag){_this.restorePlayer(true);}else{_this.hideAdContainer();}_this.embedPlayer.triggerHelper('onAllAdsCompleted');});},bindChromelessEvents:function(){var adInfoObj={};if(this.embedPlayer.getPlayerElement()!==undefined&&this.embedPlayer.getPlayerElement()!==null){var _this=this;this.embedPlayer.getPlayerElement().subscribe(function(){_this.embedPlayer.hideSpinner();mw.log("DoubleClick:: adLoadedEvent");_this.adManagerLoaded=true;clearTimeout(_this.chromelessAdManagerLoadedId);},'adLoadedEvent');this.embedPlayer.getPlayerElement().subscribe(function(adInfo){mw.log("DoubleClick:: adStart");if(!adInfo.linear&&_this.currentAdSlotType==="preroll"){_this.embedPlayer.load();}var podPosition=null;var podStartTime=null;if(adInfo.adPodInfo&&adInfo.adPodInfo.podIndex!==-1){podPosition=adInfo.adPodInfo.podIndex;podStartTime=adInfo.adPodInfo.timeOffset;}$(_this.embedPlayer).trigger("onAdPlay",[adInfo.adID,adInfoObj.adSystem,adInfoObj.currentAdSlotType,adInfoObj.adPosition,adInfo.duration,podPosition,podStartTime,adInfo.adTitle,adInfo.traffickingParameters]);if(_this.isNativeSDK||adInfo.linear){_this.embedPlayer.sequenceProxy.isInSequence=true;_this.embedPlayer.setPlayerElementVolume(_this.embedPlayer.volume);$(_this.embedPlayer).trigger("playing");$(_this.embedPlayer).trigger("onplay");if(_this.currentAdSlotType!=_this.prevSlotType){_this.embedPlayer.adTimeline.updateUiForAdPlayback(_this.currentAdSlotType);_this.prevSlotType=_this.currentAdSlotType;}if(_this.currentAdSlotType!=_this.prevSlotType){_this.prevSlotType=_this.currentAdSlotType;}if(adInfo.duration>0){_this.embedPlayer.triggerHelper('AdSupport_AdUpdateDuration',adInfo.duration);}if(_this.isChromeless){$(".mwEmbedPlayer").hide();}_this.addCountdownNotice();_this.embedPlayer.paused=false;}else{_this.embedPlayer.play();}},'adStart',true);this.embedPlayer.getPlayerElement().subscribe(function(adInfo){mw.log("DoubleClick:: adLoaded");_this.isLinear=adInfo.isLinear;if(!_this.isLinear&&_this.isChromeless){$(".mwEmbedPlayer").hide();mw.setConfig("EmbedPlayer.EnableFlashActivation",false);}var currentAdSlotType=_this.isLinear?_this.currentAdSlotType:"overlay";$(_this.embedPlayer).trigger('onAdOpen',[adInfo.adID,adInfo.adSystem,currentAdSlotType,adInfo.adPosition]);adInfoObj.id=adInfo.adID;adInfoObj.adSystem=adInfo.adSystem;adInfoObj.currentAdSlotType=currentAdSlotType;adInfoObj.adPosition=adInfo.adPosition;if(!_this.isLinear){_this.restorePlayer();}else{if(!adInfo.skippable){_this.showSkipBtn();}}},'adLoaded',true);this.embedPlayer.getPlayerElement().subscribe(function(adInfo){mw.log("DoubleClick:: adCompleted");$(_this.embedPlayer).trigger('onAdComplete',[adInfo.adID,mw.npt2seconds($(".currentTimeLabel").text())]);_this.hideSkipBtn();},'adCompleted',true);this.embedPlayer.getPlayerElement().subscribe(function(adInfo){mw.log("DoubleClick:: adClicked");_this.toggleAdPlayback(adInfo.isLinear);$(_this.embedPlayer).trigger('onAdClick');},'adClicked',true);this.embedPlayer.getPlayerElement().subscribe(function(adInfo){mw.log("DoubleClick:: adSkipped");$(_this.embedPlayer).trigger('onAdSkip');},'adSkipped',true);this.embedPlayer.getPlayerElement().subscribe(function(companionInfo){mw.log("DoubleClick:: displayCompanion");_this.showCompanion(companionInfo.companionID,companionInfo.content);},'displayCompanion',true);this.embedPlayer.getPlayerElement().subscribe(function(adInfo){mw.log("DoubleClick:: allAdsCompleted");setTimeout(function(){_this.restorePlayer(true);},0);if(_this.currentAdSlotType=='postroll'){_this.embedPlayer.triggerHelper('AdSupport_AdUpdateDuration',_this.entryDuration);_this.embedPlayer.triggerHelper('timeupdate',0);}_this.embedPlayer.triggerHelper('onAllAdsCompleted');},'allAdsCompleted',true);this.embedPlayer.getPlayerElement().subscribe(function(adInfo){mw.log("DoubleClick:: adRemainingTimeChange");if(adInfo.duration>0){_this.embedPlayer.triggerHelper('AdSupport_AdUpdatePlayhead',(adInfo.duration-adInfo.remain));_this.embedPlayer.updatePlayHead(adInfo.time/adInfo.duration);}if(adInfo.remain>0){_this.embedPlayer.adTimeline.updateSequenceProxy('timeRemaining',parseInt(adInfo.remain));}if(_this.getConfig('countdownText')){_this.embedPlayer.getInterface().find(".ad-notice-label").text(_this.getConfig('countdownText'));}_this.updateRemainingAdTime(adInfo.time);},'adRemainingTimeChange',true);this.embedPlayer.getPlayerElement().subscribe(function(adInfo){mw.log("DoubleClick:: contentResumeRequested");_this.embedPlayer.sequenceProxy.isInSequence=false;if(_this.prevSlotType==="midroll"){_this.prevSlotType="";}_this.currentAdSlotType=_this.embedPlayer.adTimeline.currentAdSlotType;if(_this.currentAdSlotType=='midroll'){setTimeout(function(){_this.embedPlayer.setDuration(_this.entryDuration);_this.embedPlayer.startMonitor();_this.embedPlayer.getPlayerElement().play();},250);}if(_this.currentAdSlotType!=='postroll'){_this.restorePlayer(null,true);if(_this.currentAdSlotType==='preroll'){_this.currentAdSlotType="midroll";}if(!_this.isNativeSDK){setTimeout(function(){_this.embedPlayer.startMonitor();_this.embedPlayer.getPlayerElement().play();},100);}}_this.playingLinearAd=false;},'contentResumeRequested',true);this.embedPlayer.getPlayerElement().subscribe(function(adInfo){mw.log("DoubleClick:: contentPauseRequested");_this.entryDuration=_this.embedPlayer.getDuration();_this.embedPlayer.stopMonitor();_this.playingLinearAd=true;},'contentPauseRequested',true);this.embedPlayer.getPlayerElement().subscribe(function(adInfo){mw.log("DoubleClick:: adsLoadError");setTimeout(function(){_this.embedPlayer.hideSpinner();_this.adLoaderErrorFlag=true;$(_this.embedPlayer).trigger("adErrorEvent");_this.onAdError("adsLoadError");},100);},'adsLoadError',true);}},getPlayerSize:function(){return{'width':this.embedPlayer.getVideoHolder().width(),'height':this.embedPlayer.getVideoHolder().height()};},hideContent:function(){mw.log("DoubleClick:: hide Content / show Ads");var _this=this;$(this.getAdContainer()).css({'top':0,'left':0});if(this.adsManager&&this.adsManager.resize){var size=this.getPlayerSize();this.adsManager.resize(size.width,size.height,google.ima.ViewMode.NORMAL);}},hidePlayerOffScreen:function(target){$(target).css({'position':'absolute','left':'-4048px'});},addEmbedPlayerListeners:function(){var _this=this;var embedPlayer=this.embedPlayer;embedPlayer.bindHelper('updateLayout'+this.bindPostfix,function(){if(_this.adActive){var size=_this.getPlayerSize();mw.log("DoubleClick::onResizePlayer: size:"+size.width+' x '+size.height);_this.adsManager.resize(size.width,size.height,google.ima.ViewMode.NORMAL);}});embedPlayer.bindHelper('volumeChanged'+this.bindPostfix,function(event,percent){if(_this.adActive){mw.log("DoubleClick::volumeChanged:"+percent);_this.adsManager.setVolume(percent);}});embedPlayer.bindHelper('ended'+this.bindPostfix,function(event){if(!_this.contentDoneFlag){mw.log("DoubleClick::playbackComplete:");_this.contentDoneFlag=true;_this.adsLoader.contentComplete();_this.embedPlayer._propagateEvents=false;}_this.restorePlayerNoPostroll();});embedPlayer.bindHelper('Kaltura_SendNotification'+this.bindPostfix,function(event,notificationName,notificationData){if(_this.adActive){mw.log("DoubleClick:: sendNotification: "+notificationName);switch(notificationName){case'doPause':_this.adPaused=true;_this.adsManager.pause();embedPlayer.paused=true;$(embedPlayer).trigger('onpause');$(embedPlayer).trigger("onPlayerStateChange",["pause",embedPlayer.currentState]);break;case'doPlay':embedPlayer.paused=false;embedPlayer.stopped=false;if(_this.adPaused){_this.adPaused=false;_this.adsManager.resume();$(embedPlayer).trigger('onplay');$(embedPlayer).trigger("onPlayerStateChange",["play",embedPlayer.currentState]);_this.monitorAdProgress();}break;case'doStop':_this.adsManager.stop();_this.adActive=false;_this.embedPlayer.sequenceProxy.isInSequence=false;_this.embedPlayer.stop();break;}}});},monitorAdProgress:function(){var _this=this;if(!this.adMonitor){this.adMonitor=setInterval(function(){_this.doMonitorAdProgress();},mw.getConfig('EmbedPlayer.MonitorRate'));}},doMonitorAdProgress:function(){var _this=this;if(!_this.adActive){_this.embedPlayer.adTimeline.updateSequenceProxy('timeRemaining',null);_this.embedPlayer.adTimeline.updateSequenceProxy('duration',null);clearInterval(this.adMonitor);this.adMonitor=0;return;}_this.embedPlayer.hideSpinner();_this.adPreviousTimeLeft=_this.adsManager.getRemainingTime();if(_this.adsManager.getRemainingTime()<0){return;}_this.embedPlayer.adTimeline.updateSequenceProxy('timeRemaining',_this.adsManager.getRemainingTime());if(_this.adsManager.getRemainingTime()>0){_this.embedPlayer.adTimeline.updateSequenceProxy('timeRemaining',parseInt(_this.adsManager.getRemainingTime()));}if(_this.duration===-1){_this.duration=_this.adsManager.getRemainingTime();}else{var currentTime=_this.duration-_this.adsManager.getRemainingTime();if(currentTime>=0){_this.embedPlayer.adTimeline.updateSequenceProxy('duration',_this.duration);_this.embedPlayer.triggerHelper('AdSupport_AdUpdatePlayhead',currentTime);_this.embedPlayer.updatePlayHead(currentTime/_this.duration);}}if(_this.getConfig('countdownText')){this.embedPlayer.getInterface().find(".ad-notice-label").text(_this.getConfig('countdownText'));}_this.updateRemainingAdTime(_this.duration-_this.adsManager.getRemainingTime());},updateRemainingAdTime:function(remainTime){if(this.embedPlayer.getInterface().find(".ad-skip-label").length){var offsetRemaining=Math.max(Math.ceil(parseFloat(this.embedPlayer.getKalturaConfig('skipBtn','skipOffset'))-remainTime),0);this.embedPlayer.adTimeline.updateSequenceProxy('skipOffsetRemaining',offsetRemaining);this.embedPlayer.getInterface().find(".ad-skip-label").text(this.embedPlayer.evaluate(this.embedPlayer.getRawKalturaConfig('skipNotice','text')));}},onAdError:function(errorEvent){if(errorEvent){var errorMsg=(typeof errorEvent.getError!='undefined')?errorEvent.getError():errorEvent;mw.log('DoubleClick:: onAdError: '+errorMsg);if(!this.adLoaderErrorFlag){$(this.embedPlayer).trigger("adErrorEvent");this.adLoaderErrorFlag=true;}if(this.adsManager&&$.isFunction(this.adsManager.unload)){this.adsManager.unload();}if(this.embedPlayer.isInSequence()||(this.embedPlayer.autoplay&&this.embedPlayer.canAutoPlay())){this.restorePlayer(this.contentDoneFlag);this.embedPlayer.play();}else{this.destroy();}}},restorePlayer:function(onContentComplete,adPlayed){if(this.isdestroy&&this.adTagUrl){return;}mw.log("DoubleClick::restorePlayer: content complete:"+onContentComplete);var _this=this;this.adActive=false;this.embedPlayer.getInterface().find(".ad-notice-label").remove();if(this.isChromeless){if(_this.isLinear||_this.adLoaderErrorFlag){$(".mwEmbedPlayer").show();}this.embedPlayer.getPlayerElement().redrawObject(50);}else{if(_this.isLinear!==false||_this.adLoaderErrorFlag){_this.hideAdContainer(true);}}this.embedPlayer.sequenceProxy.isInSequence=false;if($.isFunction(this.restorePlayerCallback)&&!onContentComplete){var shouldContinue=!onContentComplete;mw.setConfig('LoadingSpinner.Disabled',true);this.restorePlayerCallback(shouldContinue);this.restorePlayerCallback=null;setTimeout(function(){mw.setConfig('LoadingSpinner.Disabled',false);},500);}else{this.embedPlayer.adTimeline.restorePlayer(null,adPlayed);this.embedPlayer.setDuration(this.embedPlayer.duration);if(onContentComplete){if(_this.postRollCallback){_this.postRollCallback();}this.isdestroy=true;this.destroy();}else{if(_this.saveTimeWhenSwitchMedia){_this.embedPlayer.seek(_this.timeToReturn);_this.timeToReturn=null;}this.embedPlayer.play();}}if(_this.adClickEvent){$(window).unbind(_this.adClickEvent);}else if(_this.isAdClickTimeoutEnabled){_this.isAdClickTimeoutEnabled=false;}},restorePlayerNoPostroll:function(){var _this=this;if(!_this.getConfig("adTagUrl")&&!_this.getConfig("postrollUrl")){_this.currentAdSlotType="postroll";_this.restorePlayer(true);}},getConfig:function(attrName){return this.embedPlayer.getKalturaConfig(this.pluginName,attrName);},destroy:function(){var _this=this;this.hideSkipBtn();if(this.adTagUrl||this.currentAdSlotType==="postroll"){this.embedPlayer.unbindHelper(this.bindPostfix);}if(!this.isChromeless){if(this.adTagUrl&&this.playingLinearAd){this.restorePlayer(true);}$(".ad-skip-btn").remove();setTimeout(function(){_this.removeAdContainer();if(_this.adsLoader){_this.adsLoader.destroy();}},100);}else{if(!this.isLinear){this.embedPlayer.getPlayerElement().sendNotification('destroy');}}this.contentDoneFlag=false;}};})(window.mw,jQuery);;},{},{});mw.loader.implement("mw.EmbedPlayer",function($){if(!window.Silverlight){window.Silverlight={};}Silverlight._silverlightCount=0;Silverlight.__onSilverlightInstalledCalled=false;Silverlight.fwlinkRoot='http://go2.microsoft.com/fwlink/?LinkID=';Silverlight.__installationEventFired=false;Silverlight.onGetSilverlight=null;Silverlight.onSilverlightInstalled=function(){window.location.reload(false);};Silverlight.isInstalled=function(version){if(version==undefined){version=null;}var isVersionSupported=false;try{var tryOlderIE=false;try{var plugin=navigator.plugins["Silverlight Plug-In"];if(plugin){if(version===null){isVersionSupported=true;}else{var actualVer=plugin.description;if(actualVer==="1.0.30226.2"){actualVer="2.0.30226.2";}var actualVerArray=actualVer.split(".");while(actualVerArray.length>3){actualVerArray.pop();}while(actualVerArray.length<4){actualVerArray.push(0);}var reqVerArray=version.split(".");while(reqVerArray.length>4){reqVerArray.pop();}var requiredVersionPart;var actualVersionPart;var index=0;do{requiredVersionPart=parseInt(reqVerArray[index]);actualVersionPart=parseInt(actualVerArray[index]);index++;}while(index<reqVerArray.length&&requiredVersionPart===actualVersionPart);if(requiredVersionPart<=actualVersionPart&&!isNaN(requiredVersionPart)){isVersionSupported=true;}}}else{tryOlderIE=true;}}catch(e){tryOlderIE=true;}if(tryOlderIE){var control=new ActiveXObject('AgControl.AgControl');if(version===null){isVersionSupported=true;}else if(control.IsVersionSupported(version)){isVersionSupported=true;}control=null;}}catch(e){isVersionSupported=false;}return isVersionSupported;};Silverlight.WaitForInstallCompletion=function(){if(!Silverlight.isBrowserRestartRequired&&Silverlight.onSilverlightInstalled){try{navigator.plugins.refresh();}catch(e){}if(Silverlight.isInstalled(null)&&!Silverlight.__onSilverlightInstalledCalled){Silverlight.onSilverlightInstalled();Silverlight.__onSilverlightInstalledCalled=true;}else{setTimeout(Silverlight.WaitForInstallCompletion,3000);}}};Silverlight.__startup=function(){navigator.plugins.refresh();Silverlight.isBrowserRestartRequired=Silverlight.isInstalled(null);if(!Silverlight.isBrowserRestartRequired){Silverlight.WaitForInstallCompletion();if(!Silverlight.__installationEventFired){Silverlight.onInstallRequired();Silverlight.__installationEventFired=true;}}else if(window.navigator.mimeTypes){var mimeSL2=navigator.mimeTypes["application/x-silverlight-2"];var mimeSL2b2=navigator.mimeTypes["application/x-silverlight-2-b2"];var mimeSL2b1=navigator.mimeTypes["application/x-silverlight-2-b1"];var mimeHighestBeta=mimeSL2b1;if(mimeSL2b2)mimeHighestBeta=mimeSL2b2;if(!mimeSL2&&(mimeSL2b1||mimeSL2b2)){if(!Silverlight.__installationEventFired){Silverlight.onUpgradeRequired();Silverlight.__installationEventFired=true;}}else if(mimeSL2&&mimeHighestBeta){if(mimeSL2.enabledPlugin&&mimeHighestBeta.enabledPlugin){if(mimeSL2.enabledPlugin.description!=mimeHighestBeta.enabledPlugin.description){if(!Silverlight.__installationEventFired){Silverlight.onRestartRequired();Silverlight.__installationEventFired=true;}}}}}if(!Silverlight.disableAutoStartup){if(window.removeEventListener){window.removeEventListener('load',Silverlight.__startup,false);}else{window.detachEvent('onload',Silverlight.__startup);}}};if(!Silverlight.disableAutoStartup){if(window.addEventListener){window.addEventListener('load',Silverlight.__startup,false);}else{window.attachEvent('onload',Silverlight.__startup);}}Silverlight.createObject=function(source,parentElement,id,properties,events,initParams,userContext){var slPluginHelper=new Object();var slProperties=properties;var slEvents=events;slPluginHelper.version=slProperties.version;slProperties.source=source;slPluginHelper.alt=slProperties.alt;if(initParams)slProperties.initParams=initParams;if(slProperties.isWindowless&&!slProperties.windowless)slProperties.windowless=slProperties.isWindowless;if(slProperties.framerate&&!slProperties.maxFramerate)slProperties.maxFramerate=slProperties.framerate;if(id&&!slProperties.id)slProperties.id=id;delete slProperties.ignoreBrowserVer;delete slProperties.inplaceInstallPrompt;delete slProperties.version;delete slProperties.isWindowless;delete slProperties.framerate;delete slProperties.data;delete slProperties.src;delete slProperties.alt;if(Silverlight.isInstalled(slPluginHelper.version)){for(var name in slEvents){if(slEvents[name]){if(name=="onLoad"&&typeof slEvents[name]=="function"&&slEvents[name].length!=1){var onLoadHandler=slEvents[name];slEvents[name]=function(sender){return onLoadHandler(document.getElementById(id),userContext,sender)};}var handlerName=Silverlight.__getHandlerName(slEvents[name]);if(handlerName!=null){slProperties[name]=handlerName;slEvents[name]=null;}else{throw"typeof events."+name+" must be 'function' or 'string'";}}}slPluginHTML=Silverlight.buildHTML(slProperties);}else{slPluginHTML=Silverlight.buildPromptHTML(slPluginHelper);}if(parentElement){parentElement.innerHTML=slPluginHTML;}else{return slPluginHTML;}};Silverlight.buildHTML=function(slProperties){var htmlBuilder=[];htmlBuilder.push('<object type=\"application/x-silverlight\" data="data:application/x-silverlight,"');if(slProperties.id!=null){htmlBuilder.push(' id="'+Silverlight.HtmlAttributeEncode(slProperties.id)+'"');}if(slProperties.width!=null){htmlBuilder.push(' width="'+slProperties.width+'"');}if(slProperties.height!=null){htmlBuilder.push(' height="'+slProperties.height+'"');}htmlBuilder.push(' >');delete slProperties.id;delete slProperties.width;delete slProperties.height;for(var name in slProperties){if(slProperties[name]){htmlBuilder.push('<param name="'+Silverlight.HtmlAttributeEncode(name)+'" value="'+Silverlight.HtmlAttributeEncode(slProperties[name])+'" />');}}htmlBuilder.push('<\/object>');return htmlBuilder.join('');};Silverlight.createObjectEx=function(params){var parameters=params;var html=Silverlight.createObject(parameters.source,parameters.parentElement,parameters.id,parameters.properties,parameters.events,parameters.initParams,parameters.context);if(parameters.parentElement==null){return html;}};Silverlight.buildPromptHTML=function(slPluginHelper){var slPluginHTML="";var urlRoot=Silverlight.fwlinkRoot;var version=slPluginHelper.version;if(slPluginHelper.alt){slPluginHTML=slPluginHelper.alt;}else{if(!version){version="";}slPluginHTML="<a href='javascript:Silverlight.getSilverlight(\"{1}\");' style='text-decoration: none;'><img src='{2}' alt='Get Microsoft Silverlight' style='border-style: none'/></a>";slPluginHTML=slPluginHTML.replace('{1}',version);slPluginHTML=slPluginHTML.replace('{2}',urlRoot+'161376');}return slPluginHTML;};Silverlight.getSilverlight=function(version){if(Silverlight.onGetSilverlight){Silverlight.onGetSilverlight();}var shortVer="";var reqVerArray=String(version).split(".");if(reqVerArray.length>1){var majorNum=parseInt(reqVerArray[0]);if(isNaN(majorNum)||majorNum<2){shortVer="1.0";}else{shortVer=reqVerArray[0]+'.'+reqVerArray[1];}}var verArg="";if(shortVer.match(/^\d+\056\d+$/)){verArg="&v="+shortVer;}Silverlight.followFWLink("149156"+verArg);};Silverlight.followFWLink=function(linkid){top.location=Silverlight.fwlinkRoot+String(linkid);};Silverlight.HtmlAttributeEncode=function(strInput){var c;var retVal='';if(strInput==null){return null;}for(var cnt=0;cnt<strInput.length;cnt++){c=strInput.charCodeAt(cnt);if(((c>96)&&(c<123))||((c>64)&&(c<91))||((c>43)&&(c<58)&&(c!=47))||(c==95)){retVal=retVal+String.fromCharCode(c);}else{retVal=retVal+'&#'+c+';';}}return retVal;};Silverlight.default_error_handler=function(sender,args){var iErrorCode;var errorType=args.ErrorType;iErrorCode=args.ErrorCode;var errMsg="\nSilverlight error message     \n";errMsg+="ErrorCode: "+iErrorCode+"\n";errMsg+="ErrorType: "+errorType+"       \n";errMsg+="Message: "+args.ErrorMessage+"     \n";if(errorType=="ParserError"){errMsg+="XamlFile: "+args.xamlFile+"     \n";errMsg+="Line: "+args.lineNumber+"     \n";errMsg+="Position: "+args.charPosition+"     \n";}else if(errorType=="RuntimeError"){if(args.lineNumber!=0){errMsg+="Line: "+args.lineNumber+"     \n";errMsg+="Position: "+args.charPosition+"     \n";}errMsg+="MethodName: "+args.methodName+"     \n";}alert(errMsg);};Silverlight.__cleanup=function(){for(var i=Silverlight._silverlightCount-1;i>=0;i--){window['__slEvent'+i]=null;}Silverlight._silverlightCount=0;if(window.removeEventListener){window.removeEventListener('unload',Silverlight.__cleanup,false);}else{window.detachEvent('onunload',Silverlight.__cleanup);}};Silverlight.__getHandlerName=function(handler){var handlerName="";if(typeof handler=="string"){handlerName=handler;}else if(typeof handler=="function"){if(Silverlight._silverlightCount==0){if(window.addEventListener){window.addEventListener('unload',Silverlight.__cleanup,false);}else{window.attachEvent('onunload',Silverlight.__cleanup);}}var count=Silverlight._silverlightCount++;handlerName="__slEvent"+count;window[handlerName]=handler;}else{handlerName=null;}return handlerName;};Silverlight.onRequiredVersionAvailable=function(){};Silverlight.onRestartRequired=function(){};Silverlight.onUpgradeRequired=function(){};Silverlight.onInstallRequired=function(){};Silverlight.IsVersionAvailableOnError=function(sender,args){var retVal=false;try{if(args.ErrorCode==8001&&!Silverlight.__installationEventFired){Silverlight.onUpgradeRequired();Silverlight.__installationEventFired=true;}else if(args.ErrorCode==8002&&!Silverlight.__installationEventFired){Silverlight.onRestartRequired();Silverlight.__installationEventFired=true;}else if(args.ErrorCode==5014||args.ErrorCode==2106){if(Silverlight.__verifySilverlight2UpgradeSuccess(args.getHost())){retVal=true;}}else{retVal=true;}}catch(e){}return retVal;};Silverlight.IsVersionAvailableOnLoad=function(sender){var retVal=false;try{if(Silverlight.__verifySilverlight2UpgradeSuccess(sender.getHost())){retVal=true;}}catch(e){}return retVal;};Silverlight.__verifySilverlight2UpgradeSuccess=function(host){var retVal=false;var version="5.1.20125";var installationEvent=null;try{if(host.IsVersionSupported(version+".99")){installationEvent=Silverlight.onRequiredVersionAvailable;retVal=true;}else if(host.IsVersionSupported(version+".0")){installationEvent=Silverlight.onRestartRequired;}else{installationEvent=Silverlight.onUpgradeRequired;}if(installationEvent&&!Silverlight.__installationEventFired){installationEvent();Silverlight.__installationEventFired=true;}}catch(e){}return retVal;};(function(mw,$){"use strict";mw.processEmbedPlayers=function(playerSelect,callback){mw.log('processEmbedPlayers:: playerSelector: '+playerSelect);$(mw).trigger('ProcessEmbedPlayers',[playerSelect]);var playerIdList=[];var areSelectedPlayersReady=function(){var playersLoaded=true;$.each(playerIdList,function(inx,playerId){if(!$('#'+playerId)[0].playerReadyFlag){playersLoaded=false;return false;}})
if(playersLoaded){if(callback){callback();}}}
var addPlayerElement=function(playerElement){var _this=this;mw.log('EmbedPlayer:: addElement:: '+playerElement.id);$(mw).trigger('EmbedPlayerWaitForMetaCheck',playerElement);var waitForMeta=false;if(playerElement.waitForMeta!==false){waitForMeta=waitForMetaCheck(playerElement);}var ranPlayerSwapFlag=false;var runPlayerSwap=function(){if(ranPlayerSwapFlag){return;}ranPlayerSwapFlag=true;mw.log("processEmbedPlayers::runPlayerSwap::"+$(playerElement).attr('id'));var playerInterface=new mw.EmbedPlayer(playerElement);var inDomPlayer=swapEmbedPlayerElement(playerElement,playerInterface);mw.log("processEmbedPlayers::trigger:: EmbedPlayerNewPlayer "+inDomPlayer.id);$(mw).trigger('EmbedPlayerNewPlayer',inDomPlayer);$(mw).trigger('newEmbedPlayerEvent',inDomPlayer);$(inDomPlayer).bind('playerReady',areSelectedPlayersReady);mw.log("EmbedPlayer::addPlayerElement :trigger startPlayerBuildOut:"+inDomPlayer.id);$('#'+inDomPlayer.id).triggerQueueCallback('startPlayerBuildOut',function(){inDomPlayer.checkPlayerSources();});};if(waitForMeta&&mw.getConfig('EmbedPlayer.WaitForMeta')){mw.log('processEmbedPlayers::WaitForMeta ( video missing height ('+$(playerElement).attr('height')+'), width ('+$(playerElement).attr('width')+') or duration: '+$(playerElement).attr('duration'));$(playerElement).bind("loadedmetadata",runPlayerSwap);setTimeout(runPlayerSwap,5000);return;}else{runPlayerSwap();return;}};var waitForMetaCheck=function(playerElement){var waitForMeta=false;if(!playerElement){return false;}if(!playerElement.tagName||(playerElement.tagName.toLowerCase()!='audio'&&playerElement.tagName.toLowerCase()!='video')){return false;}if(!mw.EmbedTypes.getMediaPlayers().isSupportedPlayer('oggNative')&&!mw.EmbedTypes.getMediaPlayers().isSupportedPlayer('webmNative')&&!mw.EmbedTypes.getMediaPlayers().isSupportedPlayer('h264Native')&&!mw.EmbedTypes.getMediaPlayers().isSupportedPlayer('appleVdnPlayer')){return false;}var width=$(playerElement).css('width');var height=$(playerElement).css('height');if($(playerElement).css('width')=='300px'&&$(playerElement).css('height')=='150px'){waitForMeta=true;}else{if($(playerElement).attr('duration')||$(playerElement).attr('durationHint')||$(playerElement).attr('data-durationhint')){return false;}else{waitForMeta=true;}}if($(playerElement).attr('width')==-1||$(playerElement).attr('height')==-1){waitForMeta=true;}if($(playerElement).attr('width')===0||$(playerElement).attr('height')===0){waitForMeta=true;}if(playerElement.height==150&&playerElement.width==300){waitForMeta=true;}if(waitForMeta&&($(playerElement).attr('src')||$(playerElement).find("source[src]").length!==0)){return true;}else{return false;}};var swapEmbedPlayerElement=function(targetElement,playerInterface){mw.log('processEmbedPlayers::swapEmbedPlayerElement: '+targetElement.id);var swapPlayerElement=document.createElement('div');$(swapPlayerElement).addClass('mwEmbedPlayer');for(var method in playerInterface){if(method!='readyState'){swapPlayerElement[method]=playerInterface[method];}}if($(targetElement).attr('width')){$(swapPlayerElement).css('width',$(targetElement).attr('width'));}if($(targetElement).attr('height')){$(swapPlayerElement).css('height',$(targetElement).attr('height'));}swapPlayerElement.style.cssText+=targetElement.style.cssText;swapPlayerElement.style.position='relative';var dataAttributes=mw.getConfig("EmbedPlayer.DataAttributes");if(dataAttributes){$.each(dataAttributes,function(attrName,na){if($(targetElement).data(attrName)){$(swapPlayerElement).data(attrName,$(targetElement).data(attrName));}});}if((playerInterface.isPersistentNativePlayer()&&!mw.getConfig('EmbedPlayer.DisableVideoTagSupport'))||(playerInterface.useNativePlayerControls()&&(targetElement.nodeName=='video'||targetElement.nodeName=='audio'))){$(targetElement).attr('id',playerInterface.pid).addClass('nativeEmbedPlayerPid').show().after($(swapPlayerElement).css('display','none'));}else{$(targetElement).replaceWith(swapPlayerElement);}if($('#loadingSpinner_'+playerInterface.id).length==0){if(playerInterface.useNativePlayerControls()||playerInterface.isPersistentNativePlayer()){var $spinner=$(targetElement).getAbsoluteOverlaySpinner();}else{var $spinner=$(swapPlayerElement).getAbsoluteOverlaySpinner();}$spinner.attr('id','loadingSpinner_'+playerInterface.id);}return swapPlayerElement;};$(playerSelect).each(function(index,playerElement){playerIdList.push($(playerElement).attr("id"));if(playerElement.nodeName.toLowerCase()=='div'&&$(playerElement).attr('poster')){var posterSrc=$(playerElement).attr('poster');var width=$(playerElement).width();var height=$(playerElement).height();if(!width){var width='100%';}if(!height){var height='100%';}mw.log('EmbedPlayer:: set loading background: '+posterSrc);$(playerElement).append($('<img />').attr('src',posterSrc).css({'position':'absolute','width':width,'height':height}));}});var addedPlayersFlag=false;$(playerSelect).each(function(index,playerElement){if($(playerElement).hasClass('nativeEmbedPlayerPid')){$('#loadingSpinner_'+$(playerElement).attr('id')).remove();mw.log('processEmbedPlayers::$.embedPlayer skip embedPlayer gennerated video: '+playerElement);}else{addedPlayersFlag=true;addPlayerElement(playerElement);}});if(!addedPlayersFlag){if(callback){callback();}}};})(window.mw,jQuery);(function(mw,$){"use strict";mw.mergeConfig('EmbedPlayer.Attributes',{"id":null,"width":null,"height":null,"src":null,"poster":null,"autoplay":false,"loop":false,"controls":true,"paused":true,"readyState":0,"networkState":0,"currentTime":0,"previousTime":0,"previousVolume":1,"volume":1,"preMuteVolume":1,"duration":null,'data-durationhint':null,'durationHint':null,"muted":false,"isFlavorSwitching":false,'videoAspect':'4:3',"start":0,"end":null,"overlaycontrols":true,"usenativecontrols":false,'attributionbutton':true,'playerError':{},'data-blockPlayerDisplay':null,"startOffset":0,"downloadLink":true,"type":null,"adsOnReplay":false,"live":false,"liveOffSynch":false,"isAudioPlayer":false,"enableTooltips":true,"sourcesReplaced":false,"streamerType":'http',"shouldEndClip":true,"buffering":false,"casting":false});mw.mergeConfig('EmbedPlayer.SourceAttributes',['id','src','title','label','URLTimeEncoding','startOffset','start','end','default','title','titleKey']);mw.EmbedPlayer=function(element){return this.init(element);};mw.EmbedPlayer.prototype={'plugins':{},'mediaElement':null,'supports':{},'playerReadyFlag':false,'loadError':false,'thumbnailUpdatingFlag':false,'stopped':true,'cmmlData':null,'seeking':false,'bufferedPercent':0,'monitorTimerId':null,'bufferStartFlag':false,'bufferEndFlag':false,'pauseTime':null,'donePlayingCount':0,'_propagateEvents':true,'onDoneInterfaceFlag':true,'_checkHideSpinner':false,'_playContorls':true,'displayPlayer':true,'widgetLoaded':false,currentState:null,playbackRate:false,shouldHandlePlayerError:true,"manifestAdaptiveFlavors":[],clipDoneTimeout:null,playerPrefix:'BasePlayer',currentBitrate:-1,drmRequired:false,liveEdgeOffset:0,init:function(element){var _this=this;var playerAttributes=mw.getConfig('EmbedPlayer.Attributes');this.rewriteElementTagName=element.tagName.toLowerCase();for(var attr in playerAttributes){if(element.getAttribute(attr)!=null){if(element.getAttribute(attr)==''){this[attr]=true;}else{this[attr]=element.getAttribute(attr);}}else{this[attr]=playerAttributes[attr];}if(this[attr]=="false")this[attr]=false;if(this[attr]=="true")this[attr]=true;}if(!this.width){this.width=$(element).width()
$(element).attr('width',this.width)}if(!this.height){this.height=$(element).height()
$(element).attr('height',this.height)}if(this.useNativePlayerControls()){_this.controls=true;}if(!this.skinName){this.skinName=mw.getConfig('EmbedPlayer.DefaultSkin');}if(!this.monitorRate){this.monitorRate=mw.getConfig('EmbedPlayer.MonitorRate');}this.startOffset=parseFloat(this.startOffset);if(element.duration){_this.duration=element.duration;}if(_this['data-durationhint']){_this.durationHint=_this['data-durationhint'];}if(_this.durationHint&&!_this.duration){_this.duration=mw.npt2seconds(_this.durationHint);}this.duration=parseFloat(this.duration);mw.log('EmbedPlayer::init:'+this.id+' duration is: '+this.duration+', size: '+$(element).width()+'x'+$(element).height());this.pid='pid_'+this.id;this.mediaElement=new mw.MediaElement(element);},bindHelper:function(name,callback){$(this).bind(name,callback);return this;},unbindHelper:function(bindName){if(bindName){$(this).unbind(bindName);}return this;},bindOnceHelper:function(name,callback){$(this).one(name,callback);return this;},triggerQueueCallback:function(name,callback){$(this).triggerQueueCallback(name,callback);},triggerHelper:function(name,obj){try{$(this).trigger(name,obj);}catch(e){mw.log("EmbedPlayer:: possible error in trigger: "+name+" "+e.toString());}},log:function(message){mw.log(this.playerPrefix+"::"+message);},addPlayerStateChangeBindings:function(){var _this=this;var bindPostfix='.stateManager';var getStatesCssClasses=function(){var classes='';var states=['start','load','play','pause','end'];$.each(states,function(idx,state){var space=(states.length-1==idx)?'':' ';classes+=state+'-state'+space;});return classes;};var eventStateMap={'playerReady':'start','onplay':function(){return _this.isPlaying()?'play':'load';},'playing':'play','onPauseInterfaceUpdate':'pause','onEndedDone':'end','preSeek':'load','seeked':function(){return _this.isPlaying()?'play':'pause';}};var doChangeState=function(newState){if(newState!==_this.currentState){var oldState=_this.currentState;_this.currentState=newState;_this.getInterface().removeClass(getStatesCssClasses()).addClass(newState+'-state');$(_this).trigger('onPlayerStateChange',[newState,oldState]);}};this.unbindHelper(bindPostfix);$.each(eventStateMap,function(eventName,state){_this.bindHelper(eventName+bindPostfix,function(){var stateString=(typeof state==='function')?state():state;doChangeState(stateString);});});this.bindOnceHelper("layoutBuildDone",function(){_this.doUpdateLayout();});if(!this.currentState){doChangeState('load');}},stopEventPropagation:function(){mw.log("EmbedPlayer:: stopEventPropagation");this.stopMonitor();this._propagateEvents=false;},restoreEventPropagation:function(){mw.log("EmbedPlayer:: restoreEventPropagation");this.startMonitor();this._propagateEvents=true;},getPluginInstance:function(pluginName){if(!this.plugins[pluginName]){mw.log('EmbedPlayer:: getPluginInstance: plugin "'+pluginName+'" not initialsed.');return;}return this.plugins[pluginName];},enableNativeControls:function(){mw.log('Error: function enableNativeControls should be implemented by embed player interface ');return;},enablePlayControls:function(excludedComponents){if(this._playContorls||this.getError()!==null){return;}mw.log("EmbedPlayer:: enablePlayControls");excludedComponents=excludedComponents||[];this._playContorls=true;$(this).trigger('onEnableInterfaceComponents',[excludedComponents]);},disablePlayControls:function(excludedComponents){if(!this._playContorls){return;}mw.log("EmbedPlayer:: disablePlayControls");if(!excludedComponents){excludedComponents=['fullScreenBtn','logo','volumeControl'];if(mw.getConfig('enableControlsDuringAd')){excludedComponents.push('playPauseBtn');}}this._playContorls=false;$(this).trigger('onDisableInterfaceComponents',[excludedComponents]);},updateFeatureSupport:function(){mw.log("EmbedPlayer::updateFeatureSupport trigger: updateFeatureSupportEvent");$(this).trigger('updateFeatureSupportEvent',this.supports);return;},applyIntrinsicAspect:function(){var $img=this.getInterface().find('.playerPoster');if($img.length){var pHeight=this.getVideoDisplay().height();var pWidth=parseInt($img.naturalWidth()/$img.naturalHeight()*pHeight);var pClass='fill-height';if(pWidth>this.getVideoDisplay().width()){pClass='fill-width';}$img.removeClass('fill-width fill-height').addClass(pClass);if(this.getFlashvars("stretchVideo")===true){$img.removeClass(pClass).addClass('fill-width fill-height');}}},loadPlayerSize:function(element){this.height=element.height>0?element.height+'':$(element).css('height');this.width=element.width>0?element.width+'':$(element).css('width');if(this.height=='32px'||this.height=='32px'){this.width='100%';this.height='100%';}mw.log('EmbedPlayer::loadPlayerSize: css size:'+this.width+' h: '+this.height);if(this.height.indexOf('100%')!=-1||this.width.indexOf('100%')!=-1){var $relativeParent=$(element).parents().filter(function(){return $(this).is('body')||$(this).css('position')=='relative';}).slice(0,1);this.width=$relativeParent.width();this.height=$relativeParent.height();}this.height=parseInt(this.height);this.width=parseInt(this.width);this.height=(this.height==0||isNaN(this.height)&&$(element).attr('height'))?parseInt($(element).attr('height')):this.height;this.width=(this.width==0||isNaN(this.width)&&$(element).attr('width'))?parseInt($(element).attr('width')):this.width;if(this.isAudio()&&this.height=='32'){this.height=20;}if(this.isAudio()&&this.videoAspect){var aspect=this.videoAspect.split(':');if(this.height&&!this.width){this.width=parseInt(this.height*(aspect[0]/aspect[1]));}if(this.width&&!this.height){var apectRatio=(aspect[1]/aspect[0]);this.height=parseInt(this.width*(aspect[1]/aspect[0]));}}if((isNaN(this.height)||isNaN(this.width))||(this.height==-1||this.width==-1)||((this.height==150||this.height==64)&&this.width==300)){var defaultSize=mw.getConfig('EmbedPlayer.DefaultSize').split('x');if(isNaN(this.width)){this.width=defaultSize[0];}if(this.isAudio()){this.height=20;}else{this.height=defaultSize[1];}}},getPlayerWidth:function(){if(mw.getConfig('EmbedPlayer.IsIframeServer')){return $(window).width();}return this.getVideoHolder().width();},getPlayerHeight:function(){return this.getVideoHolder().height();},checkPlayerSources:function(){mw.log('EmbedPlayer::checkPlayerSources: '+this.id);var _this=this;$(_this).trigger('preCheckPlayerSources');$(_this).triggerQueueCallback('checkPlayerSourcesEvent',function(){_this.setupSourcePlayer();});},getTextTracks:function(){if(!this.mediaElement){return[];}return this.mediaElement.getTextTracks();},emptySources:function(){if(this.mediaElement){this.mediaElement.sources=[];this.mediaElement.selectedSource=null;}if(this.manifestAdaptiveFlavors.length){this.manifestAdaptiveFlavors=[];}this.prevPlayer=this.selectedPlayer;},getPlayerByStreamerType:function(source){var targetPlayer;if(this.casting&&!mw.getConfig('EmbedPlayer.ForceNativeComponent')===true){return mw.EmbedTypes.getMediaPlayers().getPlayerById('chromecast');}if(!mw.getConfig('EmbedPlayer.IgnoreStreamerType')&&!this.isImageSource()&&this.streamerType!='http'&&source.mimeType!=="video/youtube"&&mw.EmbedTypes.getMediaPlayers().isSupportedPlayer('kplayer')){targetPlayer=mw.EmbedTypes.getKplayer();}else{targetPlayer=mw.EmbedTypes.getMediaPlayers().getDefaultPlayer(source.mimeType);}return targetPlayer;},isImageSource:function(){return(this.mediaElement.selectedSource.getMIMEType().indexOf("image")==0)},switchPlaySource:function(source,switchCallback,doneCallback){var _this=this;var targetPlayer=this.getPlayerByStreamerType(source);if(targetPlayer.library!=this.selectedPlayer.library){this.selectPlayer(targetPlayer);this.updatePlaybackInterface(function(){_this.playerSwitchSource(source,switchCallback,doneCallback);});}else{_this.playerSwitchSource(source,switchCallback,doneCallback);}},playerSwitchSource:function(source,switchCallback,doneCallback){mw.log("Error player interface must support actual source switch");},replaceSources:function(sources){var _this=this;this.emptySources();$.each(sources,function(inx,source){_this.mediaElement.tryAddSource(source);});$(this).trigger('sourcesReplaced');},disablePlayer:function(){mw.log("Error player interface must support actual disablePlayer");},setupSourcePlayer:function(){var _this=this;mw.log("EmbedPlayer::setupSourcePlayer: "+this.id+' sources: '+this.mediaElement.sources.length);this.addPlayerStateChangeBindings();this.bindHelper('embedPlayerError',function(e,data){_this.handlePlayerError(data);});this.bindHelper('bitrateChange',function(e,data){_this.currentBitrate=data;});if(mw.getConfig('EmbedPlayer.ReplaceSources')){this.replaceSources(mw.getConfig('EmbedPlayer.ReplaceSources'));this.sourcesReplaced=true;mw.setConfig('EmbedPlayer.ReplaceSources',null);}else{this.sourcesReplaced=false;}var baseTimeOptions={'supportsURLTimeEncoding':this.supportsURLTimeEncoding(),'startTime':this.startTime,'endTime':this.pauseTime};this.mediaElement.autoSelectSource(baseTimeOptions);if(!this.mediaElement.selectedSource&&mw.getConfig("EmbedPlayer.PreloadNativeComponent")){this.selectPlayer(mw.EmbedTypes.getNativeComponentPlayerVideo());this.updatePlaybackInterface();return;}if(this.mediaElement.selectedSource){if(this.isImageSource()){mw.setConfig('EmbedPlayer.ForceNativeComponent',false);}var targetPlayer=this.getPlayerByStreamerType(this.mediaElement.selectedSource);this.selectPlayer(targetPlayer);if(this.selectedPlayer&&(!this.prevPlayer||this.prevPlayer.library!=this.selectedPlayer.library)){this.disablePlayer();this.updatePlaybackInterface();return;}}if(!this.selectedPlayer||!this.mediaElement.selectedSource){var errorObj;if(this.isDrmRequired()){if(!this.isPluginEnabled('multiDrm')){errorObj=this.getKalturaMsgObject('mwe-embedplayer-drm-error-not-enabled');}else{errorObj=this.getKalturaMsgObject('mwe-embedplayer-drm-error-not-supported');}}else{if(!mw.isMobileDevice()&&!mw.EmbedTypes.getMediaPlayers().isSupportedPlayer('splayer')){$.each(this.mediaElement.sources,function(currentIndex,currentSource){if(currentSource.getFlavorId()=="ism"){errorObj=_this.getKalturaMsgObject('mwe-embedplayer-install-silverlight');errorObj.code="7000";return;}});}}if(!errorObj){this.showPlayerError();}else{this.setError(errorObj);if(!this.changeMediaStarted){this.showErrorMsg(errorObj);}}mw.log("EmbedPlayer:: setupSourcePlayer > player ready ( but with errors ) ");}else{$(this).trigger('layoutReady');}this.playerReadyFlag=true;$(this).trigger('playerReady');this.triggerWidgetLoaded();},autoSelectTemporalSource:function(options){var baseTimeOptions={'supportsURLTimeEncoding':this.supportsURLTimeEncoding(),'startTime':this.startTime,'endTime':this.pauseTime};this.mediaElement.autoSelectSource($.extend({},baseTimeOptions,options));},updatePlaybackInterface:function(callback){var _this=this;mw.log("EmbedPlayer::updatePlaybackInterface: duration is: "+this.getDuration()+' playerId: '+this.id);if(this.instanceOf){$(this).data('previousInstanceOf',this.instanceOf);var tmpObj=mw['EmbedPlayer'+this.instanceOf];var attributes=mw.getConfig('EmbedPlayer.Attributes');for(var i in tmpObj){if(i in attributes){continue;}if(typeof this['parent_'+i]!='undefined'){this[i]=this['parent_'+i];}else{this[i]=null;}}}this.selectedPlayer.load(function(){mw.log('EmbedPlayer::updatePlaybackInterface: loaded '+_this.selectedPlayer.library+' duration: '+_this.getDuration());_this.updateLoadedPlayerInterface(callback);$(_this).trigger('PlayerLoaded');});},updateLoadedPlayerInterface:function(callback){var _this=this;mw.log('EmbedPlayer::updateLoadedPlayerInterface '+_this.selectedPlayer.library+" player loaded for: "+_this.id);var playerInterface=mw['EmbedPlayer'+_this.selectedPlayer.library];if(playerInterface.init){playerInterface.init();}for(var method in playerInterface){if(typeof _this[method]!='undefined'&&!_this['parent_'+method]){_this['parent_'+method]=_this[method];}_this[method]=playerInterface[method];}if($.isFunction(_this.setup)){var failCallback=function(){_this.removePoster();_this.layoutBuilder.displayAlert({title:_this.getKalturaMsg('ks-PLUGIN-BLOCKED-TITLE'),message:_this.getKalturaMsg('ks-PLUGIN-BLOCKED'),keepOverlay:true,noButtons:true,props:{customAlertTitleCssClass:"AlertTitleTransparent",customAlertMessageCssClass:"AlertMessageTransparent",customAlertContainerCssClass:"AlertContainerTransparent flashBlockAlertContainer"}});};_this.setup(function(){_this.runPlayerStartupMethods(callback);},failCallback);return;}_this.runPlayerStartupMethods(callback);},runPlayerStartupMethods:function(callback){this.updateFeatureSupport();this.embedPlayerHTML();this.getDuration();this.showPlayer();if($.isFunction(callback)){callback();}},selectPlayer:function(player){mw.log("EmbedPlayer:: selectPlayer "+player.id);var _this=this;if(!this.selectedPlayer||this.selectedPlayer.id!=player.id){if(this.selectedPlayer){this.clean();}this.selectedPlayer=player;}},clean:function(){},getDuration:function(){if(isNaN(this.duration)&&this.mediaElement&&this.mediaElement.selectedSource&&typeof this.mediaElement.selectedSource.durationHint!='undefined'){this.duration=this.mediaElement.selectedSource.durationHint;}return this.duration;},getHeight:function(){return this.getInterface().height();},getWidth:function(){return this.getInterface().width();},isAudio:function(){return(this.rewriteElementTagName=='audio'||(this.mediaElement&&this.mediaElement.selectedSource&&this.mediaElement.selectedSource.mimeType.indexOf('audio/')!==-1)||this.isAudioPlayer);},embedPlayerHTML:function(){return'Error: function embedPlayerHTML should be implemented by embed player interface ';},seek:function(seekTime,stopAfterSeek){if(seekTime<0){seekTime=0;}if(this.getDuration()>0&&seekTime>this.getDuration()){seekTime=this.getDuration();}seekTime=parseFloat(parseFloat(seekTime).toFixed(2));this.stopAfterSeek=(stopAfterSeek!==undefined)?stopAfterSeek:!this.isPlaying();mw.log('EmbedPlayer:: seek: to:'+seekTime+" sec, stopAfterSeek="+this.stopAfterSeek);this.kPreSeekTime=this.currentTime;var stopSeek={value:false};this.triggerHelper('preSeek',[seekTime,stopAfterSeek,stopSeek]);if(stopSeek.value){return false;}this.seeking=true;this.currentTime=seekTime;mw.log('EmbedPlayer::seek:trigger');this.triggerHelper('seeking');this.layoutBuilder.onSeek();this.unbindHelper("seeked"+this.bindPostfix).bindOnceHelper("seeked"+this.bindPostfix,this.seekedHandler);$(this).data('currentSeekTarget',seekTime);this.currentSeekTargetTime=seekTime;var playerElementTime=parseFloat(this.getPlayerElementTime()).toFixed(2);if(Math.abs(playerElementTime-seekTime)<mw.getConfig("EmbedPlayer.SeekTargetThreshold",0.1)){mw.log("EmbedPlayer:: seek: current time matches seek target: "+playerElementTime+' ~== '+seekTime);$(this).trigger('seeked');}else{var _this=this;this.canSeek().then(function(){_this.doSeek(seekTime,stopAfterSeek);});}},seekedHandler:function(){var _this=this;this.seeking=false;this.previousTime=this.currentTime=this.getPlayerElementTime();this.kPreSeekTime=null;this.removePoster();this.startMonitor();if(this.stopAfterSeek){this.hideSpinner();setTimeout(function(){_this.pause();_this.stopMonitor();_this.updatePlayheadStatus();},0);}else{setTimeout(function(){if(!_this.stopPlayAfterSeek){mw.log("EmbedPlayer::Play after seek");_this.play();_this.stopPlayAfterSeek=false;}},0);}},canSeek:function(){return $.Deferred().resolve();},setCurrentTime:function(time,callback){mw.log('Error: EmbedPlayer, setCurrentTime not overriden');if($.isFunction(callback)){callback();}},setDuration:function(newDuration){this.duration=newDuration;$(this).trigger('durationChange',[newDuration]);},triggeredEndDone:false,postSequenceFlag:false,onClipDone:function(){var _this=this;this.cancelClipDoneGuard();if(!_this._propagateEvents){return;}mw.log('EmbedPlayer::onClipDone: propagate:'+_this._propagateEvents+' id:'+this.id+' doneCount:'+this.donePlayingCount+' stop state:'+this.isStopped());if(!this.isStopped()){this.stopped=true;this.isPauseLoading=false;if(!this.onDoneInterfaceFlag){this.stopEventPropagation();}mw.log("EmbedPlayer:: trigger: ended ( inteface continue pre-check: "+this.onDoneInterfaceFlag+' )');$(this).trigger('ended');mw.log("EmbedPlayer::onClipDone:Trigged ended, continue? "+this.onDoneInterfaceFlag);if(!this.onDoneInterfaceFlag||this.isInSequence()){this.restoreEventPropagation();return;}if(!this.stopAfterSeek){this.stopAfterSeek=true;}if(this.onDoneInterfaceFlag){mw.log("EmbedPlayer::onDoneInterfaceFlag=true do interface done");_this.donePlayingCount++;if(_this.loop){var startTime=0.01;if(this.startOffset){startTime=this.startOffset;}this.seek(startTime,false);}else{_this.stop();mw.log("EmbedPlayer:: trigger: onEndedDone");if(!_this.triggeredEndDone){_this.triggeredEndDone=true;_this.ignoreNextNativeEvent=true;$(_this).trigger('onEndedDone');}if(_this.buffering){_this.bufferEnd();}}}if(this.onDoneInterfaceFlag){mw.log("EmbedPlayer:: trigger: playbackComplete");$(this).trigger('playbackComplete');mw.log("EmbedPlayer:: trigger: postEnded");$(this).trigger('postEnded');}}if(this.getFlashvars("EmbedPlayer.ShowPosterOnStop")!==false&&!this.loop){this.updatePosterHTML();}},replay:function(){var _this=this;var startTime=0.01;setTimeout(function(){if(_this.startOffset){startTime=_this.startOffset;}_this.seek(startTime,false);},10);},showThumbnail:function(){var _this=this;mw.log('EmbedPlayer::showThumbnail::'+this.stopped);this.layoutBuilder.closeMenuOverlay();this.updatePosterHTML();this.paused=true;this.stopped=true;this.layoutBuilder.addControlBindings();if(!this.useNativePlayerControls()){mw.log("mediaLoaded");$(this).trigger('mediaLoaded');}},addControls:function(){if(this.controls){this.layoutBuilder.addControls();}},showPlayer:function(){mw.log('EmbedPlayer:: showPlayer: '+this.id+' interace: w:'+this.width+' h:'+this.height);var _this=this;if(mw.getConfig('preload')==='auto'){this.load();}this.hideSpinner();if(!this.useNativePlayerControls()&&this.isPersistentNativePlayer()){$(this).show();}this.addControls();this.updatePosterHTML();if(this.displayPlayer===false){_this.getVideoHolder().hide();_this.getInterface().height(_this.layoutBuilder.getComponentsHeight());}this.doUpdateLayout();this.playerReadyFlag=true;if(this.mediaElement&&this.mediaElement.selectedSource&&this.mediaElement.selectedSource.mimeType==="video/youtube"){mw.log("EmbedPlayer:: Loading Youtube player. playerReady event to be dispatched by Youtube player.");}else{mw.log("EmbedPlayer:: Trigger: playerReady");$(this).trigger('playerReady');}this.triggerWidgetLoaded();if(this['data-blockPlayerDisplay']){this.blockPlayerDisplay();return;}if(this.getError()){this.showErrorMsg(this.getError());return;}if(this.isStopped()&&this.autoplay&&!this.changeMediaStarted&&this.canAutoPlay()&&!this.isLive()){mw.log('EmbedPlayer::showPlayer::Do autoPlay');_this.play();}},canAutoPlay:function(){return false;},doUpdateLayout:function(skipTrigger){var containerHeight=this.layoutBuilder.getContainerHeight();var newHeight=containerHeight-this.layoutBuilder.getComponentsHeight();var currentHeight=this.getVideoHolder().height();var deltaHeight=Math.abs(currentHeight-newHeight);mw.log('EmbedPlayer: doUpdateLayout:: containerHeight: '+containerHeight+', components: '+this.layoutBuilder.getComponentsHeight()+', videoHolder old height: '+currentHeight+', new height: '+newHeight+' hight delta: '+deltaHeight);if(currentHeight!==newHeight&&deltaHeight>1){this.getVideoHolder().height(newHeight);}if(this.isStopped()&&!(this.sequenceProxy&&this.sequenceProxy.isInSequence)&&!this.removePosterFlag){this.updatePosterHTML();}if(!skipTrigger&&deltaHeight!=1){mw.log('EmbedPlayer: updateLayout: trigger "updateLayout" ');this.triggerHelper('updateLayout');}},getInterface:function(){if(!this.$interface){var _this=this;this.layoutBuilder=new mw.PlayerLayoutBuilder(this);this.$interface=this.layoutBuilder.getInterface();if(mw.getConfig('EmbedPlayer.IsIframeServer')){$(window).off("debouncedresize").on("debouncedresize",function(){mw.log('debouncedresize:: call doUpdateLayout');_this.triggerHelper('resizeEvent');_this.doUpdateLayout();});}}return this.$interface;},updateInterfaceSize:function(size){var oldH=this.getInterface().height();var oldW=this.getInterface().width();if(size.width!=oldW||size.height!=oldH){this.getInterface().css(size);this.doUpdateLayout(true);}},setError:function(errorObj){var _this=this;if(typeof errorObj=='string'){this.playerError={'title':_this.getKalturaMsg('ks-GENERIC_ERROR_TITLE'),'message':errorObj}
return;}this.playerError=errorObj;},getError:function(){if(!$.isEmptyObject(this.playerError)){return this.playerError;}return null;},showErrorMsg:function(errorObj){this.hideSpinner();this.triggerHelper('playerError',errorObj);this.changeMediaStarted=false;if(this.layoutBuilder){if(mw.getConfig("EmbedPlayer.ShowPlayerAlerts")){var alertObj=$.extend(errorObj,{'isModal':true,'keepOverlay':true,'noButtons':true,'isError':true});this.layoutBuilder.displayAlert(alertObj);}}return;},blockPlayerDisplay:function(){this.getInterface().find('.error').hide();},showPlayerError:function(){var _this=this;var $this=$(this);mw.log("EmbedPlayer::showPlayerError");this.hideSpinner();$this.trigger('mediaLoadError');$this.trigger('mediaError');if(this['data-blockPlayerDisplay']){this.blockPlayerDisplay();return;}if(this.getError()){this.showErrorMsg(this.getError());return;}this.showNoInlinePlabackSupport();},isLinkPlayerFlag:false,isLinkPlayer:function(){return this.isLinkPlayerFlag;},showNoInlinePlabackSupport:function(){var _this=this;var $this=$(this);if(this.mediaElement.sources.length==0||!mw.getConfig('EmbedPlayer.NotPlayableDownloadLink')){if(this.kentryid){this.showNoPlayableSources();}else if(this.getFlashvars().referenceId){this.showWrongReferenceIdMessege();}return;}this.isLinkPlayerFlag=true;this.updatePosterHTML();this.addControls();var downloadUrl=this.mediaElement.sources[0].getSrc();this.triggerHelper('directDownloadLink',function(dlUrl){if(dlUrl){downloadUrl=dlUrl;}});$(this).trigger('showInlineDownloadLink',[downloadUrl]);},showNoPlayableSources:function(){var $this=$(this);var errorObj=this.getKalturaMsgObject('mwe-embedplayer-missing-source');$this.trigger('NoSourcesCustomError',function(customErrorMsg){if(customErrorMsg){errorObj.message=customErrorMsg;}});this.setError(errorObj);this.showErrorMsg(errorObj);return;},showWrongReferenceIdMessege:function(){var $this=$(this);var errorObj=this.getKalturaMsgObject('mwe-embedplayer-wrong-reference-id');$this.trigger('WrongReferenceIdCustomError',function(customErrorMsg){if(customErrorMsg){errorObj.message=customErrorMsg;}});this.setError(errorObj);this.showErrorMsg(errorObj);return;},updateThumbTimeNPT:function(time){this.updateThumbTime(mw.npt2seconds(time)-parseInt(this.startOffset));},updateThumbTime:function(floatSeconds){var _this=this;if(typeof this.orgThumSrc=='undefined'){this.orgThumSrc=this.poster;}if(this.orgThumSrc.indexOf('t=')!==-1){this.lastThumbUrl=mw.replaceUrlParams(this.orgThumSrc,{'t':mw.seconds2npt(floatSeconds+parseInt(this.startOffset))});if(!this.thumbnailUpdatingFlag){this.updatePoster(this.lastThumbUrl,false);this.lastThumbUrl=null;}}},updateThumbPerc:function(percent){return this.updateThumbTime((this.getDuration()*percent));},updatePoster:function(posterSrc,alt){if(!posterSrc){posterSrc=mw.getConfig('EmbedPlayer.BlackPixel');}this.poster=posterSrc;this.posterAlt=alt||gM('mwe-embedplayer-video-thumbnail');this.updatePosterHTML();},changeMedia:function(callback,checkPlayerSourcesFunction,resetPlaybackValues){var _this=this;var $this=$(this);mw.log('EmbedPlayer:: changeMedia ');this.removePoster();$this.trigger('onChangeMedia');this.emptySources();this.firstPlay=true;if(resetPlaybackValues||resetPlaybackValues===undefined){this.donePlayingCount=0;this.triggeredEndDone=false;this.preSequenceFlag=false;this.postSequenceFlag=false;this.shouldEndClip=true;this.mediaLoadedFlag=false;}this.isPauseLoading=true;this.pause();this.addPlayerSpinner();this.stopMonitor();this.resetPlaybackValues();this.setError(null);this['data-blockPlayerDisplay']=null;$this.attr('data-blockPlayerDisplay','');this.getInterface().find('.error').remove();this.layoutBuilder.closeAlert();this.layoutBuilder.closeMenuOverlay();var bindName='playerReady.changeMedia';$this.one(bindName,function(){mw.log('EmbedPlayer::changeMedia playerReady callback');_this.hideSpinner();if(_this.getError()){_this.changeMediaStarted=false;_this.showErrorMsg(_this.getError());return;}var changeMediaDoneCallback=function(){_this.changeMediaStarted=false;$(".mwEmbedPlayer").removeClass("mwEmbedPlayerBlackBkg");if(_this.canAutoPlay()){if(!_this.isAudioPlayer){_this.removePoster();}}$this.trigger('onChangeMediaDone');if(callback){callback();}};if($.isFunction(_this.changeMediaCallback)){setTimeout(function(){_this.changeMediaCallback(changeMediaDoneCallback);},250);}else{changeMediaDoneCallback();}});if(checkPlayerSourcesFunction){checkPlayerSourcesFunction(function(){mw.log("EmbedPlayer::changeMedia:  Done with checkPlayerSourcesFunction");_this.setupSourcePlayer();});}else{$this.triggerQueueCallback('checkPlayerSourcesEvent',function(){mw.log("EmbedPlayer::changeMedia:  Done with checkPlayerSourcesEvent");_this.setupSourcePlayer();});}},isImagePlayScreen:function(){return(this.useNativePlayerControls()&&!this.isLinkPlayer()&&mw.isIphone()&&mw.getConfig('EmbedPlayer.iPhoneShowHTMLPlayScreen'));},isPlaylistScreen:function(){return!(typeof this.playlist=="undefined");},triggerWidgetLoaded:function(){if(!this.widgetLoaded){this.widgetLoaded=true;mw.log("EmbedPlayer:: Trigger: widgetLoaded");this.triggerHelper('widgetLoaded');}},addBlackScreen:function(){var posterSrc=mw.getConfig('EmbedPlayer.BlackPixel');var posterCss={'position':'absolute','height':'100%','width':'100%'};$(this).html($('<img />').css(posterCss).attr({'src':posterSrc}).addClass('blackPlayer')).show();},removeBlackScreen:function(){$(this).find('.blackPlayer').remove();},updatePosterHTML:function(){mw.log('EmbedPlayer:updatePosterHTML:'+this.id+' poster:'+this.poster);var _this=this;var posterSrc=this.poster;var posterCss={};if(!posterSrc){posterSrc=mw.getConfig('EmbedPlayer.BlackPixel');posterCss={'position':'absolute','height':'100%','width':'100%'};}$(this).find(".playerPoster").remove();if(this.currentState=="load"&&mw.getConfig('autoPlay')&&!mw.isMobileDevice()&&!this.isAudio()){return;}if(mw.getConfig('EmbedPlayer.HidePosterOnStart')===true&&!(this.currentState=="end"&&mw.getConfig('EmbedPlayer.ShowPosterOnStop'))){return;}if(mw.isIE9Comp()||mw.isIE10Comp()){$(this).addClass("mwEmbedPlayerTransparentComp");}else{if(mw.isIE8()||mw.isIE7()){$(this).addClass("mwEmbedPlayerTransparent");}}$(".mwEmbedPlayer").addClass("mwEmbedPlayerBlackBkg");$(this).html($('<img />').css(posterCss).attr({'src':this.poster}).addClass('playerPoster').load(function(){_this.applyIntrinsicAspect();$('.playerPoster').attr('alt',_this.posterAlt);})).show();},removePoster:function(){if(!mw.getConfig("EmbedPlayer.KeepPoster")===true&&!this.isAudio()){$(".mwEmbedPlayer").removeClass("mwEmbedPlayerBlackBkg");$(this).find('.playerPoster').remove();}},useNativePlayerControls:function(){if(this.usenativecontrols===true){return true;}if(mw.getConfig('EmbedPlayer.NativeControls')===true){return true;}if(mw.getConfig("EmbedPlayer.ForceNativeComponent")){return false;}if((mw.isAndroidNativeBrowser()||(mw.isIphone()&&!this.inline))&&!mw.isWindowsPhone()){return true;}if(mw.isIpad()){if(mw.getConfig('EmbedPlayer.EnableIpadNativeFullscreen')&&this.layoutBuilder&&this.layoutBuilder.isInFullScreen()){return true;}else if(this.isPersistentNativePlayer()&&mw.getConfig('EmbedPlayer.EnableIpadHTMLControls')===true){return false;}else{return true;}}return false;},isDvrSupported:function(){return(mw.isNativeApp()||!mw.isAndroid());},isPersistentNativePlayer:function(){if(this.isLinkPlayer()){return false;}if($('#'+this.pid).length==0){return $('#'+this.id).hasClass('persistentNativePlayer');}return $('#'+this.pid).hasClass('persistentNativePlayer');},isOverlayControls:function(){if(!this.supports['overlays']){return false;}if(this.overlaycontrols===false){return false;}if(this.isAudio()&&!this.isMobileSkin()){return false;}if(mw.getConfig('EmbedPlayer.OverlayControls')===false){return false;}if(this.controls===false){return false;}return true;},getVideoHolder:function(){return this.getInterface().find('.videoHolder');},getVideoDisplay:function(){return this.getInterface().find('.videoDisplay');},getControlBarContainer:function(){return this.getInterface().find('.controlBarContainer');},getTopBarContainer:function(){return this.getInterface().find('.topBarContainer');},getPlayerPoster:function(){return this.getInterface().find('.playerPoster');},getNativePlayerHtml:function(){return $('<div />').css('width',this.getWidth()).html('Error: Trying to get native html5 player without native support for codec');},applyMediaElementBindings:function(){mw.log("Warning applyMediaElementBindings should be implemented by player interface");return;},getSharingEmbedCode:function(){switch(mw.getConfig('EmbedPlayer.ShareEmbedMode')){case'iframe':return this.getShareIframeObject();break;case'videojs':return this.getShareEmbedVideoJs();break;}},getShareIframeObject:function(){var iframeUrl=this.getIframeSourceUrl();var embedCode='&lt;iframe src=&quot;'+mw.html.escape(iframeUrl)+'&quot; ';embedCode+='width=&quot;'+this.getPlayerWidth()+'&quot; ';embedCode+='height=&quot;'+this.getPlayerHeight()+'&quot; ';embedCode+='allowfullscreen webkitallowfullscreen mozAllowFullScreen ';embedCode+='frameborder=&quot;0&quot; ';embedCode+='&gt;&lt/iframe&gt;';return embedCode;},getIframeSourceUrl:function(){var iframeUrl=false;this.triggerHelper('getShareIframeSrc',function(localIframeSrc){if(iframeUrl){mw.log("Error multiple modules binding getShareIframeSrc");}iframeUrl=localIframeSrc;});if(iframeUrl){return iframeUrl;}var iframeUrl=mw.getMwEmbedPath()+'mwEmbedFrame.php?';var params={'src[]':[]};for(var i=0;i<this.mediaElement.sources.length;i++){var source=this.mediaElement.sources[i];if(source.src){params['src[]'].push(mw.absoluteUrl(source.src));}}if(this.poster){params.poster=this.poster;}if(this.skinName){params.skin=this.skinName;}if(this.duration){params.durationHint=parseFloat(this.duration);}iframeUrl+=$.param(params);return iframeUrl;},getShareEmbedVideoJs:function(){var embedtag=(this.isAudio())?'audio':'video';var embedCode='&lt;script type=&quot;text/javascript&quot; '+'src=&quot;'+mw.html.escape(mw.absoluteUrl(mw.getMwEmbedSrc()))+'&quot;&gt;&lt;/script&gt'+'&lt;'+embedtag+' ';if(this.poster){embedCode+='poster=&quot;'+mw.html.escape(mw.absoluteUrl(this.poster))+'&quot; ';}if(this.skinName){embedCode+='class=&quot;'+mw.html.escape(this.skinName)+'&quot; ';}if(this.duration){embedCode+='durationHint=&quot;'+parseFloat(this.duration)+'&quot; ';}if(this.width||this.height){embedCode+='style=&quot;';embedCode+=(this.width)?'width:'+this.width+'px;':'';embedCode+=(this.height)?'height:'+this.height+'px;':'';embedCode+='&quot; ';}embedCode+='&gt;';for(var i=0;i<this.mediaElement.sources.length;i++){var source=this.mediaElement.sources[i];if(source.src){embedCode+='&lt;source src=&quot;'+mw.absoluteUrl(source.src)+'&quot; &gt;&lt;/source&gt;';}}embedCode+='&lt;/video&gt;';return embedCode;},isInSequence:function(){return(this.sequenceProxy&&this.sequenceProxy.isInSequence);},isMobileSkin:function(){var skin=this.getRawKalturaConfig("layout")?this.getRawKalturaConfig("layout").skin:window["kalturaIframePackageData"].playerConfig.layout?window["kalturaIframePackageData"].playerConfig.layout.skin:"kdark";return(mw.isChromeCast()||(mw.getConfig("EmbedPlayer.EnableMobileSkin")===true&&skin==="kdark"&&mw.isMobileDevice()&&!mw.isWindowsPhone()));},triggerPreSequence:function(){mw.log("EmbedPlayer:: trigger preSequence ");this.triggerHelper('preSequence');this.playInterfaceUpdate();},isTimeUpdateSupported:function(){return true;},firstPlay:true,preSequenceFlag:false,inPreSequence:false,replayEventCount:0,play:function(){if(this.seeking){this.log("Play while seeking, will play after seek!");this.stopAfterSeek=false;return false;}var _this=this;var $this=$(this);if(this.currentState=="end"){this.stopPlayAfterSeek=false;this.seek(0.01,false);return false;}mw.log("EmbedPlayer:: play: "+this._propagateEvents+' isStopped: '+_this.isStopped());this.absoluteStartPlayTime=new Date().getTime();if(this.getError()){return false;}var prePlay={allowPlayback:true};this.triggerHelper('prePlayAction',[prePlay]);if(!prePlay.allowPlayback){return false;}if(_this.isStopped()&&(_this.preSequenceFlag==false||(_this.sequenceProxy&&_this.sequenceProxy.isInSequence==false))){if(!_this.selectedPlayer){_this.showPlayerError();return false;}else{_this.embedPlayerHTML();}}if(this.isTimeUpdateSupported()){this.addPlayerSpinner();this.hideSpinnerOncePlaying();}_this.stopped=false;if(!this.preSequenceFlag){this.preSequenceFlag=true;this.triggerPreSequence();if(_this.sequenceProxy&&_this.sequenceProxy.isInSequence){mw.log("EmbedPlayer:: isInSequence, do NOT play content");return false;}}if(!this.isAudioPlayer&&!this.casting){this.removePoster();}if(this.firstPlay&&this._propagateEvents){this.firstPlay=false;this.triggerHelper('firstPlay');}if(this.paused===true){this.paused=false;}mw.log("EmbedPlayer:: trigger play event::"+!this.paused+' events:'+this._propagateEvents);if(this._propagateEvents){this.triggerHelper('onplay');}if(this.donePlayingCount>0&&!this.paused&&this._propagateEvents){this.triggeredEndDone=false;this.shouldEndClip=true;if(this.replayEventCount<this.donePlayingCount){mw.log("EmbedPlayer::play> trigger replayEvent");this.triggerHelper('replayEvent');this.replayEventCount++;}}if(!this.supportsURLTimeEncoding()){this.addStartTimeCheck();}this.playInterfaceUpdate();if(_this._playContorls){return true;}else{mw.log("EmbedPlayer::play: _playContorls is false");return false;}},addStartTimeCheck:function(){var _this=this;if(this.startTime){$(this).bind('playing.startTime',function(){$(_this).unbind('playing.startTime');if(_this.currentTime<_this.startTime){if(!mw.isIOS()){_this.seek(_this.startTime);_this.startTime=0;}else{setTimeout(function(){_this.seek(_this.startTime,false);_this.startTime=0;},500)}}});}},playInterfaceUpdate:function(){var _this=this;mw.log('EmbedPlayer:: playInterfaceUpdate');if(this.layoutBuilder){this.layoutBuilder.closeMenuOverlay();}this.getInterface().find('.error').remove();this.hideSpinnerOncePlaying();this.restoreComponentsHover();$(this).trigger('onPlayInterfaceUpdate');},pauseLoading:function(){this.isPauseLoading=true;this.pause();this.addPlayerSpinner();},addPlayerSpinner:function(){if(!mw.isChromeCast()){var sId='loadingSpinner_'+this.id;$(this).trigger('onAddPlayerSpinner');$('#'+sId).remove();var target=this;switch(mw.getConfig("EmbedPlayer.SpinnerTarget")){case"videoHolder":target=this.getVideoHolder();break;case"videoDisplay":target=this.getVideoDisplay();break;default:target=this;}$(target).getAbsoluteOverlaySpinner().attr('id',sId);}},hideSpinner:function(){$(this).trigger('onRemovePlayerSpinner');var $spinner=$('#loadingSpinner_'+this.id+',.loadingSpinner');if($spinner.length>0){$spinner.remove();}},hideSpinnerAndPlayBtn:function(){this.isPauseLoading=false;this.hideSpinner();},hideSpinnerOncePlaying:function(){this._checkHideSpinner=true;},pause:function(){mw.log("EmbedPlayer::pause()");var _this=this;if(this.paused===false){this.stopMonitor();this.paused=true;if(this._propagateEvents){mw.log('EmbedPlayer:trigger pause:'+this.paused);$(this).trigger('onpause');}}_this.pauseInterfaceUpdate();},pauseInterfaceUpdate:function(){var _this=this;mw.log("EmbedPlayer::pauseInterfaceUpdate");this.hideSpinner();this.disableComponentsHover();this.clearClipDoneGuard();$(this).trigger('onPauseInterfaceUpdate');},load:function(){mw.log('Waring:: the load method should be overided by player interface');},stop:function(){var _this=this;mw.log('EmbedPlayer::stop:'+this.id);this.stopped=true;if(this.adsOnReplay){this.preSequenceFlag=false;}$(this).trigger('doStop');this.didSeekJump=false;this.stopMonitor();if(!this.paused){this.pause();}this.resetPlaybackValues();},resetPlaybackValues:function(){this.currentTime=this.previousTime=0;this.updateBufferStatus(0);this.updatePlayHead(0);},togglePlayback:function(){if(this.paused){this.triggerHelper('userInitiatedPlay');this.play();}else{this.triggerHelper('userInitiatedPause');this.pause();}},isMuted:function(){return this.muted;},toggleMute:function(forceMute){mw.log('EmbedPlayer::toggleMute> (old state:) '+this.muted);if(forceMute||!this.muted){this.muted=true;this.preMuteVolume=this.volume;var percent=0;}else{this.muted=false;var percent=this.preMuteVolume;}this.setVolume(percent,true);$(this).trigger('onToggleMute',[percent]);},setVolume:function(percent,triggerChange){var _this=this;if(isNaN(percent)){return;}this.previousVolume=this.volume;if(this.previousVolume==percent){triggerChange=false;}this.volume=percent;this.muted=(percent===0);this.setPlayerElementVolume(percent);if(triggerChange!==false){if(this.previousVolume===0&&this.volume>0){$(_this).trigger('unmute');}if(this.previousVolume>0&&this.volume===0){$(_this).trigger('mute');}$(_this).trigger('volumeChanged',percent);}},setPlayerElementVolume:function(percent){mw.log('Error player does not support volume adjustment');},getPlayerElementVolume:function(){return this.volume;},getPlayerElementMuted:function(){return this.muted;},toggleFullscreen:function(){this.layoutBuilder.fullScreenManager.toggleFullscreen();},postEmbedActions:function(){return;},isPlaying:function(){if(this.stopped||this.paused){return false;}return true;},isStopped:function(){return this.stopped;},stopMonitor:function(){clearInterval(this.monitorInterval);this.monitorInterval=0;},startMonitor:function(){this.monitor();},monitor:function(){var _this=this;_this.syncCurrentTime();_this.syncVolume();_this.syncMonitor();if(_this._propagateEvents){if(!_this.seeking&&!_this.isFlavorSwitching){this.updatePlayheadStatus();this.checkClipDoneCondition();}$(_this).trigger('monitorEvent');if(_this.progressEventData){$(_this).trigger('progress',_this.progressEventData);}}},syncMonitor:function(){var _this=this;if(!this.isStopped()){if(!this.monitorInterval){this.monitorInterval=setInterval(function(){if(_this.monitor)_this.monitor();},this.monitorRate);}}else{this.stopMonitor();}},syncVolume:function(){var _this=this;_this.previousVolume=_this.volume;_this.volume=this.getPlayerElementVolume();if(_this.muted!=_this.getPlayerElementMuted()&&!_this.isStopped()){mw.log("EmbedPlayer::syncVolume: muted does not mach embed player");_this.toggleMute();_this.muted=_this.getPlayerElementMuted();}},bufferHandling:function(){if(!this.isLive()&&this.instanceOf!='ImageOverlay'){if(this.isPlaying()&&this.currentTime==this.getPlayerElementTime()){this.bufferStart();}else if(this.buffering){this.bufferEnd();}}},syncCurrentTime:function(){var _this=this;if(_this._checkHideSpinner&&_this.getPlayerElementTime()&&_this.currentTime!=_this.getPlayerElementTime()&&!_this.seeking){_this._checkHideSpinner=false;_this.isPauseLoading=false;_this.hideSpinner();}if(parseInt(_this.previousTime)!=parseInt(_this.currentTime)&&!this.userSlide&&!this.seeking&&!this.isStopped()){if(_this.getDuration()&&_this.currentTime<=_this.getDuration()){var seekPercent=_this.currentTime/_this.getDuration();mw.log("EmbedPlayer::syncCurrentTime::"+_this.previousTime+' != '+_this.currentTime+" javascript based currentTime update to "+_this.currentTime);_this.previousTime=_this.currentTime;this.seek(_this.currentTime);}}this.bufferHandling();_this.currentTime=_this.getPlayerElementTime();_this.previousTime=_this.currentTime;if(_this.pauseTime&&_this.currentTime>_this.pauseTime&&!this.supportsURLTimeEncoding()){_this.pause();_this.pauseTime=null;}},updatePlayheadStatus:function(){if(this.currentTime>=0&&this.duration){if(!this.userSlide&&!this.seeking){var playHeadPercent=(this.currentTime-this.startOffset)/this.duration;this.updatePlayHead(playHeadPercent);if(this.isDVR()){var perc=parseInt(playHeadPercent*1000);if(perc>998){this.liveEdgeOffset=0;}else{this.liveEdgeOffset=this.duration-perc/1000*this.duration;}}}}},checkClipDoneCondition:function(){if(this.currentTime>=0&&this.duration){if(!this.isLive()){var endPresentationTime=this.duration;var dvrWindow=(this.currentTime-this.startOffset);var endTimeRatio=dvrWindow/endPresentationTime;if(dvrWindow>=endPresentationTime&&!this.isStopped()){this.log("updatePlayheadStatus > should run clip done :: "+this.currentTime+' > '+endPresentationTime);this.onClipDone();}else if(endTimeRatio>=.99&&!this.isInSequence()){this.setClipDoneGuard();}}}},setClipDoneGuard:function(){if(!this.clipDoneTimeout&&this.shouldEndClip){var _this=this;var timeoutVal=(Math.abs(this.duration-this.currentTime)*2);this.log("Setting clip done guard check in "+timeoutVal+" seconds");this.clipDoneTimeout=setTimeout(function(){if(_this.shouldEndClip&&!_this.isLive()){_this.log("clipDone guard > should run clip done :: "+_this.currentTime);_this.onClipDone();}_this.clipDoneTimeout=null;},(timeoutVal*1000));this.unbindHelper(".clipDoneGuard").bindOnceHelper("seeking.clipDoneGuard",function(){_this.cancelClipDoneGuard();})}},cancelClipDoneGuard:function(){this.log("Cancel clipDone guard");this.shouldEndClip=false;this.clearClipDoneGuard();},clearClipDoneGuard:function(){if(this.clipDoneTimeout){this.log("Clear clipDone guard timer");clearTimeout(this.clipDoneTimeout);this.clipDoneTimeout=null;}},getPlayerElementTime:function(){mw.log("Error: getPlayerElementTime should be implemented by embed library");},resolveSrcURL:function(srcURL){var deferred=$.Deferred();deferred.resolve(srcURL);return deferred;},getPlayerElement:function(){mw.log("Error: getPlayerElement should be implemented by embed library, or you may be calling this event too soon");},updateBufferStatus:function(percent){if(percent>1){this.bufferedPercent=1;}else{this.bufferedPercent=percent;}$(this).trigger('updateBufferPercent',this.bufferedPercent);},updatePlayHead:function(perc){$(this).trigger('updatePlayHeadPercent',perc);},getSrc:function(){if(!this.mediaElement){return false;}if(!this.mediaElement.selectedSource){this.autoSelectTemporalSource();};if(this.mediaElement.selectedSource){return this.mediaElement.selectedSource.getSrc();}return false;},getSource:function(){this.autoSelectTemporalSource();if(this.mediaElement.selectedSource&&this.mediaElement.selectedSource.mimeType==="application/vnd.apple.mpegurl"){this.streamerType="hls";}return this.mediaElement.selectedSource;},getSources:function(){if(this.manifestAdaptiveFlavors.length){return this.manifestAdaptiveFlavors;}return this.mediaElement.getPlayableSources();},getSourceIndex:function(source){var sourceIndex=null;var sourceAssetId=source.getAssetId();$.each(this.getSources(),function(currentIndex,currentSource){if(sourceAssetId==currentSource.getAssetId()){sourceIndex=currentIndex;return false;}});if(sourceIndex==null){mw.log("Error could not find source: "+source.getSrc());}return sourceIndex;},getCompatibleSource:function(videoFiles){var $media=$('<video />');$.each(videoFiles,function(inx,source){$media.append($('<source />').attr(source));mw.log("EmbedPlayer::getCompatibleSource: add "+source.src+' of type:'+source.type);});var myMediaElement=new mw.MediaElement($media[0]);if(this.getRawKalturaConfig('mediaProxy')&&this.getRawKalturaConfig('mediaProxy').preferedFlavorBR){myMediaElement.preferedFlavorBR=this.getRawKalturaConfig('mediaProxy').preferedFlavorBR*1000;}var baseTimeOptions={'supportsURLTimeEncoding':this.supportsURLTimeEncoding(),'startTime':this.startTime,'endTime':this.pauseTime};var source=myMediaElement.autoSelectSource(baseTimeOptions);if(source){mw.log("EmbedPlayer::getCompatibleSource: "+source.getSrc());return source;}mw.log("Error:: could not find compatible source");return false;},supportsURLTimeEncoding:function(){return(mw.getConfig('EmbedPlayer.EnableURLTimeEncoding'));},setCookie:function(name,value,options){var _this=this;if(!mw.getConfig('alertForCookies')){$.cookie(name,value,options);return;}if($.cookie('allowCookies')){$.cookie(name,value,options);return;}var alertObj={'title':"Cookies",'message':"Video player will save cookies on your computer",'isModal':true,'isExternal':false,'buttons':["Allow","Disallow"],'callbackFunction':function(eventObj){if(eventObj.target.textContent.toLowerCase()==="allow"){$.cookie('allowCookies',true);$.cookie(name,value,options);}else{$.cookie('allowCookies',null);_this.disabledCookies=true;}}};if(!this.disabledCookies){this.layoutBuilder.displayAlert(alertObj);}},setLive:function(isLive){this.live=isLive;},isLive:function(){return this.live;},set360:function(is360){this.Is360=is360;},is360:function(){return this.Is360;},setDrmRequired:function(isDrm){this.drmRequired=isDrm;},isDrmRequired:function(){return this.drmRequired&&!this.getRawKalturaConfig("embedPlayerChromecastReceiver","plugin")===true;},isDVR:function(){if(this.kalturaPlayerMetaData&&this.kalturaPlayerMetaData['dvrStatus']){return this.kalturaPlayerMetaData['dvrStatus'];}if(mw.getConfig("forceDVR")){return true;}return false;},isLiveOffSynch:function(){return this.liveOffSynch;},setLiveOffSynch:function(status){if(status!==this.liveOffSynch){this.liveOffSynch=status;$(this).trigger('onLiveOffSynchChanged',[status]);}},disableComponentsHover:function(){if(this.layoutBuilder){this.layoutBuilder.keepControlsOnScreen=true;this.layoutBuilder.removeTouchOverlay();}$(this).trigger('onComponentsHoverDisabled');},restoreComponentsHover:function(){if(this.layoutBuilder){this.layoutBuilder.keepControlsOnScreen=false;this.layoutBuilder.addTouchOverlay();}$(this).trigger('onComponentsHoverEnabled');},checkForTags:function(value,givenTags){if(typeof value==='undefined'){return false;}var valueTags=value.split(",");if(typeof valueTags==='undefined'||typeof givenTags==='undefined'){return false;}for(var i=0;i<valueTags.length;i++){for(var j=0;j<givenTags.length;j++){if(valueTags[i]==givenTags[j]){return true;}}}return false;},getSourcesByTags:function(flavorTags){var _this=this;var sources=this.mediaElement.getPlayableSources();var sourcesByTags=[];if(flavorTags===undefined){return sources;}else{var flavorTagsArr=flavorTags.split(',');for(var i=0;i<flavorTagsArr.length;i++){$.each(sources,function(sourceIndex,source){if(_this.checkForTags(source.getTags(),[flavorTagsArr[i]])){sourcesByTags.push(source);}});if(sourcesByTags.length>0){break;}}return sourcesByTags;}},switchSrc:function(source){if(source!==-1){var _this=this;var currentBR=0;if(this.mediaElement.selectedSource){currentBR=this.mediaElement.selectedSource.getBitrate();}$(this).trigger('sourceSwitchingStarted',[{currentBitrate:currentBR}]);this.mediaElement.setSource(source);$(this).trigger('sourceSwitchingEnd',[{newBitrate:source.getBitrate()}]);if(!this.isStopped()){this.isFlavorSwitching=true;var oldMediaTime=this.currentTime;var oldPaused=this.paused;this.playerSwitchSource(source,function(vid){setTimeout(function(){_this.addBlackScreen();_this.hidePlayerOffScreen();_this.unbindHelper("seeked.switchSrc").bindOnceHelper("seeked.switchSrc",function(){_this.isFlavorSwitching=false;_this.removeBlackScreen();_this.restorePlayerOnScreen();});_this.seek(oldMediaTime,oldPaused);},100);});}}},backToLive:function(){mw.log('Error player does not support back to live');},hidePlayerOffScreen:function(){mw.log('EmbedPlayer:: hidePlayerOffScreen: Notice player does not support hide player off screen');},restorePlayerOnScreen:function(){mw.log('EmbedPlayer:: restorePlayerOnScreen: Notice player does not support restore player on screen');},setStorageId:function(storageId){this.setFlashvars("storageId",storageId);if(this.mediaElement){$.each(this.mediaElement.sources,function(sourceIndex,source){if(source.src.indexOf("playManifest")!==-1){if(source.src.indexOf("storageId")!==-1){source.src=source.src.replace(/(.*storageId=)([0-9]+)/,"$1"+storageId);}else{source.src+=((source.src.indexOf('?')===-1)?'?':'&')+"storageId="+storageId;}}});}},bufferStart:function(){if(!this.isInSequence()&&!this.buffering){var _this=this;this.buffering=true;mw.log("EmbedPlayer::bufferStart");$(this).trigger('bufferStartEvent');this.bufferStartTime=new Date().getTime();if(!mw.getConfig('EmbedPlayer.DisableBufferingSpinner')){setTimeout(function(){if(!_this.isInSequence()&&_this.buffering&&!_this.paused){_this.addPlayerSpinner();}},_this.monitorRate);}}},bufferEnd:function(){if(!this.isInSequence()&&this.buffering){this.buffering=false;mw.log("EmbedPlayer::bufferEnd");this.bufferEndTime=new Date().getTime();this.lastBufferDuration=((this.bufferEndTime-this.bufferStartTime)/1000).toFixed(3);$(this).trigger('bufferEndEvent',{'bufferDuration':this.lastBufferDuration});if(!mw.getConfig('EmbedPlayer.DisableBufferingSpinner')){this.hideSpinner();}}},getKalturaAttributeConfig:function(attr){return this.getKalturaConfig(null,attr);},isVideoSiblingEnabled:function(){if(mw.getConfig("DisableVideoSibling")){return false;}else{return true;}},handlePlayerError:function(data,shouldHandlePlayerError){if(this.shouldHandlePlayerError||shouldHandlePlayerError){var message=this.getErrorMessage(data);var errorObj={title:this.getKalturaMsg('ks-GENERIC_ERROR_TITLE'),message:message};if(data.code){errorObj.code=data.code;}this.showErrorMsg(errorObj);}},getErrorMessage:function(data){var message=data?data:this.getKalturaMsg('ks-CLIP_NOT_FOUND');if(message.errorMessage){message=message.errorMessage;}else if(message.message){message=message.message;}if(!message||message==undefined){message=this.getKalturaMsg('ks-CLIP_NOT_FOUND');}return message;},getErrorCode:function(data){return data?data.code:"7000";},onFlavorsListChanged:function(newFlavors){this.setKDPAttribute('sourceSelector','simpleFormat',false);this.manifestAdaptiveFlavors=[];var _this=this;$.each(newFlavors,function(inx,flavor){_this.manifestAdaptiveFlavors.push(new mw.MediaSource(flavor))});$(this).trigger('sourcesReplaced');},getCurrentBitrate:function(){if(!this.isLive()&&this.mediaElement.selectedSource){return this.mediaElement.selectedSource.getBitrate();}return this.currentBitrate;},getLiveEdgeOffset:function(){return this.liveEdgeOffset;},setLiveEdgeOffset:function(offset,callback){mw.log('EmbedPlayer :: setLiveEdgeOffset -'+offset);this.seek(this.getDuration()-offset);if($.isFunction(callback)){callback();}},getCurrentBufferLength:function(){mw.log("Error: getPlayerElementTime should be implemented by embed library");}};})(window.mw,window.jQuery);(function(mw,$){"use strict";mw.FullScreenManager=function(embedPlayer){return this.init(embedPlayer);};mw.FullScreenManager.prototype={inFullScreen:false,parentsAbsoluteList:[],parentsRelativeList:[],parentsFixedList:[],bindPostfix:'.fullscreenManager',init:function(embedPlayer){this.embedPlayer=embedPlayer;return this;},isInFullScreen:function(){return this.inFullScreen;},toggleFullscreen:function(){this.embedPlayer.triggerHelper('onToggleFullscreen');if(mw.getConfig('EmbedPlayer.ExternalFullScreenControl')){return;}if(this.isInFullScreen()){this.restoreWindowPlayer();}else{this.doFullScreenPlayer();}},openNewWindow:function(){var embedPlayer=this.embedPlayer;var iframeMwConfig={'EmbedPlayer.IsFullscreenIframe':true,'EmbedPlayer.IframeCurrentTime':embedPlayer.currentTime,'EmbedPlayer.IframeIsPlaying':embedPlayer.isPlaying(),'EmbedPlayer.IframeParentUrl':document.URL};var url=embedPlayer.getIframeSourceUrl()+'#'+encodeURIComponent(JSON.stringify({'mwConfig':iframeMwConfig,'playerId':embedPlayer.id}));embedPlayer.pause();var newwin=window.open(url,'_blank','width='+screen.width+', height='+(screen.height-90)+', top=0, left=0'+', fullscreen=yes');if(window.focus){newwin.focus();}},doFullScreenPlayer:function(callback){mw.log("FullScreenManager:: doFullScreenPlayer");var vid=this.embedPlayer.getPlayerElement();if(mw.isMobileChrome()&&mw.getConfig('EmbedPlayer.EnableNativeChromeFullscreen')&&vid&&vid.webkitRequestFullscreen){vid.webkitRequestFullscreen();return;}if(mw.getConfig('EmbedPlayer.NewWindowFullscreen')&&!screenfull&&!(mw.getConfig('EmbedPlayer.EnableIpadNativeFullscreen')&&mw.isIpad())){this.openNewWindow();return;}var _this=this;var embedPlayer=this.embedPlayer;var $interface=embedPlayer.getInterface();if(this.isInFullScreen()==true){return;}this.inFullScreen=true;var isIframe=(mw.getConfig('EmbedPlayer.IsIframeServer')&&mw.getConfig('EmbedPlayer.IsFriendlyIframe')),doc=isIframe?window['parent'].document:window.document,context=isIframe?window['parent']:window;this.verticalScrollPosition=(doc.all?doc.scrollTop:context.pageYOffset);$interface.addClass('fullscreen');$(embedPlayer).trigger('onOpenFullScreen');if(mw.getConfig('EmbedPlayer.ExternalFullScreenControl')){return;}var callFullScreenAPI=function(){if(!(screenfull&&screenfull.enabled(doc))){return;};var fsTarget=_this.getFsTarget();var escapeFullscreen=function(event){var doc=(mw.getConfig('EmbedPlayer.IsIframeServer')&&mw.getConfig('EmbedPlayer.IsFriendlyIframe'))?window['parent'].document:window.document;if(!screenfull.isFullscreen(doc)){_this.restoreWindowPlayer();}}
_this.orginalParnetViewPortContent=$(doc).find('meta[name="viewport"]').attr('content');doc.removeEventListener(screenfull.raw.fullscreenchange,escapeFullscreen);doc.addEventListener(screenfull.raw.fullscreenchange,escapeFullscreen);screenfull.request(fsTarget,doc);};if(!this.fullScreenApiExcludes()&&screenfull&&screenfull.enabled(doc)&&!mw.isOldAndroidChromeNativeBrowser()){callFullScreenAPI();}else{if(!this.fullScreenApiExcludes()&&mw.isAndroidChromeNativeBrowser()){callFullScreenAPI();}if(mw.getConfig('EmbedPlayer.EnableIpadNativeFullscreen')&&vid&&vid.webkitSupportsFullscreen){this.doHybridNativeFullscreen();return;}else{this.doContextTargetFullscreen();}}$(window).keyup(function(event){if(event.keyCode==27){_this.restoreWindowPlayer();}});$(document).bind('touchmove'+this.bindPostfix,function(e){e.preventDefault();});},doContextTargetFullscreen:function(){var isIframe=mw.getConfig('EmbedPlayer.IsIframeServer');var _this=this,doc=isIframe?window['parent'].document:window.document,$doc=$(doc),$target=$(this.getFsTarget()),context=isIframe?window['parent']:window;this.parentsAbsoluteList=[];this.parentsRelativeList=[];this.parentsFixedList=[];this.orginalParnetViewPortContent=$doc.find('meta[name="viewport"]').attr('content');this.orginalTargetElementLayout={'style':$target[0].style.cssText,'width':$target.width(),'height':$target.height()};mw.log("PlayerControls:: doParentIframeFullscreen> verticalScrollPosition:"+this.verticalScrollPosition);this.doNativeScroll(context,0,0);if(!$doc.find('meta[name="viewport"]').length){$doc.find('head').append($('<meta />').attr('name','viewport'));}$doc.find('meta[name="viewport"]').attr('content','width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1');var playerCssPosition=(mw.isIOS())?'absolute':'fixed';$target.parents().each(function(){var $parent=$(this);if($parent.css('position')=='absolute'){_this.parentsAbsoluteList.push($parent);$parent.css('position','static');}if($parent.css('position')=='relative'){_this.parentsRelativeList.push($parent);$parent.css('position','static');}if($parent.css('position')=='fixed'){_this.parentsFixedList.push($parent);$parent.css('position','static');}});$target.css({'z-index':mw.getConfig('EmbedPlayer.FullScreenZIndex'),'position':playerCssPosition,'top':'0px','left':'0px','margin':0}).data('isFullscreen',true).after($('<div>').addClass('player-placeholder').css({'width':this.orginalTargetElementLayout.width,'height':this.orginalTargetElementLayout.height}));var updateTargetSize=function(){_this.doNativeScroll(context,0,0);var innerWidth=context.innerWidth||context.document.documentElement.clientWidth||context.document.body.clientWidth;var innerHeight=context.innerHeight||context.document.documentElement.clientHeight||context.document.body.clientHeight;if(mw.isMobileChrome()){innerHeight+=1;}if((mw.isAndroid41()||mw.isAndroid42()||(mw.isAndroid()&&mw.isFirefox()))&&!mw.isMobileChrome()&&context.devicePixelRatio){innerHeight=context.outerHeight/context.devicePixelRatio;}$target.css({'width':innerWidth,'height':innerHeight});if(mw.isAndroid()&&!mw.isMobileChrome()){$target.trigger('resize');}_this.embedPlayer.applyIntrinsicAspect();};var updateSizeByDevice=function(){if(mw.isAndroid()){setTimeout(updateTargetSize,10);}else if(mw.isIOSAbove7()){setTimeout(updateTargetSize,500);}else{updateTargetSize();}};updateSizeByDevice();var eventName=mw.isAndroid()?'resize':'orientationchange';eventName+=this.bindPostfix;$(context).bind(eventName,function(){if(_this.isInFullScreen()){updateSizeByDevice();}});document.ontouchmove=function(e){if(_this.isInFullScreen()){e.preventDefault();}};},restoreContextPlayer:function(){var isIframe=mw.getConfig('EmbedPlayer.IsIframeServer');var _this=this;var doc=window.document;if(isIframe){try{doc=window['parent'].document;}catch(e){mw.log("FullScreenManager:: Security error when accessing window parent document: "+e.message);}}var $doc=$(doc);var $target=$(this.getFsTarget());var context=isIframe?window['parent']:window;mw.log("FullScreenManager:: restoreContextPlayer> verticalScrollPosition:"+this.verticalScrollPosition);if(this.orginalParnetViewPortContent){$doc.find('meta[name="viewport"]').attr('content',this.orginalParnetViewPortContent);}else{$doc.find('meta[name="viewport"]').attr('content','initial-scale=1, maximum-scale=8, minimum-scale=1, user-scalable=yes');if(mw.isMobileChrome()){$doc.find('meta[name="viewport"]').attr('content','user-scalable=yes');}}if(this.orginalTargetElementLayout){$target[0].style.cssText=this.orginalTargetElementLayout.style;$target.attr({'width':this.orginalTargetElementLayout.width,'height':this.orginalTargetElementLayout.height}).trigger('resize');_this.embedPlayer.applyIntrinsicAspect();$target.siblings('.player-placeholder').remove();}$.each(_this.parentsAbsoluteList,function(inx,$elm){$elm.css('position','absolute');});$.each(_this.parentsRelativeList,function(inx,$elm){$elm.css('position','relative');});$.each(_this.parentsFixedList,function(inx,$elm){$elm.css('position','fixed');});setTimeout(function(){_this.doNativeScroll(context,0,_this.verticalScrollPosition);},100)},doNativeScroll:function(context,top,left){if(context){$.each(['scroll','scrollTo'],function(i,funcName){try{if($.isFunction(context[funcName])){context[funcName](top,left);return false;}}catch(e){mw.log("FullScreenManager:: Security error when accessing context: "+e.message);}});}},doHybridNativeFullscreen:function(){var vid=this.embedPlayer.getPlayerElement();var _this=this;vid.webkitEnterFullscreen();this.fsIntervalID=setInterval(function(){var currentFS=vid.webkitDisplayingFullscreen;if(_this.isInFullScreen()&&!currentFS){_this.inFullScreen=false;$(_this.embedPlayer).trigger('onCloseFullScreen');_this.embedPlayer.getInterface().removeClass('fullscreen');clearInterval(_this.fsIntervalID);}},250);},doDomFullscreen:function(){var _this=this;var embedPlayer=this.embedPlayer;var $interface=embedPlayer.getInterface();$('.mw-fullscreen-overlay').remove();$interface.after($('<div />').addClass('mw-fullscreen-overlay').css('z-index',mw.getConfig('EmbedPlayer.FullScreenZIndex')).hide().fadeIn("slow"));if(!this.windowPositionStyle){this.windowPositionStyle=$interface.css('position');}if(!this.windowZindex){this.windowZindex=$interface.css('z-index');}this.windowOffset=this.getWindowOffset();$interface.css({'position':'fixed','z-index':mw.getConfig('EmbedPlayer.FullScreenZIndex')+1,'top':this.windowOffset.top,'left':this.windowOffset.left});if(embedPlayer.isPersistentNativePlayer()){$(embedPlayer.getPlayerElement()).css({'z-index':mw.getConfig('EmbedPlayer.FullScreenZIndex')+1,'position':'absolute'});}_this.parentsAbsolute=[];$('body').css('overflow','hidden');var topOffset='0px';var leftOffset='0px';if($interface.offsetParent()[0].tagName&&$interface.offsetParent()[0].tagName.toLowerCase()!='body'){topOffset=-this.windowOffset.top+'px';leftOffset=-this.windowOffset.left+'px';}$interface.css('overlow','hidden');$interface.parents().each(function(){if($(this).css('position')=='absolute'){_this.parentsAbsolute.push($(this));$(this).css('position',null);mw.log('PlayerLayoutBuilder::  should update position: '+$(this).css('position'));}});$(window).keyup(function(event){if(event.keyCode==27){_this.restoreWindowPlayer();}});},getWindowOffset:function(){var windowOffset=this.embedPlayer.getInterface().offset();windowOffset.top=windowOffset.top-$(document).scrollTop();windowOffset.left=windowOffset.left-$(document).scrollLeft();this.windowOffset=windowOffset;return this.windowOffset;},getFsTarget:function(){if((mw.getConfig('EmbedPlayer.IsIframeServer')&&mw.getConfig('EmbedPlayer.IsFriendlyIframe'))||mw.isOldAndroidChromeNativeBrowser()){var targetId;if(screenfull&&screenfull.enabled()){targetId=this.embedPlayer.id+'_ifp';}else{targetId=this.embedPlayer.id;}return window['parent'].document.getElementById(targetId);}else{var $interface=this.embedPlayer.getInterface();return $interface[0];}},getDocTarget:function(){if(mw.getConfig('EmbedPlayer.IsIframeServer')&&mw.getConfig('EmbedPlayer.IsFriendlyIframe')){return window['parent'].document;}else{return document;}},restoreWindowPlayer:function(){var _this=this;mw.log("FullScreenManager :: restoreWindowPlayer");var embedPlayer=this.embedPlayer;if(this.isInFullScreen()===false){return;}this.inFullScreen=false;embedPlayer.getInterface().removeClass('fullscreen');$(embedPlayer).trigger('onCloseFullScreen');if(mw.getConfig('EmbedPlayer.ExternalFullScreenControl')){return;}var docTarget=this.getDocTarget();if(!this.fullScreenApiExcludes()&&screenfull&&screenfull.enabled(docTarget)){screenfull.exit(docTarget);}this.restoreContextPlayer();$(document).unbind(this.bindPostfix);},fullScreenApiExcludes:function(){if(mw.isSilk()){return true;}return false;}};})(window.mw,window.jQuery);(function(mw,$){"use strict";mw.PlayerLayoutBuilder=function(embedPlayer,options){return this.init(embedPlayer,options);};mw.PlayerLayoutBuilder.prototype={height:mw.getConfig('EmbedPlayer.ControlsHeight'),supportedComponents:{},addWarningFlag:false,displayOptionsMenuFlag:false,controlsDisabled:false,bindPostfix:'.layoutBuilder',layoutReady:false,keepControlsOnScreen:false,playingFlag:false,importanceSet:['low','medium','high'],init:function(embedPlayer){var _this=this;this.embedPlayer=embedPlayer;this.fullScreenManager=new mw.FullScreenManager(embedPlayer);var animationSupported=this.checkAnimationSupport();mw.setConfig('EmbedPlayer.AnimationSupported',animationSupported);this.addUserAgentCssClass();$(document.body).append($('<div style="display: block" class="cssChecker"></div>'));return this;},getInterface:function(){if(!this.$interface){var embedPlayer=this.embedPlayer,$embedPlayer=$(embedPlayer);if($embedPlayer.parent('.videoDisplay').length==0){$embedPlayer.wrap($('<div />').addClass('videoDisplay'));}var $videoDisplay=$embedPlayer.parent('.videoDisplay');if($videoDisplay.find('.videoShadow').length==0){$(".mwEmbedPlayer").before('<div class="videoShadow"></div>');}if($videoDisplay.parent('.videoHolder').length==0){$videoDisplay.parent('.videoDisplay').wrap($('<div />').addClass('videoHolder'));}var $videoHolder=$videoDisplay.parent('.videoHolder');if($videoHolder.parent('.mwPlayerContainer').length==0){this.$interface=$videoHolder.wrap($('<div />').addClass('mwPlayerContainer')).parent()
if(embedPlayer.style.cssText){this.$interface[0].style.cssText+=embedPlayer.style.cssText;}}else{this.$interface=$videoHolder.parent('.mwPlayerContainer')}if(mw.isMobileDevice()){this.$interface.addClass('mobile');}if(this.embedPlayer.isMobileSkin()){this.$interface.addClass('mobileSkin');}if(mw.isTouchDevice()){this.$interface.addClass('touch');}if(mw.isNativeApp()){this.$interface.addClass('nativeApp');}if(mw.isIE8()){this.$interface.addClass('ie8');}var skinName=embedPlayer.playerConfig.layout.skin;if(embedPlayer.getRawKalturaConfig("layout")&&embedPlayer.getRawKalturaConfig("layout").skin){skinName=embedPlayer.getRawKalturaConfig("layout").skin;}this.$interface.addClass(skinName);embedPlayer.style.cssText='';}return this.$interface;},isInFullScreen:function(){return this.fullScreenManager.isInFullScreen();},getHeight:function(){return this.embedPlayer.isMobileSkin()?mw.getConfig('EmbedPlayer.MobileControlsHeight'):this.height;},clearInterface:function(){this.getInterface().find('.overlay-win').remove();},addUserAgentCssClass:function(){if(mw.isTouchDevice())this.getInterface().addClass('ua-touch');if(mw.hasMouseEvents())this.getInterface().addClass('ua-mouse');if(mw.isIOS())this.getInterface().addClass('ua-ios');if(mw.isAndroid())this.getInterface().addClass('ua-android');if(mw.isMacintosh())this.getInterface().addClass('ua-osx');if(mw.isWindows())this.getInterface().addClass('ua-win');if(mw.isChrome())this.getInterface().addClass('ua-chrome');if(mw.isFirefox())this.getInterface().addClass('ua-firefox');if(mw.isIE())this.getInterface().addClass('ua-ie');if(mw.isSafari())this.getInterface().addClass('ua-safari');if(mw.isEdge())this.getInterface().addClass('ua-edge');if(mw.isChromeCast())this.getInterface().addClass('ua-chromecast');},addControls:function(){if(this.layoutReady)return;var embedPlayer=this.embedPlayer;var _this=this;this.clearInterface();_this.displayOptionsMenuFlag=false;if(mw.hasMouseEvents()){this.initToolTips();}if(mw.isIE8()||mw.isIE9()){this.embedPlayer.bindHelper('layoutBuildDone',function(){$('.PIE').each(function(){PIE.attach(this);});});}this.addContainers();this.mapComponents();if(this.layoutCssLoaded()){this.drawLayoutAndBind();}else{var _this=this;var counter=0;var cssCheckInterval=setInterval(function(){if(_this.layoutCssLoaded()){clearInterval(cssCheckInterval);_this.drawLayoutAndBind();}else{counter++;if(counter==40){clearInterval(cssCheckInterval);_this.drawLayoutAndBind();mw.log("failed to load layout.css");}}},25);}},layoutCssLoaded:function(){return($(".cssChecker").css("display")=="none");},drawLayoutAndBind:function(){this.drawLayout();this.addControlBindings();$(".cssChecker").remove();},layoutContainers:{'topBarContainer':[],'sideBarContainer':[],'videoHolder':[],'smartContainer':[],'controlBarContainer':[],'controlsContainer':[]},addContainers:function(){this.embedPlayer.triggerHelper('addLayoutContainer');},mapComponents:function(){var _this=this;this.embedPlayer.triggerHelper('addLayoutComponent',this);$.each(this.components,function(compId,compConfig){if(!compConfig.parent)return true;if(_this.layoutContainers[compConfig.parent]){_this.layoutContainers[compConfig.parent].push({'id':compId,'order':compConfig.order,'insertMode':(compConfig.insertMode)?compConfig.insertMode:'lastChild'});}});$.each(this.layoutContainers,function(idx,components){_this.layoutContainers[idx].sort(function(comp1,comp2){return((comp1.order<comp2.order)?-1:((comp1.order>comp2.order)?1:0));});});},drawLayout:function(){mw.log('PlayerLayoutBuilder:: drawLayout',this.layoutContainers);var _this=this;var $interface=this.getInterface();this.componentsMenus=[];$.each(_this.layoutContainers,function(containerId,components){var $parent=$interface.find('.'+containerId);if($parent.length){_this.drawComponents($parent,components);}else{mw.log('PlayerLayoutBuilder:: drawLayout:: container "'+containerId+'" not found in DOM');}});var $buttons=$interface.find('.controlsContainer').find('.btn');var tabIndex=0;var rightBtnIndex=0;$buttons.each(function(i){if($(this).hasClass('pull-right')||$(this).parent().hasClass('pull-right')){rightBtnIndex++;$(this).attr('tabindex',($buttons.length-rightBtnIndex));}else{tabIndex++;$(this).attr('tabindex',tabIndex);}});this.layoutReady=true;this.embedPlayer.triggerHelper('layoutBuildDone');try{window.parent.postMessage('layoutBuildDone','*');}catch(e){}},drawComponents:function($parent,components){var _this=this;$.each(components,function(idx,component){var $component=_this.getDomComponent(component.id);if($component===false){mw.log('PlayerLayoutBuilder:: drawComponents: component "'+component.id+'" was not defined');}else{var dropDownMenu=$component.find('ul.dropdown-menu')[0];if(dropDownMenu){_this.componentsMenus.push(dropDownMenu);}if(component.insertMode=='firstChild'){$parent.prepend($component);}else{$parent.append($component);}}});},updateComponentsVisibility:function(){var _this=this;$(this.embedPlayer).trigger('updateComponentsVisibilityStart')
$.each(this.layoutContainers,function(containerId,components){if(containerId=='videoHolder'||containerId=='controlBarContainer'||containerId=='smartContainer'){return true;}_this.updateContainerCompsByAvailableSpace(_this.getInterface().find('.'+containerId));});$(this.embedPlayer).trigger('updateComponentsVisibilityDone')},updateContainerCompsByAvailableSpace:function($container){if(!$container.length||mw.isChromeCast())return;var _this=this;var containerWidth=$container.width();var hideOneByImportance=function(){for(var i=0;i<_this.importanceSet.length;i++){var $s=$container.find('.display-'+_this.importanceSet[i]+':visible');if($s.length){var $first=$s.first();$first.hide();return _this.getComponentWidth($first);}}};var showOneByImportance=function(){var reversedImportanceSet=_this.importanceSet.slice(0).reverse();for(var i=0;i<reversedImportanceSet.length;i++){var $comp=getNextComponentToShow(reversedImportanceSet[i]);if($comp){$comp.show();return _this.getComponentWidth($comp);}}};var getNextComponentToShow=function(importanceLevel){var $s=$container.children('.display-'+importanceLevel+':hidden');while($s.length){var $first=$s.first();if($first.data('forceHide')){$s=$s.slice(1);}else{return $s.first();}}};var getNextShowWidth=function(){var nextWidth=0;var reversedImportanceSet=_this.importanceSet.slice(0).reverse();for(var i=0;i<reversedImportanceSet.length;i++){var $comp=getNextComponentToShow(reversedImportanceSet[i]);if($comp){$comp.show();nextWidth=_this.getComponentWidth($comp);if(mw.getConfig('EmbedPlayer.IsFriendlyIframe')){$comp.hide();}break;}}return nextWidth;};var i=0;var componentsWidthForContainer=this.getComponentsWidthForContainer($container);if(containerWidth<componentsWidthForContainer&&this.canHideShowContainerComponents($container,true)){while(i++<30&&containerWidth<componentsWidthForContainer&&this.canHideShowContainerComponents($container,true)){mw.log("hideOneByImportance: "+containerWidth+' < '+componentsWidthForContainer);var lengthHided=hideOneByImportance();if(!lengthHided){break;}componentsWidthForContainer=componentsWidthForContainer-lengthHided;}return;}while(i++<30&&$container.find('.comp:hidden').length&&this.canHideShowContainerComponents($container,false)&&containerWidth>(componentsWidthForContainer+getNextShowWidth())){mw.log("showOneByImportance: "+containerWidth+' > '+componentsWidthForContainer);var lengthShowed=showOneByImportance();if(!lengthShowed){break;}componentsWidthForContainer=componentsWidthForContainer+lengthShowed;}},canHideShowContainerComponents:function($container,visible){var state=(visible)?'visible':'hidden';var found=false;for(var i=0;i<this.importanceSet.length;i++){var $s=$container.find('.display-'+this.importanceSet[i]+':'+state);if($s.length){found=true;break;}}return found;},getComponentWidth:function($comp){return $comp.data('width')||$comp.outerWidth(true);},getComponentsWidthForContainer:function($container){var _this=this;var totalWidth=this.embedPlayer.isMobileSkin()?2:10;$container.find('.comp:visible').each(function(){totalWidth+=_this.getComponentWidth($(this));});return totalWidth;},getComponentsHeight:function(){var height=0;this.getInterface().find('.block').each(function(){height+=$(this).outerHeight(true);});return height;},getContainerHeight:function(){var height=0;if(mw.isIE11()){height=this.getInterface()[0].clientHeight;}else{height=this.getInterface().height();}return height;},initToolTips:function(){var _this=this;this.embedPlayer.bindHelper('layoutBuildDone mediaListLayoutReady',function(){_this.setupTooltip()
_this.setupTooltip(_this.getInterface().find(".tooltipBelow"),"arrowTop");});this.embedPlayer.bindHelper('hidePlayerControls clearTooltip',function(){_this.getInterface().siblings(".ui-tooltip").remove();});},setupTooltip:function(elm,arrowDirection){if(!this.embedPlayer.enableTooltips||kWidget.isIE8()){return;}var tooltips=elm?elm:this.getInterface();if(tooltips&&tooltips.length>0){var arrowType=arrowDirection?arrowDirection:"arrow";var myPosition=tooltips.offset().top>0?"center bottom+55":"center bottom-10";tooltips.tooltip({items:'[data-show-tooltip]',"show":{"delay":1000},"hide":{"duration":0},"content":function(){return $(this).attr('title');},position:{my:myPosition,at:"center top",using:function(position,feedback){$(this).css(position);$("<div>").addClass(arrowType).addClass(feedback.vertical).addClass(feedback.horizontal).appendTo(this);}}});}},getOverlayWidth:function(){return(this.embedPlayer.getPlayerWidth()<300)?300:this.embedPlayer.getPlayerWidth();},getOverlayHeight:function(){return(this.embedPlayer.getPlayerHeight()<200)?200:this.embedPlayer.getPlayerHeight();},addControlBindings:function(){var _this=this;var embedPlayer=this.embedPlayer;var $interface=this.getInterface();var adPlaybackState='adplay-state';var b=function(eventName,callback){embedPlayer.bindHelper(eventName+_this.bindPostfix,callback);};var addPlaybackBindings=function(){if(embedPlayer.getFlashvars('disableOnScreenClick')){return;}if(mw.isTouchDevice()){if(!(mw.isAndroid()&&mw.isMobileChrome())){_this.addPlayerTouchBindings();}}if(!(mw.isNativeApp()&&(mw.isAndroid43()||mw.isAndroid41()||mw.isAndroid42()))){_this.addPlayerClickBindings();}};var removePlaybackBindings=function(){if(embedPlayer.getFlashvars('disableOnScreenClick')){return;}if(mw.isTouchDevice()){_this.removePlayerTouchBindings();}_this.removePlayerClickBindings();};_this.onControlBar=false;embedPlayer.unbindHelper(this.bindPostfix);var bindFirstPlay=false;_this.addRightClickBinding();_this.updateComponentsVisibility();_this.updatePlayerSizeClass();b('updateLayout',function(){_this.updateComponentsVisibility();_this.updatePlayerSizeClass();});b('onplay',function(){_this.addRightClickBinding();});b('AdSupport_StartAdPlayback',function(){$interface.addClass(adPlaybackState);});b('AdSupport_EndAdPlayback',function(){$interface.removeClass(adPlaybackState);});b('seeking',function(){$interface.addClass("seeking-state");});b('seeked',function(){$interface.removeClass("seeking-state");});b('onEnableInterfaceComponents',function(){_this.controlsDisabled=false;addPlaybackBindings();});b('onDisableInterfaceComponents',function(){_this.controlsDisabled=true;removePlaybackBindings();});b('onOpenFullScreen',function(){setTimeout(function(){embedPlayer.doUpdateLayout();},100)});b('onCloseFullScreen',function(){setTimeout(function(){embedPlayer.doUpdateLayout();},100)});if((embedPlayer.adSiblingFlashPlayer||embedPlayer.instanceOf=='Kplayer')&&(mw.isIE8()||mw.isIE9())){embedPlayer.getVideoHolder().bind('mouseup',function(){if(embedPlayer.sequenceProxy&&embedPlayer.sequenceProxy.isInSequence){$(embedPlayer).trigger('click');}});}addPlaybackBindings();this.addControlsVisibilityBindings();if(embedPlayer.isOverlayControls()&&mw.hasMouseEvents()){this.addMouseMoveBinding(this.getInterface());this.addMouseMoveHandler();}mw.log('trigger::addControlBindingsEvent');embedPlayer.triggerHelper('addControlBindingsEvent');},addPlayerTouchBindings:function(){var embedPlayer=this.embedPlayer;var _this=this;this.removePlayerTouchBindings();var touchStartPos,touchEndPos=null;$(_this.embedPlayer).bind('touchstart'+this.bindPostfix,function(e){touchStartPos=e.originalEvent.touches[0].pageY;}).bind('touchend'+this.bindPostfix,function(e){e.preventDefault();e.stopPropagation();if(_this.embedPlayer.isControlsVisible||_this.embedPlayer.useNativePlayerControls()){touchEndPos=e.originalEvent.changedTouches[0].pageY;var distance=Math.abs(touchStartPos-touchEndPos);if(distance<10){mw.log('PlayerLayoutBuilder::addPlayerTouchBindings:: togglePlayback from touch event');_this.togglePlayback();}}});},removePlayerTouchBindings:function(){$(this.embedPlayer).unbind("touchstart"+this.bindPostfix);$(this.embedPlayer).unbind("touchend"+this.bindPostfix);},outPlayerClass:'player-out',hideControlsTimeout:null,showPlayerControls:function(){clearTimeout(this.hideControlsTimeout);this.getInterface().removeClass(this.outPlayerClass);this.removeTouchOverlay();if(this.$interface.find(".mwEmbedPlayer").hasClass("noCursor")){this.$interface.find(".mwEmbedPlayer").removeClass("noCursor");}this.embedPlayer.triggerHelper('showPlayerControls');},hidePlayerControls:function(){if((!this.embedPlayer.paused||this.embedPlayer.isInSequence())){var areAllCompMenusClosed=true;$.each(this.componentsMenus,function(index,dropDownMenu){return(areAllCompMenusClosed=dropDownMenu.className.indexOf('open')===-1);});if(areAllCompMenusClosed){this.getInterface().addClass(this.outPlayerClass);this.addTouchOverlay();if(this.isInFullScreen()){this.$interface.find(".mwEmbedPlayer").addClass("noCursor");}this.embedPlayer.triggerHelper('hidePlayerControls');}}},addControlsVisibilityBindings:function(){var embedPlayer=this.embedPlayer;var _this=this;var $interface=this.getInterface();if(_this.checkNativeWarning()){_this.addWarningBinding('EmbedPlayer.ShowNativeWarning',gM('mwe-embedplayer-for_best_experience',$('<a />').attr({'href':'http://www.mediawiki.org/wiki/Extension:TimedMediaHandler/Client_download','target':'_new'})));}if(mw.hasMouseEvents()){var hoverIntentConfig={'sensitivity':100,'timeout':mw.getConfig('EmbedPlayer.HoverOutTimeout'),'over':function(){_this.showPlayerControls();},'out':function(){_this.hidePlayerControls();}};$interface.hoverIntent(hoverIntentConfig);}$(embedPlayer).bind('touchstart',function(){_this.showPlayerControls();_this.hideControlsTimeout=setTimeout(function(){_this.hidePlayerControls();},5000);return true;});},addMouseMoveBinding:function(elem){if(elem){var _this=this;_this.mouseMovedFlag=false;var oldX=0,oldY=0;$(elem).mousemove(function(event){if(Math.abs(oldX-event.pageX)>4||Math.abs(oldY-event.pageY)>4){_this.mouseMovedFlag=true;}oldX=event.pageX;oldY=event.pageY;}).mouseout(function(event){_this.mouseMovedFlag=false;});}else{mw.log("addMouseMoveBinding: no element supplied");}},addMouseMoveHandler:function(){var _this=this;var checkMovedMouse=function(){if(_this.mouseMovedFlag){_this.mouseMovedFlag=false;_this.showPlayerControls();_this.checkMovedMouseTimeout=setTimeout(checkMovedMouse,mw.getConfig('EmbedPlayer.MouseMoveTimeout'));}else{_this.hidePlayerControls();_this.checkMovedMouseTimeout=setTimeout(checkMovedMouse,250);}};checkMovedMouse();},removeMouseMoveHandler:function(){clearTimeout(this.checkMovedMouseTimeout);this.checkMovedMouseTimeout=null;},addTouchOverlay:function(){if(mw.isTouchDevice()&&!this.keepControlsOnScreen&&this.embedPlayer.getKalturaConfig("controlBarContainer","hover")){var _this=this;if(this.getInterface().find('#touchOverlay').length==0){var touchOverlay=this.getInterface().find('.controlBarContainer').before($('<div />').css({'position':'absolute','top':0,'width':'100%','height':'100%','z-index':1}).attr('id',"touchOverlay").bind('touchstart click',function(event){if(event.stopPropagation){event.stopPropagation();if(event.stopImmediatePropagation){event.stopImmediatePropagation();}}else{event.cancelBubble=true;}event.preventDefault();_this.removeMouseMoveHandler();_this.mouseMovedFlag=true;_this.showPlayerControls();_this.addMouseMoveHandler();_this.getInterface().find('#touchOverlay').remove();}));this.addMouseMoveBinding(touchOverlay);}}},removeTouchOverlay:function(){if(mw.isTouchDevice()&&this.getInterface().find('#touchOverlay').length!=0){this.getInterface().find('#touchOverlay').remove();}},playerSizeClass:null,updatePlayerSizeClass:function(){var width=this.embedPlayer.getVideoHolder().width();var playerSizeClass='';if(width<300){playerSizeClass='tiny';}else if(width<450){playerSizeClass='small';}else if(width<700){playerSizeClass='medium';}else{playerSizeClass='large';}if(this.playerSizeClass!==playerSizeClass){this.playerSizeClass=playerSizeClass;this.getInterface().removeClass('size-tiny size-small size-medium size-large').addClass('size-'+this.playerSizeClass);this.embedPlayer.triggerHelper('playerSizeClassUpdate',[this.playerSizeClass]);}},removePlayerClickBindings:function(){$(this.embedPlayer).unbind("click"+this.bindPostfix).unbind("dblclick"+this.bindPostfix);},addPlayerClickBindings:function(){var _this=this;var embedPlayer=this.embedPlayer;this.removePlayerClickBindings();var didDblClick=false;var dblClickTimeout=null;$(embedPlayer).bind("dblclick"+_this.bindPostfix,function(){didDblClick=true;});$(embedPlayer).bind("goingtoplay",function(){_this.playingFlag=true;setTimeout(function(){_this.playingFlag=false;},1000);});$(embedPlayer).bind("click"+_this.bindPostfix,function(){if(mw.isMobileDevice()){if(!_this.playingFlag){_this.togglePlayback();}}else{var playerStatus=embedPlayer.isPlaying();if(dblClickTimeout)return true;dblClickTimeout=setTimeout(function(){if(didDblClick){didDblClick=false;}else{mw.log('PlayerLayoutBuilder::addPlayerClickBindings:: togglePlayback from click event');if(embedPlayer.isPlaying()==playerStatus){if(!_this.playingFlag){_this.togglePlayback();}}}clearTimeout(dblClickTimeout);dblClickTimeout=null;},300);}return true;});},addRightClickBinding:function(){var embedPlayer=this.embedPlayer;if(mw.getConfig('EmbedPlayer.EnableRightClick')===false){document.oncontextmenu=function(e){return false;};$(embedPlayer).mousedown(function(e){if(e.button==2){return false;}});}},isControlsDisabled:function(){return this.controlsDisabled;},togglePlayback:function(){if(this.isControlsDisabled()){return;}this.embedPlayer.togglePlayback();},checkNativeWarning:function(){if(mw.getConfig('EmbedPlayer.ShowNativeWarning')===false){return false;}if(this.embedPlayer.instanceOf=='ImageOverlay'){return false;}if(this.embedPlayer.getPlayerHeight()<199){return false;}var supportingPlayers=mw.EmbedTypes.getMediaPlayers().getMIMETypePlayers('video/ogg');for(var i=0;i<supportingPlayers.length;i++){if(supportingPlayers[i].id=='oggNative'){return false;}}if(/chrome/.test(navigator.userAgent.toLowerCase())&&mw.EmbedTypes.getMediaPlayers().getMIMETypePlayers('video/webm').length){return false;}if((mw.EmbedTypes.getMediaPlayers().getMIMETypePlayers('video/mp4').length&&this.embedPlayer.mediaElement.getSources('video/mp4').length)||(mw.EmbedTypes.getMediaPlayers().getMIMETypePlayers('video/x-flv').length&&this.embedPlayer.mediaElement.getSources('video/x-flv').length)||(mw.EmbedTypes.getMediaPlayers().getMIMETypePlayers('application/vnd.apple.mpegurl').length&&this.embedPlayer.mediaElement.getSources('application/vnd.apple.mpegurl').length)||(mw.EmbedTypes.getMediaPlayers().getMIMETypePlayers('audio/mpeg').length&&this.embedPlayer.mediaElement.getSources('audio/mpeg').length)){return false;}return true;},addWarningBinding:function(preferenceId,warningMsg,hideDisableUi){mw.log('mw.PlayerLayoutBuilder: addWarningBinding: '+preferenceId+' wm: '+warningMsg);var embedPlayer=this.embedPlayer;var _this=this;if(embedPlayer.getWidth()<200){return false;}if(mw.getConfig(preferenceId)===true&&$.cookie(preferenceId)=='hidewarning'){return;}var warnId="warningOverlay_"+embedPlayer.id;$('#'+warnId).remove();var $targetWarning=$('<div />').attr({'id':warnId}).addClass('ui-state-highlight ui-corner-all').css({'position':'absolute','background':'#333','color':'#AAA','top':'10px','left':'10px','right':'10px','padding':'4px','z-index':2}).html(warningMsg);embedPlayer.getInterface().append($targetWarning);$targetWarning.append($('<br />'));if(!hideDisableUi){$targetWarning.append($('<input type="checkbox" />').attr({'id':'ffwarn_'+embedPlayer.id,'name':'ffwarn_'+embedPlayer.id}).click(function(){mw.log("WarningBindinng:: set "+preferenceId+' to hidewarning ');embedPlayer.setCookie(preferenceId,'hidewarning',{expires:30})
mw.setConfig(preferenceId,false);$('#warningOverlay_'+embedPlayer.id).fadeOut('slow');_this.addWarningFlag=false;}));$targetWarning.append($('<label />').text(gM('mwe-embedplayer-do_not_warn_again')).attr('for','ffwarn_'+embedPlayer.id));}return $targetWarning;},onSeek:function(){this.embedPlayer.addPlayerSpinner();this.embedPlayer.hideSpinnerOncePlaying();},setStatus:function(value){if(this.embedPlayer.getInterface()){}},closeMenuOverlay:function(){var _this=this;var embedPlayer=this.embedPlayer;var $overlay=embedPlayer.getInterface().find('.overlay-win,.overlay,.ui-widget-shadow');if($overlay.length&&!embedPlayer._playContorls&&!$overlay.find('.overlayCloseButton').length){embedPlayer.enablePlayControls();}this.displayOptionsMenuFlag=false;$overlay.fadeOut("slow",function(){$overlay.remove();});$overlay.remove();$(embedPlayer).trigger('closeMenuOverlay');return false;},displayMenuOverlay:function(overlayContent,closeCallback,hideCloseButton){var _this=this;var embedPlayer=this.embedPlayer;mw.log('PlayerLayoutBuilder:: displayMenuOverlay');this.displayOptionsMenuFlag=true;if(!this.supportedComponents['overlays']){embedPlayer.pause();}if(embedPlayer.getInterface().find('.overlay-win').length!=0){embedPlayer.getInterface().find('.overlay-content').html(overlayContent);return;}var $overlayContainer=embedPlayer.getInterface();if(hideCloseButton){$overlayContainer=embedPlayer.getVideoHolder();embedPlayer.disablePlayControls(['playlistPrevNext']);embedPlayer.getInterface().find('.play-btn').unbind('click').click(function(){if(embedPlayer._playContorls){embedPlayer.play();}})}$overlayContainer.append($('<div />').addClass('overlay').css({'height':'100%','width':'100%','z-index':mw.isMobileDevice()?1000:4}));var $closeButton=[];if(!hideCloseButton){var closeMessage=gM("mwe-embedplayer-close_screen");$closeButton=$('<button></button>').addClass('btn icon-close closePluginsScreen').attr('aria-label',closeMessage).click(function(){_this.closeMenuOverlay();if(closeCallback){closeCallback();}});}var margin=$(".topBarContainer").length===0?'0 10px 10px 0':'22px 10px 10px 0';var overlayMenuCss={'height':'100%','width':'100%','position':'absolute','margin':margin,'overflow':'hidden','z-index':5};var $overlayMenu=$('<div />').addClass('overlay-win ui-state-default ui-widget-header ui-corner-all').css(overlayMenuCss).append($closeButton,$('<div />').addClass('overlay-content').append(overlayContent));$overlayContainer.find(".overlay").append($overlayMenu).find('.overlay-win').fadeIn("slow");$(embedPlayer).trigger('displayMenuOverlay');return false;},closeAlert:function(keepOverlay){var embedPlayer=this.embedPlayer;var $alert=embedPlayer.getInterface().find('.alert-container');mw.log('mw.PlayerLayoutBuilder::closeAlert');if(!keepOverlay||(mw.isIpad()&&this.inFullScreen)){this.closeMenuOverlay();}$alert.remove();return false;},displayAlert:function(alertObj){var _this=this;var embedPlayer=this.embedPlayer;var callback;mw.log('PlayerLayoutBuilder::displayAlert:: '+alertObj.title);if(embedPlayer.getInterface().find('.overlay-win').length!=0){return;}try{embedPlayer.getInterface().parent().find('#error').remove();}catch(e){}if(typeof alertObj.callbackFunction=='string'){if(alertObj.isExternal){try{callback=window.parent[alertObj.callbackFunction];}catch(e){}}else{callback=window[alertObj.callbackFunction];}}else if(typeof alertObj.callbackFunction=='function'){callback=alertObj.callbackFunction;}else{callback=function(){};}var $container=$('<div />').addClass('alert-container');var $title=$('<div />').text(alertObj.title).addClass('alert-title alert-text');var $buttonsContainer=$('<div />').addClass('alert-buttons-container');var $message=$('<div />').html(alertObj.message).addClass('alert-message alert-text');if(alertObj.isError){$message.addClass('error');}if(alertObj.props){if(alertObj.props.customAlertContainerCssClass){$container.removeClass('alert-container');$container.addClass(alertObj.props.customAlertContainerCssClass);}if(alertObj.props.customAlertTitleCssClass){$title.removeClass('alert-text alert-title');$title.addClass(alertObj.props.customAlertTitleCssClass);}if(alertObj.props.titleTextColor){$title.removeClass('alert-text');$title.css('color',mw.getHexColor(alertObj.props.titleTextColor));}if(alertObj.props.customAlertMessageCssClass){$message.removeClass('alert-text alert-message');$message.addClass(alertObj.props.customAlertMessageCssClass);}if(alertObj.props.textColor){$message.removeClass('alert-text');$message.css('color',mw.getHexColor(alertObj.props.textColor));}if(alertObj.props.buttonRowSpacing){$buttonsContainer.css('margin-top',alertObj.props.buttonRowSpacing);}}var $buttonSet=alertObj.buttons||[];var buttonsNum=$buttonSet.length;if(buttonsNum==0&&!alertObj.noButtons){$buttonSet=["OK"];buttonsNum++;}if(buttonsNum>0){$container.addClass('alert-container-with-buttons');}$.each($buttonSet,function(i){var label=this.toString();var $currentButton=$('<button />').addClass('alert-button').text(label).width(Math.floor(100/buttonsNum)+"%").click(function(eventObject){callback(eventObject);_this.closeAlert(alertObj.keepOverlay);});if(alertObj.props){if(alertObj.props.buttonHeight){$currentButton.css('height',alertObj.props.buttonHeight);}if(buttonsNum>1){if(i<buttonsNum-1){if(alertObj.props.buttonSpacing){$currentButton.css('margin-right',alertObj.props.buttonSpacing);}}}}$buttonsContainer.append($currentButton);});$container.append($title,$message,$buttonsContainer);return this.displayMenuOverlay($container,false,true);},getDomComponent:function(componentId){if(this.components[componentId]){return this.components[componentId].o(this);}else{return false;}},components:{},checkAnimationSupport:function(elm){elm=elm||document.body||document.documentElement;var animation=false,animationstring='animation',keyframeprefix='',domPrefixes='Webkit Moz O ms Khtml'.split(' '),pfx='';if(elm.style.animationName!==undefined){animation=true;}if(animation===false){for(var i=0;i<domPrefixes.length;i++){if(elm.style[domPrefixes[i]+'AnimationName']!==undefined){pfx=domPrefixes[i];animationstring=pfx+'Animation';keyframeprefix='-'+pfx.toLowerCase()+'-';animation=true;break;}}}return animation;}};})(window.mediaWiki,window.jQuery);;},{"all":".mwPlayerContainer video{width:100%;height:100%}.mwPlayerContainer.fullscreen{position:absolute !important;width:100% !important;height:100%! important;z-index:9999;min-height:100%;top:0;left:0;margin:0}.mwPlayerContainer{position:relative;width:100%;height:100%;overflow:hidden}.videoHolder{position:relative;overflow:hidden;width:100%;height:100%;background:#000}.videoDisplay{position:absolute;top:0;left:0;width:100%;height:100%}.maximize{width:100%;height:100%}.mwEmbedPlayer{cursor:pointer;width:100%;height:100%;overflow:hidden;position:absolute;top:0;left:0;background-color:transparent}.mobileSkin.start-state .mwEmbedPlayer img{opacity:0.6}.mwEmbedPlayerTransparent{background-color:black;-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)\"}.mwEmbedPlayerTransparentComp{background-color:rgba(0,0,0,0);-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)\"}.mwEmbedPlayerBlackBkg{background-color:rgba(0,0,0,1)}.mwEmbedPlayer object{position:absolute;top:0;left:0;width:100%;height:100% }.mwEmbedPlayer.noCursor{cursor:none}.playerPoster{position:absolute;top:0;left:0;right:0;bottom:0;margin:auto;width:auto;height:auto;max-width:100%;max-height:100%}.mobileSkin.pluginsScreenOpened .playerPoster{opacity:0.3}.blackPlayer{position:absolute;top:0;left:0;right:0;bottom:0;margin:auto;width:auto;height:auto;max-width:100%;max-height:100%}.playerPoster.fill-width{min-width:100%;height:auto}.playerPoster.fill-height{min-height:100%;width:auto}\n\n/* cache key: resourceloader:filter:minify-css:7:b76568f4cc258557eb5793c97bbdbf66 */\n"},{"mwe-embedplayer-close_screen":"Close screen","mwe-embedplayer-play_clip":"Play clip","mwe-embedplayer-pause_clip":"Pause clip","mwe-embedplayer-next_clip":"Play next clip","mwe-embedplayer-prev_clip":"Play previous clip","mwe-embedplayer-replay":"Replay","mwe-embedplayer-speed":"Playback Speed","mwe-embedplayer-speed-accessibility":"Media Speed is selected","mwe-embedplayer-volume_control":"Volume control","mwe-embedplayer-volume-mute":"Mute","mwe-embedplayer-volume-unmute":"Unmute","mwe-embedplayer-volume-value":"Volume $1%","mwe-embedplayer-volume-increase":"Increase Volume","mwe-embedplayer-volume-decrease":"Decrease Volume","mwe-embedplayer-audio_source":"Audio","mwe-embedplayer-select_source":"Quality Settings","mwe-embedplayer-switch_source":"switch in progress","mwe-embedplayer-select_source-accessibility":"Source quality is selected","mwe-embedplayer-auto_source":"Auto","mwe-embedplayer-select_stream":"Select stream","mwe-embedplayer-select_audio":"Select audio","mwe-embedplayer-switch_stream":"switch in progress","mwe-embedplayer-timed_text":"Closed Captions","mwe-embedplayer-seek_forward":"Seek forward","mwe-embedplayer-current_time":"Current time $1","mwe-embedplayer-seek_backward":"Seek backward","mwe-embedplayer-player_fullscreen":"Full screen","mwe-embedplayer-player_closefullscreen":"Exit full screen","mwe-embedplayer-select_playlist":"Select playlist","mwe-embedplayer-empty_playlist":"No source video was found in the selected playlist","mwe-embedplayer-videos":"videos","mwe-embedplayer-pip":"Picture in Picture","mwe-embedplayer-download_clip":"Download video","mwe-embedplayer-share":"Share","mwe-embedplayer-info":"Info","mwe-share-startTimeLbl":"Start video at","mwe-share-secureEmbedLbl":"Secured embed","mwe-share-copyLbl":"Copy","mwe-share-errDuration":"Time offset cannot be longer than movie duration.","mwe-share-errFormat":"Please use the hh:mm:ss format.","mwe-embedplayer-quality_settings":"Quality settings","mwe-embedplayer-more":"More","mwe-embedplayer-player_expend":"Expand player screen","mwe-embedplayer-player_retract":"Shrink player screen","mwe-timedtext-no-subtitles":"No Subtitles","mwe-timedtext-no-audio":"No Tracks","mwe-embedplayer-for_best_experience":"For a better video playback experience we recommend a [$1 HTML5 video browser].","mwe-embedplayer-do_not_warn_again":"In the future, do not show this message","mwe-embedplayer-seeking":"seeking","mwe-embedplayer-buffering":"buffering","mwe-embedplayer-video-h264":"H.264 video","mwe-embedplayer-video-webm":"WebM video","mwe-embedplayer-video-flv":"Flash video","mwe-embedplayer-video-ogg":"Ogg video","mwe-embedplayer-video-audio":"Ogg audio","mwe-embedplayer-audio-mpeg":"MPEG audio","mwe-embedplayer-video-3gp":"3GP video","mwe-embedplayer-video-mpeg":"MPEG video","mwe-embedplayer-video-msvideo":"AVI video","mwe-embedplayer-missing-source":"No source video was found","mwe-embedplayer-wrong-reference-id":"Wrong reference id","mwe-embedplayer-video-thumbnail":"Video thumbnail","mwe-embedplayer-video-thumbnail-for":"Video thumbnail for $1","mwe-embedplayer-enable-audio-description":"Enable audio description","mwe-embedplayer-disable-audio-description":"Disable audio description","mwe-embedplayer-no-audio-description":"No audio description available","mwe-embedplayer-install-silverlight":"This video requires Microsoft Silverlight, which is currently not available on your browser. Please <a href=\"http:\/\/www.microsoft.com\/silverlight\/\" target=\"_blank\"> install Microsoft Silverlight <\/a> to view this video.","mwe-embedplayer-drm-error-not-enabled":"This content is DRM protected, it can only be played via DRM enabled players.","mwe-embedplayer-drm-error-not-supported":"This content is DRM protected, please use the latest browser that supports content protection\r\nor check that your browser has the <a href=\"http:\/\/www.microsoft.com\/silverlight\/\" target=\"_blank\">sliverlight plugin<\/a> installed and enabled.","mwe-embedplayer-player-on-air":"LIVE","mwe-embedplayer-player-off-air":"Off Air","mwe-embedplayer-player-jump-to-live":"Jump to live","mwe-embedplayer-related":"Related","mwe-embedplayer-related-errMsg":"No related<br>videos were<br>found.","mwe-embedplayer-no-source":"No sources"});mw.loader.implement("mw.EmbedPlayerImageOverlay",function($){(function(mw,$){"use strict";mw.EmbedPlayerImageOverlay={instanceOf:'ImageOverlay',playerReady:true,lastPauseTime:0,currentTime:0,startOffset:0,clockStartTime:0,imageLoaded:false,init:function(){if(this['native_instaceOf']=='Native'){return;}for(var i in mw.EmbedPlayerNative){if(typeof mw.EmbedPlayerImageOverlay[i]!='undefined'){this['native_'+i]=mw.EmbedPlayerNative[i];}else{this[i]=mw.EmbedPlayerNative[i];}}},setup:function(readyCallback){this.bindHelper('onplay'+this.bindPostfix,function(){this.clockStartTime=new Date().getTime();}.bind(this));readyCallback();},updatePlaybackInterface:function(callback){mw.log('EmbedPlayerImageOverlay:: updatePlaybackInterface: '+$(this).siblings('.playerPoster').length);$(this.getPlayerElement()).css('left',0);this.parent_updatePlaybackInterface(callback);},updatePosterHTML:function(){var vid=this.getPlayerElement();$(vid).empty();this.embedPlayerHTML();},removePoster:function(){},play:function(){mw.log('EmbedPlayerImageOverlay::play> lastPauseTime:'+this.lastPauseTime+' ct: '+this.currentTime);this.captureUserGesture();this.applyIntrinsicAspect();if(this.currentTime>this.getDuration()){this.currentTime=this.pauseTime=0;}this.stopped=false;this.parent_play();this.playInterfaceUpdate();this.bufferedPercent=0;this.monitor();this.hideSpinner();$(this).trigger('playing');},getDuration:function(){if(this.duration){return this.duration;}this.updateDuration();return this.duration;},updateDuration:function(){if($(this).data('imageDuration')){this.duration=parseFloat($(this).data('imageDuration'));}else{this.duration=parseFloat(mw.getConfig("EmbedPlayer.DefaultImageDuration"));}this.triggerHelper('durationChange',[this.duration]);},_onpause:function(){},pause:function(){mw.log('EmbedPlayerImageOverlay::pause, lastPauseTime: '+this.lastPauseTime);this.lastPauseTime=this.currentTime;this.parent_pause();},monitor:function(){if(this.duration===0){return;}var oldCurrentTime=this.currentTime;this.parent_monitor();if(oldCurrentTime!=this.currentTime){$(this).trigger('timeupdate');}},seek:function(seekTime){this.lastPauseTime=seekTime;this.seeking=false;$(this).trigger('seeking');$(this).trigger('seeked');this.play();},setCurrentTime:function(time,callback){this.lastPauseTime=time;$(this).trigger('seeking');$(this).trigger('seeked');if(callback){callback();}},playerSwitchSource:function(source,switchCallback,doneCallback){mw.log("EmbedPlayerImageOverlay:: playerSwitchSource");var _this=this;this.mediaElement.selectedSource=source;this.addPlayerSpinner();this.captureUserGesture();this.embedPlayerHTML(function(){mw.log("EmbedPlayerImageOverlay:: playerSwitchSource, embedPlayerHTML callback");_this.applyIntrinsicAspect();_this.play();$(_this).bind('ended.playerSwitchSource',function(){_this.stopMonitor();$(_this).unbind('ended.playerSwitchSource');if(doneCallback){doneCallback(_this);}});});if(switchCallback){switchCallback(this);}},captureUserGesture:function(){if(!$(this).data('previousInstanceOf')){$(this).data('previousInstanceOf',this.instanceOf);var vid=this.getPlayerElement();$(vid).attr('src',null);this.triggerHelper('AddEmptyBlackSources',[vid]);if(mw.isIOS()){vid.load();}}},updatePoster:function(posterSrc){var _this=this;if(!posterSrc){posterSrc=mw.getConfig('EmbedPlayer.BlackPixel');}this.poster=posterSrc;$(this).find('img.playerPoster').attr('src',this.poster).load(function(){_this.applyIntrinsicAspect();});},embedPlayerHTML:function(callback){var _this=this;mw.log('EmbedPlayerImageOverlay::embedPlayerHTML: '+this.id);this.updateDuration();var currentSoruceObj=this.mediaElement.selectedSource;_this.imageLoaded=false;if(!currentSoruceObj){mw.log("Error:: EmbedPlayerImageOverlay:embedPlayerHTML> missing source");return;}var loadedCallback=function(){_this.applyIntrinsicAspect();_this.imageLoaded=true;_this.monitor();if($.isFunction(callback)){callback();}};var $image=$('<img />').attr({'src':currentSoruceObj.getSrc()}).addClass('playerPoster').one('load',function(){if($.isFunction(loadedCallback)){loadedCallback();loadedCallback=null;}}).each(function(){if(this.complete){$(this).load();}});$(this.getPlayerElement()).css({'left':this.getWidth()+50,'position':'absolute'});$(this).html($image);},getPlayerElementTime:function(){if(!this.imageLoaded){mw.log('image not loaded: 0');this.currentTime=0;}else if(this.paused){this.currentTime=this.lastPauseTime;}else if(this.stopped){this.currentTime=this.duration;}else if(this.clockStartTime>0){this.currentTime=((new Date().getTime()-this.clockStartTime)/1000)+this.lastPauseTime;}else{this.currentTime=0;}return this.currentTime;}};})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mw.EmbedPlayerKplayer",function($){(function(mw,$){"use strict";mw.EmbedPlayerKplayer={instanceOf:'Kplayer',bindPostfix:'.kPlayer',playerPrefix:'EmbedPlayerKplayer',cancelLiveAutoPlay:false,supports:{'playHead':true,'pause':true,'stop':true,'sourceSwitch':true,'timeDisplay':true,'volumeControl':true,'overlays':true,'fullscreen':true},mediaLoadedFlag:false,seekStarted:false,flashCurrentTime:0,selectedFlavorIndex:0,b64Referrer:base64_encode(window.kWidgetSupport.getHostPageUrl()),playerObject:null,LIVE_OFFLINE_ALERT_TIMEOUT:8000,ignoreEnableGui:false,flashActivationRequired:false,unresolvedSrcURL:false,kPreload:{'preLoading':false,'playPending':false},setup:function(readyCallback){mw.log('EmbedPlayerKplayer:: Setup');var $container=this.getPlayerContainer();if($container.length){this.enablePlayerObject(true);$container.css('visibility','visible');readyCallback();return;}this.hideNativePoster();this.getVideoDisplay().prepend($('<div />').attr('id',this.kPlayerContainerId).addClass('maximize'));var _this=this;this.updateSources();var flashvars={};this.getEntryUrl().then(function(srcToPlay){flashvars.widgetId="_"+_this.kpartnerid;flashvars.partnerId=_this.kpartnerid;flashvars.autoMute=_this.muted||mw.getConfig('autoMute');flashvars.streamerType=_this.streamerType;flashvars.entryUrl=encodeURIComponent(srcToPlay);flashvars.entryDuration=_this.getDuration();flashvars.isMp4=_this.isMp4Src();flashvars.ks=_this.getFlashvars('ks');flashvars.serviceUrl=mw.getConfig('Kaltura.ServiceUrl');flashvars.b64Referrer=_this.b64Referrer;flashvars.forceDynamicStream=_this.getKalturaAttributeConfig('forceDynamicStream');flashvars.isLive=_this.isLive();flashvars.stretchVideo=_this.getKalturaAttributeConfig('stretchVideo')||false;flashvars.flavorId=_this.getKalturaAttributeConfig('flavorId');if(!flashvars.flavorId&&_this.mediaElement.selectedSource){flashvars.flavorId=_this.mediaElement.selectedSource.getAssetId();_this.setFlashvars('flavorId',flashvars.flavorId);}if(_this.streamerType!='http'&&_this.streamerType!='hls'&&_this.mediaElement.selectedSource){flashvars.selectedFlavorIndex=_this.getSourceIndex(_this.mediaElement.selectedSource);}if(mw.getConfig("ignoreAkamaiHD")){flashvars.ignoreAkamaiHD=mw.getConfig("ignoreAkamaiHD");}if(_this.isHlsSource(_this.mediaElement.selectedSource)){var hlsPluginConfiguration={plugin:'true',asyncInit:'true',loadingPolicy:'preInitialize'};if(mw.getConfig("hlsLiveSegmentBuffer")){hlsPluginConfiguration["liveSegmentBuffer"]=mw.getConfig("hlsLiveSegmentBuffer");}if(mw.getConfig("hlsInitialBufferTime")){hlsPluginConfiguration["initialBufferTime"]=mw.getConfig("hlsInitialBufferTime");}if(mw.getConfig("hlsExpandedBufferTime")){hlsPluginConfiguration["expandedBufferTime"]=mw.getConfig("hlsExpandedBufferTime");}if(mw.getConfig("hlsMaxBufferTime")){hlsPluginConfiguration["maxBufferTime"]=mw.getConfig("hlsMaxBufferTime");}var preferedBitRate=_this.evaluate('{mediaProxy.preferedFlavorBR}');if(preferedBitRate){hlsPluginConfiguration["prefBitrate"]=preferedBitRate;flashvars.disableAutoDynamicStreamSwitch=true;}if(mw.getConfig("maxBitrate")){hlsPluginConfiguration["maxBitrate"]=mw.getConfig("maxBitrate");}if(mw.getConfig("minBitrate")){hlsPluginConfiguration["minBitrate"]=mw.getConfig("minBitrate");}if(mw.getConfig("hlsLogs")){hlsPluginConfiguration["sendLogs"]=mw.getConfig("hlsLogs");var func=["onManifest","onNextRequest","onDownload","onCurrentTime","onTag"];for(var index=0;index<func.length;index++){(function(){var x=func[index];if(x){window[x]=function(a,b,c,d,e,f,g,h){parent.window[x](a,b,c,d,e,f,g,h);}}})();}}flashvars.KalturaHLS=hlsPluginConfiguration;flashvars.streamerType=_this.streamerType='hls';}if(_this.isLive()&&_this.streamerType=='rtmp'&&!_this.cancelLiveAutoPlay){flashvars.autoPlay=true;}if(_this.getKalturaAttributeConfig('maxAllowedRegularBitrate')){flashvars.maxAllowedRegularBitrate=_this.getKalturaAttributeConfig('maxAllowedRegularBitrate');}if(_this.getKalturaAttributeConfig('maxAllowedFSBitrate')){flashvars.maxAllowedFSBitrate=_this.getKalturaAttributeConfig('maxAllowedFSBitrate');}var kdpVars=_this.getKalturaConfig('kdpVars',null);$.extend(flashvars,kdpVars);var flashFailCallback=function(){_this.removePoster();_this.layoutBuilder.displayAlert({title:_this.getKalturaMsg('ks-FLASH-BLOCKED-TITLE'),message:_this.getKalturaMsg('ks-FLASH-BLOCKED'),keepOverlay:true,noButtons:true,props:{customAlertTitleCssClass:"AlertTitleTransparent",customAlertMessageCssClass:"AlertMessageTransparent",customAlertContainerCssClass:"AlertContainerTransparent flashBlockAlertContainer"}});};var playerElementFlash=new mw.PlayerElementFlash(_this.kPlayerContainerId,'kplayer_'+_this.pid,flashvars,_this,function(){var bindEventMap={'playerPaused':'onPause','playerPlayed':'onPlay','durationChange':'onDurationChange','playbackComplete':'onClipDone','playerUpdatePlayhead':'onUpdatePlayhead','bytesTotalChange':'onBytesTotalChange','bytesDownloadedChange':'onBytesDownloadedChange','playerSeekEnd':'onPlayerSeekEnd','alert':'onAlert','switchingChangeStarted':'onSwitchingChangeStarted','switchingChangeComplete':'onSwitchingChangeComplete','flavorsListChanged':'onFlavorsListChanged','liveStreamOffline':'onLiveEntryOffline','liveStreamReady':'onLiveStreamReady','loadEmbeddedCaptions':'onLoadEmbeddedCaptions','bufferChange':'onBufferChange','audioTracksReceived':'onAudioTracksReceived','audioTrackSelected':'onAudioTrackSelected','videoMetadataReceived':'onVideoMetadataReceived','mediaLoaded':'onMediaLoaded','hlsEndList':'onHlsEndList','mediaError':'onMediaError','bitrateChange':'onBitrateChange','textTracksReceived':'onTextTracksReceived','debugInfoReceived':'onDebugInfoReceived','readyToPlay':'onReadyToPlay','id3tag':'onId3tag'};_this.playerObject=this.getElement();$.each(bindEventMap,function(bindName,localMethod){_this.playerObject.addJsListener(bindName,localMethod);});if(_this.startTime!==undefined&&_this.startTime!=0&&!_this.supportsURLTimeEncoding()){_this.playerObject.setKDPAttribute('mediaProxy','mediaPlayFrom',_this.startTime);}readyCallback();if(mw.getConfig('autoMute')){_this.triggerHelper("volumeChanged",0);}},flashFailCallback);_this.bindHelper('switchAudioTrack'+_this.bindPostfix,function(e,data){if(_this.playerObject){_this.playerObject.sendNotification("doAudioSwitch",{audioIndex:data.index});}});_this.bindHelper('liveEventEnded'+_this.bindPostfix,function(){if(_this.playerObject){_this.playerObject.sendNotification("liveEventEnded");}});_this.bindHelper('changeEmbeddedTextTrack'+_this.bindPostfix,function(e,data){if(_this.playerObject){_this.playerObject.sendNotification("doTextTrackSwitch",{textIndex:data.index});}});_this.bindHelper('liveOnline'+_this.bindPostfix,function(){if(this.isLive()&&!this.isDVR()){_this.reset();}});});},load:function(){if(!this.isLive()&&(!this.autoplay||(this.autoplay&&this.isInSequence()))){this.kPreload.preLoading=true;this.playerObject.play();}},reset:function(){if(this.restarting){return;}this.restarting=true;var _this=this;this.clean();this.setup(function(){_this.restarting=false;_this.play();});},isHlsSource:function(source){if(source&&(source.getMIMEType()=='application/vnd.apple.mpegurl')){return true;}return false;},setCurrentTime:function(time,callback){this.flashCurrentTime=time;if(callback){callback();}},addStartTimeCheck:function(){},enablePlayerObject:function(enabled){if(this.playerObject){this.playerObject.disabled=enabled;}},disablePlayer:function(){this.getPlayerContainer().css('visibility','hidden');this.showNativePoster();this.enablePlayerObject(false);},showNativePoster:function(){var videoTagObj=$($('#'+this.pid).get(0));if(videoTagObj){videoTagObj.css('visibility','');}},hideNativePoster:function(){var videoTagObj=$($('#'+this.pid).get(0));if(videoTagObj){videoTagObj.css('visibility','hidden');}},onTextTracksReceived:function(data){this.triggerHelper('textTracksReceived',data);},getSources:function(){if(this.manifestAdaptiveFlavors.length){return this.manifestAdaptiveFlavors;}return this.getSourcesForKDP();},getSourcesForKDP:function(){var _this=this;var sourcesByTags=[];var flavorTags=_this.getKalturaAttributeConfig('flavorTags');if(flavorTags===undefined){var sources=_this.mediaElement.getPlayableSources();$.each(sources,function(sourceIndex,source){if(_this.checkForTags(source.getTags(),['web','mbr'])||(_this.isHlsSource(source))){sourcesByTags.push(source);}});}else{sourcesByTags=_this.getSourcesByTags(flavorTags);}return sourcesByTags;},restorePlayerOnScreen:function(){},updateSources:function(){if(!(this.isLive()||this.sourcesReplaced||this.isHlsSource(this.mediaElement.selectedSource))){this.autoSelectTemporalSource({'sources':this.getSourcesForKDP()});}else if(this.isLive()&&this.streamerType=='rtmp'){var _this=this;if(!this.autoplay){this.autoplay=true;this.cancelLiveAutoPlay=true;}else if(this.playerObject){this.playerObject.setKDPAttribute('configProxy.flashvars','autoPlay','true');}this.setKDPAttribute('liveCore','offlineAlertOffest',this.LIVE_OFFLINE_ALERT_TIMEOUT);$(this).bind('layoutBuildDone',function(){_this.disablePlayControls();});}},changeMediaCallback:function(callback){var _this=this;this.updateSources();this.seekStarted=false;this.mediaLoadedFlag=false;this.flashCurrentTime=0;this.playerObject.setKDPAttribute('mediaProxy','isLive',this.isLive());this.playerObject.setKDPAttribute('mediaProxy','isMp4',this.isMp4Src());this.playerObject.setKDPAttribute('mediaProxy','entryDuration',this.getDuration());this.getEntryUrl().then(function(srcToPlay){if(!_this.playlist||_this.autoplay){_this.bindHelper("onChangeMediaDone"+_this.bindPostfix,function(){_this.unbindHelper("onChangeMediaDone"+_this.bindPostfix);_this.play();});}_this.playerObject.sendNotification('changeMedia',{entryUrl:srcToPlay});callback();});},isMp4Src:function(){if(this.mediaElement.selectedSource&&(this.mediaElement.selectedSource.getMIMEType()=='video/mp4'||this.mediaElement.selectedSource.getMIMEType()=='video/h264')){return true;}return false;},embedPlayerHTML:function(){},onPause:function(){if(this.kPreload.preLoading){this.kPreload.preLoading=false;if(this.kPreload.playPending){this.kPreload.playPending=false;this.play();}return;}$(this).trigger("pause");},onPlay:function(){if(this.kPreload.preLoading){this.playerObject.pause();return;}if(mw.isChrome()&&!this.flashActivationRequired&&mw.getConfig("EmbedPlayer.EnableFlashActivation")!==false){this.flashActivationRequired=true;$(this).hide();}if(this._propagateEvents){$(this).trigger("playing");this.hideSpinner();if(this.isLive()){this.ignoreEnableGui=false;this.enablePlayControls(['sourceSelector']);}this.stopped=this.paused=false;}},onDurationChange:function(data,id){var dur=this.getDuration();if(this.startTime&&this.pauseTime){dur=this.pauseTime-this.startTime+2;}else{if(this.startTime){dur=dur-this.startTime+2;}}if(!this.isLive()&&data.newValue>dur&&mw.getConfig("EmbedPlayer.EnableURLTimeEncoding")===true){return;}this.setDuration(data.newValue);this.playerObject.duration=data.newValue;},onVideoMetadataReceived:function(data){if(data&&data.info){$(this).trigger('videoMetadataReceived',[data.info]);}if(!this.mediaLoadedFlag){$(this).trigger('mediaLoaded');this.mediaLoadedFlag=true;}},onMediaLoaded:function(){if(!this.mediaLoadedFlag){$(this).trigger('mediaLoaded');this.mediaLoadedFlag=true;}},onClipDone:function(){this.parent_onClipDone();this.flashCurrentTime=0;},onAlert:function(data,id){if(data.messageKey){data.message=gM(data.messageKey);}if(data.titleKey){data.title=gM(data.titleKey);}this.layoutBuilder.displayAlert(data);},onHlsEndList:function(){this.triggerHelper('liveEventEnded');},onMediaError:function(data){var error=null;if(data){error=data.errorId+" detail:"+data.errorDetail;}data.errorMessage=this.getKalturaMsg('ks-CLIP_NOT_FOUND');mw.log("EmbedPlayerKPlayer::MediaError error code: "+error);this.triggerHelper('embedPlayerError',[data]);},play:function(){if(this.kPreload.preLoading){this.kPreload.playPending=true;return;}if(this.restarting){return;}var _this=this;mw.log('EmbedPlayerKplayer::play');if(this.unresolvedSrcURL){this.getEntryUrl().then(function(srcToPlay){_this.unresolvedSrcURL=false;_this.playerObject.sendNotification('changeMedia',{entryUrl:srcToPlay});_this.play();});return;}var shouldDisable=false;if(this.isLive()&&this.paused){shouldDisable=true;}if(this.parent_play()){if(shouldDisable){this.ignoreEnableGui=true;this.disablePlayControls(['sourceSelector']);}this.playerObject.play();this.monitor();}else{mw.log("EmbedPlayerKPlayer:: parent play returned false, don't issue play on kplayer element");}},pause:function(){try{this.playerObject.pause();}catch(e){mw.log("EmbedPlayerKplayer:: doPause failed");}this.parent_pause();},playerSwitchSource:function(source,switchCallback,doneCallback){if(switchCallback){switchCallback(this.playerObject);}setTimeout(function(){if(doneCallback)doneCallback();},100);},doSeek:function(seekTime){this.seekStarted=true;if(this.firstPlay){this.stopEventPropagation();if(this.streamerType=='http'){this.playerObject.seek(seekTime);}else{this.playerObject.setKDPAttribute('mediaProxy','mediaPlayFrom',seekTime);this.playerObject.play();}}else{this.playerObject.seek(seekTime);}},setPlayerElementVolume:function(percentage){if(this.playerObject){this.playerObject.changeVolume(percentage);}},onUpdatePlayhead:function(playheadValue){if(this.flashActivationRequired){this.flashActivationRequired=false;$(this).show();}if(this.isLive()){$(this).trigger('timeupdate');return;}if(this.seeking){this.seeking=false;this.flashCurrentTime=playheadValue;}else{if(this.flashCurrentTime<playheadValue){this.flashCurrentTime=playheadValue;}}$(this).trigger('timeupdate');},onBytesTotalChange:function(data,id){this.bytesTotal=data.newValue;},onBytesDownloadedChange:function(data,id){this.bytesLoaded=data.newValue;this.bufferedPercent=this.bytesLoaded/this.bytesTotal;$(this).trigger('updateBufferPercent',this.bufferedPercent);},onPlayerSeekEnd:function(){if(this.firstPlay){this.restoreEventPropagation();}if(this.seekStarted){this.seekStarted=false;this.triggerHelper('seeked',[this.playerObject.getCurrentTime()]);}},onSwitchingChangeStarted:function(data,id){$(this).trigger('sourceSwitchingStarted',[data]);},onSwitchingChangeComplete:function(data,id){this.onBitrateChange(data);$(this).trigger('sourceSwitchingEnd',[data.newIndex]);},onBitrateChange:function(data){if(data&&data.newBitrate){this.triggerHelper('bitrateChange',data.newBitrate);}},onFlavorsListChanged:function(data,id){var flavors=data.flavors;var currentSources=[];if(this.mediaElement){currentSources=this.mediaElement.getPlayableSources();}if(flavors&&flavors.length>1){if(currentSources.length>0){$.each(flavors,function(index,flavor){for(var i=0;i<currentSources.length;i++){if(currentSources[i].bandwidth==flavor.bandwidth){flavor.height=currentSources[i].height;break;}}});}this.setKDPAttribute('sourceSelector','visible',true);this.parent_onFlavorsListChanged(flavors);}},onLiveEntryOffline:function(){if(this.streamerType=='rtmp'){this.triggerHelper('liveStreamStatusUpdate',{'onAirStatus':false});}},onLiveStreamReady:function(){if(this.streamerType=='rtmp'){this.hideSpinner();this.playerObject.setKDPAttribute('configProxy.flashvars','autoPlay','false');this.triggerHelper('liveStreamStatusUpdate',{'onAirStatus':true});if(this.cancelLiveAutoPlay){this.cancelLiveAutoPlay=false;this.autoplay=false;this.pause();}}},onLoadEmbeddedCaptions:function(data){this.triggerHelper('onTextData',data);var caption={source:{srclang:data.language},capId:data.trackid,caption:{content:data.text}};this.triggerHelper('onEmbeddedData',caption);},onEnableGui:function(data,id){if(this.ignoreEnableGui){return;}if(data.guiEnabled===false){this.disablePlayControls();}else{this.enablePlayControls();}},onBufferChange:function(buffering){if(buffering){this.bufferStart();}else{this.bufferEnd();}},onAudioTracksReceived:function(data){this.triggerHelper('audioTracksReceived',data);},onAudioTrackSelected:function(data){this.triggerHelper('audioTrackIndexChanged',data);},onDebugInfoReceived:function(data){var msg='';for(var prop in data){msg+=prop+': '+data[prop]+' | ';}this.triggerHelper('debugInfoReceived',data);mw.log("EmbedPlayerKplayer:: onDebugInfoReceived | "+msg);},onReadyToPlay:function(){this.triggerHelper('readyToPlay');},onId3tag:function(data){var id3TagData=base64_decode(data.data);var id3TagString=id3TagData.substring(id3TagData.indexOf("{"),id3TagData.lastIndexOf("}")+1);var id3Tag=JSON.parse(id3TagString);this.triggerHelper('onId3Tag',id3Tag);},getPlayerElementTime:function(){return this.flashCurrentTime;},getPlayerElement:function(){return this.playerObject;},getPlayerContainer:function(){if(!this.kPlayerContainerId){this.kPlayerContainerId='kplayer_'+this.id;}return $('#'+this.kPlayerContainerId);},getEntryUrl:function(){var _this=this;var deferred=$.Deferred();var originalSrc=this.mediaElement.selectedSource.getSrc();if(this.isHlsSource(this.mediaElement.selectedSource)){this.streamerType='hls';this.resolveSrcURL(originalSrc).then(function(srcToPlay){_this.unresolvedSrcURL=false;deferred.resolve(srcToPlay);},function(){_this.unresolvedSrcURL=true;deferred.resolve(originalSrc);});return deferred;}else if(this.isLive()||this.sourcesReplaced){return deferred.resolve(originalSrc);}var flavorIdParam='';var mediaProtocol=this.getKalturaAttributeConfig('mediaProtocol')||mw.getConfig('Kaltura.Protocol')||"http";var format;var fileExt='f4m';if(this.streamerType==='hdnetwork'){format='hdnetworksmil';fileExt='smil';}else if(this.streamerType==='live'){format='rtmp';}else{format=this.streamerType;if(format=='http'){flavorIdParam=this.mediaElement.selectedSource?"/flavorId/"+this.mediaElement.selectedSource.getAssetId():"";}}var ksString=this.getFlashvars('ks')?"/ks/"+this.getFlashvars('ks'):"";var srcUrl=window.kWidgetSupport.getBaseFlavorUrl(this.kpartnerid)+"/entryId/"+this.kentryid+flavorIdParam+this.getPlaymanifestArg("deliveryCode","deliveryCode")+"/format/"+format+"/protocol/"+mediaProtocol+this.getPlaymanifestArg("cdnHost","cdnHost")+this.getPlaymanifestArg("storageId","storageId")+ksString+"/uiConfId/"+this.kuiconfid+this.getPlaymanifestArg("referrerSig","referrerSig")+this.getPlaymanifestArg("tags","flavorTags")+"/a/a."+fileExt+"?referrer="+this.b64Referrer;if(this.supportsURLTimeEncoding()&&this.pauseTime){if(srcUrl.indexOf("&clipTo=")!==-1){srcUrl=srcUrl.substr(0,this.selectedSource.src.indexOf("&clipTo="));}srcUrl=srcUrl+"&clipTo="+parseInt(this.pauseTime)*1000;}if(this.supportsURLTimeEncoding()&&this.startTime){if(srcUrl.indexOf("&seekFrom=")!==-1){srcUrl=srcUrl.substr(0,srcUrl.indexOf("&seekFrom="));}srcUrl=srcUrl+"&seekFrom="+parseInt(this.startTime)*1000;}srcUrl=srcUrl+"&playSessionId="+this.evaluate('{configProxy.sessionId}');if(originalSrc.indexOf("&clientTag=")!==-1){var clientTag=originalSrc.slice(originalSrc.indexOf("clientTag"));clientTag=clientTag.slice(0,clientTag.indexOf("&"))
srcUrl=srcUrl+"&"+clientTag;}var sourceElm=$('<source />').attr({src:srcUrl}).get(0);var refObj=new mw.MediaSource(sourceElm);this.triggerHelper('SourceSelected',refObj);deferred.resolve(refObj.src);return deferred;},getPlaymanifestArg:function(argName,argKey){var argString="";var argVal=this.getKalturaAttributeConfig(argKey);if(argVal!==undefined){argString="/"+argName+"/"+argVal;}return argString;},switchSrc:function(source){var _this=this;if(this.streamerType=='http'&&!this.getKalturaAttributeConfig('forceDynamicStream')){this.mediaElement.setSource(source);this.getEntryUrl().then(function(srcToPlay){_this.playerObject.setKDPAttribute('mediaProxy','entryUrl',srcToPlay);_this.playerObject.sendNotification('doSwitch',{flavorIndex:_this.getSourceIndex(source)});});return;}var sourceIndex=-1;if(source!==-1){sourceIndex=this.getSourceIndex(source);}this.playerObject.sendNotification('doSwitch',{flavorIndex:sourceIndex});},canAutoPlay:function(){return(!this.isLive()||(this.isLive()&&!this.isOffline()));},backToLive:function(){this.triggerHelper('movingBackToLive');var _this=this;if(this.isDVR()){this.playerObject.sendNotification('goLive');if(this.buffering){this.bindHelper('bufferEndEvent'+this.bindPostfix,function(){_this.unbindHelper('bufferEndEvent'+_this.bindPostfix);_this.playerObject.seek(_this.getDuration());_this.syncMonitor();});}}else{this.bindHelper('playing'+this.bindPostfix,function(){_this.unbindHelper('playing'+_this.bindPostfix);_this.playerObject.sendNotification('goLive');});}},setKPlayerAttribute:function(host,prop,val){this.playerObject.setKDPAttribute(host,prop,val);},clean:function(){this.unbindHelper(this.bindPostfix);$(this.getPlayerContainer()).remove();this.playerObject=null;},setStorageId:function(storageId){var _this=this;this.parent_setStorageId(storageId);if(this.playerObject){this.getEntryUrl().then(function(srcToPlay){_this.playerObject.setKDPAttribute('mediaProxy','entryUrl',srcToPlay);});}},toggleFullscreen:function(){var _this=this;this.parent_toggleFullscreen();this.playerObject.redrawObject();if(_this.layoutBuilder.fullScreenManager.isInFullScreen()){_this.playerObject.sendNotification("hasOpenedFullScreen");}else{_this.playerObject.sendNotification("hasCloseFullScreen");}},playSegment:function(startTime,endTime){var _this=this;if(this.supportsURLTimeEncoding()){this.getEntryUrl().then(function(srcToPlay){var shouldSeek=!_this.paused;_this.stop();_this.playerObject.sendNotification('changeMedia',{entryUrl:srcToPlay});if(shouldSeek){_this.seek(0);}else{_this.playerObject.sendNotification("doStop");}});}else{this.playerObject.setKDPAttribute('mediaProxy','mediaPlayFrom',this.startTime);if(endTime){this.pauseTime=endTime;}if(startTime){this.seek(startTime);}}},getCurrentBufferLength:function(){return parseInt(this.playerObject.getCurrentBufferLength());},bufferHandling:function(){}};})(mediaWiki,jQuery);;},{},{});mw.loader.implement("mw.EmbedPlayerNative",function($){(function(mw,$){"use strict";mw.EmbedPlayerNative={instanceOf:'Native',bindPostfix:'.nativePlayer',playerPrefix:'EmbedPlayerNative',onlyLoadFlag:false,onLoadedCallback:null,prevCurrentTime:-1,progressEventData:null,mediaLoadedFlag:null,triggerNetworkErrorsFlag:true,keepPlayerOffScreenFlag:null,ignoreNextNativeEvent:null,currentSeekTargetTime:null,ignoreNextError:false,keepNativeFullScreen:false,playing:false,disableSwitchSourceCallback:false,mobilePlayed:false,nativeEvents:['loadstart','progress','suspend','abort','error','emptied','stalled','play','pause','loadedmetadata','loadeddata','waiting','playing','canplay','canplaythrough','seeking','seeked','timeupdate','ended','ratechange','durationchange','volumechange'],supports:{'playHead':true,'pause':true,'fullscreen':true,'SourceSelector':true,'timeDisplay':true,'volumeControl':true,'overlays':true},setup:function(readyCallback){var _this=this;this._propagateEvents=true;if(mw.isIpad()||mw.isEdge()){this.getPlayerElement().removeAttribute("poster");}$(this.getPlayerElement()).css('position','absolute');if(this.inline){$(this.getPlayerElement()).attr('playsinline','');}this.addBindings();readyCallback();$(window).unload(function(){_this.triggerNetworkErrorsFlag=false;if(_this.layoutBuilder){_this.layoutBuilder.closeAlert();}});},addBindings:function(){var _this=this;this.bindHelper('firstPlay'+this.bindPostfix,function(){_this.parseTracks();});this.bindHelper('switchAudioTrack'+this.bindPostfix,function(e,data){_this.switchAudioTrack(data.index);});this.bindHelper('liveOnline'+this.bindPostfix,function(){if(_this.isLive()&&!_this.isDVR()){_this.resetSrc=true;}});},removeBindings:function(){this.unbindHelper('firstPlay'+this.bindPostfix);this.unbindHelper('switchAudioTrack'+this.bindPostfix);this.unbindHelper('liveOnline'+this.bindPostfix);},updateFeatureSupport:function(){if(this.useNativePlayerControls()){this.supports.overlays=false;}if(!this.supportsVolumeControl()){this.supports.volumeControl=false;}if(this.getPlayerElement()&&this.getSrc()&&!mw.isIE()&&!mw.isEdge()){$(this.getPlayerElement()).attr('src',this.getSrc());}if(this.getPlayerElement()){this.applyMediaElementBindings();this.playbackRate=this.getPlayerElement().playbackRate;}this.parent_updateFeatureSupport();},supportsVolumeControl:function(){return!(mw.isIpad()||mw.isAndroid()||mw.isMobileChrome()||this.useNativePlayerControls());},changeMediaCallback:function(callback){if(!this.getSource()){callback();return;}var _this=this;_this.switchPlaySource(this.getSource(),function(){if(!_this.autoplay||(_this.autoplay&&mw.isMobileDevice())){_this.ignoreNextNativeEvent=true;if(!_this.isPlaying()){_this.updatePosterHTML();}}callback();});},disablePlayer:function(){$(this.getPlayerElement()).css('position','static');},embedPlayerHTML:function(){var _this=this;var vid=_this.getPlayerElement();this.ignoreNextNativeEvent=true;if(vid&&!mw.isIphone()){$(vid).empty();}if(vid&&$(vid).attr('src')==this.getSrc(this.currentTime)){_this.postEmbedActions();return;}this.log("embedPlayerHTML > play url:"+this.getSrc(this.currentTime)+' startOffset: '+this.start_ntp+' end: '+this.end_ntp);if(this.isPersistentNativePlayer()&&vid){_this.postEmbedActions();return;}_this.bufferStartFlag=false;_this.bufferEndFlag=false;$(this.getVideoDisplay()).append(_this.getNativePlayerHtml());_this.postEmbedActions();},getNativePlayerHtml:function(playerAttribtues,cssSet){if(!playerAttribtues){playerAttribtues={};}if(!playerAttribtues['id']){playerAttribtues['id']=this.pid;}if(!playerAttribtues['src']){playerAttribtues['src']=this.getSrc(this.currentTime);}if(this.autoplay){playerAttribtues['autoplay']='true';}if(!cssSet){cssSet={};}if(!cssSet['width'])cssSet['width']='100%';if(!cssSet['height'])cssSet['height']='100%';if(this.loop){playerAttribtues['loop']='true';}var tagName=this.isAudio()?'audio':'video';return $('<'+tagName+' />').addClass('persistentNativePlayer nativeEmbedPlayerPid').attr(playerAttribtues).css(cssSet);},canAutoPlay:function(){return(!mw.isAndroid()&&!mw.isMobileChrome()&&!mw.isIOS())||this.mobilePlayed;},postEmbedActions:function(){var _this=this;var vid=this.getPlayerElement();if(!vid){return;}if(!this.skipUpdateSource){if($(vid).attr('src')!=this.getSrc(this.currentTime)&&!mw.isIE()&&!mw.isEdge()){$(vid).attr('src',this.getSrc(this.currentTime));}}if(this.muted){vid.muted=true;}if(mw.getConfig('EmbedPlayer.WebKitAllowAirplay')){$(vid).attr('x-webkit-airplay',"allow");}if(this.useNativePlayerControls()){$(vid).attr('controls',"true");}$(vid).show().css('visibility','');_this.applyMediaElementBindings();if(this.currentTime!=vid.currentTime){var waitReadyStateCount=0;var checkReadyState=function(){if(vid.readyState>0){vid.currentTime=this.currentTime;return;}if(waitReadyStateCount>1000){_this.log("Error: could not run native seek");return;}waitReadyStateCount++;setTimeout(function(){checkReadyState();},10);};}},applyMediaElementBindings:function(){var _this=this;this.log("MediaElementBindings");var vid=this.getPlayerElement();if(!vid){this.log(" Error: applyMediaElementBindings without player elemnet");return;}$.each(_this.nativeEvents,function(inx,eventName){if(mw.isIOSAbove7()&&mw.isIphone()&&eventName==="seeking"){return;}$(vid).unbind(eventName+'.embedPlayerNative').bind(eventName+'.embedPlayerNative',function(){if(_this._propagateEvents&&_this.instanceOf=='Native'){var argArray=$.makeArray(arguments);if(_this['_on'+eventName]){_this['_on'+eventName].apply(_this,argArray);}else{$(_this).trigger(eventName,argArray);}}});});},monitor:function(){var _this=this;var vid=_this.getPlayerElement();if(vid&&vid.buffered&&vid.buffered.end&&vid.duration){try{this.updateBufferStatus(vid.buffered.end(vid.buffered.length-1)/vid.duration);}catch(e){}}_this.parent_monitor();},doSeek:function(seekTime){var _this=this;if(mw.isIOS()){this.hidePlayerOffScreen();}if(seekTime===0&&this.isLive()&&mw.isIpad()&&!mw.isIOSAbove7()){seekTime=0.01;this.log("doSeek: fix seekTime to 0.01");}this.unbindHelper("seeked.doSeek").bindOnceHelper("seeked.doSeek",function(){_this.restorePlayerOnScreen();});this.setCurrentTime(seekTime);},canSeek:function(deferred,callbackCount){var vid=this.getPlayerElement();var checkVideoStateDeferred=deferred||$.Deferred();var _this=this;if(!callbackCount){callbackCount=0;}if(this.currentState==="end"&&mw.isIphone()){vid.play();this.playing=true;}if((vid.currentTime===0&&callbackCount===0)&&vid.readyState===0){if(mw.isIpad()){$(vid).attr('preload','auto')[0].load();}else{$(vid).attr('preload','auto');}}var videoReadyState=mw.isIOSAbove7()?2:1;if((vid.readyState<videoReadyState)||(this.getDuration()===0)){if(callbackCount==0&&vid.paused){this.stopEventPropagation();this.isWaitingForSeekReady=true;var vidObj=$(vid);var eventName=mw.isIOS()?"canplaythrough.seekPrePlay":"canplay.seekPrePlay";vidObj.off(eventName).one(eventName,function(){_this.isWaitingForSeekReady=false;_this.restoreEventPropagation();if(vid.duration>0){_this.log("player can seek");clearTimeout(_this.canSeekTimeout);_this.canSeekTimeout=null;setTimeout(function(){return checkVideoStateDeferred.resolve();},10);}else{_this.log("player can't seek - video duration not available, wait for video duration update");}});vidObj.off('loadedmetadata.seekPrePlay').one('loadedmetadata.seekPrePlay',function(){_this._onloadedmetadata();});this.log("player can't seek - try to init video element ready state");if(!_this.skipUpdateSource){if($(vid).attr('src')!=_this.getSrc()){$(vid).attr('src',_this.getSrc());vid.load();vid.play();_this.parseTracks();}}}if(callbackCount>=15){this.log("Error:: with seek request, media never in ready state");return checkVideoStateDeferred.resolve();}this.log("player can't seek - wait video element ready state");this.canSeekTimeout=setTimeout(function(){_this.canSeekTimeout=null;_this.canSeek(checkVideoStateDeferred,callbackCount+1);},1000);}else{setTimeout(function(){_this.log("player can seek");if(_this.isWaitingForSeekReady){_this.restoreEventPropagation();_this.isWaitingForSeekReady=false;}return checkVideoStateDeferred.resolve();},10);}return checkVideoStateDeferred;},setCurrentTime:function(time){if(this.isLive()&&!this.isDVR()){this.LiveCurrentTime=time;}else{this.log("setCurrentTime seekTime:"+time);try{var vid=this.getPlayerElement();vid.currentTime=this.currentSeekTargetTime;}catch(e){this.log("Error: Could not set video tag seekTime");this.triggerHelper("seeked");}}},getPlayerElementTime:function(){var _this=this;this.getPlayerElement();if(!this.playerElement){this.log('getPlayerElementTime: '+this.id+' not in dom ( stop monitor)');this.stop();return false;}if(this.isLive()&&!this.isDVR()){return this.LiveCurrentTime?this.LiveCurrentTime:0;}var ct=this.playerElement.currentTime;if(!ct||isNaN(ct)||ct<0||!isFinite(ct)){return 0;}return this.playerElement.currentTime;},updatePoster:function(src){this.parent_updatePoster(src);if(mw.getConfig('EmbedPlayer.HidePosterOnStart')===true){return;}if(this.getPlayerElement()){$(this.getPlayerElement()).attr('poster',src);}},emptySources:function(){var _this=this;this.ignoreNextError=true;setTimeout(function(){_this.ignoreNextError=false;},5000);$(this.getPlayerElement()).attr('src',null).attr('poster',null);this.parent_emptySources();},isTimeUpdateSupported:function(){if(this.isLive()&&(mw.isAndroid()||!this.isDVR())){return false;}else{return true;}},playerSwitchSource:function(source,switchCallback,doneCallback){var _this=this;var src=source.getSrc();var vid=this.getPlayerElement();var switchBindPostfix='.playerSwitchSource';this.isPauseLoading=false;if(!src||(src==vid.src&&!this.changeMediaStarted)){if($.isFunction(switchCallback)){switchCallback(vid);}if($.isFunction(doneCallback)){_this.ignoreNextError=false;doneCallback();}return;}$(vid).attr('preload','auto');this.log('playerSwitchSource: '+src+' native time: '+vid.currentTime);this.ignoreNextNativeEvent=true;this.currentTime=0;this.previousTime=0;if(vid){try{$(vid).unbind(switchBindPostfix);vid.pause();var originalControlsState=vid.controls;vid.removeAttribute('controls');if(_this.isFlavorSwitching){_this.seeking=true;}else{_this.seeking=false;}if(!_this.firstPlay){_this.addPlayerSpinner();_this.addBlackScreen();}$(vid).empty();if(mw.isIOS7()&&mw.isIphone()){vid.src=null;var sourceTag=document.createElement('source');sourceTag.setAttribute('src',src);vid.appendChild(sourceTag);}else{vid.src=src;}if(mw.isDesktopSafari()){vid.load();}_this.hidePlayerOffScreen();$(vid).bind('loadedmetadata'+switchBindPostfix,function(){$(vid).unbind('loadedmetadata'+switchBindPostfix);_this.log(" playerSwitchSource> loadedmetadata callback for:"+src);if(!mw.isIOS71()&&$.isFunction(switchCallback)&&!_this.isVideoSiblingEnabled()){vid.play();}else{_this.removeBlackScreen();}});var handleSwitchCallback=function(){$(vid).unbind('pause'+switchBindPostfix);_this.restorePlayerOnScreen();_this.hideSpinner();vid.controls=originalControlsState;_this.ignoreNextError=false;_this.ignoreNextNativeEvent=false;if($.isFunction(switchCallback)){_this.log(" playerSwitchSource> call switchCallback");switchCallback(vid);switchCallback=null;}};$(vid).bind('playing'+switchBindPostfix,function(){$(vid).unbind('playing'+switchBindPostfix);_this.log(" playerSwitchSource> playing callback: "+vid.currentTime);handleSwitchCallback();setTimeout(function(){_this.removeBlackScreen();},100);});if($.isFunction(doneCallback)){var sentDoneCallback=false;$(vid).bind('ended'+switchBindPostfix,function(event){if(_this.disableSwitchSourceCallback){return;}if(_this.mobileChromeTimeoutID){clearTimeout(_this.mobileChromeTimeoutID);_this.mobileChromeTimeoutID=null;}sentDoneCallback=true;$(vid).unbind(switchBindPostfix);doneCallback();return false;});if(mw.isMobileChrome()){$(vid).bind('timeupdate'+switchBindPostfix,function(e){var _this=this;var timeDiff=this.duration-this.currentTime;if(timeDiff<0.5&&this.duration!=0){_this.mobileChromeTimeoutID=setTimeout(function(){_this.mobileChromeTimeoutID=null;if(timeDiff<=(_this.duration-_this.currentTime)){_this.log('playerSwitchSource> error in getting ended event, issue doneCallback directly.');if(!sentDoneCallback){$(vid).unbind(switchBindPostfix);sentDoneCallback=true;doneCallback();}}},2000);}});}}if(_this.isInSequence()){vid.play();}else{if(!(_this.playlist&&mw.isAndroid())){_this.play();}}if(mw.isMobileDevice()){setTimeout(function(){handleSwitchCallback();},100);}setTimeout(function(){if(vid.readyState===0&&$.isFunction(switchCallback)&&!_this.canAutoPlay()){_this.log(" Error: possible play without user click gesture, issue callback");handleSwitchCallback();_this.pause();}},10000);}catch(e){this.log("Error: switching source playback failed");}}},hidePlayerOffScreen:function(vid){var vid=this.getPlayerElement();$(vid).css({'position':'absolute','left':'-4048px'});},restorePlayerOnScreen:function(vid){var vid=this.getPlayerElement();if(this.keepPlayerOffScreenFlag||this.instanceOf!='Native'){return;}if(!this.isAudioPlayer&&!mw.getConfig("EmbedPlayer.KeepPoster")===true){this.removePoster();}$(vid).css({'left':'0px','top':'0px'});},pause:function(){this.getPlayerElement();this.parent_pause();if(this.playerElement){this.playerElement.pause();}},play:function(){var vid=this.getPlayerElement();var _this=this;if(this.isStopped()&&this._playContorls){this.restorePlayerOnScreen();}var doPlay=function(){if(_this.parent_play()){if(_this.getPlayerElement()&&_this.getPlayerElement().play){_this.log(" issue native play call:");if(!_this.skipUpdateSource){if($(vid).attr('src')!=_this.getSrc()||_this.resetSrc){$(vid).attr('src',_this.getSrc());setTimeout(function(){if(!_this.playing){vid.play();_this.parseTracks();}},300);_this.resetSrc=false;}}_this.hideSpinnerOncePlaying();$(_this.getPlayerElement()).show();if(!_this.isAudio()){_this.removePoster();}if(_this.useNativePlayerControls()&&$(_this).find('video ').length==0){$(_this).hide();}if(!_this.mediaLoadedFlag){_this.load();}if(!_this.playing){vid.play();}_this.mobilePlayed=true;_this.monitor();}}else{_this.log(" parent play returned false, don't issue play on native element");}};if(this.firstPlay&&mw.isAndroid4andUp()&&mw.getConfig('EmbedPlayer.twoPhaseManifestHlsAndroid')&&this.mediaElement.selectedSource.getMIMEType()=='application/vnd.apple.mpegurl'&&!this.isLive()){this.resolveSrcURL(this.mediaElement.selectedSource.src).then(function(resolvedSrc){_this.mediaElement.selectedSource.setSrc(resolvedSrc);var firstTimePostfix=".firstTime";$(vid).bind('timeupdate'+firstTimePostfix,function(){if(_this.currentTime>=1){$(vid).unbind('timeupdate'+firstTimePostfix);vid.pause();vid.play();}});doPlay();});}else{doPlay();}},stop:function(){var _this=this;if(this.playerElement&&this.playerElement.currentTime){this.playerElement.pause();}this.parent_stop();},toggleMute:function(forceMute){this.parent_toggleMute(forceMute);this.getPlayerElement();if(this.playerElement)this.playerElement.muted=this.muted;},setPlayerElementVolume:function(percent){if(this.getPlayerElement()){this.playerElement.muted=(percent===0);this.playerElement.volume=percent;}},getPlayerElementVolume:function(){if(this.getPlayerElement()){return this.playerElement.volume;}},getPlayerElementMuted:function(){if(this.getPlayerElement()){return this.playerElement.muted;}},getNativeDuration:function(){if(this.playerElement){return this.playerElement.duration;}},load:function(callback){this.getPlayerElement();if(!this.playerElement){this.log('load() ... doEmbed');this.onlyLoadFlag=true;this.embedPlayerHTML();this.onLoadedCallback=callback;}else{this.playerElement.load();if(callback){callback();}}},getPlayerElement:function(){this.playerElement=$('#'+this.pid).get(0);return this.playerElement;},_onseeking:function(){var nua=navigator.userAgent;var is_native_android_browser=((nua.indexOf('Mozilla/5.0')>-1&&nua.indexOf('Android ')>-1&&nua.indexOf('AppleWebKit')>-1)&&!(nua.indexOf('Chrome')>-1));if(is_native_android_browser){return;}this.log("onSeeking "+this.seeking+' new time: '+this.getPlayerElement().currentTime);if(this.seeking&&Math.round(this.getPlayerElement().currentTime-this.currentSeekTargetTime)>2){this.log("Error: Seek time mismatch: target:"+this.getPlayerElement().currentTime+' actual '+this.currentSeekTargetTime+', note apple HLS can only seek to 10 second targets');}if(!this.seeking){this.currentSeekTargetTime=this.getPlayerElement().currentTime;this.seeking=true;this.layoutBuilder.onSeek();if(!this.isLive()||(this.isLive()&&this.isDVR())){this.log("seeking:trigger:: "+this.seeking);if(this._propagateEvents){this.triggerHelper('seeking');}}}else if(this.useNativePlayerControls()){this.currentSeekTargetTime=this.getPlayerElement().currentTime;}},_onseeked:function(){this.log("onSeeked "+this.seeking+' ct:'+this.playerElement.currentTime);if(this.seeking){var _this=this;this.waitForSeekTarget().then(function(){_this.seeking=false;_this.isFlavorSwitching=false;if(_this._propagateEvents){if(!_this.isLive()||(_this.isLive()&&_this.isDVR())){_this.log(" trigger: seeked");_this.triggerHelper('seeked',[_this.playerElement.currentTime]);}}_this.hideSpinner();});}},waitForSeekTarget:function(deferred,callbackCount){this.log("wait for seek target verification");var _this=this;var vid=this.getPlayerElement();var waitForSeekTargetDeferred=deferred||$.Deferred();if((this.mediaElement.selectedSource.getMIMEType()==='application/vnd.apple.mpegurl')&&((Math.abs(this.currentSeekTargetTime-this.getPlayerElement().currentTime)>2)||(this.currentSeekTargetTime>0.01&&(mw.isIpad()&&!mw.isIOSAbove7())))){this.log("Error: seeked triggred with time mismatch: target:"+this.currentSeekTargetTime+' actual:'+this.getPlayerElement().currentTime);if(!callbackCount){callbackCount=0;}var canPlayBind='canplaythrough.nativePlayBind';$(vid).unbind(canPlayBind).one(canPlayBind,function(){if(vid.paused){_this.log("seek target verified");return waitForSeekTargetDeferred.resolve();}else{var timeupdateCallback=function(callbackCount){if((Math.abs(_this.currentSeekTargetTime-_this.getPlayerElement().currentTime)>2)&&callbackCount<=15){setTimeout(function(){timeupdateCallback(++callbackCount);},100);}else{if(callbackCount>15){_this.log("Error: seek target failed");}else{_this.log("seek target verified");}return waitForSeekTargetDeferred.resolve();}};var timeupdateBind='timeupdate.nativePlayBind';$(vid).unbind(timeupdateBind).one(timeupdateBind,function(){timeupdateCallback(0);});}});return waitForSeekTargetDeferred;}else{this.log("seek target verified");return waitForSeekTargetDeferred.resolve();}},_ondurationchange:function(event,data){if(this.playerElement&&!isNaN(this.playerElement.duration)&&isFinite(this.playerElement.duration)){this.setDuration(this.getPlayerElement().duration);return;}if(this.playerElement&&!isFinite(this.playerElement.duration)&&this.isLive()&&!this.isDVR()){this.setDuration(this.getPlayerElement().duration);}},_onpause:function(){var _this=this;this.playing=false;if(this.ignoreNextNativeEvent){this.ignoreNextNativeEvent=false;return;}var timeSincePlay=Math.abs(this.absoluteStartPlayTime-new Date().getTime());this.log(" OnPaused:: propagate:"+this._propagateEvents+' time since play: '+timeSincePlay+' duringSeek:'+this.seeking);if((!this.seeking||this.isInSequence())&&!this.userSlide&&timeSincePlay>mw.getConfig('EmbedPlayer.MonitorRate')){_this.parent_pause();}else{this.getPlayerElement().play();}},_onplay:function(){this.log(" OnPlay:: propogate:"+this._propagateEvents+' paused: '+this.paused);if(this.useNativePlayerControls()&&$(this).find('video ').length==0){$(this).hide();}if(!this.ignoreNextNativeEvent&&this._propagateEvents&&this.paused&&(mw.getConfig('EmbedPlayer.EnableIpadHTMLControls')===true)){this.parent_play();}else{this.playInterfaceUpdate();this.absoluteStartPlayTime=new Date().getTime();}this.ignoreNextNativeEvent=false;if(mw.isIphone()){this.getInterface().removeClass("player-out");}this.monitor();},_onloadedmetadata:function(){this.getPlayerElement();if(!this.duration&&this.playerElement&&!isNaN(this.playerElement.duration)&&isFinite(this.playerElement.duration)){this.log('onloadedmetadata metadata ready Update duration:'+this.playerElement.duration+' old dur: '+this.getDuration());this.setDuration(this.playerElement.duration);}if(!this.paused&&!this.isInSequence()&&this._propagateEvents){this.getPlayerElement().play();}if(typeof this.onLoadedCallback=='function'){this.onLoadedCallback();}if(!this.mediaLoadedFlag){$(this).trigger('mediaLoaded');this.mediaLoadedFlag=true;}},_onprogress:function(event){var e=event.originalEvent;if(e&&e.loaded&&e.total){this.updateBufferStatus(e.loaded/e.total);this.progressEventData=e.loaded;}if(this.isLive()&&this.buffering){this.bufferEnd();}},_onended:function(event){var _this=this;if(this.getPlayerElement()){this.log('onended:'+this.playerElement.currentTime+' real dur:'+this.getDuration()+' ended '+this._propagateEvents);if(this._propagateEvents&&!this.isLive()){this.onClipDone();}}},_onerror:function(event){if(this.ignoreNextError){return;}var _this=this;setTimeout(function(){if(_this.triggerNetworkErrorsFlag){var data=[];if(event&&event.currentTarget&&event.currentTarget.error){data['errorCode']=event.currentTarget.error.code;_this.log('_onerror: MediaError code: '+data.errorCode);}}},100);},_onwaiting:function(){if(this.isLive()){this.bufferStart();}},_oncanplay:function(event){if(this.isLive()&&this.buffering){this.bufferEnd();}},onClipDone:function(){this.parent_onClipDone();if(mw.isIphone()&&!this.loop){$(this).trigger('onEndedDone');}if(!this._propagateEvents){return;}var _this=this;if(_this.isImagePlayScreen()&&!_this.isPlaylistScreen()){this.closeNativeFullScreen();}$(this).unbind('onEndedDone.onClipDone').bind('onEndedDone.onClipDone',function(){if(!_this.isImagePlayScreen()){_this.keepPlayerOffScreenFlag=false;}else{this.closeNativeFullScreen();}});},closeNativeFullScreen:function(){if(!mw.getConfig("EmbedPlayer.ForceNativeFullscreenOnClipDone")&&!this.keepNativeFullScreen){this.log('onClipDone: Exit full screen');this.getPlayerElement().webkitExitFullScreen();}},enableNativeControls:function(){$(this.getPlayerElement()).attr('controls',"true");},backToLive:function(){var _this=this;var vid=this.getPlayerElement();vid.load();vid.play();this.parseTracks();setTimeout(function(){_this.triggerHelper('movingBackToLive');},1000);},isVideoSiblingEnabled:function(){if(mw.isIphone()||mw.isAndroid2()||mw.isWindowsPhone()||mw.isAndroid40()||mw.isMobileChrome()||(mw.isIpad()&&!mw.isIpad3())){return false;}else{return this.parent_isVideoSiblingEnabled();}},playSegment:function(startTime,endTime){if(this.supportsURLTimeEncoding()){this.stop();var baseTimeOptions={'supportsURLTimeEncoding':true,'startTime':this.startTime,'endTime':this.pauseTime};var newSource=this.mediaElement.autoSelectSource(baseTimeOptions);if(newSource){this.switchSrc(newSource);}if(mw.isIOSAbove7()){this.play();}}else{this.pause();this.currentTime=0;this.addStartTimeCheck();if(this.canAutoPlay()){this.play();}}},setInline:function(state){this.getPlayerElement().attr('webkit-playsinline','');},parseTracks:function(){var vid=this.getPlayerElement();this.parseAudioTracks(vid,0);if(this.isLive()){this.parseTextTracks(vid,0);}},parseTextTracks:function(vid,counter){var _this=this;this.parseTextTracksTimeout=setTimeout(function(){if(vid.textTracks.length>0){for(var i=0;i<vid.textTracks.length;i++){if(vid.textTracks[i].kind==="metadata"){_this.id3Tag(vid.textTracks[i]);vid.textTracks[i].mode="hidden";}}}else{if(counter<10){_this.parseTextTracks(vid,++counter);}}},1000);},id3Tag:function(metadataTrack){var _this=this;metadataTrack.addEventListener("cuechange",function(evt){try{var id3Tag;if(mw.isEdge()){var id3TagData=String.fromCharCode.apply(null,new Uint8Array(evt.currentTarget.cues[evt.currentTarget.cues.length-1].data));var id3TagString=id3TagData.substring(id3TagData.indexOf("{"),id3TagData.lastIndexOf("}")+1);id3Tag=JSON.parse(id3TagString);}else{id3Tag=JSON.parse(this.activeCues[0].value.data);}_this.triggerHelper('onId3Tag',id3Tag);}catch(e){mw.log("Native player :: id3Tag :: ERROR :: "+e);}},false);},parseAudioTracks:function(vid,counter){var _this=this;this.parseAudioTracksTimeout=setTimeout(function(){if(vid.audioTracks&&vid.audioTracks.length>0){var data={'languages':[]};for(var i=0;i<vid.audioTracks.length;i++){var audioTrack=vid.audioTracks[i];var label=audioTrack.label||audioTrack.language;if(label!==""){var lang={};lang.index=i;lang.label=label;data.languages.push(lang);}}if(data.languages.length>0){_this.triggerHelper('audioTracksReceived',data);}}else{if(counter<5){_this.parseAudioTracks(vid,++counter);}}},1000);},switchAudioTrack:function(audioTrackIndex){var vid=this.getPlayerElement();var audioTracks=vid.audioTracks;if(audioTracks&&audioTracks[audioTrackIndex]&&!audioTracks[audioTrackIndex].enabled){if(mw.isEdge()){var _this=this;var currentValue=this._propagateEvents;this._propagateEvents=false;vid.pause();this.addPlayerSpinner();audioTracks[audioTrackIndex].enabled=true;setTimeout(function(){vid.play();_this.hideSpinner();_this._propagateEvents=currentValue;},200);}else{audioTracks[audioTrackIndex].enabled=true;}}},getCurrentBufferLength:function(){if(this.playerElement.buffered.length>0){return parseInt(this.playerElement.buffered.end(this.playerElement.buffered.length-1)-this.playerElement.currentTime);}return 0;},clean:function(){this.removeBindings();clearTimeout(this.parseAudioTracksTimeout);clearTimeout(this.parseTextTracksTimeout);}};})(mediaWiki,jQuery);;},{},{});mw.loader.implement("mw.EmbedPlayerNativeComponent",function($){(function(mw,$){"use strict";if(mw.getConfig("EmbedPlayer.ForceNativeComponent")){$('body,.videoHolder').css('background-color','transparent');}mw.EmbedPlayerNativeComponent={instanceOf:'NativeComponent',bindPostfix:'.EmbedPlayerNativeComponent',onlyLoadFlag:false,onLoadedCallback:null,prevCurrentTime:-1,progressEventData:null,mediaLoadedFlag:null,keepPlayerOffScreenFlag:null,ignoreNextNativeEvent:null,currentSeekTargetTime:null,disableSwitchSourceCallback:false,playbackDone:false,playingSource:undefined,lastPlayPauseTime:0,nativeEvents:['stop','play','pause','canplay','seeking','seeked','ended','error','stalled','loadedmetadata','durationchange','timeupdate','progress','bufferchange','enterfullscreen','exitfullscreen','chromecastDeviceConnected','hideConnectingMessage','chromecastDeviceDisConnected','textTracksReceived','loadEmbeddedCaptions','flavorsListChanged','sourceSwitchingStarted','sourceSwitchingEnd','audioTracksReceived'],supports:{'playHead':true,'pause':true,'fullscreen':true,'SourceSelector':true,'timeDisplay':true,'volumeControl':false,'overlays':true},canPlay:function(callback){var deferred=$.Deferred();this.bindOnceHelper("canplay",function(){if(callback){callback();}deferred.resolve();});return deferred;},setup:function(readyCallback){var _this=this;mw.log("NativeComponent:: setup");$('#'+this.pid).remove();var divElement=document.createElement("div");divElement.setAttribute('id','proxy');divElement['paused']=true;document.body.appendChild(divElement);this.proxyElement=divElement;try{if(NativeBridge.videoPlayer){NativeBridge.videoPlayer.registerPlayer(this.getPlayerElement());NativeBridge.videoPlayer.registerEmbedPlayer(this);}}catch(e){alert(e);}this.canPlayPromise=this.canPlay(readyCallback);this.applyMediaElementBindings();this.bindHelper("layoutBuildDone ended",function(){_this.getPlayerElement().notifyLayoutReady();});this.bindHelper("showChromecastDeviceList",function(){mw.log("EmbedPlayerNativeComponent:: showChromecastDeviceList::");_this.getPlayerElement().showChromecastDeviceList();});this.bindHelper("sendCCRecieverMessage",function(e,msg){mw.log("EmbedPlayerNativeComponent:: sendCCRecieverMessage::");_this.getPlayerElement().sendCCRecieverMessage(msg);});this.bindHelper("onEndedDone",function(){_this.playbackDone=true;});if(this.startTime&&!this.supportsURLTimeEncoding()){this.setStartTimeAttribute(this.startTime);}var selectedSource=this.getSrc();if(!selectedSource&&mw.getConfig("EmbedPlayer.PreloadNativeComponent")){readyCallback();}else{this.resolveSrcURL(selectedSource).then(function(resolvedSrc){mw.log("EmbedPlayerNativeComponent::resolveSrcURL get succeeded");_this.setSrcAttribute(resolvedSrc);},function(){mw.log("EmbedPlayerNativeComponent::resolveSrcURL get failed");_this.setSrcAttribute(selectedSource);});}},embedPlayerHTML:function(){},buildUdrmLicenseUri:function(mimeType){var licenseServer=mw.getConfig('Kaltura.UdrmServerURL');var licenseParams=this.mediaElement.getLicenseUriComponent();var licenseUri=null;if(licenseServer&&licenseParams){switch(mimeType){case"video/wvm":licenseUri=licenseServer+"/widevine/license?"+licenseParams;break;case"application/dash+xml":licenseUri=licenseServer+"/cenc/widevine/license?"+licenseParams;break;case"application/vnd.apple.mpegurl":licenseUri=licenseServer+"/fps/license?"+licenseParams;break;default:break;}}return licenseUri;},pushLicenseUri:function(){var selectedSource=this.mediaElement.selectedSource;if(!selectedSource){return;}var mimeType=selectedSource.mimeType;var overrideDrmServerURL=mw.getConfig('Kaltura.overrideDrmServerURL');var licenseUri=overrideDrmServerURL?overrideDrmServerURL:this.buildUdrmLicenseUri(mimeType);if(licenseUri){var playerElement=this.getPlayerElement();playerElement.attr('licenseUri',licenseUri);if(selectedSource.fpsCertificate){playerElement.attr('fpsCertificate',selectedSource.fpsCertificate);}}},addStartTimeCheck:function(){},setSrcAttribute:function(source){this.getPlayerElement().attr('src',source);this.playingSource=source;this.pushLicenseUri();},setStartTimeAttribute:function(startTime){this.getPlayerElement().attr('startTime',startTime);this.pushLicenseUri();},playerSwitchSource:function(source,switchCallback,doneCallback){mw.log("NativeComponent:: playerSwitchSource");var _this=this;var vid=this.getPlayerElement();var src=source.getSrc();var switchBindPostfix='.playerSwitchSource';if(!src||src==this.playingSource){if($.isFunction(switchCallback)){switchCallback(vid);}if($.isFunction(doneCallback)){doneCallback();}return;}var switchCallbackCalled=false;var switchCallbackWrapper=function(){if(!switchCallbackCalled){switchCallbackCalled=true;switchCallback();}};this.canPlayPromise=this.canPlay(switchCallbackWrapper);$(vid).unbind(switchBindPostfix);_this.addPlayerSpinner();$(vid).empty();this.setSrcAttribute(src);this.isPauseLoading=false;this.currentTime=0;this.previousTime=0;if($.isFunction(switchCallback)){$(vid).bind('durationchange'+switchBindPostfix,function(){$(vid).unbind('durationchange'+switchBindPostfix);switchCallbackWrapper();});}if($.isFunction(doneCallback)){$(vid).bind('ended'+switchBindPostfix,function(event){_this.currentTime=0;_this.previousTime=0;if(_this.disableSwitchSourceCallback){return;}$(vid).unbind(switchBindPostfix);doneCallback();return false;});}},changeMediaCallback:function(callback){var _this=this;_this.switchPlaySource(this.getSource(),function(){if(!_this.autoplay){mw.log("AutoPlay = false in Mobile");_this.ignoreNextNativeEvent=true;if(!_this.playlist){_this.pause();}_this.updatePosterHTML();}if(_this.autoplay&&mw.isMobileDevice()&&!_this.casting){mw.log("Autoplay = true in Mobile");_this.play();_this.updatePosterHTML();}callback();});},applyMediaElementBindings:function(){var _this=this;mw.log("EmbedPlayerNative::MediaElementBindings");var bindPostfix='.embedPlayerNativeComponent';$.each(_this.nativeEvents,function(inx,eventName){$(_this.getPlayerElement()).unbind(eventName+bindPostfix).bind(eventName+bindPostfix,function(){if(_this._propagateEvents&&_this.instanceOf=='NativeComponent'){var argArray=$.makeArray(arguments);if(_this['_on'+eventName]){_this['_on'+eventName].apply(_this,argArray);}else{$(_this).trigger(eventName,argArray);}}});});},getPlayerElementTime:function(){var _this=this;if(!this.getPlayerElement()){mw.log('EmbedPlayerNative::getPlayerElementTime: '+this.id+' not in dom ( stop monitor)');this.stop();return false;}var ct=this.getPlayerElement().attr('currentTime');if(!ct||isNaN(ct)||ct<0||!isFinite(ct)){return 0;}return ct;},getPlayerElement:function(){return this.proxyElement;},stop:function(){var _this=this;if(this.playerElement&&this.playerElement.currentTime){this.playerElement.pause();}this.parent_stop();},play:function(){var _this=this;mw.log("EmbedPlayerNativeComponent:: play::");this.playbackDone=false;this.unbindHelper('replayEvent').bindHelper('replayEvent',function(){this.getPlayerElement().replay();});var doPlay=function(){if(_this.parent_play()||_this.casting){if(_this.getPlayerElement()){_this.getPlayerElement().play();}_this.monitor();}_this.removePoster();}
this.canPlayPromise.then(function(){doPlay();});},pause:function(){mw.log("EmbedPlayerNativeComponent:: pause::");if(this.paused===false){this.stopPlayAfterSeek=true;this.stopAfterSeek=true;}this.parent_pause();if(this.getPlayerElement()){this.getPlayerElement().pause();}},doSeek:function(seekTime){mw.log("EmbedPlayerNativeComponent:: seek::");this.getPlayerElement().attr('currentTime',seekTime);},seek:function(seekTime,stopAfterSeek){if(seekTime===0){seekTime=0.01;}this.parent_seek(seekTime,stopAfterSeek);},setCurrentTime:function(seekTime,callback){seekTime=parseFloat(seekTime);mw.log("EmbedPlayerNativeComponent:: setCurrentTime to "+seekTime);if(seekTime===0){seekTime=0.01;}this.getPlayerElement().attr('currentTime',seekTime);if($.isFunction(callback)){callback();}},backToLive:function(){this.triggerHelper('movingBackToLive');this.getPlayerElement().attr('goLive','true');},doNativeAction:function(actionParams){mw.log("EmbedPlayerNativeComponent:: doNativeAction::");this.getPlayerElement().attr('nativeAction',actionParams);this.getPlayerElement().doNativeAction();},isNativeApp:function(){return mw.getConfig("EmbedPlayer.ForceNativeComponent");},canAutoPlay:function(){return true;},_onflavorsListChanged:function(event,data){var _this=this;var flavorsList=[];$.each(data.tracks,function(idx,obj){var flavor={assetid:obj.assetid,originalIndex:obj.originalIndex,bandwidth:obj.bandwidth,height:obj.height,width:obj.width,type:"video/mp4"};flavorsList.push(flavor);});setTimeout(function(){_this.setKDPAttribute('sourceSelector','visible',true);},100);this.onFlavorsListChanged(flavorsList);},_onsourceSwitchingStarted:function(event,data){$(this).trigger('sourceSwitchingStarted',data);},_onsourceSwitchingEnd:function(event,data){$(this).trigger('sourceSwitchingEnd',data);},_onloadEmbeddedCaptions:function(event,data){this.triggerHelper('onTextData',data);var caption={source:{srclang:data.language},capId:data.trackid,caption:{content:data.text}};this.triggerHelper('onEmbeddedData',caption);},_ondurationchange:function(){mw.log("EmbedPlayerNativeComponent:: onDurationChange::"+this.getPlayerElement().duration)
this.playerElement=this.getPlayerElement();if(this.playerElement&&!isNaN(this.playerElement.duration)&&isFinite(this.playerElement.duration)){this.setDuration(this.getPlayerElement().duration);}},_onplay:function(){mw.log("EmbedPlayerNativeComponent:: OnPlay::");this.removePoster();this.hideSpinner();$(this).trigger("playing");if(this.paused&&this.parent_play()){this.monitor();}else{this.playInterfaceUpdate();}},_onpause:function(){mw.log("EmbedPlayerNativeComponent:: OnPause::");this.parent_pause();},_onseeking:function(){mw.log("EmbedPlayerNative::onSeeking ");if(!this.seeking){this.seeking=true;this.layoutBuilder.onSeek();if(this._propagateEvents){mw.log("EmbedPlayerNative::seeking:trigger:: ");this.triggerHelper('seeking');}}},_onseeked:function(){if(this.seeking){if(this._propagateEvents){mw.log("EmbedPlayerNativeComponent:: trigger: seeked");this.triggerHelper('seeked');}}},_onloadedmetadata:function(){if(typeof this.onLoadedCallback=='function'){this.onLoadedCallback();}if(!this.mediaLoadedFlag){$(this).trigger('mediaLoaded');this.mediaLoadedFlag=true;}},_onended:function(event){if(this.getPlayerElement()){mw.log('EmbedPlayer:nativeComponent: onended:');if(this._propagateEvents&&!this.isLive()){this.onClipDone();}}},onClipDone:function(){mw.log('EmbedPlayer:native: oneClipDone:');this.parent_onClipDone();},_onerror:function(event,data){this.triggerHelper('embedPlayerError',data);},_onbufferchange:function(event,isBuffering){if(isBuffering==="true"){this.bufferStart();}else{this.bufferEnd();}},_onprogress:function(event,progress){if(typeof progress!=='undefined'){this.updateBufferStatus(progress);if(!this.seeking){this.updatePlayHead(progress);}if(progress<0.9){if(!this.showProgressSpinner){this.addPlayerSpinner();this.showProgressSpinner=true;}}else{this.showProgressSpinner=false;this.hideSpinner();}}},_onaudioTracksReceived:function(event,data){var _this=this;this.unbindHelper('switchAudioTrack').bindHelper('switchAudioTrack',function(event,selection){_this.getPlayerElement().attr('audioTrackSelected',selection.index.toString());});this.triggerHelper("audioTracksReceived",data);},_ontextTracksReceived:function(event,data){var _this=this;this.unbindHelper('selectClosedCaptions').bindHelper('selectClosedCaptions',function(event,selection){_this.getPlayerElement().attr('textTrackSelected',selection);});this.triggerHelper('textTracksReceived',data);},getVideoElementPosition:function(){var videoElementDiv=parent.document.getElementById(this.id);var videoElementRect=videoElementDiv.getBoundingClientRect();return videoElementRect;},showNativePlayer:function(){this.getPlayerElement().showNativePlayer();},hideNativePlayer:function(){this.getPlayerElement().hideNativePlayer();},useNativePlayerControls:function(){return false;},toggleFullscreen:function(){this.parent_toggleFullscreen();this.getPlayerElement().toggleFullscreen();},doneFSBtnPressed:function(){this.getPlayerElement().doneFSBtnPressed();},addNativeAirPlayButton:function(){this.getPlayerElement().addNativeAirPlayButton();},showNativeAirPlayButton:function(airPlayBtnPosition){var x=airPlayBtnPosition.left;var y=airPlayBtnPosition.top;var w=airPlayBtnPosition.right-airPlayBtnPosition.left;var h=airPlayBtnPosition.bottom-airPlayBtnPosition.top;this.getPlayerElement().showNativeAirPlayButton([x,y,w,h]);},togglePictureInPicture:function(){this.getPlayerElement().togglePictureInPicture();},hideNativeAirPlayButton:function(){this.getPlayerElement().hideNativeAirPlayButton();},isVideoSiblingEnabled:function(){return true;},isPlaying:function(){if(this.stopped||this.paused||this.getPlayerElement().paused){return false;}return true;},switchSrc:function(source){var sourceIndex=(source===-1)?-1:source.assetid;this.getPlayerElement().switchFlavor(sourceIndex);},checkClipDoneCondition:function(){if(mw.isAndroid()){this.parent_checkClipDoneCondition();}}};})(mediaWiki,jQuery);;},{},{});mw.loader.implement("mw.EmbedTypes",function($){(function(mw,$){"use strict";var nativeComponentPlayerVideo=new mw.MediaPlayer('nativeComponentPlayer',window.kNativeSdk&&window.kNativeSdk.allFormats,'NativeComponent');var kplayer=new mw.MediaPlayer('kplayer',['video/live','video/kontiki','video/x-flv','video/h264','video/mp4','audio/mpeg','application/x-shockwave-flash','application/vnd.apple.mpegurl'],'Kplayer');var splayer=new mw.MediaPlayer('splayer',['video/playreadySmooth','video/ism','video/multicast','video/h264','video/mp4'],'Silverlight');var oggNativePlayer=new mw.MediaPlayer('oggNative',['video/ogg','audio/ogg','application/ogg'],'Native');var h264NativePlayer=new mw.MediaPlayer('h264Native',['video/h264','video/mp4'],'Native');var appleVdnPlayer=new mw.MediaPlayer('appleVdn',['application/vnd.apple.mpegurl'],'Native');var wvmPlayer=new mw.MediaPlayer('wvmNative',['video/wvm'],'Native');var mp3NativePlayer=new mw.MediaPlayer('mp3Native',['audio/mpeg','audio/mp3'],'Native');var webmNativePlayer=new mw.MediaPlayer('webmNative',['video/webm'],'Native');var imageOverlayPlayer=new mw.MediaPlayer('imageOverlay',['image/jpeg','image/png'],'ImageOverlay');mw.EmbedTypes={mediaPlayers:null,detect_done:false,init:function(){this.detect();this.detect_done=true;},getMediaPlayers:function(){if(this.mediaPlayers){return this.mediaPlayers;}this.mediaPlayers=new mw.MediaPlayers();this.detectPlayers();return this.mediaPlayers;},getNativeComponentPlayerVideo:function(){return nativeComponentPlayerVideo;},getNativeImageOverlayPlayer:function(){return imageOverlayPlayer;},supportedMimeType:function(mimeType){for(var i=0;i<navigator.plugins.length;i++){var plugin=navigator.plugins[i];if(typeof plugin[mimeType]!="undefined"){return true;}}return false;},addFlashPlayer:function(){if(!mw.getConfig('EmbedPlayer.DisableHTML5FlashFallback')){this.mediaPlayers.addPlayer(kplayer);}},addSilverlightPlayer:function(){this.mediaPlayers.addPlayer(splayer);},addNativeComponentPlayer:function(){this.mediaPlayers.addPlayer(nativeComponentPlayerVideo);},detectPlayers:function(){mw.log("EmbedTypes::detectPlayers running detect");this.mediaPlayers.addPlayer(imageOverlayPlayer);try{var javaEnabled=navigator.javaEnabled();}catch(e){}if(mw.getConfig("EmbedPlayer.ForceNativeComponent")){this.addNativeComponentPlayer();}if(mw.supportsFlash()){this.addFlashPlayer();}if(mw.supportSilverlight()){this.addSilverlightPlayer();}if(!mw.getConfig('EmbedPlayer.DisableVideoTagSupport')&&(typeof HTMLVideoElement=='object'||typeof HTMLVideoElement=='function')){try{var dummyvid=document.createElement("video");if(dummyvid.canPlayType){if(dummyvid.canPlayType('video/webm; codecs="vp8, vorbis"')&&!mw.isAndroid40()){this.mediaPlayers.addPlayer(webmNativePlayer);}if(this.supportedMimeType('audio/mpeg')||dummyvid.canPlayType('audio/mpeg; codecs="mp3"')){this.mediaPlayers.addPlayer(mp3NativePlayer);}if(dummyvid.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')){this.mediaPlayers.addPlayer(h264NativePlayer);if(dummyvid.canPlayType('application/vnd.apple.mpegurl; codecs="avc1.42E01E"')||mw.isAndroid4andUp()){if(navigator.userAgent.indexOf('Android 3.')==-1){this.mediaPlayers.addPlayer(appleVdnPlayer);}}}if(mw.isAndroid2()){this.mediaPlayers.addPlayer(h264NativePlayer);}if(dummyvid.canPlayType('video/ogg; codecs="theora,vorbis"')){this.mediaPlayers.addPlayer(oggNativePlayer);}else if(this.supportedMimeType('video/ogg')){this.mediaPlayers.addPlayer(oggNativePlayer);}if(mw.isIOS()||mw.isAndroid4andUp()){this.mediaPlayers.addPlayer(wvmPlayer);}}}catch(e){mw.log('could not run canPlayType '+e);}}if(navigator.mimeTypes&&navigator.mimeTypes.length>0){for(var i=0;i<navigator.mimeTypes.length;i++){var type=navigator.mimeTypes[i].type;var semicolonPos=type.indexOf(';');if(semicolonPos>-1){type=type.substr(0,semicolonPos);}var pluginName=navigator.mimeTypes[i].enabledPlugin?navigator.mimeTypes[i].enabledPlugin.name:'';if(!pluginName){pluginName='';}if((type=='video/mpeg'||type=='video/x-msvideo')){}if(type=='application/ogg'){continue;}}}mw.log("EmbedPlayer::trigger:EmbedPlayerUpdateMediaPlayers");$(mw).trigger('EmbedPlayerUpdateMediaPlayers',this.mediaPlayers);},testActiveX:function(name){mw.log("EmbedPlayer::detect: test testActiveX: "+name);var hasObj=true;try{var obj=new ActiveXObject(''+name);}catch(e){hasObj=false;}return hasObj;},getKplayer:function(){return kplayer;},getSilverlightPlayer:function(){return splayer;}};})(mediaWiki,jQuery);;},{},{});mw.loader.implement("mw.KAnalytics",function($){(function(mw,$){"use strict";window['Kaltura']=true;mw.KAnalytics=function(embedPlayer){this.init(embedPlayer);};mw.addKAnalytics=function(embedPlayer){embedPlayer.kAnalytics=new mw.KAnalytics(embedPlayer);}
mw.KAnalytics.prototype={embedPlayer:null,reportSet:null,lastSeekEventTime:0,bindPostFix:'.kAnalytics',startReportTime:0,delay:0,histroyEvent:{},histroyEventCount:{},kEventTypes:{'WIDGET_LOADED':1,'MEDIA_LOADED':2,'PLAY':3,'PLAY_REACHED_25':4,'PLAY_REACHED_50':5,'PLAY_REACHED_75':6,'PLAY_REACHED_100':7,'OPEN_EDIT':8,'OPEN_VIRAL':9,'OPEN_DOWNLOAD':10,'OPEN_REPORT':11,'BUFFER_START':12,'BUFFER_END':13,'OPEN_FULL_SCREEN':14,'CLOSE_FULL_SCREEN':15,'REPLAY':16,'SEEK':17,'OPEN_UPLOAD':18,'SAVE_PUBLISH':19,'CLOSE_EDITOR':20,'PRE_BUMPER_PLAYED':21,'POST_BUMPER_PLAYED':22,'BUMPER_CLICKED':23,'FUTURE_USE_1':24,'FUTURE_USE_2':25,'FUTURE_USE_3':26},init:function(embedPlayer){var _this=this;this.version=mw.getConfig('version');if(!mw.KAnalytics.totalEventCount){mw.KAnalytics.totalEventCount=0;}this.embedPlayer=embedPlayer;if(!this.kClient){this.kClient=mw.kApiGetPartnerClient(embedPlayer.kwidgetid);this.delay=this.embedPlayer.getKalturaConfig('statistics','delay')?this.embedPlayer.getKalturaConfig('statistics','delay')*1000:0;}$(embedPlayer).unbind(this.bindPostFix);$(embedPlayer).bind('playerReady'+this.bindPostFix,function(){_this.resetPlayerflags();});$(embedPlayer).bind('changeMedia'+this.bindPostFix,function(){_this.histroyEvent={};_this.histroyEventCount={};});this.bindPlayerEvents();},resetPlayerflags:function(){this._p25Once=false;this._p50Once=false;this._p75Once=false;this._p100Once=false;this.hasSeeked=false;this.lastSeek=0;},sendAnalyticsEvent:function(KalturaStatsEventKey){var _this=this;mw.log("KAnalytics :: doSendAnalyticsEvent > "+KalturaStatsEventKey);if(this.embedPlayer.evaluate('{sequenceProxy.isInSequence}')){return;}var eventKeyId=this.kEventTypes[KalturaStatsEventKey];var eventSet={'eventType':eventKeyId,'clientVer':this.version,'currentPoint':parseInt(this.embedPlayer.currentTime*1000),'duration':this.embedPlayer.getDuration(),'eventTimestamp':new Date().getTime(),'isFirstInSession':'false','objectType':'KalturaStatsEvent','partnerId':this.embedPlayer.kpartnerid,'sessionId':this.embedPlayer.evaluate('{configProxy.sessionId}'),'uiconfId':0};if(isNaN(eventSet.duration)){eventSet.duration=0;}eventSet['seek']=(this.hasSeeked)?'true':'false';if(this.embedPlayer.kentryid){eventSet['entryId']=this.embedPlayer.kentryid;}else{eventSet['entryId']=this.embedPlayer.getSrc();}if(this.histroyEvent[eventSet['entryId']]==null){this.histroyEvent[eventSet['entryId']]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];}if(this.histroyEventCount[eventSet['entryId']]==null){this.histroyEventCount[eventSet['entryId']]=0;}this.histroyEvent[eventSet['entryId']][eventKeyId-1]=1;this.histroyEventCount[eventSet['entryId']]++;mw.KAnalytics.totalEventCount++;eventSet['historyEvents']=this.histroyEvent[eventSet['entryId']].join('')+'-'+this.histroyEventCount[eventSet['entryId']]+'-'+mw.KAnalytics.totalEventCount;if(this.embedPlayer.kuiconfid){eventSet['uiconfId']=this.embedPlayer.kuiconfid;}if(this.embedPlayer.kwidgetid){eventSet['widgetId']=this.embedPlayer.kwidgetid;}var flashVarEvents={'playbackContext':'contextId','originFeature':'featureType','applicationName':'applicationId','userId':'userId'}
for(var fvKey in flashVarEvents){if(this.embedPlayer.getKalturaConfig('',fvKey)){eventSet[flashVarEvents[fvKey]]=encodeURIComponent(this.embedPlayer.getKalturaConfig('',fvKey));}}for(var fvKey in flashVarEvents){if(this.embedPlayer.getKalturaConfig('statistics',fvKey)){eventSet[flashVarEvents[fvKey]]=encodeURIComponent(this.embedPlayer.getKalturaConfig('statistics',fvKey));}}if(this.embedPlayer.getKalturaConfig('statistics','hideUserId')&&eventSet.userId){delete(eventSet.userId);}var pageReferrer=mw.getConfig('EmbedPlayer.IsFriendlyIframe')?mw.getConfig('EmbedPlayer.IframeParentUrl'):document.referrer;eventSet['referrer']=encodeURIComponent(pageReferrer);var eventRequest={'service':'stats','action':'collect'};for(var i in eventSet){eventRequest['event:'+i]=eventSet[i];}eventRequest['hasKanalony']=false;if(this.embedPlayer.plugins&&this.embedPlayer.plugins.kAnalony){eventRequest['hasKanalony']=true;}$(this.embedPlayer).trigger('KalturaSendAnalyticEvent',[KalturaStatsEventKey,eventSet]);var parentTrackName=this.embedPlayer.getKalturaConfig('statistics','trackEventMonitor');if(mw.getConfig('EmbedPlayer.IsFriendlyIframe')){try{if(window.parent[parentTrackName]){window.parent[parentTrackName](KalturaStatsEventKey,eventSet);}}catch(e){}}if(this.embedPlayer.getFlashvars('ks')&&!this.embedPlayer.getKalturaConfig('statistics','hideKs')){eventRequest['ks']=this.embedPlayer.getFlashvars('ks');}if(this.delay){setTimeout(function(){_this.kClient.doRequest(eventRequest,null,true);},this.delay);}else{this.kClient.doRequest(eventRequest,null,true);}},bindPlayerEvents:function(){var embedPlayer=this.embedPlayer;var _this=this;var b=function(hookName,eventType){$(_this.embedPlayer).bind(hookName+_this.bindPostFix,function(){_this.sendAnalyticsEvent(eventType);});};b('widgetLoaded','WIDGET_LOADED');b('KalturaSupport_EntryDataReady','MEDIA_LOADED');b('firstPlay','PLAY');b('showShareEvent','OPEN_VIRAL');b('downloadMedia','OPEN_DOWNLOAD');b('bufferStartEvent','BUFFER_START');b('bufferEndEvent','BUFFER_END');b('onOpenFullScreen','OPEN_FULL_SCREEN');b('onCloseFullScreen','CLOSE_FULL_SCREEN');b('replayEvent','REPLAY');$(embedPlayer).bind('seeked'+this.bindPostFix,function(seekTarget){if(_this.lastSeekEventTime==0||_this.lastSeekEventTime+2000<new Date().getTime()){_this.sendAnalyticsEvent('SEEK');}_this.lastSeekEventTime=new Date().getTime();this.hasSeeked=true;this.lastSeek=seekTarget;});$(embedPlayer).bind('monitorEvent'+this.bindPostFix,function(){_this.updateTimeStats();});},updateTimeStats:function(){var embedPlayer=this.embedPlayer;var _this=this;var percent=embedPlayer.currentTime/embedPlayer.duration;var seekPercent=this.lastSeek/embedPlayer.duration;if(!embedPlayer.isLive()){if(!_this._p25Once&&percent>=.25&&seekPercent<=.25){_this._p25Once=true;_this.sendAnalyticsEvent('PLAY_REACHED_25');$(embedPlayer).trigger("firstQuartile");}else if(!_this._p50Once&&percent>=.50&&seekPercent<.50){_this._p50Once=true;_this.sendAnalyticsEvent('PLAY_REACHED_50');$(embedPlayer).trigger("secondQuartile");}else if(!_this._p75Once&&percent>=.75&&seekPercent<.75){_this._p75Once=true;_this.sendAnalyticsEvent('PLAY_REACHED_75');$(embedPlayer).trigger("thirdQuartile");}else if(!_this._p100Once&&percent>=.98&&seekPercent<1){_this._p100Once=true;_this.sendAnalyticsEvent('PLAY_REACHED_100');}}}};})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mw.KBaseComponent",function($){(function(mw,$){"use strict";mw.KBaseComponent=mw.KBasePlugin.extend({getBaseConfig:function(){return{'visible':true,'disableable':true,'showTooltip':false,'accessibilityLabels':true,'hideWhenEmpty':false};},setDefaults:function(){if($.isPlainObject(this.defaultConfig)){var obj=$.extend({},this.getBaseConfig(),this.defaultConfig);this._super(obj);}else{this._super(this.getBaseConfig());}},init:function(embedPlayer,callback,pluginName){if(this._super(embedPlayer,callback,pluginName)===false){return;}if(!this.componentType){this.componentType=pluginName;}this._addBindings();if(this.getConfig('hideWhenEmpty')==true){this.setConfig('visible',false)}},_addBindings:function(){var _this=this;if($.isFunction(this.getComponent)){this.addComponent();}if($.isFunction(this.onEnable)){this.bindEnableComponent();}if($.isFunction(this.onDisable)){this.bindDisableComponent();}if($.isFunction(this.getMenu)){this.bindFocusOutPlayer();}this.bind('layoutBuildDone',function(){if(!_this.getConfig('visible')){_this.hide();}});this.bindShowComponent();this.bindHideComponent();},addComponent:function(){var _this=this;this.bind('addLayoutComponent',function(e,layoutBuilder){layoutBuilder.components[_this.pluginName]={'parent':_this.getConfig('parent'),'order':_this.getConfig('order'),'insertMode':_this.getConfig('insertMode'),'o':function(){_this.enableTooltip();return _this.getComponent().attr({'data-order':_this.getConfig('order'),'data-plugin-name':_this.pluginName});}};});},onEnable:function(){this.isDisabled=false;this.getComponent().removeClass('disabled');},onDisable:function(){this.isDisabled=true;this.getComponent().addClass('disabled');},bindShowComponent:function(){var _this=this;this.bind('onShowInterfaceComponents',function(event,includedComponents){if($.inArray(_this.componentType,includedComponents)!=-1){_this.show();}});},bindHideComponent:function(){var _this=this;this.bind('onHideInterfaceComponents',function(event,includedComponents){if($.inArray(_this.componentType,includedComponents)!=-1){_this.hide();}});},bindEnableComponent:function(){var _this=this;this.bind('onEnableInterfaceComponents',function(event,excludedComponents){if($.inArray(_this.componentType,excludedComponents)==-1&&_this.getConfig('disableable')){_this.onEnable();}});},bindDisableComponent:function(){var _this=this;this.bind('onDisableInterfaceComponents',function(event,excludedComponents){if($.inArray(_this.componentType,excludedComponents)==-1&&_this.getConfig('disableable')){_this.onDisable();}});},bindFocusOutPlayer:function(){var _this=this;this.bind('onFocusOutOfIframe',function(){_this.getMenu().close();});},onConfigChange:function(property,value){switch(property){case'visible':if(value){this.show();}else{this.hide();}break;}},show:function(){this.getComponent().removeData('forceHide').show();},hide:function(){this.getComponent().data('forceHide',true).hide();},getCssClass:function(){var cssClass=' comp '+this.pluginName+' ';switch(this.getConfig('align')){case'right':cssClass+=" pull-right";break;case'left':cssClass+=" pull-left";break;}if(this.getConfig('cssClass')){cssClass+=' '+this.getConfig('cssClass');}if(this.getConfig('displayImportance')){var importance=this.getConfig('displayImportance').toLowerCase();if($.inArray(importance,['low','medium','high'])!==-1){cssClass+=' display-'+importance;}}return cssClass;},getBtn:function(){return this.getComponent();},enableTooltip:function(){if(this.getConfig('showTooltip')&&this.getBtn().length){var parentContainer=this.getConfig('parent');this.getBtn().each(function(){$(this).attr('data-show-tooltip',true);if(parentContainer=="topBarContainer"){$(this).addClass('tooltipBelow');}});}else{this.getBtn().each(function(){$(this).removeAttr("title");});}},updateTooltip:function(text){if(this.getConfig('showTooltip')&&this.getBtn().length){var tooltipId=this.getBtn().attr("aria-describedby");if(tooltipId){$('#'+tooltipId+' .ui-tooltip-content').html(text);}this.getBtn().data('ui-tooltip-title',text);this.getBtn().attr('title',text);}},setAccessibility:function(btn,label){if(this.getConfig('accessibilityLabels')){btn.attr('aria-label',label);}},destroy:function(){this._super();this.getComponent().remove();},getComponent:function(){mw.log("Error - you must implement getComponent in your plugin:"+this.componentType)
return $('<div></div>');}});})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mw.KBasePlugin",function($){(function(mw,$){"use strict";mw.KBasePlugin=Class.extend({asyncInit:false,init:function(embedPlayer,callback,pluginName){this.embedPlayer=embedPlayer;this.initCompleteCallback=callback;this.pluginName=pluginName;this.safe=true;this.bindPostFix='.'+pluginName;this.setDefaults();var safeEnviornment=this.isSafeEnviornment();var _this=this;if(typeof safeEnviornment=='object'&&safeEnviornment.promise){safeEnviornment.done(function(isSafe){if(!isSafe){_this.safe=false;_this.destroy();}});}else if(typeof safeEnviornment=='boolean'&&!safeEnviornment){this.safe=false;this.initCompleteCallback();return false;}this.bindConfigChangeEvent();this.setup();if(this.asyncInit===false){this.initCompleteCallback();}return this;},setDefaults:function(obj){obj=obj||this.defaultConfig;var _this=this;if($.isPlainObject(obj)){$.each(obj,function(key,value){if(_this.getConfig(key)===undefined){_this.setConfig(key,value,true);}});}},isSafeEnviornment:function(){return true;},setup:function(){},getPlayer:function(){return this.embedPlayer;},getConfig:function(attr,raw){if(raw){return this.embedPlayer.getRawKalturaConfig(this.pluginName,attr);}return this.embedPlayer.getKalturaConfig(this.pluginName,attr);},setConfig:function(attr,value,quiet){this.embedPlayer.setKalturaConfig(this.pluginName,attr,value,quiet);},getTemplateHTML:function(data){var _this=this;data=data||{};data.self=this;data.player=this.embedPlayer;data.entry=this.embedPlayer.kalturaPlayerMetaData;data.entryMetadata=this.embedPlayer.kalturaEntryMetaData;data.formaters=mw.util.formaters().getAll();var defer=$.Deferred();var parseTemplate=function(rawHTML){var transformedHTML=mw.util.tmpl(rawHTML);transformedHTML=transformedHTML(data);var evaluatedHTML=$.trim(_this.embedPlayer.evaluate(transformedHTML));var $templateHtml=$('<span class="tmpl">'+evaluatedHTML+'</span>');$templateHtml.find('[data-click],[data-notification]').click(function(e){var data=$(this).data();return _this.handleClick(e,data);});$templateHtml.find('[data-submit]').submit(function(e){var cb=$(this).data('submit');if($.isFunction(_this[cb])){_this[cb](e);}return false;});defer.resolve($templateHtml);}
var rawHTML=this.getConfig('template',true);if(!rawHTML){var templatePath=this.getConfig('templatePath');if(!window.kalturaIframePackageData.templates[templatePath]){this.log('getTemplateHTML:: Template not found in payload - trying async loading');if(templatePath&&templatePath.indexOf("http")===0){$.ajax({url:templatePath}).done(function(data){window.kalturaIframePackageData.templates[templatePath]=rawHTML=data;parseTemplate(rawHTML);}).fail(function(data){defer.reject("mw.KBasePlugin::Error occur when trying to load external template from: "+templatePath);});}else{defer.reject("mw.KBasePlugin::Could not load external template: "+templatePath+". Must be a full url starting with http.");}}else{rawHTML=window.kalturaIframePackageData.templates[templatePath];parseTemplate(rawHTML);}}else{parseTemplate(rawHTML);}return defer;},getTemplatePartialHTML:function(partialName,settings){var rawHTML=this.getConfig('template',true);if(!rawHTML){if(!partialName||!window.kalturaIframePackageData.templates[partialName]){this.log('getTemplateHTML:: Template not found');return'';}rawHTML=window.kalturaIframePackageData.templates[partialName];}var transformedHTML=mw.util.tmpl(rawHTML,settings);return transformedHTML;},handleClick:function(e,data){e.preventDefault();if(data.click&&$.isFunction(this[data.click])){this[data.click](e,data);}if(data.notification){this.getPlayer().sendNotification(data.notification,data);}return false;},once:function(eventName,callback){return this.bind(eventName,callback,true);},bind:function(eventName,callback,once){var bindEventsString='',events=eventName.split(" "),totalEvents=events.length,i=0,space=' ';for(i;i<totalEvents;i++){if(i==(totalEvents-1)){space='';}bindEventsString+=events[i]+this.bindPostFix+space;}if(once){return this.embedPlayer.bindOnceHelper(bindEventsString,callback);}return this.embedPlayer.bindHelper(bindEventsString,callback);},unbind:function(eventName){var fullEventName=eventName+this.bindPostFix;if(eventName===null||eventName===undefined){fullEventName=this.bindPostFix;}return this.embedPlayer.unbindHelper(fullEventName);},log:function(msg){mw.log(this.pluginName+'::'+msg);},bindConfigChangeEvent:function(){var _this=this;if(typeof this.onConfigChange!=='function'){return;}this.bind('Kaltura_ConfigChanged',function(event,pluginName,property,value){if(pluginName===_this.pluginName){_this.onConfigChange(property,value);}});},getKalturaClient:function(){if(!this.kClient){this.kClient=mw.kApiGetPartnerClient(this.embedPlayer.kwidgetid);}return this.kClient;},destroy:function(){this.unbind();}});})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mw.KBaseSmartContainer",function($){(function(mw,$){"use strict";mw.KBaseSmartContainer=mw.KBaseComponent.extend({title:"settings",closingEvents:'onplay',registeredPlugins:[],shouldResumePlay:false,pluginsScreenOpened:false,overlayOpen:false,isDisabled:false,setup:function(embedPlayer){this.addBindings();},isSafeEnviornment:function(){return this.embedPlayer.isMobileSkin()&&mw.getConfig("EmbedPlayer.UseSmartContainers")!==false;},getComponent:function(){var _this=this;if(!this.$el){this.$el=$('<button />').attr('title',this.title).addClass("btn"+this.getCssClass()).on('click',function(e){if(_this.isDisabled){return;}if(!_this.pluginsScreenOpened&&!_this.overlayOpen){_this.showRegisteredPlugins();}else{_this.hideRegisteredPlugins();}});}return this.$el;},addBindings:function(){var _this=this;this.bind('pluginsReady',function(e,plugins){for(var plugin in plugins){if(plugins[plugin].getConfig("smartContainer")&&plugins[plugin].getConfig("smartContainer")===_this.pluginName&&plugins[plugin].safe){_this.registeredPlugins.push(plugins[plugin]);if(plugins[plugin].getConfig("smartContainerCloseEvent")){var closeEvent=plugins[plugin].getConfig("smartContainerCloseEvent");if(_this.closingEvents.indexOf(closeEvent)===-1){_this.closingEvents+=" "+closeEvent;}}}}if(_this.registeredPlugins.length>1){if(!_this.embedPlayer.getVideoHolder().find(".smartContainer").length){_this.embedPlayer.getVideoHolder().append("<div class='smartContainer'></div>");}for(var i=0;i<_this.registeredPlugins.length;i++){_this.registeredPlugins[i].setConfig("parent","smartContainer");_this.registeredPlugins[i].setConfig("align","center");}_this.bind(_this.closingEvents,function(){if(_this.pluginsScreenOpened){_this.hideRegisteredPlugins();_this.checkResumePlayback();}});_this.bind("preShowScreen displayMenuOverlay",function(){if(_this.pluginsScreenOpened){_this.hideRegisteredPlugins();}});_this.bind("displayMenuOverlay",function(){_this.overlayOpen=true;});_this.bind("closeMenuOverlay",function(){_this.overlayOpen=false;});_this.bind("onShowInterfaceComponents",function(){setTimeout(function(){_this.hideRegisteredPlugins();},0);});setTimeout(function(){_this.hideRegisteredPlugins();},0);}else{_this.hide();}});this.bind('playerReady',function(){if(_this.registeredPlugins.length<2){_this.hide();}});},hideRegisteredPlugins:function(){this.pluginsScreenOpened=false;this.embedPlayer.getInterface().removeClass("pluginsScreenOpened");$(this.embedPlayer.getPlayerElement()).removeClass("blur");this.embedPlayer.getVideoHolder().find(".closePluginsScreen").remove();for(var i=0;i<this.registeredPlugins.length;i++){this.registeredPlugins[i].hide();}this.embedPlayer.getControlBarContainer().show();this.embedPlayer.triggerHelper("hideMobileComponents");this.embedPlayer.triggerHelper("updateComponentsVisibilityDone");},showRegisteredPlugins:function(){var _this=this;for(var i=this.registeredPlugins.length-1;i>=0;i--){if(!this.registeredPlugins[i].safe){this.registeredPlugins.splice(i,1);}}this.pluginsScreenOpened=true;var $sc=this.embedPlayer.getVideoHolder().find(".smartContainer");$sc.children().hide();this.embedPlayer.getInterface().addClass("pluginsScreenOpened");$(this.embedPlayer.getPlayerElement()).addClass("blur");var numPlugins=this.registeredPlugins.length;var pluginWidth=33;if(numPlugins===4||numPlugins===2){pluginWidth=50;}var pluginHeight=this.embedPlayer.getVideoHolder().width()/(numPlugins+1);$sc.find(".comp").not(".closePluginsScreen, .icon-next, .icon-prev, .largePlayBtn").width(pluginWidth+"%").height(pluginHeight);$sc.removeClass("comp1 comp2 comp3 comp4 comp5 comp6").addClass("comp"+this.registeredPlugins.length);for(var i=0;i<this.registeredPlugins.length;i++){var plugin=this.registeredPlugins[i].getComponent();if(!plugin.find(".btnLabel").length){var pluginBtn=plugin.find(".btn");if(pluginBtn.length===0&&plugin.hasClass("btn")){pluginBtn=plugin;}pluginBtn.removeClass("pull-right");pluginBtn.append("<p class='btnLabel'>"+this.registeredPlugins[i].getConfig('title')+"</p>");pluginBtn.find(".accessibilityLabel").remove();}plugin.fadeIn(400,function(){$(this).css("display","inline-block");});}this.shouldResumePlay=!this.embedPlayer.paused;this.embedPlayer.ignoreNextNativeEvent=true;this.embedPlayer.pause();this.embedPlayer.getControlBarContainer().fadeOut();this.embedPlayer.triggerHelper("showMobileComponents");var closeBtn=$("<button class='btn icon-close closePluginsScreen'></button>").on('click',function(e){if(_this.pluginsScreenOpened){_this.hideRegisteredPlugins();_this.checkResumePlayback();}});_this.embedPlayer.getVideoHolder().append(closeBtn);},checkResumePlayback:function(){if(this.shouldResumePlay){this.shouldResumePlay=false;this.embedPlayer.play();}else{this.embedPlayer.triggerHelper("showLargePlayBtn");}}});})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mw.KCuePoints",function($){(function(mw,$){"use strict";mw.KCuePoints=function(embedPlayer){return this.init(embedPlayer);};mw.KCuePoints.TYPE={AD:"adCuePoint.Ad",ANNOTATION:"annotation.Annotation",CODE:"codeCuePoint.Code",EVENT:"eventCuePoint.Event",THUMB:"thumbCuePoint.Thumb",QUIZ_QUESTION:"quiz.QUIZ_QUESTION"};mw.KCuePoints.THUMB_SUB_TYPE={SLIDE:1,CHAPTER:2};mw.KCuePoints.prototype={bindPostfix:'.kCuePoints',midCuePointsArray:[],codeCuePointsArray:[],liveCuePointsIntervalId:null,supportedCuePoints:[mw.KCuePoints.TYPE.CODE,mw.KCuePoints.TYPE.THUMB,mw.KCuePoints.TYPE.QUIZ_QUESTION],init:function(embedPlayer){var _this=this;this.destroy();this.embedPlayer=embedPlayer;embedPlayer.bindHelper('KalturaSupport_CuePointsReady'+this.bindPostfix,function(){_this.initSupportedCuepointTypes();_this.processCuePoints();_this.addPlayerBindings();if(_this.embedPlayer.isLive()&&mw.getConfig("EmbedPlayer.LiveCuepoints")){_this.setLiveCuepointsWatchDog();}});},destroy:function(){if(this.liveCuePointsIntervalId){clearInterval(this.liveCuePointsIntervalId);this.liveCuePointsIntervalId=null;}$(this.embedPlayer).unbind(this.bindPostfix);},processCuePoints:function(){var _this=this;var cuePoints=this.getCuePoints();this.requestThumbAsset(cuePoints,function(){_this.embedPlayer.triggerHelper('KalturaSupport_ThumbCuePointsReady');});var newCuePointsArray=[];var newCodeCuePointsArray=[];$.each(cuePoints,function(idx,cuePoint){if((_this.getVideoAdType(cuePoint)=='pre'||_this.getVideoAdType(cuePoint)=='post')&&cuePoint.cuePointType=='adCuePoint.Ad'){_this.triggerCuePoint(cuePoint);}else{if(cuePoint.cuePointType==='codeCuePoint.Code'){newCodeCuePointsArray.push(cuePoint);}else if(cuePoint.cuePointType!="eventCuePoint.Event"){newCuePointsArray.push(cuePoint);}}});this.midCuePointsArray=newCuePointsArray;this.codeCuePointsArray=newCodeCuePointsArray;},initSupportedCuepointTypes:function(){var supportedCuePoints=mw.getConfig("EmbedPlayer.SupportedCuepointTypes",this.supportedCuePoints);if($.type(supportedCuePoints)==="string"){supportedCuePoints=supportedCuePoints.split(",")}mw.setConfig("EmbedPlayer.SupportedCuepointTypes",supportedCuePoints);},requestThumbAsset:function(cuePoints,callback){var _this=this;var requestArray=[];var responseArray=[];var requestCuePoints=cuePoints||this.getCuePoints();var thumbCuePoint=$.grep(requestCuePoints,function(cuePoint){return(cuePoint.cuePointType=='thumbCuePoint.Thumb');});var loadThumbnailWithReferrer=this.embedPlayer.getFlashvars('loadThumbnailWithReferrer');var referrer=window.kWidgetSupport.getHostPageUrl();$.each(thumbCuePoint,function(index,item){if(typeof item.assetId!=='undefined'){requestArray.push({'service':'thumbAsset','action':'getUrl','id':item.assetId});responseArray.push(item);}});if(requestArray.length){this.getKalturaClient().doRequest(requestArray,function(data){if(requestArray.length===1){data=[data];}$.each(data,function(index,thumbnailUrl){if(_this.isValidResult(thumbnailUrl)){var resItem=responseArray[index];if(resItem){resItem.thumbnailUrl=thumbnailUrl;if(loadThumbnailWithReferrer){resItem.thumbnailUrl+='?options:referrer='+referrer;}}}});if(callback){callback();}});}else{if(callback){callback();}}},fixLiveCuePointArray:function(arr){$.each(arr,function(index,cuePoint){cuePoint.startTime=cuePoint.createdAt*1000;});arr.sort(function(a,b){return a.createdAt-b.createdAt;});},setLiveCuepointsWatchDog:function(){var _this=this;var cuePoints=this.getCuePoints();this.fixLiveCuePointArray(this.midCuePointsArray);this.fixLiveCuePointArray(this.codeCuePointsArray);this.fixLiveCuePointArray(cuePoints);this.associativeCuePoints={};$.each(cuePoints,function(index,cuePoint){_this.associativeCuePoints[cuePoint.id]=cuePoint;});var liveCuepointsRequestInterval=mw.getConfig("EmbedPlayer.LiveCuepointsRequestInterval",10000);mw.log("mw.KCuePoints::start live cue points watchdog, polling rate: "+liveCuepointsRequestInterval+"ms");this.liveCuePointsIntervalId=setInterval(function(){_this.requestLiveCuepoints();},liveCuepointsRequestInterval);this.embedPlayer.bindHelper("liveOffline",function(){if(_this.liveCuePointsIntervalId){mw.log("mw.KCuePoints::lifeOffline event received, stop live cue points watchdog");clearInterval(_this.liveCuePointsIntervalId);_this.liveCuePointsIntervalId=null;}});this.embedPlayer.bindHelper("liveOnline",function(){if(!_this.liveCuePointsIntervalId){mw.log("mw.KCuePoints::liveOnline event received, start live cue points watchdog");_this.requestLiveCuepoints();_this.liveCuePointsIntervalId=setInterval(function(){_this.requestLiveCuepoints();},liveCuepointsRequestInterval);}});},requestLiveCuepoints:function(){var _this=this;var entryId=_this.embedPlayer.kentryid;var request={'service':'cuepoint_cuepoint','action':'list','filter:entryIdEqual':entryId,'filter:objectType':'KalturaCuePointFilter','filter:statusIn':'1,3','filter:cuePointTypeIn':'thumbCuePoint.Thumb,codeCuePoint.Code','filter:orderBy':"+createdAt"};var lastCreationTime=_this.getLastCreationTime()+1;if(lastCreationTime>0){request['filter:createdAtGreaterThanOrEqual']=lastCreationTime;}this.getKalturaClient().doRequest(request,function(data){if(!data||data.code){mw.log("Error:: KCuePoints could not retrieve live cuepoints");return;}_this.fixLiveCuePointArray(data.objects);_this.updateCuePoints(data.objects);_this.embedPlayer.triggerHelper('KalturaSupport_CuePointsUpdated',[data.totalCount]);});},updateCuePoints:function(rawCuePoints){if(rawCuePoints.length>0){var _this=this;var thumbNewCuePoints=[];var codeNewCuePoints=[];var playerNewCuePoints=[];$.each(rawCuePoints,function(id,rawCuePoint){if(!_this.associativeCuePoints[rawCuePoint.id]){_this.associativeCuePoints[rawCuePoint.id]=rawCuePoint;playerNewCuePoints.push(rawCuePoint);if(rawCuePoint.cuePointType==='codeCuePoint.Code'){codeNewCuePoints.push(rawCuePoint);}else{thumbNewCuePoints.push(rawCuePoint);}}});if(playerNewCuePoints.length>0){var playerCuePoints=this.getCuePoints();$.merge(playerCuePoints,playerNewCuePoints);}if(thumbNewCuePoints.length>0){$.merge(this.midCuePointsArray,thumbNewCuePoints);this.requestThumbAsset(thumbNewCuePoints,function(){_this.embedPlayer.triggerHelper('KalturaSupport_ThumbCuePointsUpdated',[thumbNewCuePoints]);});}if(codeNewCuePoints.length>0){$.merge(this.codeCuePointsArray,codeNewCuePoints);}}},getLastUpdateTime:function(){var cuePoints=this.getCuePoints();var lastUpdateTime=-1;$.each(cuePoints,function(key,cuePoint){if(lastUpdateTime<cuePoint.updatedAt){lastUpdateTime=cuePoint.updatedAt;}});return lastUpdateTime;},getLastCreationTime:function(){var cuePoints=this.getCuePoints();var lastCreationTime=-1;$.each(cuePoints,function(key,cuePoint){if(lastCreationTime<cuePoint.createdAt){lastCreationTime=cuePoint.createdAt;}});return lastCreationTime;},getKalturaClient:function(){if(!this.kClient){this.kClient=mw.kApiGetPartnerClient(this.embedPlayer.kwidgetid);}return this.kClient;},isValidResult:function(data){if(!data){mw.log("mw.KCuePoints :: error retrieving data");return false;}else if(data.code&&data.message){mw.log("mw.KCuePoints :: error code: "+data.code+", error message: "+data.message);return false;}return true;},addPlayerBindings:function(){var _this=this;var currentCuePoint=this.getNextCuePoint(0);var embedPlayer=this.embedPlayer;if(!((embedPlayer.isLive()&&mw.getConfig("EmbedPlayer.LiveCuepoints"))||currentCuePoint)){return;}$(embedPlayer).bind('onChangeMedia'+this.bindPostfix,function(){_this.destroy();});$(embedPlayer).bind("monitorEvent"+this.bindPostfix+" seeked"+this.bindPostfix+" onplay"+this.bindPostfix+" KalturaSupport_ThumbCuePointsUpdated"+this.bindPostfix,function(e){var currentTime=embedPlayer.getPlayerElementTime()*1000;if(e.type=="seeked"){currentCuePoint=_this.getPreviousCuePoint(currentTime);}if(currentCuePoint&&currentTime>currentCuePoint.startTime&&embedPlayer._propagateEvents){var cuePointToBeTriggered=$.extend({},currentCuePoint);_this.triggerCuePoint(cuePointToBeTriggered);}currentCuePoint=_this.getNextCuePoint(currentTime);});},getEndTime:function(){return this.embedPlayer.evaluate('{mediaProxy.entry.msDuration}');},getCuePoints:function(){if(!this.embedPlayer.rawCuePoints||!this.embedPlayer.rawCuePoints.length){this.embedPlayer.rawCuePoints=[];}return this.embedPlayer.rawCuePoints;},getCodeCuePoints:function(){return this.codeCuePointsArray||[];},getCuePointsByType:function(type,subType){var filteredCuePoints=this.getCuePoints();if(filteredCuePoints&&(type||subType)){var _this=this;filteredCuePoints=$.grep(filteredCuePoints,function(cuePoint){var foundCuePointType=_this.validateCuePointAttribute(cuePoint,"cuePointType",type);var foundCuePointSubType=_this.validateCuePointAttribute(cuePoint,"subType",subType);return foundCuePointType&&foundCuePointSubType;});}return filteredCuePoints;},validateCuePointAttribute:function(cuePoint,attrName,attrValues){var foundAttr=false;if(attrName&&attrValues){if(!$.isArray(attrValues)){attrValues=[attrValues];}$.each(attrValues,function(i,attrValue){if(attrValue==cuePoint[attrName]){foundAttr=true;return false;}});}else{foundAttr=true;}return foundAttr;},getNextCuePoint:function(time){if(!isNaN(time)&&time>=0){var cuePoints=this.midCuePointsArray;for(var i=0;i<cuePoints.length;i++){if(cuePoints[i].startTime>=time){return cuePoints[i];}}}return false;},getPreviousCuePoint:function(time){if(!isNaN(time)&&time>=0){var cuePoints=this.midCuePointsArray;for(var i=0;i<cuePoints.length;i++){if(cuePoints[i].startTime>=time){var index=(i-1>0)?(i-1):0;return cuePoints[index];}}}return cuePoints[cuePoints.length-1];},triggerCuePoint:function(rawCuePoint){var eventName;rawCuePoint.sourceUrl=this.embedPlayer.evaluate(rawCuePoint.sourceUrl);var cuePointWrapper={'cuePoint':rawCuePoint};if(rawCuePoint.cuePointType=='adCuePoint.Ad'){eventName='KalturaSupport_AdOpportunity';cuePointWrapper.context=this.getVideoAdType(rawCuePoint);}else if($.inArray(rawCuePoint.cuePointType,mw.getConfig("EmbedPlayer.SupportedCuepointTypes"))!==-1){eventName='KalturaSupport_CuePointReached';}else{return;}mw.log('mw.KCuePoints :: Trigger event: '+eventName+' - '+rawCuePoint.cuePointType+' at: '+rawCuePoint.startTime);$(this.embedPlayer).trigger(eventName,cuePointWrapper);},getVideoAdType:function(rawCuePoint){if(rawCuePoint.startTime===0){return'pre';}else if(rawCuePoint.startTime==this.getEndTime()){return'post';}else{return'mid';}mw.log("Error:: KCuePoints could not determine adType");},getAdSlotType:function(cuePointWrapper){if(cuePointWrapper.cuePoint.adType==1){return this.getVideoAdType(cuePointWrapper.cuePoint)+'roll';}else{return'overlay';}},getRawAdSlotType:function(rawCuePoint){if(rawCuePoint.adType==1){return this.getVideoAdType(rawCuePoint)+'roll';}else{return'overlay';}},getCuePointsCount:function(filter){var _this=this;var cuePoints=this.getCuePoints();if(!cuePoints)return 0;if(!filter)return cuePoints.length;var totalResults={'preroll':0,'midroll':0,'postroll':0,'overlay':0};$.each(cuePoints,function(idx,rawCuePoint){totalResults[_this.getRawAdSlotType(rawCuePoint)]++;});if(filter&&totalResults[filter]){return totalResults[filter];}return 0;}};})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mw.KDPMapping",function($){(function(mw,$){"use strict";mw.KDPMapping=function(embedPlayer){return this.init(embedPlayer);};mw.KDPMapping.prototype={listenerList:{},init:function(embedPlayer){var _this=this;this.registerDefaultFormaters();var kdpApiMethods=['addJsListener','removeJsListener','sendNotification','setKDPAttribute','evaluate'];var parentProxyDiv=null;if(mw.getConfig('EmbedPlayer.IsFriendlyIframe')){try{parentProxyDiv=window['parent'].document.getElementById(embedPlayer.id);}catch(e){}}$.each(kdpApiMethods,function(inx,methodName){embedPlayer[methodName]=function(){var args=$.makeArray(arguments);args.splice(0,0,embedPlayer);return _this[methodName].apply(_this,args);}
if(parentProxyDiv){parentProxyDiv[methodName]=function(){var args=arguments;var ret=[];if(args!=null){var i=args.length;if(i==null||typeof args==="string"||jQuery.isFunction(args)||args.setInterval)ret[0]=args;else while(i)ret[--i]=args[i];}ret.splice(0,0,embedPlayer);return _this[methodName].apply(_this,ret);}}});var runCallbackOnParent=false;if(mw.getConfig('EmbedPlayer.IsFriendlyIframe')){try{if(window['parent']&&window['parent']['kWidget']&&parentProxyDiv){runCallbackOnParent=true;window['parent']['kWidget'].jsCallbackReady(embedPlayer.id);}}catch(e){runCallbackOnParent=false;}}if(!runCallbackOnParent){window.kWidget.jsCallbackReady(embedPlayer.id);}},registerDefaultFormaters:function(){mw.util.formaters().register({timeFormat:function(value){return mw.seconds2npt(parseFloat(value));},dateFormat:function(value){var date=new Date(value*1000);return date.toDateString();},numberWithCommas:function(value){return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");}});},setKDPAttribute:function(embedPlayer,componentName,property,value){mw.log("KDPMapping::setKDPAttribute "+componentName+" p:"+property+" v:"+value+' for: '+embedPlayer.id);var pluginNameToSet=componentName;var propertyNameToSet=property;var valueToSet=value;switch(property){case'autoPlay':embedPlayer.autoplay=value;break;case'disableAlerts':mw.setConfig('EmbedPlayer.ShowPlayerAlerts',!value);break;default:if(componentName.indexOf('.')!=-1){var cparts=componentName.split('.');pluginNameToSet=cparts[0];propertyNameToSet=cparts[1];valueToSet={};valueToSet[property]=value;}embedPlayer.setKalturaConfig(pluginNameToSet,propertyNameToSet,valueToSet);break;}if(pluginNameToSet=='servicesProxy'&&propertyNameToSet&&propertyNameToSet=='kalturaClient'&&property=='ks'){this.updateKS(embedPlayer,value);}$(embedPlayer).trigger('Kaltura_SetKDPAttribute',[componentName,property,value]);},updateKS:function(embedPlayer,ks){var client=mw.kApiGetPartnerClient(embedPlayer.kwidgetid);client.setKs(ks);embedPlayer.setFlashvars('ks',ks);embedPlayer.sendNotification('changeMedia',{'entryId':embedPlayer.kentryid});},evaluate:function(embedPlayer,objectString,limit){var _this=this;var result;var isCurlyBracketsExpresion=function(str){if(typeof str=='string'){return(str.charAt(0)=='{'&&str.charAt(str.length-1)=='}');}return false;};limit=limit||0;if(limit>4){mw.log('KDPMapping::evaluate: recursive calls are limited to 5');return objectString;}if(typeof objectString!=='string'){return objectString;}if(isCurlyBracketsExpresion(objectString)&&objectString.split('{').length==2){result=_this.evaluateExpression(embedPlayer,objectString.substring(1,objectString.length-1));}else if(objectString.split('{').length>1){result=objectString.replace(/\{([^\}]*)\}/g,function(match,contents,offset,s){return _this.evaluateExpression(embedPlayer,contents);});}else{result=objectString;}if(result===0){return result;}if(result==="undefined"||result==="null"||result==="")result=undefined;if(result==="false"){result=false;}if(result==="true"){result=true;}if(isCurlyBracketsExpresion(result)){result=this.evaluate(embedPlayer,result,limit++);}return result;},getEvaluateExpression:function(embedPlayer,expression){var _this=this;if(expression.indexOf('(')!==-1){var fparts=expression.split('(');return _this.evaluateStringFunction(fparts[0],_this.getEvaluateExpression(embedPlayer,fparts[1].slice(0,-1)));}var objectPath=expression.split('.');if(embedPlayer.playerConfig&&embedPlayer.playerConfig.plugins&&embedPlayer.playerConfig.plugins[objectPath[0]]){var kObj=embedPlayer.playerConfig.plugins[objectPath[0]];if(!objectPath[1]){return kObj;}if(!objectPath[2]&&(objectPath[1]in kObj)){return kObj[objectPath[1]];}if(objectPath[2]&&kObj[objectPath[1]]&&typeof kObj[objectPath[1]][objectPath[2]]!='undefined'){return kObj[objectPath[1]][objectPath[2]];}}var getReffererURL=function(fv,objectPath){if(fv&&fv[objectPath[2]]){return fv[objectPath[2]];}return mw.getConfig('EmbedPlayer.IframeParentUrl');}
switch(objectPath[0]){case'isHTML5':return true;break;case'flashVersion':return kWidget.getFlashVersion();break;case'playerVersion':return window['MWEMBED_VERSION'];break;case'sequenceProxy':if(!embedPlayer.sequenceProxy){return null;}if(objectPath[1]){switch(objectPath[1]){case'timeRemaining':case'isInSequence':case'skipOffsetRemaining':return embedPlayer.sequenceProxy[objectPath[1]];break;case'activePluginMetadata':if(objectPath[2]){if(!embedPlayer.sequenceProxy.activePluginMetadata){return null;}return embedPlayer.sequenceProxy.activePluginMetadata[objectPath[2]]}return embedPlayer.sequenceProxy.activePluginMetadata;break;}return null;}return embedPlayer.sequenceProxy;break;case'video':switch(objectPath[1]){case'volume':return embedPlayer.volume;break;case'buffer':switch(objectPath[2]){case'lastBufferDuration':return embedPlayer.lastBufferDuration||0;break;case'lastBufferDurationMs':return(embedPlayer.lastBufferDuration)?embedPlayer.lastBufferDuration*1000:0;break;case'bufferEndTime':return embedPlayer.bufferEndTime;break;case'bufferStartTime':return embedPlayer.bufferStartTime;break;case'percent':return(embedPlayer.bufferedPercent);break;}break;case'player':switch(objectPath[2]){case'currentTime':if(embedPlayer.seeking&&embedPlayer.kPreSeekTime!==null){return embedPlayer.kPreSeekTime;}return embedPlayer.currentTime;break;case'height':return embedPlayer.getHeight();break;case'width':return embedPlayer.getWidth();break;case'position':try{var pos=$("#"+embedPlayer.id,parent.document.body).position();return pos.left+','+pos.top;}catch(e){return'0,0';}break;}break;}break;case'duration':return embedPlayer.getDuration();break;case'mediaProxy':switch(objectPath[1]){case'entryCuePoints':if(!embedPlayer.rawCuePoints){return null;}var kdpCuePointFormat={};$.each(embedPlayer.rawCuePoints,function(inx,cuePoint){var startTime=parseInt(cuePoint.startTime);if(kdpCuePointFormat[startTime]){kdpCuePointFormat[startTime].push(cuePoint)}else{kdpCuePointFormat[startTime]=[cuePoint];}});return kdpCuePointFormat;break;case'entryMetadata':if(!embedPlayer.kalturaEntryMetaData){return null;}if(objectPath[2]){return embedPlayer.kalturaEntryMetaData[objectPath[2]];}else{return embedPlayer.kalturaEntryMetaData;}break;case'entry':if(!embedPlayer.kalturaPlayerMetaData){return null;}if(objectPath[2]){return embedPlayer.kalturaPlayerMetaData[objectPath[2]];}else{return embedPlayer.kalturaPlayerMetaData;}break;case'sources':return embedPlayer.mediaElement.getSources();break;case'isLive':return embedPlayer.isLive();break;case'mediaPlayTo':var mediaPlayTo=embedPlayer.getFlashvars('mediaProxy.mediaPlayTo');return mediaPlayTo?mediaPlayTo:null;break;case'mediaPlayFrom':var mediaPlayFrom=embedPlayer.getFlashvars('mediaProxy.mediaPlayFrom');return mediaPlayFrom?mediaPlayFrom:null;break;case'isOffline':if($.isFunction(embedPlayer.isOffline)){return embedPlayer.isOffline();}return true;break;case'kalturaMediaFlavorArray':if(!embedPlayer.kalturaFlavors){return null;}return embedPlayer.kalturaFlavors;break;}break;case'configProxy':var fv=embedPlayer.getFlashvars();switch(objectPath[1]){case'flashvars':if(objectPath[2]){switch(objectPath[2]){case'autoPlay':return embedPlayer.autoplay;break;case'referer':case'referrer':return getReffererURL(fv,objectPath);break;default:if(fv&&fv[objectPath[2]]){return fv[objectPath[2]]}return null;break;}}else{return fv;}break;case'kw':var kw={'objectType':"KalturaWidget",'id':embedPlayer.kwidgetid,'partnerId':embedPlayer.kpartnerid,'uiConfId':embedPlayer.kuiconfid}
if(objectPath[2]){if(typeof kw[objectPath[2]]!='undefined'){return kw[objectPath[2]]}return null;}return kw;break;case'targetId':return embedPlayer.id;break;case'sessionId':return window.kWidgetSupport.getGUID();break;}return{'flashvars':fv,'sessionId':window.kWidgetSupport.getGUID()};break;case'playerStatusProxy':switch(objectPath[1]){case'kdpStatus':if(embedPlayer.kdpEmptyFlag){return"empty";}if(embedPlayer.playerReadyFlag){return'ready';}return null;break;}break;case'playlistAPI':switch(objectPath[1]){case'dataProvider':if(!embedPlayer.kalturaPlaylistData){return null;}var plData=embedPlayer.kalturaPlaylistData;var plId=null;if(plData['currentPlaylistId']){plId=plData['currentPlaylistId'];}else{for(var plKey in plData)break;plId=plKey;}var dataProvider={'content':plData[plId],'length':plData[plId].length,'selectedIndex':plData['selectedIndex']}
if(objectPath[2]=='selectedIndex'){return dataProvider.selectedIndex;}return dataProvider;break;}break;case'utility':switch(objectPath[1]){case'random':return Math.floor(Math.random()*1000000000);break;case'timestamp':return new Date().getTime();break;case'referrer_url':var fv=embedPlayer.getFlashvars();return getReffererURL(fv,objectPath);break;case'referrer_host':var fv=embedPlayer.getFlashvars();var referrer=getReffererURL(fv,objectPath);var getLocation=function(href){var l=document.createElement("a");l.href=href;return l;};var location=getLocation(referrer);return location.hostname;break;case'nativeAdId':if(embedPlayer){return embedPlayer.getFlashvars('nativeAdId');}else{return"";}break;case'nativeVersion':if(embedPlayer){return embedPlayer.getFlashvars('nativeVersion');}else{return"";}break;case'streamerType':if(embedPlayer){return embedPlayer.streamerType;}return"";break;}break;case'embedServices':var proxyData=embedPlayer.getKalturaConfig('proxyData');var filedName=expression.replace('embedServices.','');return this.getProperty(filedName,proxyData);break;}var pluginConfigValue=null;if(!objectPath[1]&&$.isEmptyObject(embedPlayer.getKalturaConfig(objectPath[0]))){pluginConfigValue=embedPlayer.getKalturaConfig('',objectPath[0]);}else{pluginConfigValue=embedPlayer.getKalturaConfig(objectPath[0],objectPath[1]);if($.isEmptyObject(pluginConfigValue)){return;}}return pluginConfigValue;},evaluateExpression:function(embedPlayer,expression){var formatFunc=null;if(expression.indexOf('|')!==-1){var expArr=expression.split('|');expression=expArr[0];formatFunc=expArr[1];if(mw.util.formaters().exists(formatFunc)){formatFunc=mw.util.formaters().get(formatFunc);}else{formatFunc=null;}}var evalVal=this.getEvaluateExpression(embedPlayer,expression);if(evalVal===null||typeof evalVal=='undefined'||evalVal==='undefined'){return'';}if(formatFunc){return formatFunc(evalVal);}return evalVal;},evaluateStringFunction:function(functionName,value){switch(functionName){case'encodeUrl':return encodeURI(value);break;case'conditional':value
break;}},getProperty:function(propertyName,object){var parts=propertyName.split("."),length=parts.length,i,property=object||this;for(i=0;i<length;i++){if(property===undefined)break;property=property[parts[i]];}return property;},removeJsListener:function(embedPlayer,eventName,callbackName){mw.log("KDPMapping:: removeJsListener:: "+eventName);if(typeof eventName=='string'){var eventData=eventName.split('.',2);var eventNamespace=eventData[1];if(eventNamespace&&eventName[0]==='.'){$(embedPlayer).unbind('.'+eventNamespace);}else if(!eventNamespace){eventNamespace='kdpMapping';}eventName=eventData[0];if(!callbackName){callbackName='anonymous';}else{var listenerId=this.getListenerId(embedPlayer,eventName,eventNamespace,callbackName);if(!this.listenerList[listenerId]){return;}}if(this.listenerList[listenerId]){this.listenerList[listenerId]=null;}else{for(var listenerItem in this.listenerList){if(listenerItem.indexOf(embedPlayer.id+'_'+eventName+'.'+eventNamespace)!=-1){this.listenerList[listenerItem]=null;}}}}},getListenerId:function(embedPlayer,eventName,eventNamespace,callbackName){return embedPlayer.id+'_'+eventName+'.'+eventNamespace+'_'+callbackName;},addJsListener:function(embedPlayer,eventName,callbackName){var _this=this;if(typeof eventName=='string'){var eventData=eventName.split('.',2);var eventNamespace=(eventData[1])?eventData[1]:'kdpMapping';eventName=eventData[0];}if(typeof callbackName=='string'){var listenerId=this.getListenerId(embedPlayer,eventName,eventNamespace,callbackName);this.listenerList[listenerId]=callbackName;var callback=function(){var callbackName=_this.listenerList[listenerId];var callbackToRun=kWidgetSupport.getFunctionByName(callbackName,window);if(!$.isFunction(callbackToRun)){callbackToRun=kWidgetSupport.getFunctionByName(callbackName,window['parent']);}if($.isFunction(callbackToRun)){try{callbackToRun.apply(embedPlayer,$.makeArray(arguments));}catch(e){mw.log("Error when trying to run callbackToRun (probably JavaScript error in callbackToRun code)")};}else{mw.log('kdpMapping::addJsListener: callback name: '+callbackName+' not found');}};}else if(typeof callbackName=='function'){var listenerId=this.getListenerId(embedPlayer,eventName,eventNamespace,'anonymous');_this.listenerList[listenerId]=true;var callback=function(){if(_this.listenerList[listenerId]){callbackName.apply(embedPlayer,$.makeArray(arguments));}}}else{mw.log("Error: KDPMapping : bad callback type: "+callbackName);return;}var b=function(bindName,bindCallback){if(!bindCallback){bindCallback=function(){callback(embedPlayer.id);};}bindName+='.'+eventNamespace;embedPlayer.bindHelper(bindName,function(){bindCallback.apply(embedPlayer,$.makeArray(arguments));});};switch(eventName){case'layoutReady':b('KalturaSupport_DoneWithUiConf');break;case'mediaLoadError':b('mediaLoadError');break;case'mediaError':b('mediaError');break;case'kdpEmpty':case'readyToLoad':if(embedPlayer.playerReadyFlag){if(!embedPlayer.kalturaPlayerMetaData){embedPlayer.kdpEmptyFlag=true;callback(embedPlayer.id);}}else{b('playerReady',function(){if(!embedPlayer.kalturaPlayerMetaData){embedPlayer.kdpEmptyFlag=true;setTimeout(function(){callback(embedPlayer.id);},0)}});}break;case'kdpReady':b('playerReady',function(){if(!embedPlayer.getError()){embedPlayer.kdpEmptyFlag=false;}callback(embedPlayer.id);});break;case'playerLoaded':case'playerReady':b('playerReady');break;case'changeVolume':case'volumeChanged':b('volumeChanged',function(event,percent){callback({'newVolume':percent},embedPlayer.id);});break;case'playerStateChange':b('preCheckPlayerSources',function(){callback('loading',embedPlayer.id);})
b('playerReady',function(){callback('ready',embedPlayer.id);});b('bufferStartEvent',function(){callback('buffering',embedPlayer.id);});b('onpause',function(){callback('paused',embedPlayer.id);});b('onplay',function(){callback('playing',embedPlayer.id);});break;case'doStop':case'stop':b("doStop");break;case'playerPaused':case'pause':case'doPause':b("onpause");break;case'playerPlayed':b("onplay");break;case'play':case'doPlay':b("onplay");break;case'playerSeekStart':b("seeking");break;case'seek':case'doSeek':case'doIntelligentSeek':b("seeking",function(){var seekTime=(embedPlayer.kPreSeekTime!==null)?embedPlayer.kPreSeekTime:embedPlayer.currentTime;callback(seekTime,embedPlayer.id);});break;case'playerSeekEnd':b("seeked",function(){embedPlayer.kPreSeekTime=null
callback(embedPlayer.id);});break;case'playerPlayEnd':b("postEnded");break;case'playbackComplete':b("playbackComplete");b("AdSupport_EndAdPlayback",function(e,slotType){if(slotType!='postroll'){callback();}});break;case'durationChange':b("durationchange",function(){callback({'newValue':embedPlayer.duration},embedPlayer.id);});b("durationChange",function(){callback({'newValue':embedPlayer.duration},embedPlayer.id);});break;case'openFullScreen':case'hasOpenedFullScreen':b("onOpenFullScreen");break;case'hasCloseFullScreen':case'closeFullScreen':b("onCloseFullScreen");break;case'playerUpdatePlayhead':b('monitorEvent',function(){if(embedPlayer.isPlaying()){callback(embedPlayer.currentTime);}});break;case'changeMedia':b('playerReady',function(event){callback({'entryId':embedPlayer.kentryid},embedPlayer.id);});break;case'entryReady':b('KalturaSupport_EntryDataReady',function(event,entryData){callback(entryData,embedPlayer.id);});break;case'entryFailed':b('KalturaSupport_EntryFailed');break;case'mediaReady':b('playerReady',function(event){if(embedPlayer.kentryid){setTimeout(function(){callback(embedPlayer.id)},0);}});break;case'metadataReceived':b('KalturaSupport_MetadataReceived');break;case'bufferChange':var triggeredBufferStart=false;var triggeredBufferEnd=false;b('monitorEvent',function(){if(!triggeredBufferStart){callback(true,embedPlayer.id);triggeredBufferStart=true;}if(!triggeredBufferEnd&&embedPlayer.bufferedPercent==1){callback(false,embedPlayer.id);triggeredBufferEnd=true;}})
break;case'bytesDownloadedChange':var prevBufferBytes=0;b('monitorEvent',function(){if(typeof embedPlayer.bufferedPercent!='undefined'&&embedPlayer.mediaElement.selectedSource){var bufferBytes=parseInt(embedPlayer.bufferedPercent*embedPlayer.mediaElement.selectedSource.getSize());if(bufferBytes!=prevBufferBytes){callback({'newValue':bufferBytes},embedPlayer.id);prevBufferBytes=bufferBytes;}}})
break;case'playerDownloadComplete':b('monitorEvent',function(){if(embedPlayer.bufferedPercent==1){callback(embedPlayer.id);}});break;case'bufferProgress':var prevBufferTime=0;b('monitorEvent',function(){if(typeof embedPlayer.bufferedPercent!='undefined'){var bufferTime=parseInt(embedPlayer.bufferedPercent*embedPlayer.duration);if(bufferTime!=prevBufferTime){callback({'newTime':bufferTime},embedPlayer.id);prevBufferTime=bufferTime;}}})
break;case'bytesTotalChange':var prevBufferBytesTotal=0;b('mediaLoaded',function(){callback({'newValue':embedPlayer.mediaElement.selectedSource.getSize()});})
break;case'preSequenceStart':case'prerollStarted':b('AdSupport_prerollStarted',function(e,slotType){callback({'timeSlot':slotType},embedPlayer.id);});break;case'preSequenceComplete':b('AdSupport_preSequenceComplete',function(e,slotType){callback({'timeSlot':slotType},embedPlayer.id);});break;case'midSequenceStart':b('AdSupport_midrollStarted',function(e,slotType){callback({'timeSlot':slotType},embedPlayer.id);});break;case'midSequenceComplete':b('AdSupport_midSequenceComplete',function(e,slotType){callback({'timeSlot':slotType},embedPlayer.id);});break;case'postSequenceStart':b('AdSupport_postrollStarted',function(e,slotType){callback({'timeSlot':slotType},embedPlayer.id);});break;case'postSequenceComplete':b('AdSupport_postSequenceComplete',function(e,slotType){callback({'timeSlot':slotType},embedPlayer.id);});break;case'adStart':b('AdSupport_StartAdPlayback',function(e,slotType){callback({'timeSlot':slotType},embedPlayer.id);});break;case'adEnd':b('AdSupport_EndAdPlayback',function(e,slotType){callback({'timeSlot':slotType},embedPlayer.id)});break;case'adUpdatePlayhead':b('AdSupport_AdUpdatePlayhead',function(event,adTime){callback(adTime,embedPlayer.id);});break;case'pre1start':b('AdSupport_PreSequence');break;case'post1start':b('AdSupport_PostSequence');break;case'cuePointsReceived':b('KalturaSupport_CuePointsReady',function(event,cuePoints){callback(embedPlayer.rawCuePoints,embedPlayer.id);});break;case'cuePointReached':b('KalturaSupport_CuePointReached',function(event,cuePointWrapper){callback(cuePointWrapper,embedPlayer.id);});break;case'adOpportunity':b('KalturaSupport_AdOpportunity',function(event,cuePointWrapper){callback(cuePointWrapper,embedPlayer.id);});break;case'videoView':b('firstPlay');break;case'share':b('showShareEvent');break;case'openFullscreen':b('openFullScreen');break;case'closefullscreen':b('closeFullScreen');break;case'replay':case'doReplay':b('replayEvent');break;case'save':case'gotoContributorWindow':case'gotoEditorWindow':mw.log("Warning: kdp event: "+eventName+" does not have an html5 mapping");break;case'freePreviewEnd':b('KalturaSupport_FreePreviewEnd');break;case'switchingChangeStarted':b('sourceSwitchingStarted',function(event,data){callback(data);});break;case'switchingChangeComplete':b('sourceSwitchingEnd',function(event,data){callback(data);});break;default:b(eventName,function(){var args=$.makeArray(arguments);if(args.length){args.shift();}callback.apply(embedPlayer,args);});break;};return true;},sendNotification:function(embedPlayer,notificationName,notificationData){mw.log('KDPMapping:: sendNotification > '+notificationName,notificationData);switch(notificationName){case'switchSrc':embedPlayer.switchSrc(notificationData);break;case'showSpinner':embedPlayer.addPlayerSpinner();break;case'hideSpinner':embedPlayer.hideSpinner();break;case'doPlay':if(embedPlayer.sequenceProxy&&embedPlayer.sequenceProxy.isInSequence){embedPlayer.triggerHelper('doPlay');if(mw.getConfig("EmbedPlayer.ForceNativeComponent")){embedPlayer.play();}break;}if(embedPlayer.playerReadyFlag==false){mw.log('Warning:: KDPMapping, Calling doPlay before player ready');$(embedPlayer).bind('playerReady.sendNotificationDoPlay',function(){$(embedPlayer).unbind('.sendNotificationDoPlay');embedPlayer.play();})
return;}if(notificationData&&notificationData.userInitiated){embedPlayer.triggerHelper('userInitiatedPlay');}embedPlayer.play();break;case'doPause':if(embedPlayer.sequenceProxy&&embedPlayer.sequenceProxy.isInSequence){embedPlayer.triggerHelper('doPause');break;}if(notificationData&&notificationData.userInitiated){embedPlayer.triggerHelper('userInitiatedPause');}embedPlayer.pause();break;case'doStop':if(!embedPlayer.stopped){setTimeout(function(){embedPlayer.ignoreNextNativeEvent=true;if(!embedPlayer.isLive()){embedPlayer.seek(0,true);}embedPlayer.stop();},10);}break;case'doReplay':embedPlayer.replay();break;case'doSeek':var seekTime=(parseFloat(notificationData)-embedPlayer.startOffset);embedPlayer.kPreSeekTime=embedPlayer.currentTime;embedPlayer.bindHelper('seeked.kdpMapOnce',function(){embedPlayer.kPreSeekTime=null;});embedPlayer.seek(seekTime);break;case'changeVolume':embedPlayer.setVolume(parseFloat(notificationData),true);break;case'openFullScreen':embedPlayer.layoutBuilder.fullScreenManager.doFullScreenPlayer();break;case'closeFullScreen':embedPlayer.layoutBuilder.fullScreenManager.restoreWindowPlayer();break;case'cleanMedia':embedPlayer.emptySources();break;case'changeMedia':if((!notificationData.entryId||notificationData.entryId==""||notificationData.entryId==-1)&&(!notificationData.referenceId||notificationData.referenceId==""||notificationData.referenceId==-1)&&!notificationData.mediaProxy){mw.log("KDPMapping:: ChangeMedia missing entryId or refrenceid, empty sources.")
embedPlayer.emptySources();break;}if((notificationData.entryId&&notificationData.entryId!=-1)||(notificationData.referenceId&&notificationData.referenceId!=-1)||(notificationData.mediaProxy)){if(embedPlayer.changeMediaStarted){break;}embedPlayer.changeMediaStarted=true;if(!notificationData.entryId&&notificationData.referenceId){embedPlayer.setFlashvars('referenceId',notificationData.referenceId);}else{embedPlayer.setFlashvars('referenceId',null);}embedPlayer.kentryid=notificationData.entryId;if(notificationData.referenceId){embedPlayer.referenceId=notificationData.referenceId;}embedPlayer.setKalturaConfig("proxyData",notificationData.proxyData);embedPlayer.setKalturaConfig("proxyData","data",notificationData.proxyData);embedPlayer.setKalturaConfig('originalProxyData',notificationData.proxyData);embedPlayer.kalturaPlayerMetaData=null;embedPlayer.kalturaEntryMetaData=null;embedPlayer.rawCuePoints=null;embedPlayer.kCuePoints=null;embedPlayer.kAds=null;embedPlayer.updatePoster();if(notificationData.mediaProxy){window.kalturaIframePackageData.entryResult=notificationData.mediaProxy;embedPlayer.playerConfig.plugins['mediaProxy']=notificationData.mediaProxy;embedPlayer.playerConfig.plugins['mediaProxy'].manualProvider=true;}embedPlayer.changeMedia();break;}case'alert':embedPlayer.layoutBuilder.displayAlert(notificationData);break;case'removealert':embedPlayer.layoutBuilder.closeAlert();break;case'enableGui':if(notificationData.guiEnabled==true){embedPlayer.enablePlayControls();}else{embedPlayer.disablePlayControls();}break;case'addBlackScreen':embedPlayer.addBlackScreen();break;case'removeBlackScreen':embedPlayer.removeBlackScreen();break;default:$(embedPlayer).trigger(notificationName,[notificationData]);break;}$(embedPlayer).trigger('Kaltura_SendNotification',[notificationName,notificationData]);}};})(window.mw,jQuery);;},{},{});mw.loader.implement("mw.KEntryLoader",function($){(function(mw,$){"use strict";mw.KEntryLoader=function(client,kProperties){return this.init(client,kProperties);};mw.KEntryLoader.prototype={baseDataInx:0,playerLoaderCache:[],init:function(client,kProperties){this.clinet=client;this.kProperties=kProperties;},get:function(callback){var _this=this,requestObject=[];var kProperties=this.kProperties;kProperties.flashvars=kProperties.flashvars||{};if(this.getCacheKey(kProperties)&&this.playerLoaderCache[this.getCacheKey(kProperties)]){mw.log("KApi:: playerLoader load from cache: "+!!(this.playerLoaderCache[this.getCacheKey(kProperties)]));callback(this.playerLoaderCache[this.getCacheKey(kProperties)]);return;}var fillCacheAndRunCallback=function(namedData){if(!mw.getConfig("EmbedPlayer.DisableEntryCache")){_this.playerLoaderCache[_this.getCacheKey(kProperties)]=namedData;}callback(namedData);};if(!kProperties.flashvars.referenceId&&!kProperties.entry_id){mw.log("KApi:: entryId and referenceId not found, exit.");callback({error:"Empty player"});return;}if(kProperties.flashvars&&kProperties.flashvars.ks){this.clinet.setKs(kProperties.flashvars.ks);}var entryIdValue='{1:result:objects:0:id}';var baseEntryRequestObj={'service':'baseentry','action':'list','filter:objectType':'KalturaBaseEntryFilter'};if(!kProperties.entry_id&&kProperties.flashvars.referenceId){baseEntryRequestObj['filter:referenceIdEqual']=kProperties.flashvars.referenceId;}else if(kProperties.entry_id){if(kProperties.features['entryRedirect']&&kProperties.flashvars.disableEntryRedirect!==true){baseEntryRequestObj['filter:redirectFromEntryId']=kProperties.entry_id;}else{baseEntryRequestObj['filter:idEqual']=kProperties.entry_id;}}var withProxyData=false;if(kProperties.proxyData){baseEntryRequestObj['filter:freeText']=JSON.stringify(kProperties.proxyData);withProxyData=true;}requestObject.push(baseEntryRequestObj);var streamerType=kProperties.flashvars.streamerType||'http';var flavorTags=kProperties.flashvars.flavorTags||'all';requestObject.push({'contextDataParams':{'referrer':window.kWidgetSupport.getHostPageUrl(),'objectType':'KalturaEntryContextDataParams','flavorTags':flavorTags,'streamerType':streamerType},'service':'baseentry','entryId':entryIdValue,'action':'getContextData'});requestObject.push({'service':'metadata_metadata','action':'list','version':'-1','filter:metadataObjectTypeEqual':1,'filter:orderBy':'+createdAt','filter:objectIdEqual':entryIdValue,'pager:pageSize':1});if(typeof kProperties.flashvars['metadataProfileId']!='undefined'){requestObject[requestObject.length-1]['filter:metadataProfileIdEqual']=kProperties.flashvars['metadataProfileId'];}if(kProperties.flashvars.getCuePointsData!==false){requestObject.push({'service':'cuepoint_cuepoint','action':'list','filter:objectType':'KalturaCuePointFilter','filter:orderBy':'+startTime','filter:statusEqual':1,'filter:entryIdEqual':entryIdValue});}_this.getNamedDataFromRequest(requestObject,fillCacheAndRunCallback,withProxyData);},getNamedDataFromRequest:function(requestObject,callback,withProxyData){var _this=this;this.clinet.doRequest(requestObject,function(data){var namedData={};if(data[0].code){mw.log('Error in kaltura api response: '+data[0].message);callback({'error':data[0].message});return;}var dataIndex=_this.baseDataInx;if(!data[dataIndex].objects||(data[dataIndex].objects&&data[dataIndex].objects.length==0)){namedData['meta']={code:'ENTRY_ID_NOT_FOUND',message:'Entry not found'};}else{namedData['meta']=data[dataIndex].objects[0];}dataIndex++;namedData['contextData']=data[dataIndex];dataIndex++;namedData['entryMeta']=_this.convertCustomDataXML(data[dataIndex]);dataIndex++;if(data[dataIndex]&&data[dataIndex].totalCount>0){namedData['entryCuePoints']=data[dataIndex].objects;}callback(namedData);},undefined,undefined,withProxyData);},convertCustomDataXML:function(data){var result={};if(data&&data.objects&&data.objects[0]){var xml=$.parseXML(data.objects[0].xml);var $xml=$(xml).find('metadata').children();$.each($xml,function(inx,node){result[node.nodeName]=node.textContent;});}return result;},getCacheKey:function(kProperties){var rKey='';if(kProperties){$.each(kProperties,function(inx,value){if(inx=='flashvars'){if(typeof kProperties.flashvars=='object'){rKey+=kProperties.flashvars.getCuePointsData;rKey+=kProperties.flashvars.ks;rKey+=kProperties.flashvars.referenceId;}}else{rKey+=inx+'_'+value;}});}return rKey;}};mw.kApiEntryLoader=function(kProperties,callback){if(!kProperties.widget_id){mw.log("Error:: mw.KApiPlayerLoader:: cant run player loader with widget_id "+kProperties.widget_id);}if(!kProperties.features){kProperties.features={};}var client=mw.kApiGetPartnerClient(kProperties.widget_id);var entryLoader=new mw.KEntryLoader(client,kProperties);entryLoader.get(callback);return client;};})(window.mw,jQuery);;},{},{});mw.loader.implement("mw.KWidgetSupport",function($){(function(mw,$){"use strict";mw.KApiPartnerCache=[];mw.kApiGetPartnerClient=function(widgetId){if(!mw.KApiPartnerCache[widgetId]){mw.KApiPartnerCache[widgetId]=new kWidget.api({'wid':widgetId});}return mw.KApiPartnerCache[widgetId];};mw.KWidgetSupport=function(options){return this.init(options);};mw.KWidgetSupport.prototype={kClient:null,kSessionId:null,originalStreamerType:null,init:function(options){if(options){$.extend(this,options);}this.addStringsSupport();this.addPlayerHooks();},addStringsSupport:function(){window.getStringByKey=function(key){var playerConfig=window.kalturaIframePackageData.playerConfig;var localizationCode=window.kalturaIframePackageData.enviornmentConfig["localizationCode"]||false;if(playerConfig&&playerConfig.plugins&&playerConfig.plugins.strings){if(localizationCode&&playerConfig.plugins.strings[localizationCode+"."+key]){return playerConfig.plugins.strings[localizationCode+"."+key];}else if(localizationCode&&playerConfig.plugins.strings[localizationCode]&&playerConfig.plugins.strings[localizationCode][key]){return playerConfig.plugins.strings[localizationCode][key];}else if(playerConfig.plugins.strings[key]){return playerConfig.plugins.strings[key];}else{return false;}}else{return false;}}},isIframeApiServer:function(){return(mw.getConfig('EmbedPlayer.IsIframeServer')&&mw.getConfig('EmbedPlayer.IframeParentUrl'));},addPlayerHooks:function(){var _this=this;$(mw).bind('KalturaSupportNewPlayer',function(event,embedPlayer){if(!embedPlayer.kwidgetid){mw.log("Error:: KalturaSupportNewPlayer without kwidgetid");return;}_this.bindPlayer(embedPlayer);new mw.KDPMapping(embedPlayer);if(kWidget.isIE8()&&!kWidget.supportsFlash()){embedPlayer.setError(embedPlayer.getKalturaMsg('ks-FLASH-REQUIRED'));}});},bindPlayer:function(embedPlayer){var _this=this;this.addPlayerMethods(embedPlayer);if(!embedPlayer.playerConfig){mw.log('Error: KWidgetSupport::bindPlayer error playerConfig not found');return;}mw.setConfig("nativeVersion",embedPlayer.getFlashvars("nativeVersion"));embedPlayer.bindHelper('directDownloadLink',function(event,downloadUrlCallback){var baseUrl=mw.getConfig('wgLoadScript').replace('load.php','');var downloadUrl=baseUrl+'modules/KalturaSupport/download.php/wid/'+embedPlayer.kwidgetid;if(embedPlayer.kuiconfid){downloadUrl+='/uiconf_id/'+embedPlayer.kuiconfid;}if(embedPlayer.kentryid){downloadUrl+='/entry_id/'+embedPlayer.kentryid;}var client=mw.kApiGetPartnerClient(embedPlayer.kwidgetid);downloadUrl+='/referrer/'+base64_encode(kWidgetSupport.getHostPageUrl());var ks=client.getKs();if(ks){downloadUrl+='/ks/'+ks;}downloadUrl+='/?playSessionId='+_this.getGUID();downloadUrlCallback(downloadUrl);});embedPlayer.bindHelper('checkPlayerSourcesEvent',function(event,callback){_this.originalStreamerType=embedPlayer.getKalturaConfig(null,'streamerType')?embedPlayer.getKalturaConfig(null,'streamerType'):'http';_this.loadAndUpdatePlayerData(embedPlayer,callback);});embedPlayer.bindHelper('KalturaSupport_EntryDataReady',function(){embedPlayer.setDuration(embedPlayer.kalturaPlayerMetaData.duration);var thumbUrl=_this.getKalturaThumbnailUrl({url:embedPlayer.evaluate('{mediaProxy.entry.thumbnailUrl}'),width:embedPlayer.getWidth(),height:embedPlayer.getHeight()});if(embedPlayer.getFlashvars('loadThumbnailWithKs')===true){thumbUrl+='/ks/'+embedPlayer.getFlashvars('ks');}if(mw.getConfig('thumbnailUrl')){thumbUrl=embedPlayer.evaluate(mw.getConfig('thumbnailUrl'));}var alt=gM('mwe-embedplayer-video-thumbnail-for',embedPlayer.evaluate('{mediaProxy.entry.name}'));embedPlayer.updatePoster(thumbUrl,alt);embedPlayer.isAudioPlayer=(embedPlayer.kalturaPlayerMetaData.mediaType===5);});embedPlayer.bindHelper('AddEmptyBlackSources',function(event,vid){$(vid).empty();$.each(mw.getConfig('Kaltura.BlackVideoSources'),function(inx,sourceAttr){$(vid).append($('<source />').attr(sourceAttr));});});embedPlayer.bindHelper('getShareIframeSrc',function(event,callback){var uiconf_id=(embedPlayer.kuiconfid)?'/uiconf_id/'+embedPlayer.kuiconfid:'';var iframeUrl=mw.getMwEmbedPath()+'mwEmbedFrame.php';iframeUrl+='/wid/'+embedPlayer.kwidgetid+uiconf_id+'/entry_id/'+embedPlayer.kentryid+'/'+'?'+kWidget.flashVarsToUrl(embedPlayer.getFlashvars());callback(iframeUrl);});if(!this.isEmbedServicesEnabled(kalturaIframePackageData.entryResult)){embedPlayer.shouldHandlePlayerError=false;embedPlayer.bindHelper('embedPlayerError',function(event,data,doneCallback){var displayedAcError=false;if(mw.getConfig("manualProvider")){embedPlayer.shouldHandlePlayerError=true;embedPlayer.handlePlayerError(data);return;}_this.getEntryIdSourcesFromApi(embedPlayer,embedPlayer.kentryid,function(sources){if(!sources||sources.message){embedPlayer.showErrorMsg(sources);displayedAcError=true;doneCallback();}});setTimeout(function(){if(displayedAcError){return;}embedPlayer.handlePlayerError(data,true);},3000);});}embedPlayer.bindHelper('Kaltura_SetKDPAttribute',function(e,componentName,property,value){if(!value&&value!==0){return;}var segmentChange=false;switch(property){case'mediaPlayFrom':embedPlayer.startTime=parseFloat(value);segmentChange=true;clearTimeout(window.timeoutID);break;case'mediaPlayTo':embedPlayer.pauseTime=parseFloat(value);segmentChange=true;embedPlayer.stopMonitor();clearTimeout(window.timeoutID);break;}if(segmentChange){window.timeoutID=setTimeout(function(){$(embedPlayer).trigger("playSegmentEvent",[embedPlayer.startTime,embedPlayer.pauseTime]);embedPlayer.playSegment(embedPlayer.startTime,embedPlayer.pauseTime);},100);}});},loadAndUpdatePlayerData:function(embedPlayer,callback){var _this=this;mw.log("KWidgetSupport::loadAndUpdatePlayerData");_this.loadPlayerData(embedPlayer,function(playerData){if(!playerData){mw.log("KWidgetSupport::loadAndUpdatePlayerData> error no player data!");callback();return;}_this.updatePlayerData(embedPlayer,playerData,callback);});},updatePlayerData:function(embedPlayer,playerData,callback){this.updatePlayerEntryData(embedPlayer,playerData);this.updatePlayerMetaData(embedPlayer,playerData);this.handlePlayerError(embedPlayer,playerData);this.updatePlayerContextData(embedPlayer,playerData);if(this.isLive(playerData)){this.updateLivePlayerData(embedPlayer,playerData);}else{if(this.isEmbedServicesEnabled(playerData)){this.updateEmbedServicesData(embedPlayer,playerData);}else{this.updateVodPlayerData(embedPlayer,playerData);this.updateDrmPlayerData(embedPlayer);}}this.update360PlayerData(embedPlayer,playerData);this.updateImagePlayerData(embedPlayer,playerData);this.updateExternalPlayerData(embedPlayer,playerData);if(this.isNoEntryId(playerData)){this.handleNoEntryId();}this.initCuePointsService(embedPlayer,playerData);this.handleUiConf(embedPlayer,callback);},updatePlayerContextData:function(embedPlayer,playerData){if(playerData.contextData){if(playerData.contextData.msDuration){embedPlayer.kalturaPlayerMetaData.duration=Math.floor(playerData.contextData.msDuration/1000);}embedPlayer.kalturaContextData=playerData.contextData;if(playerData.contextData&&$.isArray(playerData.contextData.accessControlActions)){var kalturaAccessControlModifyRequestHostRegexActions=$.grep(playerData.contextData.accessControlActions,function(action){return action.type===7;});if(kalturaAccessControlModifyRequestHostRegexActions.length>0){var action=kalturaAccessControlModifyRequestHostRegexActions[0];if(action.pattern&&action.replacement){var regExp=new RegExp(action.pattern,"i");var urlsToModify=['Kaltura.ServiceUrl','Kaltura.StatsServiceUrl','Kaltura.ServiceBase','Kaltura.LiveStatsServiceUrl','Kaltura.AnalyticsUrl'];urlsToModify.forEach(function(key){var serviceUrl=mw.config.get(key);var match=serviceUrl.match(regExp);if(match){serviceUrl=serviceUrl.replace(regExp,action.replacement);mw.config.set(key,serviceUrl);}});}}}}},isLive:function(playerData){return playerData.meta&&(playerData.meta.type==7||playerData.meta.type==8);},updateLivePlayerData:function(embedPlayer,playerData){var isStreamSupported=false;if(this.isOnlyHlsSources(playerData)){mw.setConfig("LeadWithHLSOnFlash",true);}if(playerData&&playerData.meta&&(playerData.meta.sourceType==="32"||playerData.meta.sourceType==="33")&&!mw.getConfig('forceHDS')){mw.setConfig("LeadWithHLSOnFlash",true);mw.setConfig("isLiveKalturaHLS",true);}var legacyMulticastSource=this.getLegacyLiveMulticastSource(playerData);if(legacyMulticastSource){this.addLiveEntrySource(embedPlayer,playerData.meta,"silverlightMulticast",'multicast_silverlight');isStreamSupported=true;embedPlayer.setLive(true);}if(embedPlayer.getFlashvars("LeadWithUnicastToMulticast")===true){this.addLiveEntrySource(embedPlayer,playerData.meta,"silverlightMulticast",'applehttp_to_mc');isStreamSupported=true;embedPlayer.setLive(true);if(embedPlayer.getFlashvars("disableMulticastFallback")){return;}}var drmPlugin=embedPlayer.playerConfig.plugins["multiDrm"];var drmRequired=drmPlugin&&(drmPlugin.plugin===true);var liveSource;var _this=this;var attachLiveDrmData=function(playerData,liveSource){if(drmRequired){var drmData=_this.getFlavorAssetsDrmData(playerData);var ids=$.map(drmData,function(data,id){return id;});_this.attachFlavorAssetDrmData(liveSource,ids[0],drmData);liveSource.fpsCertificate=_this.getFairplayCert(playerData);}};if(drmRequired&&this.hasLivestreamConfig(playerData,"mpegdash")&&mw.EmbedTypes.getMediaPlayers().getMIMETypePlayers('application/dash+xml').length){liveSource=this.addLiveEntrySource(embedPlayer,playerData.meta,"dash",'mpegdash');attachLiveDrmData(playerData,liveSource);embedPlayer.setLive(true);}else if(this.hasHlsSourcse(playerData)&&mw.EmbedTypes.getMediaPlayers().getMIMETypePlayers('application/vnd.apple.mpegurl').length){if(this.isManualProvider(playerData)){liveSource=this.addManualProviderSources(embedPlayer,playerData);embedPlayer.setLive(true);}else{liveSource=this.addLiveEntrySource(embedPlayer,playerData.meta,"hls",'applehttp');embedPlayer.setLive(true);}attachLiveDrmData(playerData,liveSource);}else if(drmRequired&&this.hasLivestreamConfig(playerData,"sl")&&mw.EmbedTypes.getMediaPlayers().getMIMETypePlayers('video/playreadySmooth').length){liveSource=this.addLiveEntrySource(embedPlayer,playerData.meta,"silverlight",'sl');attachLiveDrmData(playerData,liveSource);embedPlayer.setLive(true);}else if(mw.EmbedTypes.getMediaPlayers().isSupportedPlayer('kplayer')){var streamerType=this.resolveFlashStreamerType(embedPlayer,playerData);this.addLiveEntrySource(embedPlayer,playerData.meta,"flash",streamerType);embedPlayer.setLive(true);}else if(!isStreamSupported){embedPlayer.setError(embedPlayer.getKalturaMsg('LIVE-STREAM-NOT-SUPPORTED'));}},hasLivestreamConfig:function(playerData,protocol){var configurations=playerData.meta.liveStreamConfigurations;if(configurations&&configurations.length){for(var i=0;i<configurations.length;i++){if(configurations[i].protocol==protocol){return true;}}}return false;},isOnlyHlsSources:function(playerData){var hasOnlyHLS=false;var configurations=playerData.meta.liveStreamConfigurations;if(playerData.meta.hlsStreamUrl&&(!configurations||configurations.length==0)){hasOnlyHLS=true;}else if(configurations){for(var i=0;i<configurations.length;i++){if(configurations[i].protocol!="hls"&&configurations[i].protocol!="applehttp"){hasOnlyHLS=false;break;}hasOnlyHLS=true;}}return hasOnlyHLS;},getLegacyLiveMulticastSource:function(playerData){var source=null;if(mw.EmbedTypes.getMediaPlayers().isSupportedPlayer('splayer')){if(playerData.contextData&&playerData.contextData.flavorAssets){var flavorData=playerData.contextData.flavorAssets;for(var i=0;i<flavorData.length;i++){var tags=flavorData[i].tags.toLowerCase().split(',');if($.inArray('multicast_silverlight',tags)!=-1){source=flavorData;break;}}}}return source;},hasHlsSourcse:function(playerData){return(playerData.meta.hlsStreamUrl||this.hasLivestreamConfig(playerData,'hls')||this.hasLivestreamConfig(playerData,'applehttp'));},isManualProvider:function(playerData){return(playerData.entry&&playerData.entry.manualProvider);},addManualProviderSources:function(embedPlayer,playerData){if(playerData.meta.hdsStreamUrl){return embedPlayer.mediaElement.tryAddSource($('<source />').attr({'src':playerData.meta.hdsStreamUrl,'type':'application/vnd.apple.mpegurl'})[0]);}return embedPlayer.mediaElement.tryAddSource($('<source />').attr({'src':playerData.meta.hlsStreamUrl,'type':'application/vnd.apple.mpegurl'})[0]);},resolveFlashStreamerType:function(embedPlayer,playerData){var streamerType;var streamerTypeFV=embedPlayer.getKalturaConfig(null,'streamerType');if(streamerTypeFV&&this.hasLivestreamConfig(playerData,streamerTypeFV)){streamerType=streamerTypeFV;}else if(this.hasLivestreamConfig(playerData,'hdnetworkmanifest')){streamerType='hdnetworkmanifest';}else if(this.hasLivestreamConfig(playerData,'hds')){streamerType='hds';}else{streamerType='rtmp';}return streamerType;},isEmbedServicesEnabled:function(playerData){if(playerData&&playerData.meta&&playerData.meta.partnerData&&playerData.meta.partnerData["proxyEnabled"]&&playerData.meta.partnerData["proxyEnabled"]==="true"){return true;}else{return false;}},updateEmbedServicesData:function(embedPlayer,playerData){var _this=this;var flavorAssets=[];var flavorData=playerData.contextData.flavorAssets;var flavorDrmData=this.getFlavorAssetsDrmData(playerData);$.each(flavorData,function(index,flavorAsset){var flavorPartnerData=flavorAsset.partnerData;if(flavorPartnerData.url!=""){var flavorAssetObj={"data-assetid":flavorAsset.id,src:_this.addSessionIdToSrc(flavorPartnerData.url),type:flavorPartnerData.type,"data-width":flavorAsset.width,"data-height":flavorAsset.height,"data-bitrate":flavorAsset.bitrate,"data-bandwidth":(flavorAsset.bitrate?(flavorAsset.bitrate*1024):0),"data-frameRate":flavorAsset.frameRate,"data-flavorid":flavorPartnerData.flavorid};if(flavorPartnerData["default"]==="true"){flavorAssetObj["default"]=true;}_this.attachFlavorAssetDrmData(flavorAssetObj,flavorAsset.id,flavorDrmData);if(flavorAssetObj.type==="application/vnd.apple.mpegurl"){flavorAssetObj.fpsCertificate=_this.getFairplayCert(playerData);}flavorAssets.push(flavorAssetObj);}});embedPlayer.replaceSources(flavorAssets);if(playerData.meta.partnerData["isLive"]&&playerData.meta.partnerData["isLive"]=="true"){embedPlayer.setLive(true);}embedPlayer.setKalturaConfig('originalProxyData',embedPlayer.getKalturaConfig('proxyData'));embedPlayer.setKalturaConfig('proxyData',playerData.meta.partnerData);},addSessionIdToSrc:function(srcURL){if(srcURL&&srcURL.toLowerCase().indexOf("playmanifest")===-1){return srcURL;}var nativeVersion=mw.getConfig("nativeVersion");nativeVersion=(nativeVersion!=null&&nativeVersion.length>0)?'_'+nativeVersion:'';var clientTag='html5:v'+window['MWEMBED_VERSION']+nativeVersion;var qp=(srcURL.indexOf('?')===-1)?'?':'&';return srcURL+qp+'playSessionId='+this.getGUID()+'&clientTag='+clientTag;},updateVodPlayerData:function(embedPlayer,playerData){embedPlayer.setLive(false);if(playerData.contextData&&playerData.contextData.flavorAssets){this.addFlavorSources(embedPlayer,playerData);}if(playerData.sources){this.addSources(embedPlayer,playerData.sources);}},updateDrmPlayerData:function(embedPlayer){var drmSources=embedPlayer.mediaElement.sources.filter(function(source){return(source.signature&&source.custom_data);});var drmRequired=(drmSources.length>0);embedPlayer.setDrmRequired(drmRequired);},update360PlayerData:function(embedPlayer,playerData){if(playerData.meta&&playerData.meta.tags){var pattern=new RegExp('(, |^)360(,|$)');embedPlayer.set360(pattern.test(playerData.meta.tags));}else{embedPlayer.set360(false);}},updateImagePlayerData:function(embedPlayer,playerData){if(playerData.meta&&playerData.meta.mediaType==2){mw.log('KWidgetSupport::updatePlayerData: Add Entry Image');embedPlayer.mediaElement.tryAddSource($('<source />').attr({'src':this.getKalturaThumbnailUrl({url:playerData.meta.thumbnailUrl,width:embedPlayer.getWidth(),height:embedPlayer.getHeight()}),'type':'image/jpeg'}).get(0));}},updateExternalPlayerData:function(embedPlayer,playerData){if(playerData.meta&&playerData.meta.type=="externalMedia.externalMedia"){$(embedPlayer).trigger('KalturaSupport_AddExternalMedia',playerData.meta);}},isNoEntryId:function(playerData){return playerData.meta&&playerData.meta.code=='ENTRY_ID_NOT_FOUND';},handleNoEntryId:function(embedPlayer){$(embedPlayer).trigger('KalturaSupport_EntryFailed');},updatePlayerEntryData:function(embedPlayer,playerData){embedPlayer.kalturaEntryMetaData=(playerData.entryMeta)?playerData.entryMeta:playerData.entryMetadata;},updatePlayerMetaData:function(embedPlayer,playerData){var meta=(playerData.meta)?playerData.meta:playerData.entry;if(meta){embedPlayer.kalturaPlayerMetaData=meta;if(meta.moderationStatus&&(!playerData.contextData||!playerData.contextData.isAdmin)){if(meta.moderationStatus==1){embedPlayer.setError(embedPlayer.getKalturaMsgObject('ks-ENTRY_MODERATE'));}else if(meta.moderationStatus==3){embedPlayer.setError(embedPlayer.getKalturaMsgObject('ks-ENTRY_REJECTED'));}}}},initCuePointsService:function(embedPlayer,playerData){if((playerData.entryCuePoints&&playerData.entryCuePoints.length>0)||(embedPlayer.isLive()&&mw.getConfig("EmbedPlayer.LiveCuepoints"))){embedPlayer.rawCuePoints=playerData.entryCuePoints||[];embedPlayer.kCuePoints=new mw.KCuePoints(embedPlayer);}},addPlayerMethods:function(embedPlayer){var _this=this;embedPlayer.getRawKalturaConfig=function(confPrefix,attr){var rawConfigArray=_this.getRawPluginConfig(embedPlayer,confPrefix,attr);if($.isPlainObject(rawConfigArray)&&attr){return rawConfigArray[attr];}return rawConfigArray;};embedPlayer.getKalturaConfig=function(confPrefix,attr){return _this.getPluginConfig(embedPlayer,confPrefix,attr);};embedPlayer.setKalturaConfig=function(pluginName,key,value,quiet){if(!key){return;}var objectSet={};if(typeof key==="string"){objectSet[key]=value;}if(typeof key==="object"){objectSet=key;}if(!embedPlayer.playerConfig){embedPlayer.playerConfig={'plugins':{},'vars':{}};}if(!pluginName){embedPlayer.playerConfig['vars'][key]=value;}else if(!embedPlayer.playerConfig['plugins'][pluginName]){embedPlayer.playerConfig['plugins'][pluginName]=objectSet;}else{if(typeof key==='object'){$.extend(embedPlayer.playerConfig['plugins'][pluginName],objectSet);mw.log('merged:: ',embedPlayer.playerConfig['plugins'][pluginName]);}else if($.isArray(embedPlayer.playerConfig['plugins'][pluginName][key])&&$.isArray(value)){embedPlayer.playerConfig['plugins'][pluginName][key]=value;}else if(typeof embedPlayer.playerConfig['plugins'][pluginName][key]==='object'&&typeof value==='object'){$.extend(embedPlayer.playerConfig['plugins'][pluginName][key],value);}else{embedPlayer.playerConfig['plugins'][pluginName][key]=value;}}if(!quiet){embedPlayer.triggerHelper('Kaltura_ConfigChanged',[pluginName,key,value]);}};embedPlayer.addExportedObject=function(pluginName,objectSet){mw.log("KwidgetSupport:: addExportedObject is deprecated, please use standard setKalturaConfig");for(var key in objectSet){embedPlayer.setKalturaConfig(pluginName,key,objectSet[key]);}};embedPlayer.isPluginEnabled=function(pluginName){var lcPluginName=(pluginName.substr(0,1))?pluginName.substr(0,1).toLowerCase()+pluginName.substr(1):false;if(lcPluginName){if(_this.getRawPluginConfig(embedPlayer,lcPluginName)===undefined){return false;}if(_this.getPluginConfig(embedPlayer,lcPluginName,'plugin')===false){return false;}if(_this.getPluginConfig(embedPlayer,lcPluginName,'disableHTML5')){return false;}return true;}return false;};embedPlayer.getFlashvars=function(param){if(!embedPlayer.playerConfig||!embedPlayer.playerConfig.vars){return{};}var fv=embedPlayer.playerConfig['vars']||{};if(param){if(param in fv){return fv[param];}else{return undefined;}}return fv;}
embedPlayer.setFlashvars=function(key,value){if(key){embedPlayer.playerConfig['vars'][key]=value;}}
embedPlayer.getKalturaMsg=function(msgKey){var localeMsgKey=msgKey;if(embedPlayer.currentLocale){localeMsgKey=embedPlayer.currentLocale+'_'+msgKey;}if(_this.getPluginConfig(embedPlayer,'strings',localeMsgKey)){return _this.getPluginConfig(embedPlayer,'strings',localeMsgKey);}if(mw.messages.exists(msgKey)){return gM(msgKey);}msgKey='ks-'+msgKey;if(mw.messages.exists(msgKey)){return gM(msgKey);}if(msgKey.indexOf('_TITLE')==-1){return gM('ks-GENERIC_ERROR');}return gM('ks-GENERIC_ERROR_TITLE');};embedPlayer.getKalturaMsgTitle=function(msgKey){return embedPlayer.getKalturaMsg(msgKey+'_TITLE');};embedPlayer.getKalturaMsgObject=function(msgKey){return{'title':embedPlayer.getKalturaMsgTitle(msgKey),'message':embedPlayer.getKalturaMsg(msgKey)}};embedPlayer.resolveSrcURL=function(srcURL){var deferred=$.Deferred();var eventObj={"src":srcURL,"promise":deferred,"handled":false};embedPlayer.triggerHelper('preResolveSrc',eventObj);if(eventObj.handled){return eventObj.promise;}if(mw.getConfig("EmbedPlayer.UseDirectManifestLinks")){return deferred.resolve(srcURL);}if(srcURL&&srcURL.toLowerCase().indexOf("playmanifest")===-1){return deferred.resolve(srcURL);}var srcToPlay=null;var qp=(srcURL.indexOf('?')===-1)?'?':'&';$.ajax({url:srcURL+qp+"responseFormat=jsonp",timeout:7000,dataType:'jsonp',success:function(playmanifest){var flavors=playmanifest.flavors;if(flavors&&flavors.length===1){srcToPlay=flavors[0].url;deferred.resolve(srcToPlay);}else if(flavors&&flavors.length>1){if(srcURL.indexOf("applehttp_to_mc")===-1)deferred.resolve(srcURL);else deferred.resolve(playmanifest);}else{deferred.reject();}},error:function(){deferred.reject();}});return deferred.promise();};},handleUiConf:function(embedPlayer,callback){var _this=this;var doneWithUiConf=function(){if(embedPlayer.rawCuePoints||(embedPlayer.isLive()&&mw.getConfig("EmbedPlayer.LiveCuepoints"))){mw.log("KWidgetSupport:: trigger KalturaSupport_CuePointsReady",embedPlayer.rawCuePoints);$(embedPlayer).trigger('KalturaSupport_CuePointsReady',[embedPlayer.rawCuePoints]);}if(embedPlayer.kalturaPlayerMetaData){$(embedPlayer).trigger('KalturaSupport_EntryDataReady',embedPlayer.kalturaPlayerMetaData);}if(embedPlayer.kalturaEntryMetaData){$(embedPlayer).trigger('KalturaSupport_MetadataReceived',embedPlayer.kalturaEntryMetaData);}mw.log("KWidgetSupport:: trigger KalturaSupport_DoneWithUiConf");setTimeout(function(){$(embedPlayer).trigger('KalturaSupport_DoneWithUiConf');callback();},0);};if(embedPlayer.playerConfig){_this.baseUiConfChecks(embedPlayer);embedPlayer.$uiConf=$({});mw.log("KWidgetSupport:: trigger Kaltura_CheckConfig");$(embedPlayer).triggerQueueCallback('Kaltura_CheckConfig',embedPlayer,function(){doneWithUiConf();});}else{doneWithUiConf();}},baseUiConfChecks:function(embedPlayer){var _this=this;var getAttr=function(attrName){return _this.getPluginConfig(embedPlayer,'',attrName);}
var autoPlay=getAttr('autoPlay');if(autoPlay){embedPlayer.autoplay=true;}var inline=getAttr('EmbedPlayer.WebKitPlaysInline');if(inline){embedPlayer.inline=true;}var autoMute=getAttr('autoMute');if(autoMute&&!mw.isMobileDevice()){setTimeout(function(){embedPlayer.toggleMute(true);},300);embedPlayer.setKalturaConfig('','autoMute',null);}var loop=getAttr('loop');if(loop){embedPlayer.loop=true;}if(getAttr('disableAlerts')){mw.setConfig('EmbedPlayer.ShowPlayerAlerts',false);}var mediaProxy=embedPlayer.getKalturaConfig('mediaProxy');if(mediaProxy){var preferedFlavorBR=mediaProxy.preferedFlavorBR;if(getAttr('disableBitrateCookie')&&preferedFlavorBR){embedPlayer.setCookie('EmbedPlayer.UserBandwidth',preferedFlavorBR*1000);}if(preferedFlavorBR&&embedPlayer.mediaElement){embedPlayer.mediaElement.preferedFlavorBR=preferedFlavorBR*1000;}var mediaPlayFrom=kWidget.getHashParam("t");if(mediaPlayFrom){mediaPlayFrom=kWidget.npt2seconds(mediaPlayFrom);}if(mediaProxy.mediaPlayFrom){mediaPlayFrom=mediaProxy.mediaPlayFrom;}if(mediaPlayFrom&&!embedPlayer.startTime){embedPlayer.startTime=parseFloat(mediaPlayFrom);mw.setConfig("Kaltura.UseAppleAdaptive",true);}var mediaPlayTo=mediaProxy.mediaPlayTo;if(mediaPlayTo&&!embedPlayer.pauseTime){embedPlayer.pauseTime=parseFloat(mediaPlayTo);}}if(getAttr('enableTooltips')===false){embedPlayer.enableTooltips=false;}var imageDuration=getAttr('imageDefaultDuration');if(imageDuration){$(embedPlayer).data('imageDuration',imageDuration);}if(getAttr('adsOnReplay')){embedPlayer.adsOnReplay=true;}if(getAttr('disablePlayerSpinner')){mw.setConfig('LoadingSpinner.Disabled',true);}var streamerType=embedPlayer.getKalturaConfig(null,'streamerType');if(embedPlayer.kalturaContextData&&streamerType=='auto'){embedPlayer.streamerType=embedPlayer.kalturaContextData.streamerType;}else if(streamerType){embedPlayer.streamerType=streamerType;}embedPlayer.setFlashvars('streamerType',_this.originalStreamerType);},getPluginConfig:function(embedPlayer,confPrefix,attr){var singleAttrName=false;if(typeof attr=='string'){singleAttrName=attr;}var rawConfigArray=this.getRawPluginConfig(embedPlayer,confPrefix,singleAttrName);var configArray=this.postProcessConfig(embedPlayer,rawConfigArray);if(singleAttrName!=false){return configArray[singleAttrName];}else{return configArray;}},getRawPluginConfig:function(embedPlayer,confPrefix,attr){var _this=this;if(!embedPlayer.playerConfig){if(window.kalturaIframePackageData.playerConfig){embedPlayer.playerConfig=window.kalturaIframePackageData.playerConfig;delete(window.kalturaIframePackageData.playerConfig);}}var plugins=embedPlayer.playerConfig['plugins'];var returnConfig={};if(confPrefix&&confPrefix[0]){confPrefix=confPrefix[0].toLowerCase()+confPrefix.substr(1);}if(confPrefix&&plugins[confPrefix]){if(!attr){return plugins[confPrefix];}if(attr&&typeof plugins[confPrefix][attr]!=='undefined'){returnConfig[attr]=plugins[confPrefix][attr];}if(attr&&typeof attr=='object'){for(var currAttr in attr){if(plugins[confPrefix][attr[currAttr]]){returnConfig[attr[currAttr]]=plugins[confPrefix][attr[currAttr]];}}}}else if(!confPrefix&&attr){returnConfig[attr]=embedPlayer.playerConfig['vars'][attr];}else{return undefined;}return returnConfig;},postProcessConfig:function(embedPlayer,config){var _this=this;var returnSet=$.extend({},config);$.each(returnSet,function(attrName,value){if(value&&(typeof value==='string')){returnSet[attrName]=unescape(value);}if(embedPlayer.evaluate){returnSet[attrName]=embedPlayer.evaluate(returnSet[attrName]);}});return returnSet;},getEntryIdSourcesFromApi:function(embedPlayer,entryId,callback){var _this=this;var sources;mw.log("KWidgetSupport:: getEntryIdSourcesFromApi: w:"+embedPlayer.kwidgetid+' entry:'+embedPlayer.kentryid);this.kClient=mw.kApiEntryLoader({'widget_id':embedPlayer.kwidgetid,'entry_id':entryId},function(playerData){if(playerData.contextData){var acStatus=_this.getAccessControlStatus(playerData.contextData,embedPlayer);if(acStatus!==true){callback(acStatus);return;}}if(playerData.meta&&playerData.meta.mediaType==2){sources=[{'src':_this.getKalturaThumbnailUrl({url:playerData.meta.thumbnailUrl,width:embedPlayer.getWidth(),height:embedPlayer.getHeight()}),'type':'image/jpeg'}];}else{sources=_this.getEntryIdSourcesFromPlayerData(embedPlayer.kpartnerid,playerData);}callback(sources);});},loadPlayerData:function(embedPlayer,callback){var _this=this;var playerRequest={};if(!embedPlayer.kwidgetid){mw.log("Error: missing required widget paramater ( kwidgetid ) ");callback(false);return;}else{playerRequest.widget_id=embedPlayer.kwidgetid;}if(!this.checkForUrlEntryId(embedPlayer)&&embedPlayer.kentryid){playerRequest.entry_id=embedPlayer.kentryid;}var proxyData=embedPlayer.getKalturaConfig('proxyData','data');if(proxyData){playerRequest.proxyData=proxyData;}playerRequest.flashvars=embedPlayer.getFlashvars();playerRequest.features=kalturaIframePackageData.apiFeatures;this.kClient=mw.kApiGetPartnerClient(playerRequest.widget_id);this.kClient.setKs(embedPlayer.getFlashvars('ks'));if(window.kalturaIframePackageData&&window.kalturaIframePackageData.playlistResult){var pl=window.kalturaIframePackageData.playlistResult;for(var plId in pl)break;if(pl[plId].content.indexOf('<?xml')===0){var entryList=[];for(var i in pl[plId].items){entryList.push(pl[plId].items[i].id);}pl[plId].content=entryList.join(',');}embedPlayer.kalturaPlaylistData=pl;delete(window.kalturaIframePackageData.playlistResult);}if(window.kalturaIframePackageData&&window.kalturaIframePackageData.entryResult){var entryResult=window.kalturaIframePackageData.entryResult;_this.handlePlayerData(embedPlayer,entryResult);var kpartnerid=embedPlayer.kpartnerid?embedPlayer.kpartnerid:"";if(this.isEmbedServicesEnabled(entryResult)||"_"+kpartnerid==playerRequest.widget_id||_this.kClient.getKs()){callback(entryResult);}else{this.kClient.forceKs(playerRequest.widget_id,function(ks){_this.kClient.setKs(ks);if(embedPlayer.playerConfig&&!embedPlayer.playerConfig.vars){embedPlayer.playerConfig.vars={};}embedPlayer.playerConfig.vars.ks=ks;callback(entryResult);},function(){mw.log("Error occur while trying to create widget KS");callback(entryResult);});}delete(window.kalturaIframePackageData.entryResult);return;}_this.kClient=mw.kApiEntryLoader(playerRequest,function(playerData){_this.handlePlayerData(embedPlayer,playerData);callback(playerData);});},handlePlayerError:function(embedPlayer,data){var errObj=null;if(data.meta&&data.meta.code=="INVALID_KS"){errObj=embedPlayer.getKalturaMsgObject("NO_KS");}if(data.meta&&(data.meta.status==1||data.meta.status==0)){errObj=embedPlayer.getKalturaMsgObject("ks-ENTRY_CONVERTING");}if(data.error){errObj=embedPlayer.getKalturaMsgObject('GENERIC_ERROR');errObj.message=data.error;if(data.contextData&&data.contextData.isScheduledNow===false){errObj=embedPlayer.getKalturaMsgObject("OUT_OF_SCHEDULING");}}if(errObj){embedPlayer.hideSpinner();embedPlayer.setError(errObj);}},handlePlayerData:function(embedPlayer,entryResult){if(entryResult.meta&&entryResult.meta.id){embedPlayer.kentryid=entryResult.meta.id;embedPlayer.kpartnerid=entryResult.meta.partnerId;}this.handlePlayerError(embedPlayer,entryResult);if(entryResult.entry&&entryResult.entry.manualProvider){mw.setConfig("manualProvider",true);}},getAccessControlStatus:function(ac,embedPlayer){if(ac.isCountryRestricted){return embedPlayer.getKalturaMsgObject('UNAUTHORIZED_COUNTRY');}if(ac.isScheduledNow===0){return embedPlayer.getKalturaMsgObject('OUT_OF_SCHEDULING');}if(ac.isIpAddressRestricted){return embedPlayer.getKalturaMsgObject('UNAUTHORIZED_IP_ADDRESS');}if(ac.isSessionRestricted&&ac.previewLength===-1){return embedPlayer.getKalturaMsgObject('NO_KS');}if(ac.isSiteRestricted){return embedPlayer.getKalturaMsgObject('UNAUTHORIZED_DOMAIN');}if(ac.isUserAgentRestricted){return embedPlayer.getKalturaMsgObject('USER_AGENT_RESTRICTED');}if(ac.accessControlActions&&ac.accessControlActions.length){var msgObj=embedPlayer.getKalturaMsgObject('GENERIC_ERROR');var err=false;$.each(ac.accessControlActions,function(){if(this.type==1){msgObj.message='';if(ac.accessControlMessages&&ac.accessControlMessages.length){$.each(ac.accessControlMessages,function(){msgObj.message+=this.value+'\n';err=true;});}else{msgObj=embedPlayer.getKalturaMsgObject('NO_KS');err=true;}}});if(err){return msgObj;}}return true;},getUiConfId:function(embedPlayer){return embedPlayer.kuiconfid;},checkForUrlEntryId:function(embedPlayer){if(embedPlayer.kentryid&&typeof embedPlayer.kentryid=='string'&&embedPlayer.kentryid.indexOf('://')!=-1){embedPlayer.mediaElement.tryAddSource($('<source />').attr({'src':embedPlayer.kentryid}).get(0));return true;}return false;},addSources:function(embedPlayer,sources){$.each(sources,function(inx,source){embedPlayer.mediaElement.tryAddSource($('<source />').attr(source).get(0));});},addFlavorSources:function(embedPlayer,playerData){var _this=this;var sources=embedPlayer.mediaElement.getSources();if(sources[0]&&sources[0]['data-flavorid']){return;}var flavorSources=_this.getEntryIdSourcesFromPlayerData(embedPlayer.kpartnerid,playerData);embedPlayer.kalturaFlavors=flavorSources;var preferedBitRate=embedPlayer.evaluate('{mediaProxy.preferedFlavorBR}');var flashvarsPlayMainfestParams=this.getPlayMainfestParams(embedPlayer);var qp='';for(var i=0;i<flavorSources.length;i++){var source=flavorSources[i];if(preferedBitRate&&source.type=='application/vnd.apple.mpegurl'){qp=(source.src.indexOf('?')===-1)?'?':'&';source.src=source.src+qp+'preferredBitrate='+preferedBitRate;}if(source['disableQueryString']){var mParams=this.getPlayMainfestParams(embedPlayer,true);if(mParams!=''){var index=source.src.lastIndexOf('/a.');source.src=source.src.substring(0,index)+'/'+mParams+source.src.substring(index);}}else{qp=(source.src.indexOf('?')===-1)?'?':'&';source.src=source.src+qp+flashvarsPlayMainfestParams;}mw.log('KWidgetSupport:: addSource::'+embedPlayer.id+' : '+source.src+' type: '+source.type);var sourceElm=$('<source />').attr(source).get(0);embedPlayer.mediaElement.tryAddSource(sourceElm);}},getPlayMainfestParams:function(embedPlayer,disableQueryString){var p='';var and='';var equalDelimiter='=';var andDelimiter='&';if(disableQueryString){andDelimiter=equalDelimiter='/';}var urlParms=["deliveryCode","storageId","maxBitrate","playbackContext","seekFrom","clipTo"];$.each(urlParms,function(inx,param){if(embedPlayer.getFlashvars(param)){p+=and+param+equalDelimiter+embedPlayer.getFlashvars(param);and=andDelimiter;}});p+=and+'uiConfId'+equalDelimiter+embedPlayer.kuiconfid;return p;},getHostPageUrl:function(){var hostUrl=(mw.getConfig('EmbedPlayer.IframeParentUrl'))?mw.getConfig('EmbedPlayer.IframeParentUrl'):(document.referrer||document.URL);if(hostUrl.indexOf("#")!==-1){hostUrl=hostUrl.substr(0,hostUrl.indexOf("#"));}hostUrl=hostUrl.substr(0,hostUrl.indexOf("/",8));return hostUrl;},getBaseFlavorUrl:function(partnerId){if(mw.getConfig('Kaltura.UseManifestUrls')){return mw.getConfig('Kaltura.ServiceUrl')+'/p/'+partnerId+'/sp/'+partnerId+'00/playManifest';}else{return mw.getConfig('Kaltura.CdnUrl')+'/p/'+partnerId+'/sp/'+partnerId+'00/flvclipper';}},getEntryIdSourcesFromPlayerData:function(partnerId,playerData){var _this=this;if(!playerData.contextData||(playerData.contextData&&!playerData.contextData.flavorAssets)){mw.log("Error: KWidgetSupport: contextData.flavorAssets is not defined ");return;}var flavorData=playerData.contextData.flavorAssets;var flavorDrmData=this.getFlavorAssetsDrmData(playerData);var protocol=mw.getConfig('Kaltura.Protocol');if(!protocol){protocol=window.location.protocol.replace(':','');}var deviceSources=[];var ipadAdaptiveFlavors=[];var iphoneAdaptiveFlavors=[];var androidNativeAdaptiveFlavors=[];var dashAdaptiveFlavors=[];var flavorUrl=_this.getBaseFlavorUrl(partnerId);var hasH264Flavor=false;var hasIsmFlavor=false;for(var i=0;i<flavorData.length;i++){var asset=flavorData[i];var sourceAspect=Math.round((asset.width/asset.height)*100)/100
var source={'data-sizebytes':asset.size*1024,'data-bandwidth':asset.bitrate*1024,'data-width':asset.width,'data-height':asset.height,'data-aspect':sourceAspect,'data-tags':asset.tags,'data-assetid':asset.id};var tags=asset.tags.toLowerCase().split(',');if(asset.status!=2){if(asset.status==4){source.error='not-ready-transcoding';mw.log("KWidgetSupport:: Skip sources that are not ready: "+asset.id+' '+asset.tags);}continue;}if(mw.getConfig('Kaltura.UseManifestUrls')){var src=flavorUrl+'/entryId/'+asset.entryId;if(mw.getConfig('Kaltura.UseAppleAdaptive')&&$.inArray('applembr',tags)!=-1){src+='/format/applehttp/protocol/'+protocol+'/a.m3u8';deviceSources.push({'data-aspect':sourceAspect,'data-flavorid':'AppleMBR','type':'application/vnd.apple.mpegurl','src':src});continue;}else{src+='/flavorId/'+asset.id+'/format/url/protocol/'+protocol;}}else{mw.log("Error: KWidgetSupport: non-manifest urls are deprecated");var src=flavorUrl+'/entry_id/'+asset.entryId+'/flavor/'+asset.id;}if($.inArray('ipad',tags)!=-1){source['src']=src+'/a.mp4';source['data-flavorid']='iPad';source['type']='video/mp4; codecs="avc1.42E01E, mp4a.40.2';hasH264Flavor=true;}if($.inArray('iphone',tags)!=-1){source['src']=src+'/a.mp4';source['data-flavorid']='iPhone';source['type']='video/mp4; codecs="avc1.42E01E, mp4a.40.2';hasH264Flavor=true;}if(($.inArray('mbr',tags)!=-1||$.inArray('web',tags)!=-1)&&$.isEmptyObject(source['src'])&&!mw.isMobileDevice()&&asset.fileExt){if(asset.fileExt.toLowerCase()=='mp4'){source['src']=src+'/a.mp4';source['type']='video/mp4; codecs="avc1.42E01E, mp4a.40.2';hasH264Flavor=true;}else if(asset.fileExt.toLowerCase()=='flv'){source['src']=src+'/a.flv';source['type']='video/x-flv';}}if(asset.fileExt&&(asset.fileExt.toLowerCase()=='ogg'||asset.fileExt.toLowerCase()=='ogv'||(asset.containerFormat&&asset.containerFormat.toLowerCase()=='ogg'))){source['src']=src+'/a.ogg';source['data-flavorid']='ogg';source['type']='video/ogg';}if(asset.fileExt&&asset.containerFormat&&(asset.fileExt=='webm'||$.inArray('webm',tags)!=-1||(asset.containerFormat.toLowerCase()=='webm'))){source['src']=src+'/a.webm';source['data-flavorid']='webm';source['type']='video/webm; codecs="vp8, vorbis';}if(asset.fileExt&&asset.fileExt=='mov'){source['src']=src+'/a.mov';source['data-flavorid']='mov';source['type']='video/mp4';}if(asset.fileExt&&asset.fileExt=='3gp'){source['src']=src+'/a.3gp';source['data-flavorid']='3gp';source['type']='video/3gp';}if(asset.fileExt&&asset.fileExt=='mp3'){source['src']=src+'/a.mp3';source['data-flavorid']='mp3';source['type']='audio/mp3';}if(asset.fileExt&&asset.fileExt=='wvm'){source['src']=src+'/a.wvm';source['data-flavorid']='wvm';source['type']='video/wvm';source['disableQueryString']=true;}if(asset.tags&&asset.tags=='kontiki'){source['src']=src+'/a.mp4';source['data-flavorid']='kontiki';source['type']='video/kontiki';}if(asset.tags&&asset.tags.indexOf('ism_manifest')!=-1){src=src.replace("/format/url/","/format/sl/");source['src']=src+'/a.ism';source['data-flavorid']='ism';if(asset.tags.indexOf('playready')!=-1){source['type']='video/playreadySmooth';}else{source['type']='video/ism';}hasIsmFlavor=true;}var assetDrmData=this.getFlavorAssetDrmData(asset.id,flavorDrmData);$.extend(source,assetDrmData);if(source['src']){deviceSources.push(source);}if(navigator.userAgent.indexOf('Android')!==-1&&asset.width==0&&asset.height==0){continue;}if($.inArray('ipadnew',tags)!=-1){ipadAdaptiveFlavors.push(asset.id);}if($.inArray('iphonenew',tags)!=-1){ipadAdaptiveFlavors.push(asset.id);iphoneAdaptiveFlavors.push(asset.id);}if($.inArray('h264b',tags)!=-1){androidNativeAdaptiveFlavors.push(asset.id);}if($.inArray('dash',tags)!=-1){dashAdaptiveFlavors.push(asset.id);}}for(var i=0;i<deviceSources.length;i++){var source=deviceSources[i];if(!this.isValidAspect(source['data-aspect'])){source['data-aspect']=this.getValidAspect(deviceSources);}}if(mw.getConfig('Kaltura.UseFlavorIdsUrls')&&mw.getConfig('Kaltura.UseAppleAdaptive')&&$.grep(deviceSources,function(a){if(a['data-flavorid']=='AppleMBR'){return true;}}).length==0){var addedHlsStream=false;if(iphoneAdaptiveFlavors.length||ipadAdaptiveFlavors.length||androidNativeAdaptiveFlavors.length){var validClipAspect=this.getValidAspect(deviceSources);var lowResolutionDevice=(mw.isMobileDevice()&&mw.isDeviceLessThan480P()&&iphoneAdaptiveFlavors.length);var targetFlavors;if(mw.getConfig('Kaltura.ForceHighResFlavors')){mw.log('KWidgetSupport::Forcing High resolution flavours');if(ipadAdaptiveFlavors.length||dashAdaptiveFlavors.length){mw.log('KWidgetSupport::High resolution flavours found');targetFlavors=ipadAdaptiveFlavors;if(dashAdaptiveFlavors.length){targetFlavors=targetFlavors.concat(dashAdaptiveFlavors);for(var i=0;i<targetFlavors.length;++i){for(var j=i+1;j<targetFlavors.length;++j){if(targetFlavors[i]===targetFlavors[j])targetFlavors.splice(j--,1);}}}}else{mw.log('KWidgetSupport::High resolution flavours not found - will use low resolution flavours');targetFlavors=iphoneAdaptiveFlavors;}}else{if(androidNativeAdaptiveFlavors.length&&mw.isNativeApp()&&mw.isAndroid()){targetFlavors=androidNativeAdaptiveFlavors;}else if(lowResolutionDevice){targetFlavors=iphoneAdaptiveFlavors;}else if(mw.isMobileDevice()||dashAdaptiveFlavors.length==0){targetFlavors=ipadAdaptiveFlavors;}else{targetFlavors=dashAdaptiveFlavors;}}var assetId=targetFlavors[0];var hlsSource=this.generateAbrSource({entryId:asset.entryId,flavorUrl:flavorUrl,flavorId:(lowResolutionDevice?'iPhoneNew':'iPadNew'),type:'application/vnd.apple.mpegurl',flavors:targetFlavors,format:"applehttp",ext:"m3u8",protocol:protocol,clipAspect:validClipAspect});this.attachFlavorAssetDrmData(hlsSource,targetFlavors[0],flavorDrmData);hlsSource.fpsCertificate=this.getFairplayCert(playerData);deviceSources.push(hlsSource);addedHlsStream=true;}}if(mw.getConfig('Kaltura.UseFlavorIdsUrls')){var validClipAspect=this.getValidAspect(deviceSources);if(dashAdaptiveFlavors.length){var dashSource=this.generateAbrSource({entryId:asset.entryId,flavorUrl:flavorUrl,flavorId:'mpd',type:'application/dash+xml',flavors:dashAdaptiveFlavors,format:"mpegdash",ext:"mpd",protocol:protocol,clipAspect:validClipAspect});this.attachFlavorAssetDrmData(dashSource,dashAdaptiveFlavors[0],flavorDrmData);deviceSources.push(dashSource);}if((iphoneAdaptiveFlavors.length||ipadAdaptiveFlavors.length)&&this.getSourcesByAttribute(deviceSources,"type","video/playreadySmooth").length===0&&!$.isEmptyObject(flavorDrmData)){var targetFlavors=ipadAdaptiveFlavors.length?ipadAdaptiveFlavors:iphoneAdaptiveFlavors;var assetId=targetFlavors[0];var ismSource=this.generateAbrSource({entryId:asset.entryId,flavorUrl:flavorUrl,flavorId:"ism",type:'video/playreadySmooth',flavors:targetFlavors,format:"sl",ext:"ism",protocol:protocol,clipAspect:validClipAspect});this.attachFlavorAssetDrmData(ismSource,assetId,flavorDrmData);deviceSources.push(ismSource);}}this.removedAdaptiveFlavors=false;if(playerData.meta.duration<10){deviceSources=this.removeAdaptiveFlavors(deviceSources);}if(!this.removedAdaptiveFlavors&&mw.getConfig('playlistAPI.kpl0Url')&&playerData.meta&&playerData.meta.mediaType==5){deviceSources=this.removeAdaptiveFlavors(deviceSources);}if(!this.removedAdaptiveFlavors&&(mw.isAndroid()&&!mw.isNativeApp())&&hasH264Flavor&&!mw.getConfig('Kaltura.LeadHLSOnAndroid')){deviceSources=this.removeHlsFlavor(deviceSources);}if(mw.isWindowsPhone()){deviceSources=this.removeAdaptiveFlavors(deviceSources);}if(mw.supportsFlash()&&this.originalStreamerType&&this.originalStreamerType!=="hls"&&mw.getConfig("LeadWithHLSOnFlash")===null){deviceSources=this.removeHlsFlavor(deviceSources);}var ks=this.kClient.getKs();var ksStr='';var ksQueryString='';if(ks){var manifestKs=_this.fixPlaymanifestParam(ks);ksStr='/ks/'+manifestKs;ksQueryString='&ks='+manifestKs;}var referrer=_this.fixPlaymanifestParam(base64_encode(_this.getHostPageUrl()));var nativeVersion=mw.getConfig("nativeVersion");nativeVersion=(nativeVersion!=null&&nativeVersion.length>0)?'_'+nativeVersion:'';var clientTag='html5:v'+window['MWEMBED_VERSION']+nativeVersion;$.each(deviceSources,function(inx,source){if(deviceSources[inx]['disableQueryString']==true){var index=deviceSources[inx]['src'].lastIndexOf('/a.');deviceSources[inx]['src']=deviceSources[inx]['src'].substring(0,index)+ksStr+'/referrer/'+referrer+'/clientTag/'+clientTag+'/playSessionId/'+_this.getGUID()+deviceSources[inx]['src'].substring(index);}else{deviceSources[inx]['src']=deviceSources[inx]['src']+'?referrer='+referrer+ksQueryString+'&playSessionId='+_this.getGUID()+'&clientTag='+clientTag;}});return deviceSources;},generateAbrSource:function(options){var flavorsString=options.flavors.join(',');var dashSource={'data-aspect':options.clipAspect,'data-flavorid':options.flavorId,'type':options.type,'src':options.flavorUrl+'/entryId/'+options.entryId+'/flavorIds/'+flavorsString+'/format/'+options.format+'/protocol/'+options.protocol+'/a.'+options.ext,'flavors':flavorsString};return dashSource;},attachFlavorAssetDrmData:function(source,assetId,flavorDrmData){var assetDrmData=this.getFlavorAssetDrmData(assetId,flavorDrmData);$.extend(source,assetDrmData);return source;},getFairplayCert:function(playerData){var publicCertificate=null;if(playerData&&playerData.contextData&&playerData.contextData.pluginData&&playerData.contextData.pluginData.KalturaFairplayEntryContextPluginData&&playerData.contextData.pluginData.KalturaFairplayEntryContextPluginData.publicCertificate){publicCertificate=playerData.contextData.pluginData.KalturaFairplayEntryContextPluginData.publicCertificate;}return publicCertificate;},getFlavorAssetsDrmData:function(playerData){var flavorDrmData={};if(playerData.contextData.pluginData&&playerData.contextData.pluginData.KalturaDrmEntryContextPluginData&&playerData.contextData.pluginData.KalturaDrmEntryContextPluginData.flavorData){flavorDrmData=playerData.contextData.pluginData.KalturaDrmEntryContextPluginData.flavorData;}return flavorDrmData;},getFlavorAssetDrmData:function(id,flavorDrmData){var assetDrmData=flavorDrmData&&flavorDrmData[id];var drmData={};if(assetDrmData){drmData.custom_data=assetDrmData.custom_data;drmData.signature=assetDrmData.signature;drmData.contentId=assetDrmData.contentId;}return drmData;},getSourcesByAttribute:function(source,attribute,value){return $.grep(source,function(a){if(a[attribute]==value){return true;}});},fixPlaymanifestParam:function(value){return value.replace(/\+/g,"-").replace(/\//g,"_");},removeAdaptiveFlavors:function(sources){this.removeHlsFlavor(sources);this.removeDashFlavor(sources);this.removedAdaptiveFlavors=true;return sources;},removeHlsFlavor:function(sources){for(var i=0;i<sources.length;i++){if(sources[i].type=='application/vnd.apple.mpegurl'){sources.splice(i,1);i--;}}return sources;},removeDashFlavor:function(sources){for(var i=0;i<sources.length;i++){if(sources[i].type=="application/dash+xml"){sources.splice(i,1);i--;}}return sources;},getValidAspect:function(sources){var _this=this;for(var i=0;i<sources.length;i++){var source=sources[i];var aspect=source['data-aspect'];if(this.isValidAspect(aspect)){return aspect;}}var aspectParts=mw.getConfig('EmbedPlayer.DefaultSize').split('x');return Math.round((aspectParts[0]/aspectParts[1])*100)/100;},addLiveEntrySource:function(embedPlayer,entry,streamType,streamerType){var _this=this;var extension;var mimeType;var format=streamerType;var protocol;switch(streamType){case"flash":extension='f4m';embedPlayer.setFlashvars('streamerType',streamerType);protocol='rtmp';if(embedPlayer.kalturaContextData){protocol=embedPlayer.kalturaContextData.mediaProtocol;}mimeType='video/live';break;case"silverlightMulticast":extension='f4m';protocol='http';mimeType='video/multicast';break;case"silverlight":extension='manifest';protocol='http';mimeType='video/playreadySmooth';break;case"hls":embedPlayer.setFlashvars('streamerType','http');extension='m3u8';protocol=mw.getConfig('Kaltura.Protocol');if(!protocol){protocol=window.location.protocol.replace(':','');}mimeType='application/vnd.apple.mpegurl';break;case"dash":embedPlayer.setFlashvars('streamerType','http');extension='mpd';protocol=mw.getConfig('Kaltura.Protocol');if(!protocol){protocol=window.location.protocol.replace(':','');}mimeType='application/dash+xml';break;}var srcUrl=this.getBaseFlavorUrl(entry.partnerId)+'/entryId/'+entry.id+'/format/'+format+'/protocol/'+protocol+'/uiConfId/'+embedPlayer.kuiconfid+'/a.'+extension;srcUrl+='?referrer='+base64_encode(_this.getHostPageUrl())+'&playSessionId='+_this.getGUID();var deferred=$.Deferred();var ks=_this.kClient.getKs();if(ks){srcUrl+='&ks='+ks;}mw.log('KWidgetSupport::addLiveEntrySource: Add Live Entry Source - '+srcUrl);var liveSource=embedPlayer.mediaElement.tryAddSource($('<source />').attr({'src':srcUrl,'type':mimeType})[0]);return liveSource;},isValidAspect:function(aspect){return!isNaN(aspect)&&isFinite(aspect);},generateGUID:function(){var S4=function(){return(((1+Math.random())*0x10000)|0).toString(16).substring(1);};return(S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4());},getGUID:function(){if(!this.kSessionId){this.kSessionId=this.generateGUID();}return this.kSessionId;},getKalturaThumbnailUrl:function(thumb){if(!thumb.url){return mw.getConfig('EmbedPlayer.BlackPixel');}var thumbUrl=thumb.url;if(thumbUrl.indexOf("thumbnail/entry_id")!=-1){if(mw.getConfig('EmbedPlayer.ShowOriginalPoster')){thumbUrl+='/width/0/height/0';}else{thumbUrl+='/width/'+thumb.width+'/height/'+thumb.height;}}return thumbUrl;},getFunctionByName:function(functionName,context){try{var args=Array.prototype.slice.call(arguments).splice(2);var namespaces=functionName.split(".");var func=namespaces.pop();for(var i=0;i<namespaces.length;i++){context=context[namespaces[i]];}return context[func];}catch(e){mw.log("kWidgetSupport::executeFunctionByName: Error could not find function: "+functionName+' error: '+e);return false;}}};if(!window.kWidgetSupport){window.kWidgetSupport=new mw.KWidgetSupport();}mw.getEntryIdSourcesFromApi=function(embedPlayer,entryId,callback){kWidgetSupport.getEntryIdSourcesFromApi(embedPlayer,entryId,callback);};})(window.mw,jQuery);;},{},{"ks-CLIP_NOT_FOUND":"An error was experienced when playing the video. Please check your Internet connection and try again.","ks-CLIP_NOT_FOUND_TITLE":"Sorry, clip not found","ks-ENTRY_CONVERTING":"Media is currently being converted, please try again in a few minutes.","ks-ENTRY_CONVERTING_TITLE":"Entry is converting","ks-ENTRY_DELETED":"We're sorry, this content is no longer available.","ks-ENTRY_DELETED_TITLE":"Entry is deleted ","ks-ENTRY_IMPORTING":"Media is currently being converted, please try again in a few minutes.","ks-ENTRY_IMPORTING_TITLE":"Entry is converting","ks-ENTRY_MODERATE":"Media is awaiting moderation","ks-ENTRY_MODERATE_TITLE":"Entry is awaiting moderation","ks-ENTRY_PENDING":"Free preview completed, need to purchase ","ks-ENTRY_PENDING_TITLE":"Free preview completed, need to purchase ","ks-ENTRY_PRECONVERT":"Media is currently being converted, please try again in a few minutes.","ks-ENTRY_PRECONVERT_TITLE":"Entry is converting","ks-ENTRY_REJECTED":"We're sorry, this content was removed","ks-ENTRY_REJECTED_TITLE":"Entry is rejected","ks-ERROR_PROCESSING_MEDIA":"There was an error processing this media.","ks-ERROR_PROCESSING_MEDIA_TITLE":"Error processing media ","ks-FREE_PREVIEW_END":"Access to the rest of the content is restricted.","ks-FREE_PREVIEW_END_TITLE":"Free preview completed, need to purchase ","ks-GENERIC_ERROR":"An internal error has occurred","ks-GENERIC_ERROR_TITLE":"Error","ks-NO_KS":"We're sorry, access to this content is restricted. ","ks-NO_KS_TITLE":"No KS where KS is required ","ks-NO_MIX_PLUGIN":"In order to view mix entry, you must add the mix plugin to the uiconf xml","ks-NO_MIX_PLUGIN_TITLE":"No Mix Plugin","ks-OUT_OF_SCHEDULING":"We're sorry, this content is currently unavailable.","ks-OUT_OF_SCHEDULING_TITLE":"Out of scheduling  ","ks-SERVICE_ERROR":"Service error","ks-SERVICE_GET_ENTRY_ERROR":"Error in Get Entry","ks-SERVICE_GET_EXTRA_ERROR":"Error in get base entry extra data","ks-SERVICE_GET_EXTRA_ERROR_TITLE":"Error Get Extra Data","ks-SERVICE_GET_FLAVORS_ERROR":"Error in Get Flavors","ks-SERVICE_GET_UICONF_ERROR":"Error in Get Uiconf","ks-SERVICE_GET_WIDGET_ERROR":"Error in Get Widget","ks-SERVICE_START_WIDGET_ERROR":"Error in Start Widget Session","ks-UNAUTHORIZED_COUNTRY":"We're sorry, this content is only available in certain countries.","ks-UNAUTHORIZED_COUNTRY_TITLE":"Unauthorized country","ks-UNAUTHORIZED_DOMAIN":"We're sorry, this content is only available on certain domains.","ks-UNAUTHORIZED_DOMAIN_TITLE":"Unauthorized domain","ks-UNAUTHORIZED_IP_ADDRESS":"We're sorry, this content is only available for certain IP addresses.","ks-UNAUTHORIZED_IP_ADDRESS_TITLE":"Unauthorized IP address","ks-UNKNOWN_STATUS":"Unknown status","ks-UNKNOWN_STATUS_TITLE":"Unknown status","ks-USER_AGENT_RESTRICTED":"User Agent Restricted\nWe're sorry, this content is not available for your device.","ks-LIVE-STREAM-NOT-SUPPORTED":"Your browser does not support Live stream playback.","ks-LIVE-STREAM-OFFLINE-TITLE":"Currently not broadcasting","ks-LIVE-STREAM-OFFLINE":"video will play once broadcasting starts","ks-FLASH-REQUIRED":"This video requires Adobe Flash Player, which is currently not available on your browser. Please <a href='http:\/\/www.adobe.com\/support\/flashplayer\/downloads.html' target='_blank'> install Adobe Flash Player <\/a> to view this video.","ks-NO-DRM-LICENSE":"We're sorry, you don\u2019t have a valid license for this video.","ks-ERROR":"Error","ks-LIVE-STREAM-NOT-AVAILABLE":"Live stream is not available","ks-adBlockDetector-title":"Ad Block Detected","ks-adBlockDetector-message":"Ad Block Detected, Please disable ad block in order to watch content","ks-adBlockDetector-btn-ok":"OK","ks-adBlockDetector-btn-no":"NO","ks-adBlockDetector-btn-cancel":"Cancel","ks-adBlockDetector-btn-close":"Close","ks-adBlockDetector-btn-resume":"Continue","ks-chapters-search-placeholder":"Search","ks-chapters-search-clear":"Clear","ks-chapters-search-empty-result":"Sorry, no results were found","ks-chapters-locate-active-media":"Locate current slide","ks-chapters-toggle-chapter":"Expand\/collapse chapter","ks-chapters-toggle-all-chapter":"Expand\/collapse all chapters","ks-chapters-chapterNumber":"Chapter number","ks-chapters-chapter-start-time":"Chapter start time","ks-chapters-chapter-duration":"Chapter duration","ks-chapters-slideNumber":"Slide number","ks-chapters-slide-start-time":"Slide start time","ks-chapters-slide-duration":"Slide duration","ks-sidebar-toggleBtn":"Navigation","ks-FLASH-BLOCKED-TITLE":"Flash is not active","ks-FLASH-BLOCKED":"Flash does not appear to be installed or active.<br>Please <a href='http:\/\/get.adobe.com\/flashplayer\/' target='_blank'>install<\/a> or <a href='http:\/\/knowledge.kaltura.com\/faq\/how-activate-flash-safari-desktop' target='_blank'>activate<\/a> flash","ks-PLUGIN-BLOCKED-TITLE":"Microsoft Silverlight is not active","ks-PLUGIN-BLOCKED":"Silverlight plug-in does not appear to be active.<br>Please <a href='http:\/\/knowledge.kaltura.com\/faq\/how-activate-silverlight-safari-desktop' target='_blank'>activate<\/a> Microsoft Silverlight","ks-DUAL-SCREEN-SBS":"Side By Side","ks-DUAL-SCREEN-HIDE":"Single View","ks-DUAL-SCREEN-PIP":"Picture In Picture","ks-DUAL-SCREEN-SWITCH":"Toggle View","ks-MODERATION-CANCEL":"Cancel","ks-MODERATION-SUBMIT":"Submit report","ks-MODERATION-SUBMIT-BTN":"Submit","ks-MODERATION-THANKS":"Thank you for sharing your concerns","ks-MODERATION-DONE":"Done","ks-MODERATION-HEADER":"Report","ks-MODERATION-TEXT":"Please describe your concerns about this video.","ks-MODERATION-PLACEHOLDER":"Anything else to add?","ks-MODERATION-REPORT":"Report this video","ks-MODERATION-REASON-SEX":"Sexual Content","ks-MODERATION-REASON-VIOLENCE":"Violent Or Repulsive","ks-MODERATION-REASON-HARMFUL":"Harmful Or Dangerous Act","ks-MODERATION-REASON-SPAM":"Spam \/ Commercials"});mw.loader.implement("mw.KalturaIframePlayerSetup",function($){(function(mw,$,playerData){"use strict";function resolvePlayerConfig(serverSettings,clientSettings){var resolvedSettings=jQuery.extend(true,{},serverSettings);if(serverSettings.vars["inlineScript"]&&(clientSettings!==null)){var clientFlashvars=clientSettings.flashvars;var clientPlugins={};var clientVars={};$.each(clientFlashvars,function(name,value){if($.isPlainObject(value)){clientPlugins[name]=value;}else{clientVars[name]=value;}});if(serverSettings&&serverSettings.uiVars){var resolvedVars=resolvedSettings.vars;var serverUiVars=serverSettings.uiVars;$.each(serverUiVars,function(i,serverUiVar){var name=serverUiVar.key;if(clientVars[name]&&!serverUiVar.overrideFlashvar){resolvedVars[name]=clientVars[name];}});$.each(clientVars,function(name,value){if(!resolvedVars[name]){resolvedVars[name]=value;}});}$.extend(true,resolvedSettings.plugins,clientPlugins);}return resolvedSettings;}try{if(window['parent']&&window['parent']['kWidget']&&window!==window['parent']){mw.config.set('EmbedPlayer.IsFriendlyIframe',true);}else{mw.config.set('EmbedPlayer.IsFriendlyIframe',false);}}catch(e){mw.config.set('EmbedPlayer.IsFriendlyIframe',false);}if(mw.config.get('EmbedPlayer.IsFriendlyIframe')){try{if(window['parent']&&window['parent']['preMwEmbedConfig']){mw.config.set(window['parent']['preMwEmbedConfig']);mw.config.set('EmbedPlayer.IframeParentUrl',document.URL.replace(/#.*/,''));}}catch(e){}}else{try{var hashString=window.location.hash;if(hashString){var hashObj=JSON.parse(decodeURIComponent(hashString.replace(/^#/,'')));if(hashObj&&hashObj.mwConfig){mw.config.set(hashObj.mwConfig);}}}catch(e){kWidget.log("KalturaIframePlayerSetup, could not get configuration ");}}var serverSettings=playerData['playerConfig'];var clientSettings=mw.getConfig("widgetOriginalSettings_"+playerData.playerId);var playerConfig=resolvePlayerConfig(serverSettings,clientSettings);mw.config.set('KalturaSupport.PlayerConfig',playerConfig);mw.config.set('Kaltura.IframeRewrite',false);mw.config.set('Mw.LogPrepend','iframe:');mw.config.set('Kaltura.LoadScriptForVideoTags',false);mw.config.set('EmbedPlayer.WaitForMeta',false);mw.config.set('EmbedPlayer.IframeParentPlayerId',playerData['playerId']);mw.config.set(playerData['enviornmentConfig']);if(mw.config.get('EmbedPlayer.IsFullscreenIframe')){mw.config.set('EmbedPlayer.EnableFullscreen',false);}else{if(mw.config.get('EmbedPlayer.IframeParentUrl')===null&&!mw.config.get('EmbedPlayer.ForceNativeComponent')){mw.config.set('EmbedPlayer.NewWindowFullscreen',true);mw.config.set('EmbedPlayer.EnableIpadNativeFullscreen',true);}}var removeElement=function(elemId){if(document.getElementById(elemId)){try{var el=document.getElementById(elemId);el.parentNode.removeChild(el);}catch(e){}}};if(kWidget.isUiConfIdHTML5(playerData.playerConfig.uiConfId)||!(kWidget.supportsFlash()||mw.config.get('Kaltura.ForceFlashOnDesktop'))){removeElement('kaltura_player_iframe_no_rewrite');$('#'+playerData.playerId).embedPlayer(function(){$('#kaltura_player_iframe_no_rewrite').remove();var embedPlayer=$('#'+playerData.playerId)[0];if(mw.config.get('EmbedPlayer.IframeCurrentTime')){embedPlayer.currentTime=mw.config.get('EmbedPlayer.IframeCurrentTime');}if(mw.config.get('EmbedPlayer.IframeIsPlaying')){embedPlayer.play();}});}else{mw.log("Error: KalturaIframePlayer:: rendering flash player after loading html5 lib");}if(playerData.error){$('body').append($('<div />').attr('id','error').html(playerData.error));}})(window.mw,window.jQuery,window.kalturaIframePackageData);;},{},{});mw.loader.implement("mw.MediaElement",function($){(function(mw,$){"use strict";mw.MediaElement=function(element){this.init(element);};mw.MediaElement.prototype={sources:null,addedROEData:false,selectedSource:null,preferedFlavorBR:null,init:function(videoElement){var _this=this;mw.log("EmbedPlayer::mediaElement:init:"+videoElement.id);this.parentEmbedId=videoElement.id;this.sources=new Array();if(videoElement){var src=$(videoElement).attr("src");var found=false;if(src){$.each(mw.getConfig('Kaltura.BlackVideoSources'),function(inx,sourceAttr){if(src.indexOf(sourceAttr.src)!==-1){found=true;return false;}});if(!found){_this.tryAddSource(videoElement);}}$(videoElement).find('source,track').each(function(){_this.tryAddSource(this);});}},updateSourceTimes:function(startNpt,endNpt){var _this=this;$.each(this.sources,function(inx,mediaSource){mediaSource.updateSrcTime(startNpt,endNpt);});},getTextTracks:function(){var textTracks=[];$.each(this.sources,function(inx,source){if(source.nodeName=='track'||(source.mimeType&&source.mimeType.indexOf('text/')!==-1)){textTracks.push(source);}});return textTracks;},getSources:function(mimeFilter){if(!mimeFilter){return this.sources;}var source_set=new Array();for(var i=0;i<this.sources.length;i++){if(this.sources[i].mimeType&&this.sources[i].mimeType.indexOf(mimeFilter)!=-1){source_set.push(this.sources[i]);}}return source_set;},getSourceById:function(sourceId){for(var i=0;i<this.sources.length;i++){if(this.sources[i].id==sourceId){return this.sources[i];}}return null;},setSourceByIndex:function(index){mw.log('EmbedPlayer::mediaElement:selectSource: '+index);var playableSources=this.getPlayableSources();var oldSrc;if(this.selectedSource){oldSrc=this.selectedSource.getSrc();}for(var i=0;i<playableSources.length;i++){if(i==index){this.selectedSource=playableSources[i];break;}}if(!oldSrc||oldSrc!=this.selectedSource.getSrc()){$('#'+this.parentEmbedId).trigger('SourceChange');}},setSource:function(source){var oldSrc=this.selectedSource;this.selectedSource=source;if(!oldSrc||oldSrc.getSrc()!=source.getSrc()){$('#'+this.parentEmbedId).trigger('SourceChange');}return this.selectedSource;},autoSelectSource:function(options){if(!options){options={};}if(this.autoSelectSourceExecute(options)){var updatedDuration=0;if(options.supportsURLTimeEncoding&&!!options.endTime){updatedDuration=options.endTime;this.selectedSource.src=this.selectedSource.src.replace(/clipTo\/\d+\//,'');this.selectedSource.src=this.selectedSource.src.replace("playManifest/","playManifest/clipTo/"+parseInt(options.endTime)*1000+"/");}if(options.supportsURLTimeEncoding&&!!options.startTime){updatedDuration-=options.startTime;this.selectedSource.src=this.selectedSource.src.replace(/seekFrom\/\d+\//,'');this.selectedSource.src=this.selectedSource.src.replace("playManifest/","playManifest/seekFrom/"+parseInt(options.startTime)*1000+"/");}$('#'+this.parentEmbedId).trigger('SourceSelected',this.selectedSource);if(updatedDuration>0){try{$('#'+this.parentEmbedId)[0].setDuration(updatedDuration);}catch(e){$('#'+this.parentEmbedId).trigger('durationChange',updatedDuration);}}return this.selectedSource;}return false;},autoSelectSourceExecute:function(options){mw.log('EmbedPlayer::mediaElement::autoSelectSource');var _this=this;if(!options){options={};}var playableSources=options.sources||this.getPlayableSources();this.removeSourceFlavor(playableSources);var flash_flag=false,ogg_flag=false;this.selectedSource=null;if(playableSources.length==0){return false;}$('#'+this.parentEmbedId).trigger('onSelectSource',[playableSources]);if(_this.selectedSource){mw.log('MediaElement::autoSelectSource: Set via trigger::'+_this.selectedSource.getTitle());return _this.selectedSource;}var hasDefaultSource=false;$.each(playableSources,function(inx,source){if(source.markedDefault){mw.log('MediaElement::autoSelectSource: Set via marked default: '+source.markedDefault);hasDefaultSource=true;_this.setSource(source);return false;}});if(hasDefaultSource){return _this.selectedSource;}mw.setConfig('EmbedPlayer.IgnoreStreamerType',false);var typesToCheck=['application/dash+xml','video/playreadySmooth','video/ism','video/multicast','video/wvm'];for(var i=0;i<typesToCheck.length;i++){var matchingSources=this.getPlayableSources(typesToCheck[i],playableSources);if(matchingSources.length){mw.log('MediaElement::autoSelectSource: Set prefered mimeType flavor '+typesToCheck[i]);mw.setConfig('EmbedPlayer.IgnoreStreamerType',true);return _this.setSource(matchingSources[0]);}}var vndSources=this.getPlayableSources('application/vnd.apple.mpegurl',playableSources);this.removeSourceFlavor(vndSources);if(vndSources.length&&mw.EmbedTypes.getMediaPlayers().getMIMETypePlayers('application/vnd.apple.mpegurl').length){var desktopVdn,mobileVdn;$.each(vndSources,function(inx,source){if(source.getFlavorId()&&source.getFlavorId().toLowerCase()=='iphonenew'){mobileVdn=source;}else{desktopVdn=source;}});if((mw.isNativeApp()||mw.isIphone()||mw.isAndroid4andUp())&&mobileVdn){_this.setSource(mobileVdn);}else if(desktopVdn){_this.setSource(desktopVdn);}}if(this.selectedSource){mw.log('MediaElement::autoSelectSource: Set via Adaptive HLS: source flavor id:'+_this.selectedSource.getFlavorId()+' src: '+_this.selectedSource.getSrc());return this.selectedSource;}if($.cookie('EmbedPlayer.UserBandwidth')||this.preferedFlavorBR){var bandwidthDelta=999999999;var bandwidthTarget=$.cookie('EmbedPlayer.UserBandwidth')||this.preferedFlavorBR;$.each(playableSources,function(inx,source){if(source.bandwidth){if(Math.abs(source.bandwidth-bandwidthTarget)<bandwidthDelta){bandwidthDelta=Math.abs(source.bandwidth-bandwidthTarget);_this.setSource(source);}}});if(this.selectedSource){var setTypeName=($.cookie('EmbedPlayer.UserBandwidth'))?'cookie':'preferedFlavorBR'
mw.log('MediaElement::autoSelectSource: '+'Set via bandwidth, '+setTypeName+' source:'+this.selectedSource.bandwidth+' target: '+bandwidthTarget);return this.selectedSource;}}var nativePlayableSources=this.getNativePlayableSources(playableSources);this.removeSourceFlavor(nativePlayableSources);var namedSourceSet={};$.each(nativePlayableSources,function(inx,source){var mimeType=source.mimeType;var player=mw.EmbedTypes.getMediaPlayers().getNativePlayer(mimeType);switch(player.id){case'mp3Native':var shortName='mp3';break;case'oggNative':var shortName='ogg';break;case'webmNative':var shortName='webm';break;case'h264Native':var shortName='h264';break;case'appleVdn':var shortName='appleVdn';break;}if(!namedSourceSet[shortName]){namedSourceSet[shortName]=[];}namedSourceSet[shortName].push(source);});if(mw.isMobileDevice()&&namedSourceSet['h264']&&namedSourceSet['h264'].length){var minSize=99999999;$.each(namedSourceSet['h264'],function(inx,source){if(parseInt(source.width)<parseInt(minSize)&&parseInt(source.width)!=0){minSize=source.width;_this.setSource(source);}})}if(this.selectedSource){mw.log('MediaElement::autoSelectSource: mobileDevice; most compatible h.264 because of resolution:'+this.selectedSource.width);return this.selectedSource;}var codecPref=mw.getConfig('EmbedPlayer.CodecPreference');if(!$.isArray(codecPref)){codecPref=codecPref.split(",");}if(codecPref){for(var i=0;i<codecPref.length;i++){var codec=codecPref[i];if(!namedSourceSet[codec]){continue;}if(namedSourceSet[codec].length==1){mw.log('MediaElement::autoSelectSource: Set 1 source via EmbedPlayer.CodecPreference: '+namedSourceSet[codec][0].getTitle());return _this.setSource(namedSourceSet[codec][0]);}else if(namedSourceSet[codec].length>1){var minSizeDelta=null;if(this.parentEmbedId){var displayWidth=$('#'+this.parentEmbedId).width();$.each(namedSourceSet[codec],function(inx,source){if(parseInt(source.width)&&displayWidth){var sizeDelta=Math.abs(source.width-displayWidth);if(minSizeDelta==null||sizeDelta<minSizeDelta){minSizeDelta=sizeDelta;_this.setSource(source);}}});}if(this.selectedSource){mw.log('MediaElement::autoSelectSource: from  '+this.selectedSource.mimeType+' because of resolution:'+this.selectedSource.width+' close to: '+displayWidth);return this.selectedSource;}if(namedSourceSet[codec][0]){mw.log('MediaElement::autoSelectSource: first codec prefrence source');return _this.setSource(namedSourceSet[codec][0]);}}}}$.each(playableSources,function(inx,source){var mimeType=source.mimeType;var player=mw.EmbedTypes.getMediaPlayers().getDefaultPlayer(mimeType);if((mimeType=='video/mp4'||mimeType=='video/h264')&&player&&(player.library=='Native'||player.library=='Kplayer')){if(source){mw.log('MediaElement::autoSelectSource: Set h264 via native or flash fallback:'+source.getTitle());return _this.setSource(source);}}});if(this.selectedSource){mw.log('MediaElement::autoSelectSource: from  '+this.selectedSource.mimeType+' because of resolution:'+this.selectedSource.width+' close to: '+displayWidth);return this.selectedSource;}if(!this.selectedSource){for(var i=0;i<playableSources.length;i++){if(playableSources[i].tags&&playableSources[i].tags.indexOf("mbr")!==-1){return _this.setSource(playableSources[i]);}}}if(!this.selectedSource&&playableSources[0]){mw.log('MediaElement::autoSelectSource: Set via first source: '+playableSources[0].getTitle()+' mime: '+playableSources[0].getMIMEType());return _this.setSource(playableSources[0]);}mw.log('MediaElement::autoSelectSource: no match found');return false;},autoSelectNativeSource:function(){mw.log("MediaElement::autoSelectNativeSource");if(!this.selectedSource&&!this.autoSelectSource()){return false;}var player=mw.EmbedTypes.getMediaPlayers().getNativePlayer(this.selectedSource.mimeType);if(player){return this.selectedSource;}mw.log("MediaElement::autoSelectNativeSource: no native player found");return null;},isOgg:function(mimeType){if(mimeType=='video/ogg'||mimeType=='ogg/video'||mimeType=='video/annodex'||mimeType=='application/ogg'){return true;}return false;},getPosterSrc:function(){return this.poster;},hasStreamOfMIMEType:function(mimeType){for(var i=0;i<this.sources.length;i++){if(this.sources[i].getMIMEType()==mimeType){return true;}}return false;},getNativePlayableSources:function(sources){var playableSources=sources||this.getPlayableSources();var nativePlayableSources=[];$.each(playableSources,function(inx,source){var mimeType=source.mimeType;var player=mw.EmbedTypes.getMediaPlayers().getNativePlayer(mimeType);if(player&&player.library=='Native'){nativePlayableSources.push(source);}});return nativePlayableSources;},isPlayableType:function(mimeType){if(mw.EmbedTypes.getMediaPlayers().getDefaultPlayer(mimeType)){return true;}else{return false;}},tryAddSource:function(element){if(element instanceof mw.MediaSource){this.sources.push(element);return element;}var newSrc=$(element).attr('src');if(newSrc){for(var i=0;i<this.sources.length;i++){if(this.sources[i].src==newSrc){this.sources[i].updateSource(element);return this.sources[i];}}}var source=new mw.MediaSource(element);this.sources.push(source);if(element.nodeName&&element.nodeName.toLowerCase()==='track'){if(!mw.isIOS()||(mw.isIOS()&&!mw.getConfig('disableTrackElement'))){if(!mw.isIE8()){var $vid=$('#pid_'+this.parentEmbedId);if($vid.length){if(mw.isIphone()){$vid.attr('crossorigin','anonymous');}$vid.append(element);}}}}return source;},getPlayableSources:function(mimeFilter,sources){var playableSources=[];var sourcesList=sources||this.sources;for(var i=0;i<sourcesList.length;i++){if(this.isPlayableType(sourcesList[i].mimeType)&&(!mimeFilter||sourcesList[i].mimeType.indexOf(mimeFilter)!=-1)){playableSources.push(sourcesList[i]);}};mw.log("MediaElement::GetPlayableSources mimeFilter:"+mimeFilter+" "+playableSources.length+' sources playable out of '+sourcesList.length);return playableSources;},removeSourceFlavor:function(sources){if(sources.length>1){for(var i=sources.length-1;i>=0;i--){if(sources[i].tags&&sources[i].tags.indexOf("source")!==-1){sources.splice(i,1);}}}},getLicenseData:function(){var licenseData={custom_data:this.selectedSource["custom_data"],signature:this.selectedSource["signature"]};if(this.selectedSource.flavors){var base64encode=window.btoa?window.btoa:window.base64_encode;licenseData.files=encodeURIComponent(base64encode(this.selectedSource.flavors));}return licenseData;},getLicenseUriComponent:function(){var licenseData=this.getLicenseData();var licenseDataString="";if(licenseData){$.each(licenseData,function(key,val){if(val){licenseDataString+=key+"="+val+"&";}});}return licenseDataString;},getAuthenticationToken:function(){return this.selectedSource["contentId"];}};})(mediaWiki,jQuery);;},{},{});mw.loader.implement("mw.MediaPlayer",function($){(function(mw,$){"use strict";mw.MediaPlayer=function(id,supportedTypes,library){this.id=id;this.supportedTypes=supportedTypes;this.library=library;this.loaded=false;this.loading_callbacks=new Array();return this;};mw.MediaPlayer.prototype={id:null,supportedTypes:null,library:null,loaded:false,supportsMIMEType:function(type){for(var i=0;i<this.supportedTypes.length;i++){if(this.supportedTypes[i]==type)return true;}return false;},getName:function(){return gM('mwe-embedplayer-ogg-player-'+this.id);},load:function(callback){mw.load(['mw.EmbedPlayer'+this.library.substr(0,1).toUpperCase()+this.library.substr(1)],function(){if(callback){callback();}});}};})(mediaWiki,jQuery);;},{},{});mw.loader.implement("mw.MediaPlayers",function($){(function(mw,$){"use strict";mw.MediaPlayers=function(){this.init();};mw.MediaPlayers.prototype={players:null,preference:{},defaultPlayers:{},init:function(){this.players=new Array();this.loadPreferences();this.defaultPlayers['video/wvm']=['NativeComponent'];this.defaultPlayers['video/live']=['Kplayer'];this.defaultPlayers['video/kontiki']=['Kplayer'];this.defaultPlayers['video/x-flv']=['Kplayer','Vlc'];this.defaultPlayers['video/h264']=['NativeComponent','Native','Kplayer','Silverlight','Vlc'];this.defaultPlayers['video/mp4']=['NativeComponent','Native','Kplayer','Silverlight','Vlc'];this.defaultPlayers['application/vnd.apple.mpegurl']=['Native'];this.defaultPlayers['application/x-shockwave-flash']=['Kplayer'];this.defaultPlayers['video/ogg']=['Native','Vlc','Java','Generic'];this.defaultPlayers['video/webm']=['Native','Vlc'];this.defaultPlayers['application/ogg']=['Native','Vlc','Java','Generic'];this.defaultPlayers['audio/ogg']=['Native','Vlc','Java'];this.defaultPlayers['audio/mpeg']=['Native','Kplayer'];this.defaultPlayers['audio/mp3']=['Native','Kplayer'];this.defaultPlayers['video/mpeg']=['Vlc'];this.defaultPlayers['video/x-msvideo']=['Vlc'];this.defaultPlayers['video/multicast']=['Silverlight'];this.defaultPlayers['video/ism']=['Silverlight'];this.defaultPlayers['video/playreadySmooth']=['Silverlight'];this.defaultPlayers['image/jpeg']=['ImageOverlay'];this.defaultPlayers['image/png']=['ImageOverlay'];if(mw.getConfig("LeadWithHLSOnFlash")){this.defaultPlayers['application/vnd.apple.mpegurl'].push('Kplayer');}if(mw.getConfig("chromecastReceiver")){this.defaultPlayers['application/vnd.apple.mpegurl'].push('ChromecastReceiver');}if($.inArray('application/dash+xml',window.kNativeSdk&&window.kNativeSdk.allFormats)>=0){this.defaultPlayers['application/dash+xml']=['NativeComponent'];}if(window.kNativeSdk&&window.kNativeSdk.allFormats){if($.inArray('application/vnd.apple.mpegurl',window.kNativeSdk&&window.kNativeSdk.allFormats)>=0){this.defaultPlayers['application/vnd.apple.mpegurl']=['NativeComponent'];}}else{this.defaultPlayers['application/vnd.apple.mpegurl'].push('NativeComponent');}},addPlayer:function(player){for(var i=0;i<this.players.length;i++){if(this.players[i].id==player.id){return;}}this.players.push(player);},isSupportedPlayer:function(playerId){for(var i=0;i<this.players.length;i++){if(this.players[i].id==playerId){return true;}}return false;},getPlayerById:function(playerId){for(var i=0;i<this.players.length;i++){if(this.players[i].id.toLowerCase()==playerId.toLowerCase()){return this.players[i];}}return null;},getMIMETypePlayers:function(mimeType){var mimePlayers=new Array();var _this=this;if(this.defaultPlayers[mimeType]){$.each(this.defaultPlayers[mimeType],function(d,lib){var library=_this.defaultPlayers[mimeType][d];for(var i=0;i<_this.players.length;i++){if(_this.players[i].library==library&&_this.players[i].supportsMIMEType(mimeType)){mimePlayers.push(_this.players[i]);}}});}return mimePlayers;},setMIMETypePlayers:function(mimeType,playerName){if(this.defaultPlayers[mimeType]&&$.isArray(this.defaultPlayers[mimeType])){var contains=false;$.each(this.defaultPlayers[mimeType],function(index,name){if(name===playerName){contains=true;return false;}});if(!contains){this.defaultPlayers[mimeType].push(playerName);}}else{this.defaultPlayers[mimeType]=[playerName];}},removeMIMETypePlayers:function(mimeType,playerName){if(this.defaultPlayers[mimeType]&&$.isArray(this.defaultPlayers[mimeType])){var _this=this;$.each(this.defaultPlayers[mimeType],function(index,name){if(name===playerName){_this.defaultPlayers[mimeType].splice(index,1);return false;}});}},defaultPlayer:function(mimeType){mw.log("MediaPlayer:: defaultPlayer has been deprecated, use getDefaultPlayer method instead");return getDefaultPlayer(mimeType);},getDefaultPlayer:function(mimeType){var mimePlayers=this.getMIMETypePlayers(mimeType);if(mw.getConfig('chromecastReceiver')){return this.getPlayerById('chromecastReceiver');}if(mw.getConfig('EmbedPlayer.ForceNativeComponent')&&this.isSupportedPlayer('nativeComponentPlayer')){var nativeComponentPlayer=mw.EmbedTypes.getNativeComponentPlayerVideo();var imageOverlayPlayer=mw.EmbedTypes.getNativeImageOverlayPlayer();if(this.isPlayerSupportMimeType(mimePlayers,nativeComponentPlayer)){mimePlayers=[nativeComponentPlayer];}else if(imageOverlayPlayer.supportsMIMEType(mimeType)){mimePlayers=[imageOverlayPlayer];}else{mimePlayers=[];}}if((mw.getConfig('EmbedPlayer.ForceKPlayer')||(mw.getConfig('ForceFlashOnDesktopSafari')&&mw.isDesktopSafari()))&&this.isSupportedPlayer('kplayer')&&mimeType!=="video/youtube"){var kplayer=mw.EmbedTypes.getKplayer();if(this.isPlayerSupportMimeType(mimePlayers,kplayer)){mimePlayers=[kplayer];}else{mimePlayers=[];}}if(mw.getConfig('EmbedPlayer.ForceSPlayer')&&this.isSupportedPlayer('splayer')){var silverlightPlayer=mw.EmbedTypes.getSilverlightPlayer();if(this.isPlayerSupportMimeType(mimePlayers,silverlightPlayer)){mimePlayers=[silverlightPlayer];}else{mimePlayers=[];}}for(var i=0;i<mimePlayers.length;i++){if(mimePlayers[i].id==this.preference[mimeType]){mimePlayers=[mimePlayers[i]];break;}}if(mimePlayers[0]){return mimePlayers[0];}return null;},isPlayerSupportMimeType:function(mimePlayers,player){var playerSupported=mimePlayers.filter(function(mimePlayer){return mimePlayer.id===player.id;});return(playerSupported.length>0);},getNativePlayer:function(mimeType){var mimePlayers=this.getMIMETypePlayers(mimeType);for(var i=0;i<mimePlayers.length;i++){if(mimePlayers[i].library=='Native'){return mimePlayers[i];}}return null;},setFormatPreference:function(mimeFormat){this.preference['formatPreference']=mimeFormat;$.cookie('EmbedPlayer.Preference',JSON.stringify(this.preference));},loadPreferences:function(){this.preference={};if($.cookie('EmbedPlayer.Preference')){this.preference=JSON.parse($.cookie('EmbedPlayer.Preference'));}},setPlayerPreference:function(playerId,mimeType){var selectedPlayer=null;for(var i=0;i<this.players.length;i++){if(this.players[i].id==playerId){selectedPlayer=this.players[i];mw.log('EmbedPlayer::setPlayerPreference: choosing '+playerId+' for '+mimeType);this.preference[mimeType]=playerId;$.cookie('EmbedPlayer.Preference',JSON.stringify(this.preference));break;}}if(selectedPlayer){$('.mwEmbedPlayer').each(function(inx,playerTarget){var embedPlayer=$(playerTarget).get(0);if(embedPlayer.mediaElement.selectedSource&&(embedPlayer.mediaElement.selectedSource.mimeType==mimeType)){embedPlayer.selectPlayer(selectedPlayer);}});}}};})(mediaWiki,jQuery);;},{},{});mw.loader.implement("mw.MediaSource",function($){(function(mw,$){"use strict";mw.mergeConfig('EmbedPlayer.SourceAttributes',['id','src','title','URLTimeEncoding','nodeName','data-startoffset','data-durationhint','data-shorttitle','data-width','data-height','data-bandwidth','data-sizebytes','data-framerate','data-flavorid','data-aspect','data-tags','data-assetid','data-mwtitle','data-mwprovider','start','end','default','type','height','assetid','bandwidth','srclang','custom_data','signature','contentId','flavors','fpsCertificate']);mw.MediaSource=function(element){this.init(element);};mw.MediaSource.prototype={mimeType:null,uri:null,title:null,markedDefault:false,URLTimeEncoding:false,startOffset:0,duration:0,id:null,startNpt:null,endNpt:null,srclang:null,init:function(element){var _this=this;this.src=$(element).attr('src');var sourceAttr=mw.getConfig('EmbedPlayer.SourceAttributes');$.each(sourceAttr,function(inx,attr){if($(element).attr(attr)!==undefined){var attrName=(attr.indexOf('data-')===0)?attr.substr(5):attr
_this[attrName]=$(element).attr(attr);if(attrName=='default'){_this[attrName]=$(element).attr(attr)=="true"?true:false;}}});if(this.label){this.title=this.label;}if($(element).attr('type')){this.mimeType=$(element).attr('type');}else if($(element).attr('content-type')){this.mimeType=$(element).attr('content-type');}else if($(element)[0].tagName.toLowerCase()=='audio'){this.mimeType='audio/ogg';}else{this.mimeType=this.detectType(this.src);}if(this.mimeType=='video/theora'){this.mimeType='video/ogg';}if(this.mimeType=='audio/vorbis'){this.mimeType='audio/ogg';}if(this.mimeType){this.mimeType=this.mimeType.split(';')[0];}if($(element).parent().attr('category')){this.category=$(element).parent().attr('category');}if($(element).attr('default')){this.markedDefault=true;}this.getURLDuration();},updateSource:function(element){if($(element).attr("title")){this.title=$(element).attr("title");}},updateSrcTime:function(startNpt,endNpt){if(this.URLTimeEncoding){if(!mw.npt2seconds(startNpt)){startNpt=this.startNpt;}if(!mw.npt2seconds(endNpt)){endNpt=this.endNpt;}this.src=mw.replaceUrlParams(this.src,{'t':startNpt+'/'+endNpt});this.getURLDuration();}},setDuration:function(duration){this.duration=duration;if(!this.endNpt){this.endNpt=mw.seconds2npt(this.startOffset+duration);}},getMIMEType:function(){if(this.mimeType){return this.mimeType;}this.mimeType=this.detectType(this.src);return this.mimeType;},setSrc:function(src){this.src=src;},getSrc:function(){return this.src;},getTitle:function(){if(this.title){return this.title;}if(this.label){return this.label;}switch(this.getMIMEType()){case'video/h264':return gM('mwe-embedplayer-video-h264');break;case'video/x-flv':return gM('mwe-embedplayer-video-flv');break;case'video/webm':return gM('mwe-embedplayer-video-webm');break;case'video/ogg':return gM('mwe-embedplayer-video-ogg');break;case'audio/ogg':return gM('mwe-embedplayer-video-audio');break;case'audio/mpeg':return gM('mwe-embedplayer-audio-mpeg');break;case'video/3gp':return gM('mwe-embedplayer-video-3gp');break;case'video/mpeg':return gM('mwe-embedplayer-video-mpeg');break;case'video/x-msvideo':return gM('mwe-embedplayer-video-msvideo');break;}try{var fileName=new mw.Uri(mw.absoluteUrl(this.getSrc())).path.split('/').pop();if(fileName){return fileName;}}catch(e){}return this.mimeType;},getShortTitle:function(){var _this=this;if(this.shorttitle){return this.shorttitle;}var genTitle='';if(this.height){if(this.heigth<255){genTitle+='240P ';}else if(this.height<370){genTitle+='360P ';}else if(this.height<500){genTitle+='480P ';}else if(this.height<800){genTitle+='720P ';}else{genTitle+='1080P ';}}genTitle+=this.getTitle().replace('video','').replace('a.','');if(genTitle.length>20){genTitle=genTitle.substring(0,17)+"...";}if(this.getBitrate()){var bits=(Math.round(this.getBitrate()/1024*10)/10)+'';if(bits[0]=='0'){bits=bits.substring(1);}genTitle+=' '+bits+'Mbs ';}return genTitle},getURLDuration:function(){if(this.URLTimeEncoding){var annoURL=new mw.Uri(this.src);if(annoURL.query.t){var times=annoURL.query.t.split('/');this.startNpt=times[0];this.endNpt=times[1];this.startOffset=mw.npt2seconds(this.startNpt);this.duration=mw.npt2seconds(this.endNpt)-this.startOffset;}else{if(this.startOffset){this.startNpt=mw.seconds2npt(this.startOffset);}if(this.duration){this.endNpt=mw.seconds2npt(parseInt(this.duration)+parseInt(this.startOffset));}}}},getExt:function(uri){var urlParts=new mw.Uri(uri);var ext=(urlParts.file)?/[^.]+$/.exec(urlParts.file):/[^.]+$/.exec(uri);if(!ext){return'';}ext=/[^#]*/g.exec(ext.toString());return ext.toString().toLowerCase();},getFlavorId:function(){if(this.flavorid){return this.flavorid;}return;},detectType:function(uri){switch(this.getExt(uri)){case'smil':case'sml':return'application/smil';break;case'm4v':case'mp4':return'video/h264';break;case'm3u8':return'application/vnd.apple.mpegurl';break;case'webm':return'video/webm';break;case'3gp':return'video/3gp';break;case'srt':return'text/x-srt';break;case'vtt':return'text/vtt';break;case'flv':return'video/x-flv';break;case'ogg':case'ogv':return'video/ogg';break;case'oga':return'audio/ogg';break;case'mp3':return'audio/mpeg';break;case'anx':return'video/ogg';break;case'dfxp':case'xml':return'text/xml';break;case'avi':return'video/x-msvideo';break;case'mpg':return'video/mpeg';break;case'mpeg':return'video/mpeg';break;}mw.log("Error: could not detect type of media src: "+uri);},getBitrate:function(){if(this.bandwidth){return this.bandwidth/1024;}return 0;},getSize:function(){if(this.sizebytes){return this.sizebytes;}return 0;},getTags:function(){return this.tags;},getAssetId:function(){return this.assetid;},getHeight:function(){if(this.height){return this.height;}return 0;}};})(mediaWiki,jQuery);;},{},{});mw.loader.implement("mw.PlayerElement",function($){(function(mw,$){"use strict";mw.PlayerElement=Class.extend({element:null,src:null,init:function(containerId,playerId){mw.log('PlayerElement::Error: function init should be implemented by playerElement interface ');},getElement:function(){return this.element;},play:function(){mw.log('PlayerElement::Error: function play should be implemented by playerElement interface ');},pause:function(){mw.log('PlayerElement::Error: function pause should be implemented by playerElement interface ');},seek:function(val){mw.log('PlayerElement::Error: function seek should be implemented by playerElement interface ');},load:function(){mw.log('PlayerElement::Error: function load should be implemented by playerElement interface ');},changeVolume:function(val){mw.log('PlayerElement::Error: function changeVolume should be implemented by playerElement interface ');}});})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mw.PlayerElementFlash",function($){(function(mw,$){"use strict";mw.PlayerElementFlash=mw.PlayerElement.extend({jsReadyFunName:'elementJsReadyFunc',playerElement:null,currentTime:0,duration:0,paused:true,muted:false,volume:1,id:null,readyState:0,disabled:false,listenerCounter:0,targetObj:null,initialized:false,detectFlashInterval:null,detectFlashIntervalLoops:3,flashDetected:false,init:function(containerId,playerId,elementFlashvars,target,readyCallback,failCallback){var _this=this;this.element=this;this.id=playerId;this.targetObj=target;var flashvars={};flashvars.jsCallBackReadyFunc=this.jsReadyFunName;flashvars.externalInterfaceDisabled="false";flashvars.disableOnScreenClick=true;if(mw.getConfig('debug',true)){flashvars.debugMode='true';}if(elementFlashvars){$.extend(flashvars,elementFlashvars);}var mwEmbedPath=mw.getMwEmbedPath();if(window.location.protocol){mwEmbedPath=window.location.protocol+mwEmbedPath.substring(mwEmbedPath.indexOf(":")+1);}var kdpPath=mwEmbedPath+'modules/EmbedPlayer/binPlayers/kaltura-player/kdp3.swf';if(mw.getConfig('forceNoKdpCache')){kdpPath+='?'+new Date().getTime();}if(mw.getConfig("ForceFlashOnDesktopSafari")){_this.detectFlashInterval=setInterval(function(){_this.detectFlash(failCallback);},500);}window[this.jsReadyFunName]=function(playerId){if(!_this.initialized){_this.initialized=true;_this.flashDetected=true;_this.cleanInterval(_this.detectFlashInterval);setTimeout(function(){_this.playerElement=$('#'+playerId)[0];if(!_this.targetObj){_this.targetObj=_this;var bindEventMap={'playerPaused':'onPause','playerPlayed':'onPlay','durationChange':'onDurationChange','playbackComplete':'onClipDone','playerUpdatePlayhead':'onUpdatePlayhead','playerSeekEnd':'onPlayerSeekEnd','alert':'onAlert','mute':'onMute','unmute':'onUnMute','volumeChanged':'onVolumeChanged','mediaError':'onMediaError'};$.each(bindEventMap,function(bindName,localMethod){_this.bindPlayerFunction(bindName,localMethod);});}_this.readyState=4;if($.isFunction(readyCallback)){readyCallback.apply(_this);}$(_this).trigger('playerJsReady');},0);}};var wmode="transparent";if(mw.getConfig("wmode")){wmode=mw.getConfig("wmode");}flashembed(containerId,{id:playerId,src:kdpPath,bgcolor:"#000000",allowNetworking:"all",version:[10,0],wmode:wmode},flashvars);return this;},detectFlash:function(failCallback){mw.log("PlayerElementFlash::detectFlash::detect loop "+this.detectFlashIntervalLoops);if(this.detectFlashIntervalLoops===0){if(!this.flashDetected){mw.log("PlayerElementFlash::detectFlash::failed to detecting Flash Player");failCallback();}this.cleanInterval(this.detectFlashInterval);}this.detectFlashIntervalLoops--;},cleanInterval:function(interval){clearInterval(interval);interval=null;},play:function(){this.sendNotification('doPlay');},pause:function(){this.sendNotification('doPause');},seek:function(val){this.sendNotification('doSeek',val);$(this).trigger('seeking');},load:function(){this.sendNotification('changeMedia',{'entryUrl':this.src});},changeVolume:function(volume){this.sendNotification('changeVolume',volume);},sendNotification:function(noteName,value){if(this.disabled){return false;}if(this.playerElement){this.playerElement.sendNotification(noteName,value);}else{$(this).bind('playerJsReady',function(){if(!this.disabled){this.playerElement.sendNotification(noteName,value);}});}},setKDPAttribute:function(obj,property,value){if(this.playerElement&&!this.disabled){this.playerElement.setKDPAttribute(obj,property,value);}},addJsListener:function(eventName,methodName){if(this.playerElement){this.bindPlayerFunction(eventName,methodName);}},removeJsListener:function(eventName,methodName){if(this.playerElement){mw.log('PlayerElementFlash:: unbindPlayerFunction:'+eventName);var gKdpCallbackName='kdp_'+methodName+'_cb_'+this.id.replace(/[^a-zA-Z 0-9]+/g,'');this.playerElement.removeJsListener(eventName,gKdpCallbackName);}},getCurrentTime:function(){if(this.playerElement){return this.playerElement.getCurrentTime();}return null;},getCurrentBufferLength:function(){if(this.playerElement){return this.playerElement.getCurrentBufferLength();}return null;},subscribe:function(callback,eventName,disregardEventCounter){if(this.playerElement){var methodName=!!disregardEventCounter?eventName:eventName+this.listenerCounter;this.listenerCounter++;this.targetObj[methodName]=callback;this.bindPlayerFunction(eventName,methodName);}},bindPlayerFunction:function(bindName,methodName,target){var _this=this;mw.log('PlayerElementFlash:: bindPlayerFunction:'+bindName);var gKdpCallbackName='kdp_'+methodName+'_cb_'+this.id.replace(/[^a-zA-Z 0-9]+/g,'');var createGlobalCB=function(cName){window[cName]=function(data){if(bindName!='playerUpdatePlayhead'&&bindName!='bytesDownloadedChange'){mw.log("PlayerElementFlash:: event: "+bindName);}_this.targetObj[methodName](data);};}(gKdpCallbackName,this);this.playerElement.removeJsListener(bindName,gKdpCallbackName);this.playerElement.addJsListener(bindName,gKdpCallbackName);},onUpdatePlayhead:function(playheadVal){this.currentTime=playheadVal;},onPause:function(){this.paused=true;},onPlay:function(){this.paused=false;$(this).trigger('playing');},onDurationChange:function(data,id){this.duration=data.newValue;$(this).trigger('loadedmetadata');},onClipDone:function(){$(this).trigger('ended');},onPlayerSeekEnd:function(){$(this).trigger('seeked');},onAlert:function(data,id){},onMute:function(){this.muted=true;},onUnMute:function(){this.muted=false;},onVolumeChanged:function(data){this.volume=data.newVolume;$(this).trigger('volumechange');},onMediaError:function(){$(this).trigger('error');},redrawObject:function(timeout){var _this=this;if(!timeout){timeout=250;}this.playerElement.style.width="99%";setTimeout(function(){_this.playerElement.style.width="100%";},timeout);}});})(window.mw,jQuery);(function(){function f(a,b){if(b)for(var c in b)if(b.hasOwnProperty(c))a[c]=b[c];return a}function l(a,b){var c=[];for(var d in a)if(a.hasOwnProperty(d))c[d]=b(a[d]);return c}function m(a,b,c){if(e.isSupported(b.version))a.innerHTML=e.getHTML(b,c);else if(b.expressInstall&&e.isSupported([6,65]))a.innerHTML=e.getHTML(f(b,{src:b.expressInstall}),{MMredirectURL:location.href,MMplayerType:"PlugIn",MMdoctitle:document.title});else{if(!a.innerHTML.replace(/\s/g,"")){a.innerHTML="<h2>Flash version "+b.version+" or greater is required</h2><h3>"+(g[0]>0?"Your version is "+g:"You have no flash plugin installed")+"</h3>"+(a.tagName=="A"?"<p>Click here to download latest version</p>":"<p>Download latest version from <a href='"+k+"'>here</a></p>");if(a.tagName=="A")a.onclick=function(){location.href=k}}if(b.onFail){var d=b.onFail.call(this);if(typeof d=="string")a.innerHTML=d}}if(i)window[b.id]=document.getElementById(b.id);f(this,{getRoot:function(){return a},getOptions:function(){return b},getConf:function(){return c},getApi:function(){return a.firstChild}})}var i=document.all,k="http://www.adobe.com/go/getflashplayer",n=typeof jQuery=="function",o=/(\d+)[^\d]+(\d+)[^\d]*(\d*)/,j={width:"100%",height:"100%",id:"_"+(""+Math.random()).slice(9),allowfullscreen:true,allowscriptaccess:"always",quality:"high",version:[3,0],onFail:null,expressInstall:null,w3c:false,cachebusting:false};window.attachEvent&&window.attachEvent("onbeforeunload",function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){}});window.flashembed=function(a,b,c){if(typeof a=="string")a=document.getElementById(a.replace("#",""));if(a){if(typeof b=="string")b={src:b};return new m(a,f(f({},j),b),c)}};var e=f(window.flashembed,{conf:j,getVersion:function(){var a,b;try{b=navigator.plugins["Shockwave Flash"].description.slice(16)}catch(c){try{b=(a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7"))&&a.GetVariable("$version")}catch(d){try{b=(a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6"))&&a.GetVariable("$version")}catch(h){}}}return(b=o.exec(b))?[b[1],b[3]]:[0,0]},asString:function(a){if(a===null||a===undefined)return null;var b=typeof a;if(b=="object"&&a.push)b="array";switch(b){case"string":a=a.replace(new RegExp('(["\\\\])',"g"),"\\$1");a=a.replace(/^\s?(\d+\.?\d+)%/,"$1pct");return'"'+a+'"';case"array":return"["+l(a,function(d){return e.asString(d)}).join(",")+"]";case"function":return'"function()"';case"object":b=[];for(var c in a)a.hasOwnProperty(c)&&b.push('"'+c+'":'+e.asString(a[c]));return"{"+b.join(",")+"}"}return String(a).replace(/\s/g," ").replace(/\'/g,'"')},getHTML:function(a,b){a=f({},a);var c='<object alt="video content" width="'+a.width+'" height="'+a.height+'" id="'+a.id+'" name="'+a.id+'"';if(a.cachebusting)a.src+=(a.src.indexOf("?")!=-1?"&":"?")+Math.random();c+=a.w3c||!i?' data="'+a.src+'" type="application/x-shockwave-flash"':' classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"';c+=">";if(a.w3c||i)c+='<param name="movie" value="'+a.src+'" />';a.width=a.height=a.id=a.w3c=a.src=null;a.onFail=a.version=a.expressInstall=null;for(var d in a)if(a[d])c+='<param name="'+d+'" value="'+a[d]+'" />';a="";if(b){for(var h in b)if(b[h]){d=b[h];a+=h+"="+(/function|object/.test(typeof d)?e.asString(d):d)+"&"}a=a.slice(0,-1);c+='<param name="flashvars" value=\''+a+"' />"}c+="</object>";return c},isSupported:function(a){return g[0]>a[0]||g[0]==a[0]&&g[1]>=a[1]}}),g=e.getVersion();if(n){jQuery.tools=jQuery.tools||{version:"1.2.5"};jQuery.tools.flashembed={conf:j};jQuery.fn.flashembed=function(a,b){return this.each(function(){$(this).data("flashembed",flashembed(this,a,b))})}}})();;},{},{});mw.loader.implement("mw.PlayerElementHTML",function($){(function(mw,$){"use strict";mw.PlayerElementHTML=mw.PlayerElement.extend({init:function(containerId,playerId){var $vidSibling=$('<video />').attr({'id':playerId}).css({'-webkit-transform-style':'preserve-3d','position':'relative','width':'100%','height':'100%'});$('#'+containerId).append($vidSibling);this.element=$vidSibling[0];return this;},play:function(){this.element.play();},pause:function(){mw.log('PlayerElement::Error: function pause should be implemented by playerElement interface ');},seek:function(val){mw.log('PlayerElement::Error: function seek should be implemented by playerElement interface ');},load:function(){this.element.src=this.src;this.element.load();},changeVolume:function(val){this.element.volume=val;}});})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mw.PluginManager",function($){(function(mw,$){if(mw.PluginManager)return;mw.PluginManager={registerdPlugins:{},totalPlugins:0,initialisedPlugins:0,define:function(pluginName,pluginClass){if(this.registerdPlugins[pluginName]){mw.log('PluginManager::register: Plugin "'+pluginName+'" already registered.');return;}this.registerdPlugins[pluginName]=pluginClass;var playerConfig=window.kalturaIframePackageData.playerConfig;if(playerConfig.plugins&&playerConfig.plugins[pluginName]&&playerConfig.plugins[pluginName].plugin===false){mw.log('PluginManager::register: Plugin "'+pluginName+'" is disabled, omitted from total plugin count.');}else{this.totalPlugins++;}},getClass:function(pluginName){if(!this.registerdPlugins[pluginName]){mw.log('PluginManager::getClass: Plugin "'+pluginName+'" not registered.');return false;}return this.registerdPlugins[pluginName];},make:function(pluginName,embedPlayer,callback){var pluginClass=this.getClass(pluginName);return(pluginClass)?new pluginClass(embedPlayer,callback,pluginName):false;},registerLoader:function(pluginName){if(!this.registerdPlugins[pluginName]){mw.log('PluginManager::init: Plugin "'+pluginName+'" not registered.');return;}var _this=this;mw.addKalturaPlugin(pluginName,function(embedPlayer,callback){if(embedPlayer.plugins[pluginName]){callback();return;}embedPlayer.plugins[pluginName]=_this.make(pluginName,embedPlayer,callback);_this.initialisedPlugins++;if(_this.totalPlugins===_this.initialisedPlugins){embedPlayer.triggerHelper('pluginsReady',embedPlayer.plugins);}});return this;},add:function(pluginName,pluginClass){this.define(pluginName,pluginClass);this.registerLoader(pluginName);}};})(mediaWiki,jQuery);;},{},{});mw.loader.implement("mw.VastAdParser",function($){(function(mw,$){"use strict";mw.VastAdParser={wrapperVideoClickTrackingUrl:undefined,videoClickTrackingUrl:undefined,parse:function(xmlObject,callback,wrapperData,originalAjaxOptions,adLoader){var _this=this;if(wrapperData==null){wrapperData=[];}var adConf={};var $vast=$(xmlObject);var addVideoClicksIfExist=function(){if($vast.find('VideoClicks ClickTracking').length>0){_this.wrapperVideoClickTrackingUrl=$vast.find('VideoClicks ClickTracking').text();}};if($vast.find('Wrapper').length&&$vast.find('VASTAdTagURI').length){wrapperData.push($vast);var adUrl=$vast.find('VASTAdTagURI').text();adUrl=adLoader.embedPlayer.evaluate(adUrl);addVideoClicksIfExist();mw.log('VastAdParser:: Found vast wrapper, load ad: '+adUrl);adLoader.load(adUrl,callback,true,wrapperData,originalAjaxOptions);return;}this.wrapperData=wrapperData;adConf.ads=[];$vast.find('Ad').each(function(inx,node){var $ad=$(node);var currentAd={'id':$ad.attr('id')};var sequence=$ad.attr('sequence');if(sequence!==undefined){currentAd.sequence=parseInt(sequence);}if($ad.find('duration')){currentAd.duration=mw.npt2seconds($ad.find('duration').text());}if($ad.find('AdSystem')){currentAd.adSystem=$ad.find('AdSystem').text();}if($ad.find('AdTitle')){currentAd.title=$ad.find('AdTitle').text();}if($ad.find('Description')){currentAd.description=$ad.find('Description').text();}currentAd.impressions=[];$ad.find('Impression').each(function(na,node){if($(node).find('URL').length){$ad.find('URL').each(function(na,urlNode){currentAd.impressions.push({'beaconUrl':_this.getURLFromNode(urlNode),'idtype':$(urlNode).attr('id')});});}else{currentAd.impressions.push({'beaconUrl':_this.getURLFromNode(node)});}});currentAd.nonLinear=[];$ad.find('NonLinearAds NonLinear').each(function(na,nonLinearNode){var staticResource=_this.getResourceObject(nonLinearNode);if(staticResource){currentAd.nonLinear.push(staticResource);}});currentAd.trackingEvents=[];var selector='trackingEvents Tracking';var $inlineLinear=$ad.find('InLine Linear');if($inlineLinear.length){selector='InLine Linear '+selector;currentAd.skipoffset=$inlineLinear.attr('skipoffset');}$ad.find(selector).each(function(na,trackingNode){currentAd.trackingEvents.push({'eventName':$(trackingNode).attr('event'),'beaconUrl':_this.getURLFromNode(trackingNode)});});if(_this.wrapperData.length>0){for(var i=0,iMax=_this.wrapperData.length;i<iMax;i++){var wrapperData=_this.wrapperData[i];var $impressionWrapper=$(wrapperData).contents().find('Wrapper Impression');if($impressionWrapper.length){$impressionWrapper.each(function(na,trackingNode){currentAd.impressions.unshift({'beaconUrl':$(trackingNode).text()});});}var $wrapperEvents=$(wrapperData).contents().find('Wrapper Creatives TrackingEvents Tracking');if($wrapperEvents.length){$wrapperEvents.each(function(na,trackingNode){currentAd.trackingEvents.push({'eventName':$(trackingNode).attr('event'),'beaconUrl':_this.getURLFromNode(trackingNode)});});}}}currentAd.videoFiles=[];$ad.find('MediaFiles MediaFile, StaticResource').each(function(na,mediaFile){var type=$(mediaFile).attr('type')?$(mediaFile).attr('type'):$(mediaFile).attr('creativeType');if(type=='video/x-mp4'||type=='video/mp4'){type='video/h264';}if(type=='video/h264'||type=='video/ogg'||type=='video/webm'||type=='video/x-flv'){var source={'src':_this.getURLFromNode(mediaFile),'type':type};if($(mediaFile).attr('bitrate')){source['data-bandwith']=$(mediaFile).attr('bitrate')*1024;}if($(mediaFile).attr('width')){source['data-width']=$(mediaFile).attr('width');}if($(mediaFile).attr('height')){source['data-height']=$(mediaFile).attr('height');}currentAd.videoFiles.push(source);mw.log("VastAdParser::add MediaFile:"+_this.getURLFromNode(mediaFile));}if($(mediaFile).attr('apiFramework')=='VPAID'||$(mediaFile).parent().attr('apiFramework')=='VPAID'){var vpaidAd={'src':$.trim($(mediaFile).text()),'type':type,'bitrate':$(mediaFile).attr('bitrate')*1024,'width':$(mediaFile).attr('width'),'height':$(mediaFile).attr('height')};if(!currentAd.vpaid){currentAd.vpaid={};}if(type.indexOf("javascript")!=-1){currentAd.vpaid.js=vpaidAd;}else if(type.indexOf("application/x-shockwave-flash")!=-1){currentAd.vpaid.flash=vpaidAd;}}});$ad.find('VideoClicks ClickThrough').each(function(na,clickThrough){currentAd.clickThrough=_this.getURLFromNode(clickThrough);});if($ad.find('AdParameters')){currentAd.adParameters=$ad.find('AdParameters').text();}if(currentAd.videoFiles.length==0&&!currentAd.vpaid){mw.log('Error:; VastAdParser::MISSING videoFile no video url: ( skip ) ');}currentAd.companions=[];$ad.find('CompanionAds Companion').each(function(na,companionNode){var staticResource=_this.getResourceObject(companionNode);if(staticResource){staticResource.trackingEvents=[];$(companionNode).find('trackingEvents Tracking').each(function(na,trackingNode){staticResource.trackingEvents.push({'eventName':$(trackingNode).attr('event'),'beaconUrl':_this.getURLFromNode(trackingNode)});});currentAd.companions.push(staticResource);}});currentAd.icons=[];$ad.find('Icons Icon').each(function(na,icon){var curIcon={};for(var i=0;i<icon.attributes.length;i++){curIcon[icon.attributes[i].name]=icon.attributes[i].value;}_this.setResourceType(icon,curIcon);curIcon.clickthru=_this.getURLFromNode($(icon).find('IconClicks IconClickThrough'));curIcon.clickTracking=_this.getURLFromNode($(icon).find('IconClicks IconClickTracking'));curIcon.viewTracking=_this.getURLFromNode($(icon).find('IconViewTracking'));curIcon.html=$('<div />').html(curIcon.$html).html();currentAd.icons.push(curIcon);});addVideoClicksIfExist();if((currentAd.videoFiles&&currentAd.videoFiles.length>0)||currentAd.vpaid||(currentAd.nonLinear&&currentAd.nonLinear.length>0)){adConf.ads.push(currentAd);}});adConf.videoClickTracking=[];if(_this.wrapperVideoClickTrackingUrl!=undefined){adConf.videoClickTracking.push(_this.wrapperVideoClickTrackingUrl);}if(_this.videoClickTrackingUrl!=undefined){adConf.videoClickTracking.push(_this.videoClickTrackingUrl);}adConf.wrapperData=wrapperData;callback(adConf);},getResourceObject:function(resourceNode){var _this=this;var resourceObj={};var companionAttr=['width','height','id','expandedWidth','expandedHeight','minSuggestedDuration'];$j.each(companionAttr,function(na,attr){if($(resourceNode).attr(attr)){resourceObj[attr]=$(resourceNode).attr(attr);}});if($(resourceNode).attr('creativeType')&&$(resourceNode).attr('resourceType')=='static'){var link=_this.getURLFromNode($(resourceNode).find('NonLinearClickThrough'));try{resourceObj.$html=$('<a />').attr({'href':link,'target':'_new'}).append($('<img/>').attr({'src':_this.getURLFromNode(resourceNode),'width':resourceObj['width'],'height':resourceObj['height']}));}catch(e){mw.log("Error in getResourceObject:"+e);}};_this.setResourceType(resourceNode,resourceObj);if(!resourceObj.$html){return false;}resourceObj.html=$('<div />').html(resourceObj.$html).html();return resourceObj;},setResourceType:function(resourceNode,resourceObj){var _this=this;if($(resourceNode).find('StaticResource').length){if($(resourceNode).find('StaticResource').attr('creativeType')){resourceObj.$html=_this.getStaticResourceHtml(resourceNode,resourceObj);mw.log("VastAdParser::getResourceObject: StaticResource \n"+$('<div />').append(resourceObj.$html).html());}}if($(resourceNode).find('IFrameResource').length){mw.log("VastAdParser::getResourceObject: IFrameResource \n"+_this.getURLFromNode($(resourceNode).find('IFrameResource')));resourceObj.$html=$('<iframe />').attr({'src':_this.getURLFromNode($(resourceNode).find('IFrameResource')),'width':resourceObj['width'],'height':resourceObj['height'],'border':'0px'});}if($(resourceNode).find('HTMLResource').length){mw.log("VastAdParser::getResourceObject:  HTMLResource \n"+_this.getURLFromNode($(resourceNode).find('HTMLResource')));resourceObj.$html=$(_this.getURLFromNode($(resourceNode).find('HTMLResource')));}},getStaticResourceHtml:function(companionNode,companionObj){try{var _this=this;companionObj['contentType']=$(companionNode).find('StaticResource').attr('creativeType');companionObj['resourceUri']=_this.getURLFromNode($(companionNode).find('StaticResource'));var $companionHtml=$('<div />');switch(companionObj['contentType']){case'image/gif':case'image/jpeg':case'image/png':var $img=$('<img />').attr({}).css({'width':companionObj['width']+'px','height':companionObj['height']+'px'});if($(companionNode).find('AltText').text()!=''){$img.attr('alt',_this.getURLFromNode($(companionNode).find('AltText')));}if($(companionNode).find('CompanionClickThrough,NonLinearClickThrough').text()!=''){$companionHtml=$('<a />').attr({'href':_this.getURLFromNode($(companionNode).find('CompanionClickThrough,NonLinearClickThrough')[0]),'target':'_new'}).append($img);}else{$companionHtml=$img;}if($(companionNode).find('NonLinearClickTracking').text()!=''){$companionHtml.attr("data-NonLinearClickTracking",$(companionNode).find('NonLinearClickTracking').text());}break;case'application/x-shockwave-flash':var flashObjectId=$(companionNode).attr('id')+'_flash';$companionHtml=$('<OBJECT />').attr({'classid':"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",'codebase':"http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0",'WIDTH':companionObj['width'],"HEIGHT":companionObj['height'],"id":flashObjectId}).append($('<PARAM />').attr({'NAME':'movie','VALUE':companionObj['resourceUri']}),$('<PARAM />').attr({'NAME':'quality','VALUE':'high'}),$('<PARAM />').attr({'NAME':'bgcolor','VALUE':'#FFFFFF'}),$('<EMBED />').attr({'src':companionObj['resourceUri'],'quality':'high','bgcolor':'#FFFFFF','WIDTH':companionObj['width'],'HEIGHT':companionObj['height'],'NAME':flashObjectId,'TYPE':"application/x-shockwave-flash",'PLUGINSPAGE':"http://www.macromedia.com/go/getflashplayer"}));break;}return $companionHtml;}catch(e){mw.log("Error in getStaticResourceHtml function:"+e);}},getURLFromNode:function(node){if($(node).find('URL').length){node=$(node).find('URL')[0];}var urlText=$.trim($(node).text());try{if(!/[<>`#%{}\s|\\^\~\[\]]/.test(decodeURIComponent(urlText))&&!mw.getConfig('disableVastDecodeURI')){urlText=decodeURIComponent(urlText)}}catch(e){mw.log("BastError url includes non-utf chars? ")}return urlText.replace(/^\<\!\-?\-?\[CDATA\[/,'').replace(/\]\]\-?\-?\>/,'');}};})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mw.ajaxProxy",function($){(function(mw,$){var ajaxProxy=function(options){if(!$.isFunction(options.success)){mw.log("mw.ajaxProxy :: Error: missing success callback.");return;}if(!options.url){mw.log("mw.ajaxProxy :: Error: missing url to proxy.");}if(options.ajaxOptions){options.enableCORS=options.ajaxOptions.enableCORS||false;}var defaults={error:function(){},proxyUrl:mw.getConfig('Mw.XmlProxyUrl'),proxyType:'jsonp',startWithProxy:false,timeout:mw.getConfig('Mw.AjaxTimeout',10000),enableCORS:false};this.options=$.extend({},defaults,options);this.ajax();};ajaxProxy.prototype={ajax:function(useProxy){var _this=this;if(_this.options.startWithProxy){_this.proxy();return;}var ajaxOptions={success:function(result){_this.handleResult(result);},timeout:_this.options.timeout,xhrFields:{withCredentials:_this.options.enableCORS}};if(useProxy){ajaxOptions.url=_this.options.proxyUrl+encodeURIComponent(_this.options.url);ajaxOptions.error=function(){mw.log("mw.ajaxProxy :: Error: request failed with proxy.");_this.options.error();};}else{ajaxOptions.url=_this.options.url;ajaxOptions.error=function(jqXHR,textStatus,errorThrown){mw.log("mw.ajaxProxy :: Error: cross domain request failed, trying with proxy");_this.proxy();};}try{$.ajax(ajaxOptions);}catch(e){}},proxy:function(){var _this=this;if(_this.options.proxyUrl){if(_this.options.proxyType=='jsonp'){$.ajax({url:_this.options.proxyUrl+'?url='+encodeURIComponent(_this.options.url)+'&callback=?',dataType:'json',success:function(result){_this.handleResult(result,true);},error:function(error){mw.log("mw.ajaxProxy :: Error: could not load:",error);_this.options.error();},timeout:_this.options.timeout});}else{_this.ajax(true);}}else{mw.log("mw.ajaxProxy :: Error: please setup proxy configuration");this.options.error();}},handleResult:function(result,isJsonP){var _this=this;if(isJsonP){if(result['http_code']=='ERROR'||result['http_code']==0){mw.log("mw.ajaxProxy :: Error: load error with http response");_this.options.error();return;}try{var resultXML=$.parseXML(result['contents']);if(resultXML){result=resultXML;}}catch(e){result=result['contents'];}_this.options.success(result);}else{_this.options.success(result);}}};mw.ajaxProxy=ajaxProxy;})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mw.MwEmbedSupport.style",function($){;},{"all":".modal_editor{ left:10px;top:10px;right:10px;bottom:10px;position:fixed;z-index:100}.displayHTML a:visited{color:white}.loadingSpinner{width:32px;height:32px;display:block;padding:0px;background-image:url(http://cdnapi.kaltura.com/html5/html5lib/v2.54/modules/MwEmbedSupport/skins/common/images/loading_ani.gif?2017-03-09T14:16:40Z)}.mw-imported-resource{border:thin solid black}.kaltura-icon{background-image:url(http://cdnapi.kaltura.com/html5/html5lib/v2.54/modules/MwEmbedSupport/skins/common/images/kaltura_logo_sm_transparent.png?2017-03-09T14:16:40Z) !important;background-repeat:no-repeat;display:block;height:12px;width:12px;margin-top:2px !important;margin-left:3px !important}.mw-fullscreen-overlay{background:rgb(0,0,0) none repeat scroll 0% 0%;position:fixed;top:0pt;left:0pt;width:100%;height:100%;-moz-background-clip:border;-moz-background-origin:padding;-moz-background-inline-policy:continuous} .play-btn-large{width:70px;height:53px;background :url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEYAAAA1CAYAAAD8mJ3rAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA+RJREFUeNrsm0tPGlEYhg/MIDcZLhqqqcYYY1GimJgYjRovcePadKm7rrvgX3TT/ozWhW5duLCJMerCaBSroASVaJRquBSQmeHS76vYWqmpF844g/MmLwmjQHj8bud4RkP+yAAeAb8BN5OXpRA4AP4KzuAFTfEHbrAX/Iq8bJ2BP4K/IZh68CewmagixYh5z8DDO7BL5fFbLNikhQePyqJEHgRjUjmU6FfEqPqHVDAqGBWMMsDU1tbqGhsb9Urs2VSk0+m0Xq/3dU9Pjw2fn5+fCzMzM5H5+fmoEsDggPcWXFXuN56amnIODQ3VFAoFgjYajUx3dzc3MDBgvbi4EE5OTgQZcxGpgZmcnKznOE53+7rFYmH7+/vtnZ2dZoDDA6TsiwIzPj5eYzabmeuIuW2Hw1E1MjLiaG5u1ofDYT6RSOTkBIZajcnlcgXwf3+vq6vL2tHRYVlZWYlNT09HYrFYtqJrzNjYmMNkMt0ZMTeN2x8NDQ3G4mu0oVAoI4pioSJTaXR01H5fMNfWgFpaWkzDw8N2eF44ODjg8/l8oaLAwJfDvz4LX4w81AzDaNva2qr7+vo4QRByR0dHfMWAgVZtxxb9GDDX1uv1DNYfaPMWrD1nZ2eC4sEMDg7aHppKdxm6G4szkMvlMiIcCQo0PTAwyNmeGjG3bbVadb29vTYo1FU4IKZSKVotnmq7JtlslkrhhMixtLa2Vm9sbCTm5ubOacxAVOcYAEMz3DUej8fqdrsty8vL0YWFhSjP83nZg8FoyWP8094e0Goxbe0wKHKzs7One3t7l7LediimkmQ2GAzMxMREHXQyrRJSSdLhjGVZbVNTkyEQCKRlCwazCOFIPbImk8ms7GuM1BFzfHx8Wa59HpoRc6/Vdbk+y+fzJRYXF2OK6EpSREwwGEwuLS3F4vF4WWcDqgMezZUxpE0G5xda6yeqxZdGxOB+8erqaiwcDmeodjil1BjsNmtrazEY4NJEAlEFU45UymQy+c3Nzfj29naqUNzuUzoY8pQVgSAI+d3d3R9bW1tJURTzRGLJLmLwNfv7+6n19fVEOReFcouYB4E5PDxMIxCoJ8/+rxRqYLAc3DeVIpEID0Di0HFEIhOxz/nh0WhURCCnp6c8kZmogYFukuM4jr2r9UJRTYRCoUsiU1EDs7Ozk3Q6nX8d/8BiCm034ff701K23scIz/l+IZTO+NbV1enb29urGYbRYLoAkNRztN5HKEUVjIKVUo+a3SEVjApGBVM2MGkVQ4nSCManciiRD8F8JsW7ulRd7XggEzztkAT7ydXtOS99nvkO/gAOam5cVO+JvHFP5E8BBgBjuVwnLBcrSQAAAABJRU5ErkJggg==);background :url(http://cdnapi.kaltura.com/html5/html5lib/v2.54/modules/MwEmbedSupport/skins/common/images/player_big_play_button.png?2017-03-09T14:16:40Z)!ie;position :absolute;cursor :pointer;border :none !important;z-index :1;left :50%;top :50%;margin-left:-35px;margin-top :-26px}.play-btn-large:hover{background :url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEYAAAA1CAYAAAD8mJ3rAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA9RJREFUeNrsm8tPGlEUxgcBQamNSavVKBoa05I2AWNaW2IlJDauXJkaE1cuumbByv/A1AVsjRtjorEujFEDC3ykvhZGWGgIAtKqUYrTgmjLAPLsuVZbqrUxOheGcr/km8WQ3MWPc+acc2cuj/otMVgDfgSWUfmlbbAL/AEcQTd4Zz88AevAD6j8Fg3Wg+0ITCXYAJZQRNRZxGj5cHkLfkx4/JIAXFwAFwVhcUkKBKaYcLik04gh+osIGAKGgMkNMDKZTFRfXy8hYM7nC7G4wGg0Kt1u92ur1arZ29vTaLXaqlwBgxq8N+BCthc2GAx1HR0dsmQySSFLJJLC1tbWiq6uroqDg4PQ5uZmiMNcYtgiRq1WlwOQ1EVDapUMDw83Li8vNzY3N9/Nu1QqAMXj8dRVViqV90wmU9PExIRSoVBI8gbMv6CkW6PRVM7NzTUNDg4+raqqKvzvwSQSidR14aDtj7a2turV1dXm3t7eutLSUkHeR0y6+aDu7u6HAOiVTqeTikSirPVZaD/mPY69mMXFRVVtbe2d26yBqld/f/8nSDNvhrkw2MDMz8+/rKmpYWXdnZ2doF6vd8PD2p/zYMxm8wu2wJxrY2PjsK+vz22xWII5Cwb+3edSqRRLGYYeiIYGcsflcoVzDszU1NSz6upqbP0JVL0klPkDBIim6RjbYLCVxVgslopGoymchQP1QCqVqnxycnJ/YGBgPxgMJthaHCsYKMFJ7MMen89rb2+XtrS0VEAP5IA0O+Y8GMwR84eKiooEPT098s7OTgvDMAnOgkENG4KTyeZDKBTyGxoaSpaWlo44DSYTqXRRfr8/yulUykbEOJ3OY7vdHiJg0gbWhYUFemhoyJMLVSmJjBuK1Wr1j4yMeGCuirK5Lu5nDLaIga7329jY2P7W1haW7hcnGApHKnk8ntD4+LhnfX39O85IFODMezYjJhAInExPT39eWVk5ojIgrGCQbz20MEx8dnbWOzMzc4g20zNV4TgbMScnJ0lo77+YzWZfOBxOUBkWNjDnr0tuAtRisfghbWg2h8KcTiWbzRZAQHw+X4zKsnBGzKmvo+3t7aDRaPTu7u5GKI4oq68pvF5v2GQyeR0OB0NxTNjAQDWJlZWVia8qvVBl6LW1tWOKo8IGBmYXP3p9wgOll14004ADmSy9NxG2PV8kuVwuUavV94VCIc/tdjMA5DASiSQo7ovBCiaHxZBPza4QAUPAEDCsgQkRDJcUQmBshMPlsQ2BGaXOTnURnQrtHY+iz1nRJxVO6ufxnHzvZ76C34E/8tJukjORaWcifwgwAL3bpBIa2UbLAAAAAElFTkSuQmCC);background :url(http://cdnapi.kaltura.com/html5/html5lib/v2.54/modules/MwEmbedSupport/skins/common/images/player_big_play_button_hover.png?2017-03-09T14:16:40Z)!ie}.carouselContainer{position :absolute;width :100%;z-index :2}.carouselVideoTitle{position :absolute;top :0px;left :0px;width :100%;background :rgba(0,0,0,0.8);color :white;font-size :small;font-weight :bold;z-index :2}.carouselVideoTitleText{display :block;padding :10px 10px 10px 20px}.carouselTitleDuration{position :absolute;top :0px;right :0px;padding :2px;background-color :#5A5A5A;color :#D9D9D9;font-size :smaller;z-index :2}.carouselImgTitle{position :absolute;width :100%;text-align :center;color :white;font-size :small;background :rgba(0,0,0,0.4)}.carouselImgDuration{position :absolute;top :2px;left :2px;background :rgba( 0,0,0,0.7 );color :white;padding :1px 6px;font-size :small}.carouselPrevButton,.carouselNextButton{display :block;position :absolute;bottom:23px}.carouselPrevButton{left :5px}.carouselNextButton{right:6px}.alert-container{-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;background-color:#e6e6e6;background-image:linear-gradient(bottom,rgb(215,215,215) 4%,rgb(230,230,230) 55%,rgb(255,255,255) 100%);background-image:-o-linear-gradient(bottom,rgb(215,215,215) 4%,rgb(230,230,230) 55%,rgb(255,255,255) 100%);background-image:-moz-linear-gradient(bottom,rgb(215,215,215) 4%,rgb(230,230,230) 55%,rgb(255,255,255) 100%);background-image:-webkit-linear-gradient(bottom,rgb(215,215,215) 4%,rgb(230,230,230) 55%,rgb(255,255,255) 100%);background-image:-ms-linear-gradient(bottom,rgb(215,215,215) 4%,rgb(230,230,230) 55%,rgb(255,255,255) 100%);background-image:-webkit-gradient(linear,left bottom,left top,color-stop(0.04,rgb(215,215,215)),color-stop(0.55,rgb(230,230,230)),color-stop(1,rgb(255,255,255)));margin:auto;position:absolute;top:0;left:0;right:0;bottom:0;max-width:80%;max-height:40%}.alert-container-with-buttons{max-height:44%}.ie8 .alert-container{top:50%;background-color:#e6e6e6}.alert-title{background-color :#E6E6E6;padding :5px;border-bottom :1px solid #D1D1D1;font-weight :normal !important;font-size:14px !important;-webkit-border-top-left-radius:3px;-moz-border-radius-topleft:3px;border-top-left-radius:3px;-webkit-border-top-right-radius:3px;-moz-border-radius-topright:3px;border-top-right-radius:3px }.alert-message{overflow:auto;max-height:inherit;padding :5px;font-weight :normal !important;text-align:center;font-size:14px !important;-webkit-text-size-adjust:none}.alert-buttons-container{text-align:center;padding-bottom:5px}.alert-button{background-color:#474747;color:white;-webkit-border-radius:.5em;-moz-border-radius:.5em;border-radius:.5em;padding:2px 10px;background-image:linear-gradient(bottom,rgb(25,25,25) 4%,rgb(47,47,47) 55%,rgb(71,71,71) 68%);background-image:-o-linear-gradient(bottom,rgb(25,25,25) 4%,rgb(47,47,47) 55%,rgb(71,71,71) 68%);background-image:-moz-linear-gradient(bottom,rgb(25,25,25) 4%,rgb(47,47,47) 55%,rgb(71,71,71) 68%);background-image:-webkit-linear-gradient(bottom,rgb(25,25,25) 4%,rgb(47,47,47) 55%,rgb(71,71,71) 68%);background-image:-ms-linear-gradient(bottom,rgb(25,25,25) 4%,rgb(47,47,47) 55%,rgb(71,71,71) 68%);background-image:-webkit-gradient( linear,left bottom,left top,color-stop(0.04,rgb(25,25,25)),color-stop(0.55,rgb(47,47,47)),color-stop(0.68,rgb(71,71,71)) )}.alert-text{color :black !important}\n\n/* cache key: resourceloader:filter:minify-css:7:5959a66970649905491f133788af92df */\n"},{});

/* cache key: resourceloader:filter:minify-js:7:9869fda6d96ce4e989c71b374dfe0e02 */
